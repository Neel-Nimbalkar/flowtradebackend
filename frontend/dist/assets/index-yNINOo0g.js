(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerPolicy&&(h.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?h.credentials="include":c.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function a(c){if(c.ep)return;c.ep=!0;const h=s(c);fetch(c.href,h)}})();function k1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var xh={exports:{}},Al={};var Ug;function C1(){if(Ug)return Al;Ug=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function s(a,c,h){var d=null;if(h!==void 0&&(d=""+h),c.key!==void 0&&(d=""+c.key),"key"in c){h={};for(var g in c)g!=="key"&&(h[g]=c[g])}else h=c;return c=h.ref,{$$typeof:i,type:a,key:d,ref:c!==void 0?c:null,props:h}}return Al.Fragment=e,Al.jsx=s,Al.jsxs=s,Al}var Vg;function M1(){return Vg||(Vg=1,xh.exports=C1()),xh.exports}var l=M1(),wh={exports:{}},Ue={};var Hg;function D1(){if(Hg)return Ue;Hg=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),h=Symbol.for("react.consumer"),d=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),b=Symbol.iterator;function S(M){return M===null||typeof M!="object"?null:(M=b&&M[b]||M["@@iterator"],typeof M=="function"?M:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,R={};function _(M,T,P){this.props=M,this.context=T,this.refs=R,this.updater=P||N}_.prototype.isReactComponent={},_.prototype.setState=function(M,T){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,T,"setState")},_.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function F(){}F.prototype=_.prototype;function H(M,T,P){this.props=M,this.context=T,this.refs=R,this.updater=P||N}var z=H.prototype=new F;z.constructor=H,E(z,_.prototype),z.isPureReactComponent=!0;var L=Array.isArray;function C(){}var j={H:null,A:null,T:null,S:null},K=Object.prototype.hasOwnProperty;function I(M,T,P){var B=P.ref;return{$$typeof:i,type:M,key:T,ref:B!==void 0?B:null,props:P}}function U(M,T){return I(M.type,T,M.props)}function Y(M){return typeof M=="object"&&M!==null&&M.$$typeof===i}function $(M){var T={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(P){return T[P]})}var Q=/\/+/g;function q(M,T){return typeof M=="object"&&M!==null&&M.key!=null?$(""+M.key):T.toString(36)}function ge(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(C,C):(M.status="pending",M.then(function(T){M.status==="pending"&&(M.status="fulfilled",M.value=T)},function(T){M.status==="pending"&&(M.status="rejected",M.reason=T)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function O(M,T,P,B,te){var de=typeof M;(de==="undefined"||de==="boolean")&&(M=null);var oe=!1;if(M===null)oe=!0;else switch(de){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(M.$$typeof){case i:case e:oe=!0;break;case x:return oe=M._init,O(oe(M._payload),T,P,B,te)}}if(oe)return te=te(M),oe=B===""?"."+q(M,0):B,L(te)?(P="",oe!=null&&(P=oe.replace(Q,"$&/")+"/"),O(te,T,P,"",function(Z){return Z})):te!=null&&(Y(te)&&(te=U(te,P+(te.key==null||M&&M.key===te.key?"":(""+te.key).replace(Q,"$&/")+"/")+oe)),T.push(te)),1;oe=0;var ue=B===""?".":B+":";if(L(M))for(var ee=0;ee<M.length;ee++)B=M[ee],de=ue+q(B,ee),oe+=O(B,T,P,de,te);else if(ee=S(M),typeof ee=="function")for(M=ee.call(M),ee=0;!(B=M.next()).done;)B=B.value,de=ue+q(B,ee++),oe+=O(B,T,P,de,te);else if(de==="object"){if(typeof M.then=="function")return O(ge(M),T,P,B,te);throw T=String(M),Error("Objects are not valid as a React child (found: "+(T==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":T)+"). If you meant to render a collection of children, use an array instead.")}return oe}function A(M,T,P){if(M==null)return M;var B=[],te=0;return O(M,B,"","",function(de){return T.call(P,de,te++)}),B}function W(M){if(M._status===-1){var T=M._result;T=T(),T.then(function(P){(M._status===0||M._status===-1)&&(M._status=1,M._result=P)},function(P){(M._status===0||M._status===-1)&&(M._status=2,M._result=P)}),M._status===-1&&(M._status=0,M._result=T)}if(M._status===1)return M._result.default;throw M._result}var ce=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var T=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(T))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},se={map:A,forEach:function(M,T,P){A(M,function(){T.apply(this,arguments)},P)},count:function(M){var T=0;return A(M,function(){T++}),T},toArray:function(M){return A(M,function(T){return T})||[]},only:function(M){if(!Y(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return Ue.Activity=y,Ue.Children=se,Ue.Component=_,Ue.Fragment=s,Ue.Profiler=c,Ue.PureComponent=H,Ue.StrictMode=a,Ue.Suspense=p,Ue.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,Ue.__COMPILER_RUNTIME={__proto__:null,c:function(M){return j.H.useMemoCache(M)}},Ue.cache=function(M){return function(){return M.apply(null,arguments)}},Ue.cacheSignal=function(){return null},Ue.cloneElement=function(M,T,P){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var B=E({},M.props),te=M.key;if(T!=null)for(de in T.key!==void 0&&(te=""+T.key),T)!K.call(T,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&T.ref===void 0||(B[de]=T[de]);var de=arguments.length-2;if(de===1)B.children=P;else if(1<de){for(var oe=Array(de),ue=0;ue<de;ue++)oe[ue]=arguments[ue+2];B.children=oe}return I(M.type,te,B)},Ue.createContext=function(M){return M={$$typeof:d,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:h,_context:M},M},Ue.createElement=function(M,T,P){var B,te={},de=null;if(T!=null)for(B in T.key!==void 0&&(de=""+T.key),T)K.call(T,B)&&B!=="key"&&B!=="__self"&&B!=="__source"&&(te[B]=T[B]);var oe=arguments.length-2;if(oe===1)te.children=P;else if(1<oe){for(var ue=Array(oe),ee=0;ee<oe;ee++)ue[ee]=arguments[ee+2];te.children=ue}if(M&&M.defaultProps)for(B in oe=M.defaultProps,oe)te[B]===void 0&&(te[B]=oe[B]);return I(M,de,te)},Ue.createRef=function(){return{current:null}},Ue.forwardRef=function(M){return{$$typeof:g,render:M}},Ue.isValidElement=Y,Ue.lazy=function(M){return{$$typeof:x,_payload:{_status:-1,_result:M},_init:W}},Ue.memo=function(M,T){return{$$typeof:v,type:M,compare:T===void 0?null:T}},Ue.startTransition=function(M){var T=j.T,P={};j.T=P;try{var B=M(),te=j.S;te!==null&&te(P,B),typeof B=="object"&&B!==null&&typeof B.then=="function"&&B.then(C,ce)}catch(de){ce(de)}finally{T!==null&&P.types!==null&&(T.types=P.types),j.T=T}},Ue.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},Ue.use=function(M){return j.H.use(M)},Ue.useActionState=function(M,T,P){return j.H.useActionState(M,T,P)},Ue.useCallback=function(M,T){return j.H.useCallback(M,T)},Ue.useContext=function(M){return j.H.useContext(M)},Ue.useDebugValue=function(){},Ue.useDeferredValue=function(M,T){return j.H.useDeferredValue(M,T)},Ue.useEffect=function(M,T){return j.H.useEffect(M,T)},Ue.useEffectEvent=function(M){return j.H.useEffectEvent(M)},Ue.useId=function(){return j.H.useId()},Ue.useImperativeHandle=function(M,T,P){return j.H.useImperativeHandle(M,T,P)},Ue.useInsertionEffect=function(M,T){return j.H.useInsertionEffect(M,T)},Ue.useLayoutEffect=function(M,T){return j.H.useLayoutEffect(M,T)},Ue.useMemo=function(M,T){return j.H.useMemo(M,T)},Ue.useOptimistic=function(M,T){return j.H.useOptimistic(M,T)},Ue.useReducer=function(M,T,P){return j.H.useReducer(M,T,P)},Ue.useRef=function(M){return j.H.useRef(M)},Ue.useState=function(M){return j.H.useState(M)},Ue.useSyncExternalStore=function(M,T,P){return j.H.useSyncExternalStore(M,T,P)},Ue.useTransition=function(){return j.H.useTransition()},Ue.version="19.2.3",Ue}var qg;function jd(){return qg||(qg=1,wh.exports=D1()),wh.exports}var D=jd();const Ql=k1(D);var Sh={exports:{}},Ll={},_h={exports:{}},jh={};var Fg;function R1(){return Fg||(Fg=1,(function(i){function e(O,A){var W=O.length;O.push(A);e:for(;0<W;){var ce=W-1>>>1,se=O[ce];if(0<c(se,A))O[ce]=A,O[W]=se,W=ce;else break e}}function s(O){return O.length===0?null:O[0]}function a(O){if(O.length===0)return null;var A=O[0],W=O.pop();if(W!==A){O[0]=W;e:for(var ce=0,se=O.length,M=se>>>1;ce<M;){var T=2*(ce+1)-1,P=O[T],B=T+1,te=O[B];if(0>c(P,W))B<se&&0>c(te,P)?(O[ce]=te,O[B]=W,ce=B):(O[ce]=P,O[T]=W,ce=T);else if(B<se&&0>c(te,W))O[ce]=te,O[B]=W,ce=B;else break e}}return A}function c(O,A){var W=O.sortIndex-A.sortIndex;return W!==0?W:O.id-A.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var h=performance;i.unstable_now=function(){return h.now()}}else{var d=Date,g=d.now();i.unstable_now=function(){return d.now()-g}}var p=[],v=[],x=1,y=null,b=3,S=!1,N=!1,E=!1,R=!1,_=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;function z(O){for(var A=s(v);A!==null;){if(A.callback===null)a(v);else if(A.startTime<=O)a(v),A.sortIndex=A.expirationTime,e(p,A);else break;A=s(v)}}function L(O){if(E=!1,z(O),!N)if(s(p)!==null)N=!0,C||(C=!0,$());else{var A=s(v);A!==null&&ge(L,A.startTime-O)}}var C=!1,j=-1,K=5,I=-1;function U(){return R?!0:!(i.unstable_now()-I<K)}function Y(){if(R=!1,C){var O=i.unstable_now();I=O;var A=!0;try{e:{N=!1,E&&(E=!1,F(j),j=-1),S=!0;var W=b;try{t:{for(z(O),y=s(p);y!==null&&!(y.expirationTime>O&&U());){var ce=y.callback;if(typeof ce=="function"){y.callback=null,b=y.priorityLevel;var se=ce(y.expirationTime<=O);if(O=i.unstable_now(),typeof se=="function"){y.callback=se,z(O),A=!0;break t}y===s(p)&&a(p),z(O)}else a(p);y=s(p)}if(y!==null)A=!0;else{var M=s(v);M!==null&&ge(L,M.startTime-O),A=!1}}break e}finally{y=null,b=W,S=!1}A=void 0}}finally{A?$():C=!1}}}var $;if(typeof H=="function")$=function(){H(Y)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,q=Q.port2;Q.port1.onmessage=Y,$=function(){q.postMessage(null)}}else $=function(){_(Y,0)};function ge(O,A){j=_(function(){O(i.unstable_now())},A)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(O){O.callback=null},i.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<O?Math.floor(1e3/O):5},i.unstable_getCurrentPriorityLevel=function(){return b},i.unstable_next=function(O){switch(b){case 1:case 2:case 3:var A=3;break;default:A=b}var W=b;b=A;try{return O()}finally{b=W}},i.unstable_requestPaint=function(){R=!0},i.unstable_runWithPriority=function(O,A){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var W=b;b=O;try{return A()}finally{b=W}},i.unstable_scheduleCallback=function(O,A,W){var ce=i.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ce+W:ce):W=ce,O){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=W+se,O={id:x++,callback:A,priorityLevel:O,startTime:W,expirationTime:se,sortIndex:-1},W>ce?(O.sortIndex=W,e(v,O),s(p)===null&&O===s(v)&&(E?(F(j),j=-1):E=!0,ge(L,W-ce))):(O.sortIndex=se,e(p,O),N||S||(N=!0,C||(C=!0,$()))),O},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(O){var A=b;return function(){var W=b;b=A;try{return O.apply(this,arguments)}finally{b=W}}}})(jh)),jh}var Wg;function A1(){return Wg||(Wg=1,_h.exports=R1()),_h.exports}var Nh={exports:{}},Gt={};var Gg;function L1(){if(Gg)return Gt;Gg=1;var i=jd();function e(p){var v="https://react.dev/errors/"+p;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)v+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(e(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},c=Symbol.for("react.portal");function h(p,v,x){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:y==null?null:""+y,children:p,containerInfo:v,implementation:x}}var d=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(p,v){if(p==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return Gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Gt.createPortal=function(p,v){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(e(299));return h(p,v,null,x)},Gt.flushSync=function(p){var v=d.T,x=a.p;try{if(d.T=null,a.p=2,p)return p()}finally{d.T=v,a.p=x,a.d.f()}},Gt.preconnect=function(p,v){typeof p=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,a.d.C(p,v))},Gt.prefetchDNS=function(p){typeof p=="string"&&a.d.D(p)},Gt.preinit=function(p,v){if(typeof p=="string"&&v&&typeof v.as=="string"){var x=v.as,y=g(x,v.crossOrigin),b=typeof v.integrity=="string"?v.integrity:void 0,S=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;x==="style"?a.d.S(p,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:S}):x==="script"&&a.d.X(p,{crossOrigin:y,integrity:b,fetchPriority:S,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},Gt.preinitModule=function(p,v){if(typeof p=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var x=g(v.as,v.crossOrigin);a.d.M(p,{crossOrigin:x,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&a.d.M(p)},Gt.preload=function(p,v){if(typeof p=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var x=v.as,y=g(x,v.crossOrigin);a.d.L(p,x,{crossOrigin:y,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},Gt.preloadModule=function(p,v){if(typeof p=="string")if(v){var x=g(v.as,v.crossOrigin);a.d.m(p,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:x,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else a.d.m(p)},Gt.requestFormReset=function(p){a.d.r(p)},Gt.unstable_batchedUpdates=function(p,v){return p(v)},Gt.useFormState=function(p,v,x){return d.H.useFormState(p,v,x)},Gt.useFormStatus=function(){return d.H.useHostTransitionStatus()},Gt.version="19.2.3",Gt}var Yg;function O1(){if(Yg)return Nh.exports;Yg=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Nh.exports=L1(),Nh.exports}var Kg;function z1(){if(Kg)return Ll;Kg=1;var i=A1(),e=jd(),s=O1();function a(t){var n="https://react.dev/errors/"+t;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function h(t){var n=t,o=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,(n.flags&4098)!==0&&(o=n.return),t=n.return;while(t)}return n.tag===3?o:null}function d(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function g(t){if(t.tag===31){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function p(t){if(h(t)!==t)throw Error(a(188))}function v(t){var n=t.alternate;if(!n){if(n=h(t),n===null)throw Error(a(188));return n!==t?null:t}for(var o=t,u=n;;){var f=o.return;if(f===null)break;var m=f.alternate;if(m===null){if(u=f.return,u!==null){o=u;continue}break}if(f.child===m.child){for(m=f.child;m;){if(m===o)return p(f),t;if(m===u)return p(f),n;m=m.sibling}throw Error(a(188))}if(o.return!==u.return)o=f,u=m;else{for(var w=!1,k=f.child;k;){if(k===o){w=!0,o=f,u=m;break}if(k===u){w=!0,u=f,o=m;break}k=k.sibling}if(!w){for(k=m.child;k;){if(k===o){w=!0,o=m,u=f;break}if(k===u){w=!0,u=m,o=f;break}k=k.sibling}if(!w)throw Error(a(189))}}if(o.alternate!==u)throw Error(a(190))}if(o.tag!==3)throw Error(a(188));return o.stateNode.current===o?t:n}function x(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t;for(t=t.child;t!==null;){if(n=x(t),n!==null)return n;t=t.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),F=Symbol.for("react.consumer"),H=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),Y=Symbol.iterator;function $(t){return t===null||typeof t!="object"?null:(t=Y&&t[Y]||t["@@iterator"],typeof t=="function"?t:null)}var Q=Symbol.for("react.client.reference");function q(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Q?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case E:return"Fragment";case _:return"Profiler";case R:return"StrictMode";case L:return"Suspense";case C:return"SuspenseList";case I:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case N:return"Portal";case H:return t.displayName||"Context";case F:return(t._context.displayName||"Context")+".Consumer";case z:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case j:return n=t.displayName||null,n!==null?n:q(t.type)||"Memo";case K:n=t._payload,t=t._init;try{return q(t(n))}catch{}}return null}var ge=Array.isArray,O=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ce=[],se=-1;function M(t){return{current:t}}function T(t){0>se||(t.current=ce[se],ce[se]=null,se--)}function P(t,n){se++,ce[se]=t.current,t.current=n}var B=M(null),te=M(null),de=M(null),oe=M(null);function ue(t,n){switch(P(de,n),P(te,t),P(B,null),n.nodeType){case 9:case 11:t=(t=n.documentElement)&&(t=t.namespaceURI)?ug(t):0;break;default:if(t=n.tagName,n=n.namespaceURI)n=ug(n),t=hg(n,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}T(B),P(B,t)}function ee(){T(B),T(te),T(de)}function Z(t){t.memoizedState!==null&&P(oe,t);var n=B.current,o=hg(n,t.type);n!==o&&(P(te,t),P(B,o))}function ye(t){te.current===t&&(T(B),T(te)),oe.current===t&&(T(oe),Cl._currentValue=W)}var we,Re;function Be(t){if(we===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);we=n&&n[1]||"",Re=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+we+t+Re}var Le=!1;function Ie(t,n){if(!t||Le)return"";Le=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(n){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(re){var ae=re}Reflect.construct(t,[],ve)}else{try{ve.call()}catch(re){ae=re}t.call(ve.prototype)}}else{try{throw Error()}catch(re){ae=re}(ve=t())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(re){if(re&&ae&&typeof re.stack=="string")return[re.stack,ae.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var f=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");f&&f.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=u.DetermineComponentFrameRoot(),w=m[0],k=m[1];if(w&&k){var V=w.split(`
`),ie=k.split(`
`);for(f=u=0;u<V.length&&!V[u].includes("DetermineComponentFrameRoot");)u++;for(;f<ie.length&&!ie[f].includes("DetermineComponentFrameRoot");)f++;if(u===V.length||f===ie.length)for(u=V.length-1,f=ie.length-1;1<=u&&0<=f&&V[u]!==ie[f];)f--;for(;1<=u&&0<=f;u--,f--)if(V[u]!==ie[f]){if(u!==1||f!==1)do if(u--,f--,0>f||V[u]!==ie[f]){var he=`
`+V[u].replace(" at new "," at ");return t.displayName&&he.includes("<anonymous>")&&(he=he.replace("<anonymous>",t.displayName)),he}while(1<=u&&0<=f);break}}}finally{Le=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?Be(o):""}function ut(t,n){switch(t.tag){case 26:case 27:case 5:return Be(t.type);case 16:return Be("Lazy");case 13:return t.child!==n&&n!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return Ie(t.type,!1);case 11:return Ie(t.type.render,!1);case 1:return Ie(t.type,!0);case 31:return Be("Activity");default:return""}}function Yt(t){try{var n="",o=null;do n+=ut(t,o),o=t,t=t.return;while(t);return n}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var Ot=Object.prototype.hasOwnProperty,jt=i.unstable_scheduleCallback,lt=i.unstable_cancelCallback,Ms=i.unstable_shouldYield,Xs=i.unstable_requestPaint,It=i.unstable_now,En=i.unstable_getCurrentPriorityLevel,yt=i.unstable_ImmediatePriority,Js=i.unstable_UserBlockingPriority,ke=i.unstable_NormalPriority,me=i.unstable_LowPriority,Se=i.unstable_IdlePriority,Ae=i.log,Ye=i.unstable_setDisableYieldValue,Me=null,Ce=null;function tt(t){if(typeof Ae=="function"&&Ye(t),Ce&&typeof Ce.setStrictMode=="function")try{Ce.setStrictMode(Me,t)}catch{}}var bt=Math.clz32?Math.clz32:$a,oi=Math.log,$t=Math.LN2;function $a(t){return t>>>=0,t===0?32:31-(oi(t)/$t|0)|0}var Qs=256,Ii=262144,Ua=4194304;function Zs(t){var n=t&42;if(n!==0)return n;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Va(t,n,o){var u=t.pendingLanes;if(u===0)return 0;var f=0,m=t.suspendedLanes,w=t.pingedLanes;t=t.warmLanes;var k=u&134217727;return k!==0?(u=k&~m,u!==0?f=Zs(u):(w&=k,w!==0?f=Zs(w):o||(o=k&~t,o!==0&&(f=Zs(o))))):(k=u&~m,k!==0?f=Zs(k):w!==0?f=Zs(w):o||(o=u&~t,o!==0&&(f=Zs(o)))),f===0?0:n!==0&&n!==f&&(n&m)===0&&(m=f&-f,o=n&-n,m>=o||m===32&&(o&4194048)!==0)?n:f}function Pi(t,n){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&n)===0}function ur(t,n){switch(t){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ha(){var t=Ua;return Ua<<=1,(Ua&62914560)===0&&(Ua=4194304),t}function X(t){for(var n=[],o=0;31>o;o++)n.push(t);return n}function le(t,n){t.pendingLanes|=n,n!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function fe(t,n,o,u,f,m){var w=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var k=t.entanglements,V=t.expirationTimes,ie=t.hiddenUpdates;for(o=w&~o;0<o;){var he=31-bt(o),ve=1<<he;k[he]=0,V[he]=-1;var ae=ie[he];if(ae!==null)for(ie[he]=null,he=0;he<ae.length;he++){var re=ae[he];re!==null&&(re.lane&=-536870913)}o&=~ve}u!==0&&xe(t,u,0),m!==0&&f===0&&t.tag!==0&&(t.suspendedLanes|=m&~(w&~n))}function xe(t,n,o){t.pendingLanes|=n,t.suspendedLanes&=~n;var u=31-bt(n);t.entangledLanes|=n,t.entanglements[u]=t.entanglements[u]|1073741824|o&261930}function je(t,n){var o=t.entangledLanes|=n;for(t=t.entanglements;o;){var u=31-bt(o),f=1<<u;f&n|t[u]&n&&(t[u]|=n),o&=~f}}function ze(t,n){var o=n&-n;return o=(o&42)!==0?1:He(o),(o&(t.suspendedLanes|n))!==0?0:o}function He(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function $e(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function _e(){var t=A.p;return t!==0?t:(t=window.event,t===void 0?32:Lg(t.type))}function Ve(t,n){var o=A.p;try{return A.p=t,n()}finally{A.p=o}}var ht=Math.random().toString(36).slice(2),Ne="__reactFiber$"+ht,Qe="__reactProps$"+ht,ls="__reactContainer$"+ht,Kt="__reactEvents$"+ht,Ut="__reactListeners$"+ht,Nt="__reactHandles$"+ht,Bi="__reactResources$"+ht,Ct="__reactMarker$"+ht;function qa(t){delete t[Ne],delete t[Qe],delete t[Kt],delete t[Ut],delete t[Nt]}function Tn(t){var n=t[Ne];if(n)return n;for(var o=t.parentNode;o;){if(n=o[ls]||o[Ne]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(t=yg(t);t!==null;){if(o=t[Ne])return o;t=yg(t)}return n}t=o,o=t.parentNode}return null}function mt(t){if(t=t[Ne]||t[ls]){var n=t.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return t}return null}function Fa(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t.stateNode;throw Error(a(33))}function $i(t){var n=t[Bi];return n||(n=t[Bi]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Pt(t){t[Ct]=!0}var Jd=new Set,Qd={};function ci(t,n){Ui(t,n),Ui(t+"Capture",n)}function Ui(t,n){for(Qd[t]=n,t=0;t<n.length;t++)Jd.add(n[t])}var bb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Zd={},ef={};function xb(t){return Ot.call(ef,t)?!0:Ot.call(Zd,t)?!1:bb.test(t)?ef[t]=!0:(Zd[t]=!0,!1)}function hr(t,n,o){if(xb(n))if(o===null)t.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(n);return;case"boolean":var u=n.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){t.removeAttribute(n);return}}t.setAttribute(n,""+o)}}function dr(t,n,o){if(o===null)t.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttribute(n,""+o)}}function en(t,n,o,u){if(u===null)t.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(n,o,""+u)}}function ps(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function tf(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function wb(t,n,o){var u=Object.getOwnPropertyDescriptor(t.constructor.prototype,n);if(!t.hasOwnProperty(n)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var f=u.get,m=u.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return f.call(this)},set:function(w){o=""+w,m.call(this,w)}}),Object.defineProperty(t,n,{enumerable:u.enumerable}),{getValue:function(){return o},setValue:function(w){o=""+w},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function fc(t){if(!t._valueTracker){var n=tf(t)?"checked":"value";t._valueTracker=wb(t,n,""+t[n])}}function sf(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var o=n.getValue(),u="";return t&&(u=tf(t)?t.checked?"true":"false":t.value),t=u,t!==o?(n.setValue(t),!0):!1}function fr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Sb=/[\n"\\]/g;function gs(t){return t.replace(Sb,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function mc(t,n,o,u,f,m,w,k){t.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?t.type=w:t.removeAttribute("type"),n!=null?w==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+ps(n)):t.value!==""+ps(n)&&(t.value=""+ps(n)):w!=="submit"&&w!=="reset"||t.removeAttribute("value"),n!=null?pc(t,w,ps(n)):o!=null?pc(t,w,ps(o)):u!=null&&t.removeAttribute("value"),f==null&&m!=null&&(t.defaultChecked=!!m),f!=null&&(t.checked=f&&typeof f!="function"&&typeof f!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?t.name=""+ps(k):t.removeAttribute("name")}function nf(t,n,o,u,f,m,w,k){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(t.type=m),n!=null||o!=null){if(!(m!=="submit"&&m!=="reset"||n!=null)){fc(t);return}o=o!=null?""+ps(o):"",n=n!=null?""+ps(n):o,k||n===t.value||(t.value=n),t.defaultValue=n}u=u??f,u=typeof u!="function"&&typeof u!="symbol"&&!!u,t.checked=k?t.checked:!!u,t.defaultChecked=!!u,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(t.name=w),fc(t)}function pc(t,n,o){n==="number"&&fr(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function Vi(t,n,o,u){if(t=t.options,n){n={};for(var f=0;f<o.length;f++)n["$"+o[f]]=!0;for(o=0;o<t.length;o++)f=n.hasOwnProperty("$"+t[o].value),t[o].selected!==f&&(t[o].selected=f),f&&u&&(t[o].defaultSelected=!0)}else{for(o=""+ps(o),n=null,f=0;f<t.length;f++){if(t[f].value===o){t[f].selected=!0,u&&(t[f].defaultSelected=!0);return}n!==null||t[f].disabled||(n=t[f])}n!==null&&(n.selected=!0)}}function af(t,n,o){if(n!=null&&(n=""+ps(n),n!==t.value&&(t.value=n),o==null)){t.defaultValue!==n&&(t.defaultValue=n);return}t.defaultValue=o!=null?""+ps(o):""}function lf(t,n,o,u){if(n==null){if(u!=null){if(o!=null)throw Error(a(92));if(ge(u)){if(1<u.length)throw Error(a(93));u=u[0]}o=u}o==null&&(o=""),n=o}o=ps(n),t.defaultValue=o,u=t.textContent,u===o&&u!==""&&u!==null&&(t.value=u),fc(t)}function Hi(t,n){if(n){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=n;return}}t.textContent=n}var _b=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function rf(t,n,o){var u=n.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?u?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="":u?t.setProperty(n,o):typeof o!="number"||o===0||_b.has(n)?n==="float"?t.cssFloat=o:t[n]=(""+o).trim():t[n]=o+"px"}function of(t,n,o){if(n!=null&&typeof n!="object")throw Error(a(62));if(t=t.style,o!=null){for(var u in o)!o.hasOwnProperty(u)||n!=null&&n.hasOwnProperty(u)||(u.indexOf("--")===0?t.setProperty(u,""):u==="float"?t.cssFloat="":t[u]="");for(var f in n)u=n[f],n.hasOwnProperty(f)&&o[f]!==u&&rf(t,f,u)}else for(var m in n)n.hasOwnProperty(m)&&rf(t,m,n[m])}function gc(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Nb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mr(t){return Nb.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function tn(){}var vc=null;function yc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var qi=null,Fi=null;function cf(t){var n=mt(t);if(n&&(t=n.stateNode)){var o=t[Qe]||null;e:switch(t=n.stateNode,n.type){case"input":if(mc(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),n=o.name,o.type==="radio"&&n!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+gs(""+n)+'"][type="radio"]'),n=0;n<o.length;n++){var u=o[n];if(u!==t&&u.form===t.form){var f=u[Qe]||null;if(!f)throw Error(a(90));mc(u,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name)}}for(n=0;n<o.length;n++)u=o[n],u.form===t.form&&sf(u)}break e;case"textarea":af(t,o.value,o.defaultValue);break e;case"select":n=o.value,n!=null&&Vi(t,!!o.multiple,n,!1)}}}var bc=!1;function uf(t,n,o){if(bc)return t(n,o);bc=!0;try{var u=t(n);return u}finally{if(bc=!1,(qi!==null||Fi!==null)&&(to(),qi&&(n=qi,t=Fi,Fi=qi=null,cf(n),t)))for(n=0;n<t.length;n++)cf(t[n])}}function Wa(t,n){var o=t.stateNode;if(o===null)return null;var u=o[Qe]||null;if(u===null)return null;o=u[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(t=t.type,u=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!u;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(a(231,n,typeof o));return o}var sn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xc=!1;if(sn)try{var Ga={};Object.defineProperty(Ga,"passive",{get:function(){xc=!0}}),window.addEventListener("test",Ga,Ga),window.removeEventListener("test",Ga,Ga)}catch{xc=!1}var kn=null,wc=null,pr=null;function hf(){if(pr)return pr;var t,n=wc,o=n.length,u,f="value"in kn?kn.value:kn.textContent,m=f.length;for(t=0;t<o&&n[t]===f[t];t++);var w=o-t;for(u=1;u<=w&&n[o-u]===f[m-u];u++);return pr=f.slice(t,1<u?1-u:void 0)}function gr(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function vr(){return!0}function df(){return!1}function Zt(t){function n(o,u,f,m,w){this._reactName=o,this._targetInst=f,this.type=u,this.nativeEvent=m,this.target=w,this.currentTarget=null;for(var k in t)t.hasOwnProperty(k)&&(o=t[k],this[k]=o?o(m):m[k]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?vr:df,this.isPropagationStopped=df,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=vr)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=vr)},persist:function(){},isPersistent:vr}),n}var ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yr=Zt(ui),Ya=y({},ui,{view:0,detail:0}),Eb=Zt(Ya),Sc,_c,Ka,br=y({},Ya,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ka&&(Ka&&t.type==="mousemove"?(Sc=t.screenX-Ka.screenX,_c=t.screenY-Ka.screenY):_c=Sc=0,Ka=t),Sc)},movementY:function(t){return"movementY"in t?t.movementY:_c}}),ff=Zt(br),Tb=y({},br,{dataTransfer:0}),kb=Zt(Tb),Cb=y({},Ya,{relatedTarget:0}),jc=Zt(Cb),Mb=y({},ui,{animationName:0,elapsedTime:0,pseudoElement:0}),Db=Zt(Mb),Rb=y({},ui,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ab=Zt(Rb),Lb=y({},ui,{data:0}),mf=Zt(Lb),Ob={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ib={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pb(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=Ib[t])?!!n[t]:!1}function Nc(){return Pb}var Bb=y({},Ya,{key:function(t){if(t.key){var n=Ob[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=gr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?zb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nc,charCode:function(t){return t.type==="keypress"?gr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?gr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),$b=Zt(Bb),Ub=y({},br,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pf=Zt(Ub),Vb=y({},Ya,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nc}),Hb=Zt(Vb),qb=y({},ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fb=Zt(qb),Wb=y({},br,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gb=Zt(Wb),Yb=y({},ui,{newState:0,oldState:0}),Kb=Zt(Yb),Xb=[9,13,27,32],Ec=sn&&"CompositionEvent"in window,Xa=null;sn&&"documentMode"in document&&(Xa=document.documentMode);var Jb=sn&&"TextEvent"in window&&!Xa,gf=sn&&(!Ec||Xa&&8<Xa&&11>=Xa),vf=" ",yf=!1;function bf(t,n){switch(t){case"keyup":return Xb.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wi=!1;function Qb(t,n){switch(t){case"compositionend":return xf(n);case"keypress":return n.which!==32?null:(yf=!0,vf);case"textInput":return t=n.data,t===vf&&yf?null:t;default:return null}}function Zb(t,n){if(Wi)return t==="compositionend"||!Ec&&bf(t,n)?(t=hf(),pr=wc=kn=null,Wi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return gf&&n.locale!=="ko"?null:n.data;default:return null}}var ex={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wf(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!ex[t.type]:n==="textarea"}function Sf(t,n,o,u){qi?Fi?Fi.push(u):Fi=[u]:qi=u,n=oo(n,"onChange"),0<n.length&&(o=new yr("onChange","change",null,o,u),t.push({event:o,listeners:n}))}var Ja=null,Qa=null;function tx(t){ig(t,0)}function xr(t){var n=Fa(t);if(sf(n))return t}function _f(t,n){if(t==="change")return n}var jf=!1;if(sn){var Tc;if(sn){var kc="oninput"in document;if(!kc){var Nf=document.createElement("div");Nf.setAttribute("oninput","return;"),kc=typeof Nf.oninput=="function"}Tc=kc}else Tc=!1;jf=Tc&&(!document.documentMode||9<document.documentMode)}function Ef(){Ja&&(Ja.detachEvent("onpropertychange",Tf),Qa=Ja=null)}function Tf(t){if(t.propertyName==="value"&&xr(Qa)){var n=[];Sf(n,Qa,t,yc(t)),uf(tx,n)}}function sx(t,n,o){t==="focusin"?(Ef(),Ja=n,Qa=o,Ja.attachEvent("onpropertychange",Tf)):t==="focusout"&&Ef()}function nx(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return xr(Qa)}function ix(t,n){if(t==="click")return xr(n)}function ax(t,n){if(t==="input"||t==="change")return xr(n)}function lx(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var rs=typeof Object.is=="function"?Object.is:lx;function Za(t,n){if(rs(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var o=Object.keys(t),u=Object.keys(n);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var f=o[u];if(!Ot.call(n,f)||!rs(t[f],n[f]))return!1}return!0}function kf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Cf(t,n){var o=kf(t);t=0;for(var u;o;){if(o.nodeType===3){if(u=t+o.textContent.length,t<=n&&u>=n)return{node:o,offset:n-t};t=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=kf(o)}}function Mf(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?Mf(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function Df(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var n=fr(t.document);n instanceof t.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)t=n.contentWindow;else break;n=fr(t.document)}return n}function Cc(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}var rx=sn&&"documentMode"in document&&11>=document.documentMode,Gi=null,Mc=null,el=null,Dc=!1;function Rf(t,n,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Dc||Gi==null||Gi!==fr(u)||(u=Gi,"selectionStart"in u&&Cc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),el&&Za(el,u)||(el=u,u=oo(Mc,"onSelect"),0<u.length&&(n=new yr("onSelect","select",null,n,o),t.push({event:n,listeners:u}),n.target=Gi)))}function hi(t,n){var o={};return o[t.toLowerCase()]=n.toLowerCase(),o["Webkit"+t]="webkit"+n,o["Moz"+t]="moz"+n,o}var Yi={animationend:hi("Animation","AnimationEnd"),animationiteration:hi("Animation","AnimationIteration"),animationstart:hi("Animation","AnimationStart"),transitionrun:hi("Transition","TransitionRun"),transitionstart:hi("Transition","TransitionStart"),transitioncancel:hi("Transition","TransitionCancel"),transitionend:hi("Transition","TransitionEnd")},Rc={},Af={};sn&&(Af=document.createElement("div").style,"AnimationEvent"in window||(delete Yi.animationend.animation,delete Yi.animationiteration.animation,delete Yi.animationstart.animation),"TransitionEvent"in window||delete Yi.transitionend.transition);function di(t){if(Rc[t])return Rc[t];if(!Yi[t])return t;var n=Yi[t],o;for(o in n)if(n.hasOwnProperty(o)&&o in Af)return Rc[t]=n[o];return t}var Lf=di("animationend"),Of=di("animationiteration"),zf=di("animationstart"),ox=di("transitionrun"),cx=di("transitionstart"),ux=di("transitioncancel"),If=di("transitionend"),Pf=new Map,Ac="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ac.push("scrollEnd");function Ds(t,n){Pf.set(t,n),ci(n,[t])}var wr=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},vs=[],Ki=0,Lc=0;function Sr(){for(var t=Ki,n=Lc=Ki=0;n<t;){var o=vs[n];vs[n++]=null;var u=vs[n];vs[n++]=null;var f=vs[n];vs[n++]=null;var m=vs[n];if(vs[n++]=null,u!==null&&f!==null){var w=u.pending;w===null?f.next=f:(f.next=w.next,w.next=f),u.pending=f}m!==0&&Bf(o,f,m)}}function _r(t,n,o,u){vs[Ki++]=t,vs[Ki++]=n,vs[Ki++]=o,vs[Ki++]=u,Lc|=u,t.lanes|=u,t=t.alternate,t!==null&&(t.lanes|=u)}function Oc(t,n,o,u){return _r(t,n,o,u),jr(t)}function fi(t,n){return _r(t,null,null,n),jr(t)}function Bf(t,n,o){t.lanes|=o;var u=t.alternate;u!==null&&(u.lanes|=o);for(var f=!1,m=t.return;m!==null;)m.childLanes|=o,u=m.alternate,u!==null&&(u.childLanes|=o),m.tag===22&&(t=m.stateNode,t===null||t._visibility&1||(f=!0)),t=m,m=m.return;return t.tag===3?(m=t.stateNode,f&&n!==null&&(f=31-bt(o),t=m.hiddenUpdates,u=t[f],u===null?t[f]=[n]:u.push(n),n.lane=o|536870912),m):null}function jr(t){if(50<Sl)throw Sl=0,qu=null,Error(a(185));for(var n=t.return;n!==null;)t=n,n=t.return;return t.tag===3?t.stateNode:null}var Xi={};function hx(t,n,o,u){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function os(t,n,o,u){return new hx(t,n,o,u)}function zc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function nn(t,n){var o=t.alternate;return o===null?(o=os(t.tag,n,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=n,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,n=t.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function $f(t,n){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=n,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,n=o.dependencies,t.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t}function Nr(t,n,o,u,f,m){var w=0;if(u=t,typeof t=="function")zc(t)&&(w=1);else if(typeof t=="string")w=g1(t,o,B.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case I:return t=os(31,o,n,f),t.elementType=I,t.lanes=m,t;case E:return mi(o.children,f,m,n);case R:w=8,f|=24;break;case _:return t=os(12,o,n,f|2),t.elementType=_,t.lanes=m,t;case L:return t=os(13,o,n,f),t.elementType=L,t.lanes=m,t;case C:return t=os(19,o,n,f),t.elementType=C,t.lanes=m,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case H:w=10;break e;case F:w=9;break e;case z:w=11;break e;case j:w=14;break e;case K:w=16,u=null;break e}w=29,o=Error(a(130,t===null?"null":typeof t,"")),u=null}return n=os(w,o,n,f),n.elementType=t,n.type=u,n.lanes=m,n}function mi(t,n,o,u){return t=os(7,t,u,n),t.lanes=o,t}function Ic(t,n,o){return t=os(6,t,null,n),t.lanes=o,t}function Uf(t){var n=os(18,null,null,0);return n.stateNode=t,n}function Pc(t,n,o){return n=os(4,t.children!==null?t.children:[],t.key,n),n.lanes=o,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}var Vf=new WeakMap;function ys(t,n){if(typeof t=="object"&&t!==null){var o=Vf.get(t);return o!==void 0?o:(n={value:t,source:n,stack:Yt(n)},Vf.set(t,n),n)}return{value:t,source:n,stack:Yt(n)}}var Ji=[],Qi=0,Er=null,tl=0,bs=[],xs=0,Cn=null,Bs=1,$s="";function an(t,n){Ji[Qi++]=tl,Ji[Qi++]=Er,Er=t,tl=n}function Hf(t,n,o){bs[xs++]=Bs,bs[xs++]=$s,bs[xs++]=Cn,Cn=t;var u=Bs;t=$s;var f=32-bt(u)-1;u&=~(1<<f),o+=1;var m=32-bt(n)+f;if(30<m){var w=f-f%5;m=(u&(1<<w)-1).toString(32),u>>=w,f-=w,Bs=1<<32-bt(n)+f|o<<f|u,$s=m+t}else Bs=1<<m|o<<f|u,$s=t}function Bc(t){t.return!==null&&(an(t,1),Hf(t,1,0))}function $c(t){for(;t===Er;)Er=Ji[--Qi],Ji[Qi]=null,tl=Ji[--Qi],Ji[Qi]=null;for(;t===Cn;)Cn=bs[--xs],bs[xs]=null,$s=bs[--xs],bs[xs]=null,Bs=bs[--xs],bs[xs]=null}function qf(t,n){bs[xs++]=Bs,bs[xs++]=$s,bs[xs++]=Cn,Bs=n.id,$s=n.overflow,Cn=t}var Vt=null,pt=null,Je=!1,Mn=null,ws=!1,Uc=Error(a(519));function Dn(t){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw sl(ys(n,t)),Uc}function Ff(t){var n=t.stateNode,o=t.type,u=t.memoizedProps;switch(n[Ne]=t,n[Qe]=u,o){case"dialog":Ge("cancel",n),Ge("close",n);break;case"iframe":case"object":case"embed":Ge("load",n);break;case"video":case"audio":for(o=0;o<jl.length;o++)Ge(jl[o],n);break;case"source":Ge("error",n);break;case"img":case"image":case"link":Ge("error",n),Ge("load",n);break;case"details":Ge("toggle",n);break;case"input":Ge("invalid",n),nf(n,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Ge("invalid",n);break;case"textarea":Ge("invalid",n),lf(n,u.value,u.defaultValue,u.children)}o=u.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||n.textContent===""+o||u.suppressHydrationWarning===!0||og(n.textContent,o)?(u.popover!=null&&(Ge("beforetoggle",n),Ge("toggle",n)),u.onScroll!=null&&Ge("scroll",n),u.onScrollEnd!=null&&Ge("scrollend",n),u.onClick!=null&&(n.onclick=tn),n=!0):n=!1,n||Dn(t,!0)}function Wf(t){for(Vt=t.return;Vt;)switch(Vt.tag){case 5:case 31:case 13:ws=!1;return;case 27:case 3:ws=!0;return;default:Vt=Vt.return}}function Zi(t){if(t!==Vt)return!1;if(!Je)return Wf(t),Je=!0,!1;var n=t.tag,o;if((o=n!==3&&n!==27)&&((o=n===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||ah(t.type,t.memoizedProps)),o=!o),o&&pt&&Dn(t),Wf(t),n===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));pt=vg(t)}else if(n===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));pt=vg(t)}else n===27?(n=pt,Fn(t.type)?(t=uh,uh=null,pt=t):pt=n):pt=Vt?_s(t.stateNode.nextSibling):null;return!0}function pi(){pt=Vt=null,Je=!1}function Vc(){var t=Mn;return t!==null&&(ns===null?ns=t:ns.push.apply(ns,t),Mn=null),t}function sl(t){Mn===null?Mn=[t]:Mn.push(t)}var Hc=M(null),gi=null,ln=null;function Rn(t,n,o){P(Hc,n._currentValue),n._currentValue=o}function rn(t){t._currentValue=Hc.current,T(Hc)}function qc(t,n,o){for(;t!==null;){var u=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,u!==null&&(u.childLanes|=n)):u!==null&&(u.childLanes&n)!==n&&(u.childLanes|=n),t===o)break;t=t.return}}function Fc(t,n,o,u){var f=t.child;for(f!==null&&(f.return=t);f!==null;){var m=f.dependencies;if(m!==null){var w=f.child;m=m.firstContext;e:for(;m!==null;){var k=m;m=f;for(var V=0;V<n.length;V++)if(k.context===n[V]){m.lanes|=o,k=m.alternate,k!==null&&(k.lanes|=o),qc(m.return,o,t),u||(w=null);break e}m=k.next}}else if(f.tag===18){if(w=f.return,w===null)throw Error(a(341));w.lanes|=o,m=w.alternate,m!==null&&(m.lanes|=o),qc(w,o,t),w=null}else w=f.child;if(w!==null)w.return=f;else for(w=f;w!==null;){if(w===t){w=null;break}if(f=w.sibling,f!==null){f.return=w.return,w=f;break}w=w.return}f=w}}function ea(t,n,o,u){t=null;for(var f=n,m=!1;f!==null;){if(!m){if((f.flags&524288)!==0)m=!0;else if((f.flags&262144)!==0)break}if(f.tag===10){var w=f.alternate;if(w===null)throw Error(a(387));if(w=w.memoizedProps,w!==null){var k=f.type;rs(f.pendingProps.value,w.value)||(t!==null?t.push(k):t=[k])}}else if(f===oe.current){if(w=f.alternate,w===null)throw Error(a(387));w.memoizedState.memoizedState!==f.memoizedState.memoizedState&&(t!==null?t.push(Cl):t=[Cl])}f=f.return}t!==null&&Fc(n,t,o,u),n.flags|=262144}function Tr(t){for(t=t.firstContext;t!==null;){if(!rs(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function vi(t){gi=t,ln=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Ht(t){return Gf(gi,t)}function kr(t,n){return gi===null&&vi(t),Gf(t,n)}function Gf(t,n){var o=n._currentValue;if(n={context:n,memoizedValue:o,next:null},ln===null){if(t===null)throw Error(a(308));ln=n,t.dependencies={lanes:0,firstContext:n},t.flags|=524288}else ln=ln.next=n;return o}var dx=typeof AbortController<"u"?AbortController:function(){var t=[],n=this.signal={aborted:!1,addEventListener:function(o,u){t.push(u)}};this.abort=function(){n.aborted=!0,t.forEach(function(o){return o()})}},fx=i.unstable_scheduleCallback,mx=i.unstable_NormalPriority,Mt={$$typeof:H,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wc(){return{controller:new dx,data:new Map,refCount:0}}function nl(t){t.refCount--,t.refCount===0&&fx(mx,function(){t.controller.abort()})}var il=null,Gc=0,ta=0,sa=null;function px(t,n){if(il===null){var o=il=[];Gc=0,ta=Xu(),sa={status:"pending",value:void 0,then:function(u){o.push(u)}}}return Gc++,n.then(Yf,Yf),n}function Yf(){if(--Gc===0&&il!==null){sa!==null&&(sa.status="fulfilled");var t=il;il=null,ta=0,sa=null;for(var n=0;n<t.length;n++)(0,t[n])()}}function gx(t,n){var o=[],u={status:"pending",value:null,reason:null,then:function(f){o.push(f)}};return t.then(function(){u.status="fulfilled",u.value=n;for(var f=0;f<o.length;f++)(0,o[f])(n)},function(f){for(u.status="rejected",u.reason=f,f=0;f<o.length;f++)(0,o[f])(void 0)}),u}var Kf=O.S;O.S=function(t,n){Rp=It(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&px(t,n),Kf!==null&&Kf(t,n)};var yi=M(null);function Yc(){var t=yi.current;return t!==null?t:dt.pooledCache}function Cr(t,n){n===null?P(yi,yi.current):P(yi,n.pool)}function Xf(){var t=Yc();return t===null?null:{parent:Mt._currentValue,pool:t}}var na=Error(a(460)),Kc=Error(a(474)),Mr=Error(a(542)),Dr={then:function(){}};function Jf(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Qf(t,n,o){switch(o=t[o],o===void 0?t.push(n):o!==n&&(n.then(tn,tn),n=o),n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,em(t),t;default:if(typeof n.status=="string")n.then(tn,tn);else{if(t=dt,t!==null&&100<t.shellSuspendCounter)throw Error(a(482));t=n,t.status="pending",t.then(function(u){if(n.status==="pending"){var f=n;f.status="fulfilled",f.value=u}},function(u){if(n.status==="pending"){var f=n;f.status="rejected",f.reason=u}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,em(t),t}throw xi=n,na}}function bi(t){try{var n=t._init;return n(t._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(xi=o,na):o}}var xi=null;function Zf(){if(xi===null)throw Error(a(459));var t=xi;return xi=null,t}function em(t){if(t===na||t===Mr)throw Error(a(483))}var ia=null,al=0;function Rr(t){var n=al;return al+=1,ia===null&&(ia=[]),Qf(ia,t,n)}function ll(t,n){n=n.props.ref,t.ref=n!==void 0?n:null}function Ar(t,n){throw n.$$typeof===b?Error(a(525)):(t=Object.prototype.toString.call(n),Error(a(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t)))}function tm(t){function n(J,G){if(t){var ne=J.deletions;ne===null?(J.deletions=[G],J.flags|=16):ne.push(G)}}function o(J,G){if(!t)return null;for(;G!==null;)n(J,G),G=G.sibling;return null}function u(J){for(var G=new Map;J!==null;)J.key!==null?G.set(J.key,J):G.set(J.index,J),J=J.sibling;return G}function f(J,G){return J=nn(J,G),J.index=0,J.sibling=null,J}function m(J,G,ne){return J.index=ne,t?(ne=J.alternate,ne!==null?(ne=ne.index,ne<G?(J.flags|=67108866,G):ne):(J.flags|=67108866,G)):(J.flags|=1048576,G)}function w(J){return t&&J.alternate===null&&(J.flags|=67108866),J}function k(J,G,ne,pe){return G===null||G.tag!==6?(G=Ic(ne,J.mode,pe),G.return=J,G):(G=f(G,ne),G.return=J,G)}function V(J,G,ne,pe){var De=ne.type;return De===E?he(J,G,ne.props.children,pe,ne.key):G!==null&&(G.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===K&&bi(De)===G.type)?(G=f(G,ne.props),ll(G,ne),G.return=J,G):(G=Nr(ne.type,ne.key,ne.props,null,J.mode,pe),ll(G,ne),G.return=J,G)}function ie(J,G,ne,pe){return G===null||G.tag!==4||G.stateNode.containerInfo!==ne.containerInfo||G.stateNode.implementation!==ne.implementation?(G=Pc(ne,J.mode,pe),G.return=J,G):(G=f(G,ne.children||[]),G.return=J,G)}function he(J,G,ne,pe,De){return G===null||G.tag!==7?(G=mi(ne,J.mode,pe,De),G.return=J,G):(G=f(G,ne),G.return=J,G)}function ve(J,G,ne){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=Ic(""+G,J.mode,ne),G.return=J,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case S:return ne=Nr(G.type,G.key,G.props,null,J.mode,ne),ll(ne,G),ne.return=J,ne;case N:return G=Pc(G,J.mode,ne),G.return=J,G;case K:return G=bi(G),ve(J,G,ne)}if(ge(G)||$(G))return G=mi(G,J.mode,ne,null),G.return=J,G;if(typeof G.then=="function")return ve(J,Rr(G),ne);if(G.$$typeof===H)return ve(J,kr(J,G),ne);Ar(J,G)}return null}function ae(J,G,ne,pe){var De=G!==null?G.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return De!==null?null:k(J,G,""+ne,pe);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case S:return ne.key===De?V(J,G,ne,pe):null;case N:return ne.key===De?ie(J,G,ne,pe):null;case K:return ne=bi(ne),ae(J,G,ne,pe)}if(ge(ne)||$(ne))return De!==null?null:he(J,G,ne,pe,null);if(typeof ne.then=="function")return ae(J,G,Rr(ne),pe);if(ne.$$typeof===H)return ae(J,G,kr(J,ne),pe);Ar(J,ne)}return null}function re(J,G,ne,pe,De){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return J=J.get(ne)||null,k(G,J,""+pe,De);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case S:return J=J.get(pe.key===null?ne:pe.key)||null,V(G,J,pe,De);case N:return J=J.get(pe.key===null?ne:pe.key)||null,ie(G,J,pe,De);case K:return pe=bi(pe),re(J,G,ne,pe,De)}if(ge(pe)||$(pe))return J=J.get(ne)||null,he(G,J,pe,De,null);if(typeof pe.then=="function")return re(J,G,ne,Rr(pe),De);if(pe.$$typeof===H)return re(J,G,ne,kr(G,pe),De);Ar(G,pe)}return null}function Ee(J,G,ne,pe){for(var De=null,Ze=null,Te=G,Fe=G=0,Xe=null;Te!==null&&Fe<ne.length;Fe++){Te.index>Fe?(Xe=Te,Te=null):Xe=Te.sibling;var et=ae(J,Te,ne[Fe],pe);if(et===null){Te===null&&(Te=Xe);break}t&&Te&&et.alternate===null&&n(J,Te),G=m(et,G,Fe),Ze===null?De=et:Ze.sibling=et,Ze=et,Te=Xe}if(Fe===ne.length)return o(J,Te),Je&&an(J,Fe),De;if(Te===null){for(;Fe<ne.length;Fe++)Te=ve(J,ne[Fe],pe),Te!==null&&(G=m(Te,G,Fe),Ze===null?De=Te:Ze.sibling=Te,Ze=Te);return Je&&an(J,Fe),De}for(Te=u(Te);Fe<ne.length;Fe++)Xe=re(Te,J,Fe,ne[Fe],pe),Xe!==null&&(t&&Xe.alternate!==null&&Te.delete(Xe.key===null?Fe:Xe.key),G=m(Xe,G,Fe),Ze===null?De=Xe:Ze.sibling=Xe,Ze=Xe);return t&&Te.forEach(function(Xn){return n(J,Xn)}),Je&&an(J,Fe),De}function Oe(J,G,ne,pe){if(ne==null)throw Error(a(151));for(var De=null,Ze=null,Te=G,Fe=G=0,Xe=null,et=ne.next();Te!==null&&!et.done;Fe++,et=ne.next()){Te.index>Fe?(Xe=Te,Te=null):Xe=Te.sibling;var Xn=ae(J,Te,et.value,pe);if(Xn===null){Te===null&&(Te=Xe);break}t&&Te&&Xn.alternate===null&&n(J,Te),G=m(Xn,G,Fe),Ze===null?De=Xn:Ze.sibling=Xn,Ze=Xn,Te=Xe}if(et.done)return o(J,Te),Je&&an(J,Fe),De;if(Te===null){for(;!et.done;Fe++,et=ne.next())et=ve(J,et.value,pe),et!==null&&(G=m(et,G,Fe),Ze===null?De=et:Ze.sibling=et,Ze=et);return Je&&an(J,Fe),De}for(Te=u(Te);!et.done;Fe++,et=ne.next())et=re(Te,J,Fe,et.value,pe),et!==null&&(t&&et.alternate!==null&&Te.delete(et.key===null?Fe:et.key),G=m(et,G,Fe),Ze===null?De=et:Ze.sibling=et,Ze=et);return t&&Te.forEach(function(T1){return n(J,T1)}),Je&&an(J,Fe),De}function ct(J,G,ne,pe){if(typeof ne=="object"&&ne!==null&&ne.type===E&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case S:e:{for(var De=ne.key;G!==null;){if(G.key===De){if(De=ne.type,De===E){if(G.tag===7){o(J,G.sibling),pe=f(G,ne.props.children),pe.return=J,J=pe;break e}}else if(G.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===K&&bi(De)===G.type){o(J,G.sibling),pe=f(G,ne.props),ll(pe,ne),pe.return=J,J=pe;break e}o(J,G);break}else n(J,G);G=G.sibling}ne.type===E?(pe=mi(ne.props.children,J.mode,pe,ne.key),pe.return=J,J=pe):(pe=Nr(ne.type,ne.key,ne.props,null,J.mode,pe),ll(pe,ne),pe.return=J,J=pe)}return w(J);case N:e:{for(De=ne.key;G!==null;){if(G.key===De)if(G.tag===4&&G.stateNode.containerInfo===ne.containerInfo&&G.stateNode.implementation===ne.implementation){o(J,G.sibling),pe=f(G,ne.children||[]),pe.return=J,J=pe;break e}else{o(J,G);break}else n(J,G);G=G.sibling}pe=Pc(ne,J.mode,pe),pe.return=J,J=pe}return w(J);case K:return ne=bi(ne),ct(J,G,ne,pe)}if(ge(ne))return Ee(J,G,ne,pe);if($(ne)){if(De=$(ne),typeof De!="function")throw Error(a(150));return ne=De.call(ne),Oe(J,G,ne,pe)}if(typeof ne.then=="function")return ct(J,G,Rr(ne),pe);if(ne.$$typeof===H)return ct(J,G,kr(J,ne),pe);Ar(J,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint"?(ne=""+ne,G!==null&&G.tag===6?(o(J,G.sibling),pe=f(G,ne),pe.return=J,J=pe):(o(J,G),pe=Ic(ne,J.mode,pe),pe.return=J,J=pe),w(J)):o(J,G)}return function(J,G,ne,pe){try{al=0;var De=ct(J,G,ne,pe);return ia=null,De}catch(Te){if(Te===na||Te===Mr)throw Te;var Ze=os(29,Te,null,J.mode);return Ze.lanes=pe,Ze.return=J,Ze}}}var wi=tm(!0),sm=tm(!1),An=!1;function Xc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Jc(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ln(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function On(t,n,o){var u=t.updateQueue;if(u===null)return null;if(u=u.shared,(st&2)!==0){var f=u.pending;return f===null?n.next=n:(n.next=f.next,f.next=n),u.pending=n,n=jr(t),Bf(t,null,o),n}return _r(t,u,n,o),jr(t)}function rl(t,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194048)!==0)){var u=n.lanes;u&=t.pendingLanes,o|=u,n.lanes=o,je(t,o)}}function Qc(t,n){var o=t.updateQueue,u=t.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var f=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var w={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};m===null?f=m=w:m=m.next=w,o=o.next}while(o!==null);m===null?f=m=n:m=m.next=n}else f=m=n;o={baseState:u.baseState,firstBaseUpdate:f,lastBaseUpdate:m,shared:u.shared,callbacks:u.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=n:t.next=n,o.lastBaseUpdate=n}var Zc=!1;function ol(){if(Zc){var t=sa;if(t!==null)throw t}}function cl(t,n,o,u){Zc=!1;var f=t.updateQueue;An=!1;var m=f.firstBaseUpdate,w=f.lastBaseUpdate,k=f.shared.pending;if(k!==null){f.shared.pending=null;var V=k,ie=V.next;V.next=null,w===null?m=ie:w.next=ie,w=V;var he=t.alternate;he!==null&&(he=he.updateQueue,k=he.lastBaseUpdate,k!==w&&(k===null?he.firstBaseUpdate=ie:k.next=ie,he.lastBaseUpdate=V))}if(m!==null){var ve=f.baseState;w=0,he=ie=V=null,k=m;do{var ae=k.lane&-536870913,re=ae!==k.lane;if(re?(Ke&ae)===ae:(u&ae)===ae){ae!==0&&ae===ta&&(Zc=!0),he!==null&&(he=he.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var Ee=t,Oe=k;ae=n;var ct=o;switch(Oe.tag){case 1:if(Ee=Oe.payload,typeof Ee=="function"){ve=Ee.call(ct,ve,ae);break e}ve=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Oe.payload,ae=typeof Ee=="function"?Ee.call(ct,ve,ae):Ee,ae==null)break e;ve=y({},ve,ae);break e;case 2:An=!0}}ae=k.callback,ae!==null&&(t.flags|=64,re&&(t.flags|=8192),re=f.callbacks,re===null?f.callbacks=[ae]:re.push(ae))}else re={lane:ae,tag:k.tag,payload:k.payload,callback:k.callback,next:null},he===null?(ie=he=re,V=ve):he=he.next=re,w|=ae;if(k=k.next,k===null){if(k=f.shared.pending,k===null)break;re=k,k=re.next,re.next=null,f.lastBaseUpdate=re,f.shared.pending=null}}while(!0);he===null&&(V=ve),f.baseState=V,f.firstBaseUpdate=ie,f.lastBaseUpdate=he,m===null&&(f.shared.lanes=0),$n|=w,t.lanes=w,t.memoizedState=ve}}function nm(t,n){if(typeof t!="function")throw Error(a(191,t));t.call(n)}function im(t,n){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)nm(o[t],n)}var aa=M(null),Lr=M(0);function am(t,n){t=gn,P(Lr,t),P(aa,n),gn=t|n.baseLanes}function eu(){P(Lr,gn),P(aa,aa.current)}function tu(){gn=Lr.current,T(aa),T(Lr)}var cs=M(null),Ss=null;function zn(t){var n=t.alternate;P(Et,Et.current&1),P(cs,t),Ss===null&&(n===null||aa.current!==null||n.memoizedState!==null)&&(Ss=t)}function su(t){P(Et,Et.current),P(cs,t),Ss===null&&(Ss=t)}function lm(t){t.tag===22?(P(Et,Et.current),P(cs,t),Ss===null&&(Ss=t)):In()}function In(){P(Et,Et.current),P(cs,cs.current)}function us(t){T(cs),Ss===t&&(Ss=null),T(Et)}var Et=M(0);function Or(t){for(var n=t;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||oh(o)||ch(o)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var on=0,qe=null,rt=null,Dt=null,zr=!1,la=!1,Si=!1,Ir=0,ul=0,ra=null,vx=0;function St(){throw Error(a(321))}function nu(t,n){if(n===null)return!1;for(var o=0;o<n.length&&o<t.length;o++)if(!rs(t[o],n[o]))return!1;return!0}function iu(t,n,o,u,f,m){return on=m,qe=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,O.H=t===null||t.memoizedState===null?Hm:bu,Si=!1,m=o(u,f),Si=!1,la&&(m=om(n,o,u,f)),rm(t),m}function rm(t){O.H=fl;var n=rt!==null&&rt.next!==null;if(on=0,Dt=rt=qe=null,zr=!1,ul=0,ra=null,n)throw Error(a(300));t===null||Rt||(t=t.dependencies,t!==null&&Tr(t)&&(Rt=!0))}function om(t,n,o,u){qe=t;var f=0;do{if(la&&(ra=null),ul=0,la=!1,25<=f)throw Error(a(301));if(f+=1,Dt=rt=null,t.updateQueue!=null){var m=t.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}O.H=qm,m=n(o,u)}while(la);return m}function yx(){var t=O.H,n=t.useState()[0];return n=typeof n.then=="function"?hl(n):n,t=t.useState()[0],(rt!==null?rt.memoizedState:null)!==t&&(qe.flags|=1024),n}function au(){var t=Ir!==0;return Ir=0,t}function lu(t,n,o){n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~o}function ru(t){if(zr){for(t=t.memoizedState;t!==null;){var n=t.queue;n!==null&&(n.pending=null),t=t.next}zr=!1}on=0,Dt=rt=qe=null,la=!1,ul=Ir=0,ra=null}function Xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?qe.memoizedState=Dt=t:Dt=Dt.next=t,Dt}function Tt(){if(rt===null){var t=qe.alternate;t=t!==null?t.memoizedState:null}else t=rt.next;var n=Dt===null?qe.memoizedState:Dt.next;if(n!==null)Dt=n,rt=t;else{if(t===null)throw qe.alternate===null?Error(a(467)):Error(a(310));rt=t,t={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},Dt===null?qe.memoizedState=Dt=t:Dt=Dt.next=t}return Dt}function Pr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hl(t){var n=ul;return ul+=1,ra===null&&(ra=[]),t=Qf(ra,t,n),n=qe,(Dt===null?n.memoizedState:Dt.next)===null&&(n=n.alternate,O.H=n===null||n.memoizedState===null?Hm:bu),t}function Br(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return hl(t);if(t.$$typeof===H)return Ht(t)}throw Error(a(438,String(t)))}function ou(t){var n=null,o=qe.updateQueue;if(o!==null&&(n=o.memoCache),n==null){var u=qe.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(n={data:u.data.map(function(f){return f.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),o===null&&(o=Pr(),qe.updateQueue=o),o.memoCache=n,o=n.data[n.index],o===void 0)for(o=n.data[n.index]=Array(t),u=0;u<t;u++)o[u]=U;return n.index++,o}function cn(t,n){return typeof n=="function"?n(t):n}function $r(t){var n=Tt();return cu(n,rt,t)}function cu(t,n,o){var u=t.queue;if(u===null)throw Error(a(311));u.lastRenderedReducer=o;var f=t.baseQueue,m=u.pending;if(m!==null){if(f!==null){var w=f.next;f.next=m.next,m.next=w}n.baseQueue=f=m,u.pending=null}if(m=t.baseState,f===null)t.memoizedState=m;else{n=f.next;var k=w=null,V=null,ie=n,he=!1;do{var ve=ie.lane&-536870913;if(ve!==ie.lane?(Ke&ve)===ve:(on&ve)===ve){var ae=ie.revertLane;if(ae===0)V!==null&&(V=V.next={lane:0,revertLane:0,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),ve===ta&&(he=!0);else if((on&ae)===ae){ie=ie.next,ae===ta&&(he=!0);continue}else ve={lane:0,revertLane:ie.revertLane,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},V===null?(k=V=ve,w=m):V=V.next=ve,qe.lanes|=ae,$n|=ae;ve=ie.action,Si&&o(m,ve),m=ie.hasEagerState?ie.eagerState:o(m,ve)}else ae={lane:ve,revertLane:ie.revertLane,gesture:ie.gesture,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},V===null?(k=V=ae,w=m):V=V.next=ae,qe.lanes|=ve,$n|=ve;ie=ie.next}while(ie!==null&&ie!==n);if(V===null?w=m:V.next=k,!rs(m,t.memoizedState)&&(Rt=!0,he&&(o=sa,o!==null)))throw o;t.memoizedState=m,t.baseState=w,t.baseQueue=V,u.lastRenderedState=m}return f===null&&(u.lanes=0),[t.memoizedState,u.dispatch]}function uu(t){var n=Tt(),o=n.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=t;var u=o.dispatch,f=o.pending,m=n.memoizedState;if(f!==null){o.pending=null;var w=f=f.next;do m=t(m,w.action),w=w.next;while(w!==f);rs(m,n.memoizedState)||(Rt=!0),n.memoizedState=m,n.baseQueue===null&&(n.baseState=m),o.lastRenderedState=m}return[m,u]}function cm(t,n,o){var u=qe,f=Tt(),m=Je;if(m){if(o===void 0)throw Error(a(407));o=o()}else o=n();var w=!rs((rt||f).memoizedState,o);if(w&&(f.memoizedState=o,Rt=!0),f=f.queue,fu(dm.bind(null,u,f,t),[t]),f.getSnapshot!==n||w||Dt!==null&&Dt.memoizedState.tag&1){if(u.flags|=2048,oa(9,{destroy:void 0},hm.bind(null,u,f,o,n),null),dt===null)throw Error(a(349));m||(on&127)!==0||um(u,n,o)}return o}function um(t,n,o){t.flags|=16384,t={getSnapshot:n,value:o},n=qe.updateQueue,n===null?(n=Pr(),qe.updateQueue=n,n.stores=[t]):(o=n.stores,o===null?n.stores=[t]:o.push(t))}function hm(t,n,o,u){n.value=o,n.getSnapshot=u,fm(n)&&mm(t)}function dm(t,n,o){return o(function(){fm(n)&&mm(t)})}function fm(t){var n=t.getSnapshot;t=t.value;try{var o=n();return!rs(t,o)}catch{return!0}}function mm(t){var n=fi(t,2);n!==null&&is(n,t,2)}function hu(t){var n=Xt();if(typeof t=="function"){var o=t;if(t=o(),Si){tt(!0);try{o()}finally{tt(!1)}}}return n.memoizedState=n.baseState=t,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:t},n}function pm(t,n,o,u){return t.baseState=o,cu(t,rt,typeof u=="function"?u:cn)}function bx(t,n,o,u,f){if(Hr(t))throw Error(a(485));if(t=n.action,t!==null){var m={payload:f,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){m.listeners.push(w)}};O.T!==null?o(!0):m.isTransition=!1,u(m),o=n.pending,o===null?(m.next=n.pending=m,gm(n,m)):(m.next=o.next,n.pending=o.next=m)}}function gm(t,n){var o=n.action,u=n.payload,f=t.state;if(n.isTransition){var m=O.T,w={};O.T=w;try{var k=o(f,u),V=O.S;V!==null&&V(w,k),vm(t,n,k)}catch(ie){du(t,n,ie)}finally{m!==null&&w.types!==null&&(m.types=w.types),O.T=m}}else try{m=o(f,u),vm(t,n,m)}catch(ie){du(t,n,ie)}}function vm(t,n,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(u){ym(t,n,u)},function(u){return du(t,n,u)}):ym(t,n,o)}function ym(t,n,o){n.status="fulfilled",n.value=o,bm(n),t.state=o,n=t.pending,n!==null&&(o=n.next,o===n?t.pending=null:(o=o.next,n.next=o,gm(t,o)))}function du(t,n,o){var u=t.pending;if(t.pending=null,u!==null){u=u.next;do n.status="rejected",n.reason=o,bm(n),n=n.next;while(n!==u)}t.action=null}function bm(t){t=t.listeners;for(var n=0;n<t.length;n++)(0,t[n])()}function xm(t,n){return n}function wm(t,n){if(Je){var o=dt.formState;if(o!==null){e:{var u=qe;if(Je){if(pt){t:{for(var f=pt,m=ws;f.nodeType!==8;){if(!m){f=null;break t}if(f=_s(f.nextSibling),f===null){f=null;break t}}m=f.data,f=m==="F!"||m==="F"?f:null}if(f){pt=_s(f.nextSibling),u=f.data==="F!";break e}}Dn(u)}u=!1}u&&(n=o[0])}}return o=Xt(),o.memoizedState=o.baseState=n,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xm,lastRenderedState:n},o.queue=u,o=$m.bind(null,qe,u),u.dispatch=o,u=hu(!1),m=yu.bind(null,qe,!1,u.queue),u=Xt(),f={state:n,dispatch:null,action:t,pending:null},u.queue=f,o=bx.bind(null,qe,f,m,o),f.dispatch=o,u.memoizedState=t,[n,o,!1]}function Sm(t){var n=Tt();return _m(n,rt,t)}function _m(t,n,o){if(n=cu(t,n,xm)[0],t=$r(cn)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var u=hl(n)}catch(w){throw w===na?Mr:w}else u=n;n=Tt();var f=n.queue,m=f.dispatch;return o!==n.memoizedState&&(qe.flags|=2048,oa(9,{destroy:void 0},xx.bind(null,f,o),null)),[u,m,t]}function xx(t,n){t.action=n}function jm(t){var n=Tt(),o=rt;if(o!==null)return _m(n,o,t);Tt(),n=n.memoizedState,o=Tt();var u=o.queue.dispatch;return o.memoizedState=t,[n,u,!1]}function oa(t,n,o,u){return t={tag:t,create:o,deps:u,inst:n,next:null},n=qe.updateQueue,n===null&&(n=Pr(),qe.updateQueue=n),o=n.lastEffect,o===null?n.lastEffect=t.next=t:(u=o.next,o.next=t,t.next=u,n.lastEffect=t),t}function Nm(){return Tt().memoizedState}function Ur(t,n,o,u){var f=Xt();qe.flags|=t,f.memoizedState=oa(1|n,{destroy:void 0},o,u===void 0?null:u)}function Vr(t,n,o,u){var f=Tt();u=u===void 0?null:u;var m=f.memoizedState.inst;rt!==null&&u!==null&&nu(u,rt.memoizedState.deps)?f.memoizedState=oa(n,m,o,u):(qe.flags|=t,f.memoizedState=oa(1|n,m,o,u))}function Em(t,n){Ur(8390656,8,t,n)}function fu(t,n){Vr(2048,8,t,n)}function wx(t){qe.flags|=4;var n=qe.updateQueue;if(n===null)n=Pr(),qe.updateQueue=n,n.events=[t];else{var o=n.events;o===null?n.events=[t]:o.push(t)}}function Tm(t){var n=Tt().memoizedState;return wx({ref:n,nextImpl:t}),function(){if((st&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function km(t,n){return Vr(4,2,t,n)}function Cm(t,n){return Vr(4,4,t,n)}function Mm(t,n){if(typeof n=="function"){t=t();var o=n(t);return function(){typeof o=="function"?o():n(null)}}if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function Dm(t,n,o){o=o!=null?o.concat([t]):null,Vr(4,4,Mm.bind(null,n,t),o)}function mu(){}function Rm(t,n){var o=Tt();n=n===void 0?null:n;var u=o.memoizedState;return n!==null&&nu(n,u[1])?u[0]:(o.memoizedState=[t,n],t)}function Am(t,n){var o=Tt();n=n===void 0?null:n;var u=o.memoizedState;if(n!==null&&nu(n,u[1]))return u[0];if(u=t(),Si){tt(!0);try{t()}finally{tt(!1)}}return o.memoizedState=[u,n],u}function pu(t,n,o){return o===void 0||(on&1073741824)!==0&&(Ke&261930)===0?t.memoizedState=n:(t.memoizedState=o,t=Lp(),qe.lanes|=t,$n|=t,o)}function Lm(t,n,o,u){return rs(o,n)?o:aa.current!==null?(t=pu(t,o,u),rs(t,n)||(Rt=!0),t):(on&42)===0||(on&1073741824)!==0&&(Ke&261930)===0?(Rt=!0,t.memoizedState=o):(t=Lp(),qe.lanes|=t,$n|=t,n)}function Om(t,n,o,u,f){var m=A.p;A.p=m!==0&&8>m?m:8;var w=O.T,k={};O.T=k,yu(t,!1,n,o);try{var V=f(),ie=O.S;if(ie!==null&&ie(k,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var he=gx(V,u);dl(t,n,he,fs(t))}else dl(t,n,u,fs(t))}catch(ve){dl(t,n,{then:function(){},status:"rejected",reason:ve},fs())}finally{A.p=m,w!==null&&k.types!==null&&(w.types=k.types),O.T=w}}function Sx(){}function gu(t,n,o,u){if(t.tag!==5)throw Error(a(476));var f=zm(t).queue;Om(t,f,n,W,o===null?Sx:function(){return Im(t),o(u)})}function zm(t){var n=t.memoizedState;if(n!==null)return n;n={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:W},next:null};var o={};return n.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:o},next:null},t.memoizedState=n,t=t.alternate,t!==null&&(t.memoizedState=n),n}function Im(t){var n=zm(t);n.next===null&&(n=t.alternate.memoizedState),dl(t,n.next.queue,{},fs())}function vu(){return Ht(Cl)}function Pm(){return Tt().memoizedState}function Bm(){return Tt().memoizedState}function _x(t){for(var n=t.return;n!==null;){switch(n.tag){case 24:case 3:var o=fs();t=Ln(o);var u=On(n,t,o);u!==null&&(is(u,n,o),rl(u,n,o)),n={cache:Wc()},t.payload=n;return}n=n.return}}function jx(t,n,o){var u=fs();o={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Hr(t)?Um(n,o):(o=Oc(t,n,o,u),o!==null&&(is(o,t,u),Vm(o,n,u)))}function $m(t,n,o){var u=fs();dl(t,n,o,u)}function dl(t,n,o,u){var f={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Hr(t))Um(n,f);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=n.lastRenderedReducer,m!==null))try{var w=n.lastRenderedState,k=m(w,o);if(f.hasEagerState=!0,f.eagerState=k,rs(k,w))return _r(t,n,f,0),dt===null&&Sr(),!1}catch{}if(o=Oc(t,n,f,u),o!==null)return is(o,t,u),Vm(o,n,u),!0}return!1}function yu(t,n,o,u){if(u={lane:2,revertLane:Xu(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Hr(t)){if(n)throw Error(a(479))}else n=Oc(t,o,u,2),n!==null&&is(n,t,2)}function Hr(t){var n=t.alternate;return t===qe||n!==null&&n===qe}function Um(t,n){la=zr=!0;var o=t.pending;o===null?n.next=n:(n.next=o.next,o.next=n),t.pending=n}function Vm(t,n,o){if((o&4194048)!==0){var u=n.lanes;u&=t.pendingLanes,o|=u,n.lanes=o,je(t,o)}}var fl={readContext:Ht,use:Br,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useLayoutEffect:St,useInsertionEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useSyncExternalStore:St,useId:St,useHostTransitionStatus:St,useFormState:St,useActionState:St,useOptimistic:St,useMemoCache:St,useCacheRefresh:St};fl.useEffectEvent=St;var Hm={readContext:Ht,use:Br,useCallback:function(t,n){return Xt().memoizedState=[t,n===void 0?null:n],t},useContext:Ht,useEffect:Em,useImperativeHandle:function(t,n,o){o=o!=null?o.concat([t]):null,Ur(4194308,4,Mm.bind(null,n,t),o)},useLayoutEffect:function(t,n){return Ur(4194308,4,t,n)},useInsertionEffect:function(t,n){Ur(4,2,t,n)},useMemo:function(t,n){var o=Xt();n=n===void 0?null:n;var u=t();if(Si){tt(!0);try{t()}finally{tt(!1)}}return o.memoizedState=[u,n],u},useReducer:function(t,n,o){var u=Xt();if(o!==void 0){var f=o(n);if(Si){tt(!0);try{o(n)}finally{tt(!1)}}}else f=n;return u.memoizedState=u.baseState=f,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:f},u.queue=t,t=t.dispatch=jx.bind(null,qe,t),[u.memoizedState,t]},useRef:function(t){var n=Xt();return t={current:t},n.memoizedState=t},useState:function(t){t=hu(t);var n=t.queue,o=$m.bind(null,qe,n);return n.dispatch=o,[t.memoizedState,o]},useDebugValue:mu,useDeferredValue:function(t,n){var o=Xt();return pu(o,t,n)},useTransition:function(){var t=hu(!1);return t=Om.bind(null,qe,t.queue,!0,!1),Xt().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,n,o){var u=qe,f=Xt();if(Je){if(o===void 0)throw Error(a(407));o=o()}else{if(o=n(),dt===null)throw Error(a(349));(Ke&127)!==0||um(u,n,o)}f.memoizedState=o;var m={value:o,getSnapshot:n};return f.queue=m,Em(dm.bind(null,u,m,t),[t]),u.flags|=2048,oa(9,{destroy:void 0},hm.bind(null,u,m,o,n),null),o},useId:function(){var t=Xt(),n=dt.identifierPrefix;if(Je){var o=$s,u=Bs;o=(u&~(1<<32-bt(u)-1)).toString(32)+o,n="_"+n+"R_"+o,o=Ir++,0<o&&(n+="H"+o.toString(32)),n+="_"}else o=vx++,n="_"+n+"r_"+o.toString(32)+"_";return t.memoizedState=n},useHostTransitionStatus:vu,useFormState:wm,useActionState:wm,useOptimistic:function(t){var n=Xt();n.memoizedState=n.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=o,n=yu.bind(null,qe,!0,o),o.dispatch=n,[t,n]},useMemoCache:ou,useCacheRefresh:function(){return Xt().memoizedState=_x.bind(null,qe)},useEffectEvent:function(t){var n=Xt(),o={impl:t};return n.memoizedState=o,function(){if((st&2)!==0)throw Error(a(440));return o.impl.apply(void 0,arguments)}}},bu={readContext:Ht,use:Br,useCallback:Rm,useContext:Ht,useEffect:fu,useImperativeHandle:Dm,useInsertionEffect:km,useLayoutEffect:Cm,useMemo:Am,useReducer:$r,useRef:Nm,useState:function(){return $r(cn)},useDebugValue:mu,useDeferredValue:function(t,n){var o=Tt();return Lm(o,rt.memoizedState,t,n)},useTransition:function(){var t=$r(cn)[0],n=Tt().memoizedState;return[typeof t=="boolean"?t:hl(t),n]},useSyncExternalStore:cm,useId:Pm,useHostTransitionStatus:vu,useFormState:Sm,useActionState:Sm,useOptimistic:function(t,n){var o=Tt();return pm(o,rt,t,n)},useMemoCache:ou,useCacheRefresh:Bm};bu.useEffectEvent=Tm;var qm={readContext:Ht,use:Br,useCallback:Rm,useContext:Ht,useEffect:fu,useImperativeHandle:Dm,useInsertionEffect:km,useLayoutEffect:Cm,useMemo:Am,useReducer:uu,useRef:Nm,useState:function(){return uu(cn)},useDebugValue:mu,useDeferredValue:function(t,n){var o=Tt();return rt===null?pu(o,t,n):Lm(o,rt.memoizedState,t,n)},useTransition:function(){var t=uu(cn)[0],n=Tt().memoizedState;return[typeof t=="boolean"?t:hl(t),n]},useSyncExternalStore:cm,useId:Pm,useHostTransitionStatus:vu,useFormState:jm,useActionState:jm,useOptimistic:function(t,n){var o=Tt();return rt!==null?pm(o,rt,t,n):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:ou,useCacheRefresh:Bm};qm.useEffectEvent=Tm;function xu(t,n,o,u){n=t.memoizedState,o=o(u,n),o=o==null?n:y({},n,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var wu={enqueueSetState:function(t,n,o){t=t._reactInternals;var u=fs(),f=Ln(u);f.payload=n,o!=null&&(f.callback=o),n=On(t,f,u),n!==null&&(is(n,t,u),rl(n,t,u))},enqueueReplaceState:function(t,n,o){t=t._reactInternals;var u=fs(),f=Ln(u);f.tag=1,f.payload=n,o!=null&&(f.callback=o),n=On(t,f,u),n!==null&&(is(n,t,u),rl(n,t,u))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var o=fs(),u=Ln(o);u.tag=2,n!=null&&(u.callback=n),n=On(t,u,o),n!==null&&(is(n,t,o),rl(n,t,o))}};function Fm(t,n,o,u,f,m,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(u,m,w):n.prototype&&n.prototype.isPureReactComponent?!Za(o,u)||!Za(f,m):!0}function Wm(t,n,o,u){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,u),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,u),n.state!==t&&wu.enqueueReplaceState(n,n.state,null)}function _i(t,n){var o=n;if("ref"in n){o={};for(var u in n)u!=="ref"&&(o[u]=n[u])}if(t=t.defaultProps){o===n&&(o=y({},o));for(var f in t)o[f]===void 0&&(o[f]=t[f])}return o}function Gm(t){wr(t)}function Ym(t){console.error(t)}function Km(t){wr(t)}function qr(t,n){try{var o=t.onUncaughtError;o(n.value,{componentStack:n.stack})}catch(u){setTimeout(function(){throw u})}}function Xm(t,n,o){try{var u=t.onCaughtError;u(o.value,{componentStack:o.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(f){setTimeout(function(){throw f})}}function Su(t,n,o){return o=Ln(o),o.tag=3,o.payload={element:null},o.callback=function(){qr(t,n)},o}function Jm(t){return t=Ln(t),t.tag=3,t}function Qm(t,n,o,u){var f=o.type.getDerivedStateFromError;if(typeof f=="function"){var m=u.value;t.payload=function(){return f(m)},t.callback=function(){Xm(n,o,u)}}var w=o.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(t.callback=function(){Xm(n,o,u),typeof f!="function"&&(Un===null?Un=new Set([this]):Un.add(this));var k=u.stack;this.componentDidCatch(u.value,{componentStack:k!==null?k:""})})}function Nx(t,n,o,u,f){if(o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(n=o.alternate,n!==null&&ea(n,o,f,!0),o=cs.current,o!==null){switch(o.tag){case 31:case 13:return Ss===null?so():o.alternate===null&&_t===0&&(_t=3),o.flags&=-257,o.flags|=65536,o.lanes=f,u===Dr?o.flags|=16384:(n=o.updateQueue,n===null?o.updateQueue=new Set([u]):n.add(u),Gu(t,u,f)),!1;case 22:return o.flags|=65536,u===Dr?o.flags|=16384:(n=o.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([u])},o.updateQueue=n):(o=n.retryQueue,o===null?n.retryQueue=new Set([u]):o.add(u)),Gu(t,u,f)),!1}throw Error(a(435,o.tag))}return Gu(t,u,f),so(),!1}if(Je)return n=cs.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=f,u!==Uc&&(t=Error(a(422),{cause:u}),sl(ys(t,o)))):(u!==Uc&&(n=Error(a(423),{cause:u}),sl(ys(n,o))),t=t.current.alternate,t.flags|=65536,f&=-f,t.lanes|=f,u=ys(u,o),f=Su(t.stateNode,u,f),Qc(t,f),_t!==4&&(_t=2)),!1;var m=Error(a(520),{cause:u});if(m=ys(m,o),wl===null?wl=[m]:wl.push(m),_t!==4&&(_t=2),n===null)return!0;u=ys(u,o),o=n;do{switch(o.tag){case 3:return o.flags|=65536,t=f&-f,o.lanes|=t,t=Su(o.stateNode,u,t),Qc(o,t),!1;case 1:if(n=o.type,m=o.stateNode,(o.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Un===null||!Un.has(m))))return o.flags|=65536,f&=-f,o.lanes|=f,f=Jm(f),Qm(f,t,o,u),Qc(o,f),!1}o=o.return}while(o!==null);return!1}var _u=Error(a(461)),Rt=!1;function qt(t,n,o,u){n.child=t===null?sm(n,null,o,u):wi(n,t.child,o,u)}function Zm(t,n,o,u,f){o=o.render;var m=n.ref;if("ref"in u){var w={};for(var k in u)k!=="ref"&&(w[k]=u[k])}else w=u;return vi(n),u=iu(t,n,o,w,m,f),k=au(),t!==null&&!Rt?(lu(t,n,f),un(t,n,f)):(Je&&k&&Bc(n),n.flags|=1,qt(t,n,u,f),n.child)}function ep(t,n,o,u,f){if(t===null){var m=o.type;return typeof m=="function"&&!zc(m)&&m.defaultProps===void 0&&o.compare===null?(n.tag=15,n.type=m,tp(t,n,m,u,f)):(t=Nr(o.type,null,u,n,n.mode,f),t.ref=n.ref,t.return=n,n.child=t)}if(m=t.child,!Du(t,f)){var w=m.memoizedProps;if(o=o.compare,o=o!==null?o:Za,o(w,u)&&t.ref===n.ref)return un(t,n,f)}return n.flags|=1,t=nn(m,u),t.ref=n.ref,t.return=n,n.child=t}function tp(t,n,o,u,f){if(t!==null){var m=t.memoizedProps;if(Za(m,u)&&t.ref===n.ref)if(Rt=!1,n.pendingProps=u=m,Du(t,f))(t.flags&131072)!==0&&(Rt=!0);else return n.lanes=t.lanes,un(t,n,f)}return ju(t,n,o,u,f)}function sp(t,n,o,u){var f=u.children,m=t!==null?t.memoizedState:null;if(t===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((n.flags&128)!==0){if(m=m!==null?m.baseLanes|o:o,t!==null){for(u=n.child=t.child,f=0;u!==null;)f=f|u.lanes|u.childLanes,u=u.sibling;u=f&~m}else u=0,n.child=null;return np(t,n,m,o,u)}if((o&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},t!==null&&Cr(n,m!==null?m.cachePool:null),m!==null?am(n,m):eu(),lm(n);else return u=n.lanes=536870912,np(t,n,m!==null?m.baseLanes|o:o,o,u)}else m!==null?(Cr(n,m.cachePool),am(n,m),In(),n.memoizedState=null):(t!==null&&Cr(n,null),eu(),In());return qt(t,n,f,o),n.child}function ml(t,n){return t!==null&&t.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function np(t,n,o,u,f){var m=Yc();return m=m===null?null:{parent:Mt._currentValue,pool:m},n.memoizedState={baseLanes:o,cachePool:m},t!==null&&Cr(n,null),eu(),lm(n),t!==null&&ea(t,n,u,!0),n.childLanes=f,null}function Fr(t,n){return n=Gr({mode:n.mode,children:n.children},t.mode),n.ref=t.ref,t.child=n,n.return=t,n}function ip(t,n,o){return wi(n,t.child,null,o),t=Fr(n,n.pendingProps),t.flags|=2,us(n),n.memoizedState=null,t}function Ex(t,n,o){var u=n.pendingProps,f=(n.flags&128)!==0;if(n.flags&=-129,t===null){if(Je){if(u.mode==="hidden")return t=Fr(n,u),n.lanes=536870912,ml(null,t);if(su(n),(t=pt)?(t=gg(t,ws),t=t!==null&&t.data==="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:Cn!==null?{id:Bs,overflow:$s}:null,retryLane:536870912,hydrationErrors:null},o=Uf(t),o.return=n,n.child=o,Vt=n,pt=null)):t=null,t===null)throw Dn(n);return n.lanes=536870912,null}return Fr(n,u)}var m=t.memoizedState;if(m!==null){var w=m.dehydrated;if(su(n),f)if(n.flags&256)n.flags&=-257,n=ip(t,n,o);else if(n.memoizedState!==null)n.child=t.child,n.flags|=128,n=null;else throw Error(a(558));else if(Rt||ea(t,n,o,!1),f=(o&t.childLanes)!==0,Rt||f){if(u=dt,u!==null&&(w=ze(u,o),w!==0&&w!==m.retryLane))throw m.retryLane=w,fi(t,w),is(u,t,w),_u;so(),n=ip(t,n,o)}else t=m.treeContext,pt=_s(w.nextSibling),Vt=n,Je=!0,Mn=null,ws=!1,t!==null&&qf(n,t),n=Fr(n,u),n.flags|=4096;return n}return t=nn(t.child,{mode:u.mode,children:u.children}),t.ref=n.ref,n.child=t,t.return=n,t}function Wr(t,n){var o=n.ref;if(o===null)t!==null&&t.ref!==null&&(n.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(a(284));(t===null||t.ref!==o)&&(n.flags|=4194816)}}function ju(t,n,o,u,f){return vi(n),o=iu(t,n,o,u,void 0,f),u=au(),t!==null&&!Rt?(lu(t,n,f),un(t,n,f)):(Je&&u&&Bc(n),n.flags|=1,qt(t,n,o,f),n.child)}function ap(t,n,o,u,f,m){return vi(n),n.updateQueue=null,o=om(n,u,o,f),rm(t),u=au(),t!==null&&!Rt?(lu(t,n,m),un(t,n,m)):(Je&&u&&Bc(n),n.flags|=1,qt(t,n,o,m),n.child)}function lp(t,n,o,u,f){if(vi(n),n.stateNode===null){var m=Xi,w=o.contextType;typeof w=="object"&&w!==null&&(m=Ht(w)),m=new o(u,m),n.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=wu,n.stateNode=m,m._reactInternals=n,m=n.stateNode,m.props=u,m.state=n.memoizedState,m.refs={},Xc(n),w=o.contextType,m.context=typeof w=="object"&&w!==null?Ht(w):Xi,m.state=n.memoizedState,w=o.getDerivedStateFromProps,typeof w=="function"&&(xu(n,o,w,u),m.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(w=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),w!==m.state&&wu.enqueueReplaceState(m,m.state,null),cl(n,u,m,f),ol(),m.state=n.memoizedState),typeof m.componentDidMount=="function"&&(n.flags|=4194308),u=!0}else if(t===null){m=n.stateNode;var k=n.memoizedProps,V=_i(o,k);m.props=V;var ie=m.context,he=o.contextType;w=Xi,typeof he=="object"&&he!==null&&(w=Ht(he));var ve=o.getDerivedStateFromProps;he=typeof ve=="function"||typeof m.getSnapshotBeforeUpdate=="function",k=n.pendingProps!==k,he||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(k||ie!==w)&&Wm(n,m,u,w),An=!1;var ae=n.memoizedState;m.state=ae,cl(n,u,m,f),ol(),ie=n.memoizedState,k||ae!==ie||An?(typeof ve=="function"&&(xu(n,o,ve,u),ie=n.memoizedState),(V=An||Fm(n,o,V,u,ae,ie,w))?(he||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(n.flags|=4194308)):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=u,n.memoizedState=ie),m.props=u,m.state=ie,m.context=w,u=V):(typeof m.componentDidMount=="function"&&(n.flags|=4194308),u=!1)}else{m=n.stateNode,Jc(t,n),w=n.memoizedProps,he=_i(o,w),m.props=he,ve=n.pendingProps,ae=m.context,ie=o.contextType,V=Xi,typeof ie=="object"&&ie!==null&&(V=Ht(ie)),k=o.getDerivedStateFromProps,(ie=typeof k=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(w!==ve||ae!==V)&&Wm(n,m,u,V),An=!1,ae=n.memoizedState,m.state=ae,cl(n,u,m,f),ol();var re=n.memoizedState;w!==ve||ae!==re||An||t!==null&&t.dependencies!==null&&Tr(t.dependencies)?(typeof k=="function"&&(xu(n,o,k,u),re=n.memoizedState),(he=An||Fm(n,o,he,u,ae,re,V)||t!==null&&t.dependencies!==null&&Tr(t.dependencies))?(ie||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(u,re,V),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(u,re,V)),typeof m.componentDidUpdate=="function"&&(n.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof m.componentDidUpdate!="function"||w===t.memoizedProps&&ae===t.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||w===t.memoizedProps&&ae===t.memoizedState||(n.flags|=1024),n.memoizedProps=u,n.memoizedState=re),m.props=u,m.state=re,m.context=V,u=he):(typeof m.componentDidUpdate!="function"||w===t.memoizedProps&&ae===t.memoizedState||(n.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||w===t.memoizedProps&&ae===t.memoizedState||(n.flags|=1024),u=!1)}return m=u,Wr(t,n),u=(n.flags&128)!==0,m||u?(m=n.stateNode,o=u&&typeof o.getDerivedStateFromError!="function"?null:m.render(),n.flags|=1,t!==null&&u?(n.child=wi(n,t.child,null,f),n.child=wi(n,null,o,f)):qt(t,n,o,f),n.memoizedState=m.state,t=n.child):t=un(t,n,f),t}function rp(t,n,o,u){return pi(),n.flags|=256,qt(t,n,o,u),n.child}var Nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Eu(t){return{baseLanes:t,cachePool:Xf()}}function Tu(t,n,o){return t=t!==null?t.childLanes&~o:0,n&&(t|=ds),t}function op(t,n,o){var u=n.pendingProps,f=!1,m=(n.flags&128)!==0,w;if((w=m)||(w=t!==null&&t.memoizedState===null?!1:(Et.current&2)!==0),w&&(f=!0,n.flags&=-129),w=(n.flags&32)!==0,n.flags&=-33,t===null){if(Je){if(f?zn(n):In(),(t=pt)?(t=gg(t,ws),t=t!==null&&t.data!=="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:Cn!==null?{id:Bs,overflow:$s}:null,retryLane:536870912,hydrationErrors:null},o=Uf(t),o.return=n,n.child=o,Vt=n,pt=null)):t=null,t===null)throw Dn(n);return ch(t)?n.lanes=32:n.lanes=536870912,null}var k=u.children;return u=u.fallback,f?(In(),f=n.mode,k=Gr({mode:"hidden",children:k},f),u=mi(u,f,o,null),k.return=n,u.return=n,k.sibling=u,n.child=k,u=n.child,u.memoizedState=Eu(o),u.childLanes=Tu(t,w,o),n.memoizedState=Nu,ml(null,u)):(zn(n),ku(n,k))}var V=t.memoizedState;if(V!==null&&(k=V.dehydrated,k!==null)){if(m)n.flags&256?(zn(n),n.flags&=-257,n=Cu(t,n,o)):n.memoizedState!==null?(In(),n.child=t.child,n.flags|=128,n=null):(In(),k=u.fallback,f=n.mode,u=Gr({mode:"visible",children:u.children},f),k=mi(k,f,o,null),k.flags|=2,u.return=n,k.return=n,u.sibling=k,n.child=u,wi(n,t.child,null,o),u=n.child,u.memoizedState=Eu(o),u.childLanes=Tu(t,w,o),n.memoizedState=Nu,n=ml(null,u));else if(zn(n),ch(k)){if(w=k.nextSibling&&k.nextSibling.dataset,w)var ie=w.dgst;w=ie,u=Error(a(419)),u.stack="",u.digest=w,sl({value:u,source:null,stack:null}),n=Cu(t,n,o)}else if(Rt||ea(t,n,o,!1),w=(o&t.childLanes)!==0,Rt||w){if(w=dt,w!==null&&(u=ze(w,o),u!==0&&u!==V.retryLane))throw V.retryLane=u,fi(t,u),is(w,t,u),_u;oh(k)||so(),n=Cu(t,n,o)}else oh(k)?(n.flags|=192,n.child=t.child,n=null):(t=V.treeContext,pt=_s(k.nextSibling),Vt=n,Je=!0,Mn=null,ws=!1,t!==null&&qf(n,t),n=ku(n,u.children),n.flags|=4096);return n}return f?(In(),k=u.fallback,f=n.mode,V=t.child,ie=V.sibling,u=nn(V,{mode:"hidden",children:u.children}),u.subtreeFlags=V.subtreeFlags&65011712,ie!==null?k=nn(ie,k):(k=mi(k,f,o,null),k.flags|=2),k.return=n,u.return=n,u.sibling=k,n.child=u,ml(null,u),u=n.child,k=t.child.memoizedState,k===null?k=Eu(o):(f=k.cachePool,f!==null?(V=Mt._currentValue,f=f.parent!==V?{parent:V,pool:V}:f):f=Xf(),k={baseLanes:k.baseLanes|o,cachePool:f}),u.memoizedState=k,u.childLanes=Tu(t,w,o),n.memoizedState=Nu,ml(t.child,u)):(zn(n),o=t.child,t=o.sibling,o=nn(o,{mode:"visible",children:u.children}),o.return=n,o.sibling=null,t!==null&&(w=n.deletions,w===null?(n.deletions=[t],n.flags|=16):w.push(t)),n.child=o,n.memoizedState=null,o)}function ku(t,n){return n=Gr({mode:"visible",children:n},t.mode),n.return=t,t.child=n}function Gr(t,n){return t=os(22,t,null,n),t.lanes=0,t}function Cu(t,n,o){return wi(n,t.child,null,o),t=ku(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function cp(t,n,o){t.lanes|=n;var u=t.alternate;u!==null&&(u.lanes|=n),qc(t.return,n,o)}function Mu(t,n,o,u,f,m){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:f,treeForkCount:m}:(w.isBackwards=n,w.rendering=null,w.renderingStartTime=0,w.last=u,w.tail=o,w.tailMode=f,w.treeForkCount=m)}function up(t,n,o){var u=n.pendingProps,f=u.revealOrder,m=u.tail;u=u.children;var w=Et.current,k=(w&2)!==0;if(k?(w=w&1|2,n.flags|=128):w&=1,P(Et,w),qt(t,n,u,o),u=Je?tl:0,!k&&t!==null&&(t.flags&128)!==0)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&cp(t,o,n);else if(t.tag===19)cp(t,o,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(f){case"forwards":for(o=n.child,f=null;o!==null;)t=o.alternate,t!==null&&Or(t)===null&&(f=o),o=o.sibling;o=f,o===null?(f=n.child,n.child=null):(f=o.sibling,o.sibling=null),Mu(n,!1,f,o,m,u);break;case"backwards":case"unstable_legacy-backwards":for(o=null,f=n.child,n.child=null;f!==null;){if(t=f.alternate,t!==null&&Or(t)===null){n.child=f;break}t=f.sibling,f.sibling=o,o=f,f=t}Mu(n,!0,o,null,m,u);break;case"together":Mu(n,!1,null,null,void 0,u);break;default:n.memoizedState=null}return n.child}function un(t,n,o){if(t!==null&&(n.dependencies=t.dependencies),$n|=n.lanes,(o&n.childLanes)===0)if(t!==null){if(ea(t,n,o,!1),(o&n.childLanes)===0)return null}else return null;if(t!==null&&n.child!==t.child)throw Error(a(153));if(n.child!==null){for(t=n.child,o=nn(t,t.pendingProps),n.child=o,o.return=n;t.sibling!==null;)t=t.sibling,o=o.sibling=nn(t,t.pendingProps),o.return=n;o.sibling=null}return n.child}function Du(t,n){return(t.lanes&n)!==0?!0:(t=t.dependencies,!!(t!==null&&Tr(t)))}function Tx(t,n,o){switch(n.tag){case 3:ue(n,n.stateNode.containerInfo),Rn(n,Mt,t.memoizedState.cache),pi();break;case 27:case 5:Z(n);break;case 4:ue(n,n.stateNode.containerInfo);break;case 10:Rn(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,su(n),null;break;case 13:var u=n.memoizedState;if(u!==null)return u.dehydrated!==null?(zn(n),n.flags|=128,null):(o&n.child.childLanes)!==0?op(t,n,o):(zn(n),t=un(t,n,o),t!==null?t.sibling:null);zn(n);break;case 19:var f=(t.flags&128)!==0;if(u=(o&n.childLanes)!==0,u||(ea(t,n,o,!1),u=(o&n.childLanes)!==0),f){if(u)return up(t,n,o);n.flags|=128}if(f=n.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),P(Et,Et.current),u)break;return null;case 22:return n.lanes=0,sp(t,n,o,n.pendingProps);case 24:Rn(n,Mt,t.memoizedState.cache)}return un(t,n,o)}function hp(t,n,o){if(t!==null)if(t.memoizedProps!==n.pendingProps)Rt=!0;else{if(!Du(t,o)&&(n.flags&128)===0)return Rt=!1,Tx(t,n,o);Rt=(t.flags&131072)!==0}else Rt=!1,Je&&(n.flags&1048576)!==0&&Hf(n,tl,n.index);switch(n.lanes=0,n.tag){case 16:e:{var u=n.pendingProps;if(t=bi(n.elementType),n.type=t,typeof t=="function")zc(t)?(u=_i(t,u),n.tag=1,n=lp(null,n,t,u,o)):(n.tag=0,n=ju(null,n,t,u,o));else{if(t!=null){var f=t.$$typeof;if(f===z){n.tag=11,n=Zm(null,n,t,u,o);break e}else if(f===j){n.tag=14,n=ep(null,n,t,u,o);break e}}throw n=q(t)||t,Error(a(306,n,""))}}return n;case 0:return ju(t,n,n.type,n.pendingProps,o);case 1:return u=n.type,f=_i(u,n.pendingProps),lp(t,n,u,f,o);case 3:e:{if(ue(n,n.stateNode.containerInfo),t===null)throw Error(a(387));u=n.pendingProps;var m=n.memoizedState;f=m.element,Jc(t,n),cl(n,u,null,o);var w=n.memoizedState;if(u=w.cache,Rn(n,Mt,u),u!==m.cache&&Fc(n,[Mt],o,!0),ol(),u=w.element,m.isDehydrated)if(m={element:u,isDehydrated:!1,cache:w.cache},n.updateQueue.baseState=m,n.memoizedState=m,n.flags&256){n=rp(t,n,u,o);break e}else if(u!==f){f=ys(Error(a(424)),n),sl(f),n=rp(t,n,u,o);break e}else for(t=n.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,pt=_s(t.firstChild),Vt=n,Je=!0,Mn=null,ws=!0,o=sm(n,null,u,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(pi(),u===f){n=un(t,n,o);break e}qt(t,n,u,o)}n=n.child}return n;case 26:return Wr(t,n),t===null?(o=Sg(n.type,null,n.pendingProps,null))?n.memoizedState=o:Je||(o=n.type,t=n.pendingProps,u=co(de.current).createElement(o),u[Ne]=n,u[Qe]=t,Ft(u,o,t),Pt(u),n.stateNode=u):n.memoizedState=Sg(n.type,t.memoizedProps,n.pendingProps,t.memoizedState),null;case 27:return Z(n),t===null&&Je&&(u=n.stateNode=bg(n.type,n.pendingProps,de.current),Vt=n,ws=!0,f=pt,Fn(n.type)?(uh=f,pt=_s(u.firstChild)):pt=f),qt(t,n,n.pendingProps.children,o),Wr(t,n),t===null&&(n.flags|=4194304),n.child;case 5:return t===null&&Je&&((f=u=pt)&&(u=n1(u,n.type,n.pendingProps,ws),u!==null?(n.stateNode=u,Vt=n,pt=_s(u.firstChild),ws=!1,f=!0):f=!1),f||Dn(n)),Z(n),f=n.type,m=n.pendingProps,w=t!==null?t.memoizedProps:null,u=m.children,ah(f,m)?u=null:w!==null&&ah(f,w)&&(n.flags|=32),n.memoizedState!==null&&(f=iu(t,n,yx,null,null,o),Cl._currentValue=f),Wr(t,n),qt(t,n,u,o),n.child;case 6:return t===null&&Je&&((t=o=pt)&&(o=i1(o,n.pendingProps,ws),o!==null?(n.stateNode=o,Vt=n,pt=null,t=!0):t=!1),t||Dn(n)),null;case 13:return op(t,n,o);case 4:return ue(n,n.stateNode.containerInfo),u=n.pendingProps,t===null?n.child=wi(n,null,u,o):qt(t,n,u,o),n.child;case 11:return Zm(t,n,n.type,n.pendingProps,o);case 7:return qt(t,n,n.pendingProps,o),n.child;case 8:return qt(t,n,n.pendingProps.children,o),n.child;case 12:return qt(t,n,n.pendingProps.children,o),n.child;case 10:return u=n.pendingProps,Rn(n,n.type,u.value),qt(t,n,u.children,o),n.child;case 9:return f=n.type._context,u=n.pendingProps.children,vi(n),f=Ht(f),u=u(f),n.flags|=1,qt(t,n,u,o),n.child;case 14:return ep(t,n,n.type,n.pendingProps,o);case 15:return tp(t,n,n.type,n.pendingProps,o);case 19:return up(t,n,o);case 31:return Ex(t,n,o);case 22:return sp(t,n,o,n.pendingProps);case 24:return vi(n),u=Ht(Mt),t===null?(f=Yc(),f===null&&(f=dt,m=Wc(),f.pooledCache=m,m.refCount++,m!==null&&(f.pooledCacheLanes|=o),f=m),n.memoizedState={parent:u,cache:f},Xc(n),Rn(n,Mt,f)):((t.lanes&o)!==0&&(Jc(t,n),cl(n,null,null,o),ol()),f=t.memoizedState,m=n.memoizedState,f.parent!==u?(f={parent:u,cache:u},n.memoizedState=f,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=f),Rn(n,Mt,u)):(u=m.cache,Rn(n,Mt,u),u!==f.cache&&Fc(n,[Mt],o,!0))),qt(t,n,n.pendingProps.children,o),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function hn(t){t.flags|=4}function Ru(t,n,o,u,f){if((n=(t.mode&32)!==0)&&(n=!1),n){if(t.flags|=16777216,(f&335544128)===f)if(t.stateNode.complete)t.flags|=8192;else if(Pp())t.flags|=8192;else throw xi=Dr,Kc}else t.flags&=-16777217}function dp(t,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Tg(n))if(Pp())t.flags|=8192;else throw xi=Dr,Kc}function Yr(t,n){n!==null&&(t.flags|=4),t.flags&16384&&(n=t.tag!==22?Ha():536870912,t.lanes|=n,da|=n)}function pl(t,n){if(!Je)switch(t.tailMode){case"hidden":n=t.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:u.sibling=null}}function gt(t){var n=t.alternate!==null&&t.alternate.child===t.child,o=0,u=0;if(n)for(var f=t.child;f!==null;)o|=f.lanes|f.childLanes,u|=f.subtreeFlags&65011712,u|=f.flags&65011712,f.return=t,f=f.sibling;else for(f=t.child;f!==null;)o|=f.lanes|f.childLanes,u|=f.subtreeFlags,u|=f.flags,f.return=t,f=f.sibling;return t.subtreeFlags|=u,t.childLanes=o,n}function kx(t,n,o){var u=n.pendingProps;switch($c(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gt(n),null;case 1:return gt(n),null;case 3:return o=n.stateNode,u=null,t!==null&&(u=t.memoizedState.cache),n.memoizedState.cache!==u&&(n.flags|=2048),rn(Mt),ee(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(Zi(n)?hn(n):t===null||t.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Vc())),gt(n),null;case 26:var f=n.type,m=n.memoizedState;return t===null?(hn(n),m!==null?(gt(n),dp(n,m)):(gt(n),Ru(n,f,null,u,o))):m?m!==t.memoizedState?(hn(n),gt(n),dp(n,m)):(gt(n),n.flags&=-16777217):(t=t.memoizedProps,t!==u&&hn(n),gt(n),Ru(n,f,t,u,o)),null;case 27:if(ye(n),o=de.current,f=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==u&&hn(n);else{if(!u){if(n.stateNode===null)throw Error(a(166));return gt(n),null}t=B.current,Zi(n)?Ff(n):(t=bg(f,u,o),n.stateNode=t,hn(n))}return gt(n),null;case 5:if(ye(n),f=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==u&&hn(n);else{if(!u){if(n.stateNode===null)throw Error(a(166));return gt(n),null}if(m=B.current,Zi(n))Ff(n);else{var w=co(de.current);switch(m){case 1:m=w.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:m=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":m=w.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":m=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":m=w.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild);break;case"select":m=typeof u.is=="string"?w.createElement("select",{is:u.is}):w.createElement("select"),u.multiple?m.multiple=!0:u.size&&(m.size=u.size);break;default:m=typeof u.is=="string"?w.createElement(f,{is:u.is}):w.createElement(f)}}m[Ne]=n,m[Qe]=u;e:for(w=n.child;w!==null;){if(w.tag===5||w.tag===6)m.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===n)break e;for(;w.sibling===null;){if(w.return===null||w.return===n)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}n.stateNode=m;e:switch(Ft(m,f,u),f){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&hn(n)}}return gt(n),Ru(n,n.type,t===null?null:t.memoizedProps,n.pendingProps,o),null;case 6:if(t&&n.stateNode!=null)t.memoizedProps!==u&&hn(n);else{if(typeof u!="string"&&n.stateNode===null)throw Error(a(166));if(t=de.current,Zi(n)){if(t=n.stateNode,o=n.memoizedProps,u=null,f=Vt,f!==null)switch(f.tag){case 27:case 5:u=f.memoizedProps}t[Ne]=n,t=!!(t.nodeValue===o||u!==null&&u.suppressHydrationWarning===!0||og(t.nodeValue,o)),t||Dn(n,!0)}else t=co(t).createTextNode(u),t[Ne]=n,n.stateNode=t}return gt(n),null;case 31:if(o=n.memoizedState,t===null||t.memoizedState!==null){if(u=Zi(n),o!==null){if(t===null){if(!u)throw Error(a(318));if(t=n.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(557));t[Ne]=n}else pi(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;gt(n),t=!1}else o=Vc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),t=!0;if(!t)return n.flags&256?(us(n),n):(us(n),null);if((n.flags&128)!==0)throw Error(a(558))}return gt(n),null;case 13:if(u=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(f=Zi(n),u!==null&&u.dehydrated!==null){if(t===null){if(!f)throw Error(a(318));if(f=n.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(a(317));f[Ne]=n}else pi(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;gt(n),f=!1}else f=Vc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=f),f=!0;if(!f)return n.flags&256?(us(n),n):(us(n),null)}return us(n),(n.flags&128)!==0?(n.lanes=o,n):(o=u!==null,t=t!==null&&t.memoizedState!==null,o&&(u=n.child,f=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(f=u.alternate.memoizedState.cachePool.pool),m=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==f&&(u.flags|=2048)),o!==t&&o&&(n.child.flags|=8192),Yr(n,n.updateQueue),gt(n),null);case 4:return ee(),t===null&&eh(n.stateNode.containerInfo),gt(n),null;case 10:return rn(n.type),gt(n),null;case 19:if(T(Et),u=n.memoizedState,u===null)return gt(n),null;if(f=(n.flags&128)!==0,m=u.rendering,m===null)if(f)pl(u,!1);else{if(_t!==0||t!==null&&(t.flags&128)!==0)for(t=n.child;t!==null;){if(m=Or(t),m!==null){for(n.flags|=128,pl(u,!1),t=m.updateQueue,n.updateQueue=t,Yr(n,t),n.subtreeFlags=0,t=o,o=n.child;o!==null;)$f(o,t),o=o.sibling;return P(Et,Et.current&1|2),Je&&an(n,u.treeForkCount),n.child}t=t.sibling}u.tail!==null&&It()>Zr&&(n.flags|=128,f=!0,pl(u,!1),n.lanes=4194304)}else{if(!f)if(t=Or(m),t!==null){if(n.flags|=128,f=!0,t=t.updateQueue,n.updateQueue=t,Yr(n,t),pl(u,!0),u.tail===null&&u.tailMode==="hidden"&&!m.alternate&&!Je)return gt(n),null}else 2*It()-u.renderingStartTime>Zr&&o!==536870912&&(n.flags|=128,f=!0,pl(u,!1),n.lanes=4194304);u.isBackwards?(m.sibling=n.child,n.child=m):(t=u.last,t!==null?t.sibling=m:n.child=m,u.last=m)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=It(),t.sibling=null,o=Et.current,P(Et,f?o&1|2:o&1),Je&&an(n,u.treeForkCount),t):(gt(n),null);case 22:case 23:return us(n),tu(),u=n.memoizedState!==null,t!==null?t.memoizedState!==null!==u&&(n.flags|=8192):u&&(n.flags|=8192),u?(o&536870912)!==0&&(n.flags&128)===0&&(gt(n),n.subtreeFlags&6&&(n.flags|=8192)):gt(n),o=n.updateQueue,o!==null&&Yr(n,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==o&&(n.flags|=2048),t!==null&&T(yi),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),rn(Mt),gt(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function Cx(t,n){switch($c(n),n.tag){case 1:return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return rn(Mt),ee(),t=n.flags,(t&65536)!==0&&(t&128)===0?(n.flags=t&-65537|128,n):null;case 26:case 27:case 5:return ye(n),null;case 31:if(n.memoizedState!==null){if(us(n),n.alternate===null)throw Error(a(340));pi()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 13:if(us(n),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(a(340));pi()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return T(Et),null;case 4:return ee(),null;case 10:return rn(n.type),null;case 22:case 23:return us(n),tu(),t!==null&&T(yi),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 24:return rn(Mt),null;case 25:return null;default:return null}}function fp(t,n){switch($c(n),n.tag){case 3:rn(Mt),ee();break;case 26:case 27:case 5:ye(n);break;case 4:ee();break;case 31:n.memoizedState!==null&&us(n);break;case 13:us(n);break;case 19:T(Et);break;case 10:rn(n.type);break;case 22:case 23:us(n),tu(),t!==null&&T(yi);break;case 24:rn(Mt)}}function gl(t,n){try{var o=n.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var f=u.next;o=f;do{if((o.tag&t)===t){u=void 0;var m=o.create,w=o.inst;u=m(),w.destroy=u}o=o.next}while(o!==f)}}catch(k){at(n,n.return,k)}}function Pn(t,n,o){try{var u=n.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var m=f.next;u=m;do{if((u.tag&t)===t){var w=u.inst,k=w.destroy;if(k!==void 0){w.destroy=void 0,f=n;var V=o,ie=k;try{ie()}catch(he){at(f,V,he)}}}u=u.next}while(u!==m)}}catch(he){at(n,n.return,he)}}function mp(t){var n=t.updateQueue;if(n!==null){var o=t.stateNode;try{im(n,o)}catch(u){at(t,t.return,u)}}}function pp(t,n,o){o.props=_i(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(u){at(t,n,u)}}function vl(t,n){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var u=t.stateNode;break;case 30:u=t.stateNode;break;default:u=t.stateNode}typeof o=="function"?t.refCleanup=o(u):o.current=u}}catch(f){at(t,n,f)}}function Us(t,n){var o=t.ref,u=t.refCleanup;if(o!==null)if(typeof u=="function")try{u()}catch(f){at(t,n,f)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(f){at(t,n,f)}else o.current=null}function gp(t){var n=t.type,o=t.memoizedProps,u=t.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":o.autoFocus&&u.focus();break e;case"img":o.src?u.src=o.src:o.srcSet&&(u.srcset=o.srcSet)}}catch(f){at(t,t.return,f)}}function Au(t,n,o){try{var u=t.stateNode;Jx(u,t.type,o,n),u[Qe]=n}catch(f){at(t,t.return,f)}}function vp(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Fn(t.type)||t.tag===4}function Lu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Fn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ou(t,n,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,n?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,n):(n=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,n.appendChild(t),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=tn));else if(u!==4&&(u===27&&Fn(t.type)&&(o=t.stateNode,n=null),t=t.child,t!==null))for(Ou(t,n,o),t=t.sibling;t!==null;)Ou(t,n,o),t=t.sibling}function Kr(t,n,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,n?o.insertBefore(t,n):o.appendChild(t);else if(u!==4&&(u===27&&Fn(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(Kr(t,n,o),t=t.sibling;t!==null;)Kr(t,n,o),t=t.sibling}function yp(t){var n=t.stateNode,o=t.memoizedProps;try{for(var u=t.type,f=n.attributes;f.length;)n.removeAttributeNode(f[0]);Ft(n,u,o),n[Ne]=t,n[Qe]=o}catch(m){at(t,t.return,m)}}var dn=!1,At=!1,zu=!1,bp=typeof WeakSet=="function"?WeakSet:Set,Bt=null;function Mx(t,n){if(t=t.containerInfo,nh=vo,t=Df(t),Cc(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var f=u.anchorOffset,m=u.focusNode;u=u.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var w=0,k=-1,V=-1,ie=0,he=0,ve=t,ae=null;t:for(;;){for(var re;ve!==o||f!==0&&ve.nodeType!==3||(k=w+f),ve!==m||u!==0&&ve.nodeType!==3||(V=w+u),ve.nodeType===3&&(w+=ve.nodeValue.length),(re=ve.firstChild)!==null;)ae=ve,ve=re;for(;;){if(ve===t)break t;if(ae===o&&++ie===f&&(k=w),ae===m&&++he===u&&(V=w),(re=ve.nextSibling)!==null)break;ve=ae,ae=ve.parentNode}ve=re}o=k===-1||V===-1?null:{start:k,end:V}}else o=null}o=o||{start:0,end:0}}else o=null;for(ih={focusedElem:t,selectionRange:o},vo=!1,Bt=n;Bt!==null;)if(n=Bt,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,Bt=t;else for(;Bt!==null;){switch(n=Bt,m=n.alternate,t=n.flags,n.tag){case 0:if((t&4)!==0&&(t=n.updateQueue,t=t!==null?t.events:null,t!==null))for(o=0;o<t.length;o++)f=t[o],f.ref.impl=f.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&m!==null){t=void 0,o=n,f=m.memoizedProps,m=m.memoizedState,u=o.stateNode;try{var Ee=_i(o.type,f);t=u.getSnapshotBeforeUpdate(Ee,m),u.__reactInternalSnapshotBeforeUpdate=t}catch(Oe){at(o,o.return,Oe)}}break;case 3:if((t&1024)!==0){if(t=n.stateNode.containerInfo,o=t.nodeType,o===9)rh(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":rh(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(a(163))}if(t=n.sibling,t!==null){t.return=n.return,Bt=t;break}Bt=n.return}}function xp(t,n,o){var u=o.flags;switch(o.tag){case 0:case 11:case 15:mn(t,o),u&4&&gl(5,o);break;case 1:if(mn(t,o),u&4)if(t=o.stateNode,n===null)try{t.componentDidMount()}catch(w){at(o,o.return,w)}else{var f=_i(o.type,n.memoizedProps);n=n.memoizedState;try{t.componentDidUpdate(f,n,t.__reactInternalSnapshotBeforeUpdate)}catch(w){at(o,o.return,w)}}u&64&&mp(o),u&512&&vl(o,o.return);break;case 3:if(mn(t,o),u&64&&(t=o.updateQueue,t!==null)){if(n=null,o.child!==null)switch(o.child.tag){case 27:case 5:n=o.child.stateNode;break;case 1:n=o.child.stateNode}try{im(t,n)}catch(w){at(o,o.return,w)}}break;case 27:n===null&&u&4&&yp(o);case 26:case 5:mn(t,o),n===null&&u&4&&gp(o),u&512&&vl(o,o.return);break;case 12:mn(t,o);break;case 31:mn(t,o),u&4&&_p(t,o);break;case 13:mn(t,o),u&4&&jp(t,o),u&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=Bx.bind(null,o),a1(t,o))));break;case 22:if(u=o.memoizedState!==null||dn,!u){n=n!==null&&n.memoizedState!==null||At,f=dn;var m=At;dn=u,(At=n)&&!m?pn(t,o,(o.subtreeFlags&8772)!==0):mn(t,o),dn=f,At=m}break;case 30:break;default:mn(t,o)}}function wp(t){var n=t.alternate;n!==null&&(t.alternate=null,wp(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&qa(n)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var xt=null,es=!1;function fn(t,n,o){for(o=o.child;o!==null;)Sp(t,n,o),o=o.sibling}function Sp(t,n,o){if(Ce&&typeof Ce.onCommitFiberUnmount=="function")try{Ce.onCommitFiberUnmount(Me,o)}catch{}switch(o.tag){case 26:At||Us(o,n),fn(t,n,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:At||Us(o,n);var u=xt,f=es;Fn(o.type)&&(xt=o.stateNode,es=!1),fn(t,n,o),El(o.stateNode),xt=u,es=f;break;case 5:At||Us(o,n);case 6:if(u=xt,f=es,xt=null,fn(t,n,o),xt=u,es=f,xt!==null)if(es)try{(xt.nodeType===9?xt.body:xt.nodeName==="HTML"?xt.ownerDocument.body:xt).removeChild(o.stateNode)}catch(m){at(o,n,m)}else try{xt.removeChild(o.stateNode)}catch(m){at(o,n,m)}break;case 18:xt!==null&&(es?(t=xt,mg(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),xa(t)):mg(xt,o.stateNode));break;case 4:u=xt,f=es,xt=o.stateNode.containerInfo,es=!0,fn(t,n,o),xt=u,es=f;break;case 0:case 11:case 14:case 15:Pn(2,o,n),At||Pn(4,o,n),fn(t,n,o);break;case 1:At||(Us(o,n),u=o.stateNode,typeof u.componentWillUnmount=="function"&&pp(o,n,u)),fn(t,n,o);break;case 21:fn(t,n,o);break;case 22:At=(u=At)||o.memoizedState!==null,fn(t,n,o),At=u;break;default:fn(t,n,o)}}function _p(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{xa(t)}catch(o){at(n,n.return,o)}}}function jp(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{xa(t)}catch(o){at(n,n.return,o)}}function Dx(t){switch(t.tag){case 31:case 13:case 19:var n=t.stateNode;return n===null&&(n=t.stateNode=new bp),n;case 22:return t=t.stateNode,n=t._retryCache,n===null&&(n=t._retryCache=new bp),n;default:throw Error(a(435,t.tag))}}function Xr(t,n){var o=Dx(t);n.forEach(function(u){if(!o.has(u)){o.add(u);var f=$x.bind(null,t,u);u.then(f,f)}})}function ts(t,n){var o=n.deletions;if(o!==null)for(var u=0;u<o.length;u++){var f=o[u],m=t,w=n,k=w;e:for(;k!==null;){switch(k.tag){case 27:if(Fn(k.type)){xt=k.stateNode,es=!1;break e}break;case 5:xt=k.stateNode,es=!1;break e;case 3:case 4:xt=k.stateNode.containerInfo,es=!0;break e}k=k.return}if(xt===null)throw Error(a(160));Sp(m,w,f),xt=null,es=!1,m=f.alternate,m!==null&&(m.return=null),f.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)Np(n,t),n=n.sibling}var Rs=null;function Np(t,n){var o=t.alternate,u=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:ts(n,t),ss(t),u&4&&(Pn(3,t,t.return),gl(3,t),Pn(5,t,t.return));break;case 1:ts(n,t),ss(t),u&512&&(At||o===null||Us(o,o.return)),u&64&&dn&&(t=t.updateQueue,t!==null&&(u=t.callbacks,u!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?u:o.concat(u))));break;case 26:var f=Rs;if(ts(n,t),ss(t),u&512&&(At||o===null||Us(o,o.return)),u&4){var m=o!==null?o.memoizedState:null;if(u=t.memoizedState,o===null)if(u===null)if(t.stateNode===null){e:{u=t.type,o=t.memoizedProps,f=f.ownerDocument||f;t:switch(u){case"title":m=f.getElementsByTagName("title")[0],(!m||m[Ct]||m[Ne]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=f.createElement(u),f.head.insertBefore(m,f.querySelector("head > title"))),Ft(m,u,o),m[Ne]=t,Pt(m),u=m;break e;case"link":var w=Ng("link","href",f).get(u+(o.href||""));if(w){for(var k=0;k<w.length;k++)if(m=w[k],m.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&m.getAttribute("rel")===(o.rel==null?null:o.rel)&&m.getAttribute("title")===(o.title==null?null:o.title)&&m.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){w.splice(k,1);break t}}m=f.createElement(u),Ft(m,u,o),f.head.appendChild(m);break;case"meta":if(w=Ng("meta","content",f).get(u+(o.content||""))){for(k=0;k<w.length;k++)if(m=w[k],m.getAttribute("content")===(o.content==null?null:""+o.content)&&m.getAttribute("name")===(o.name==null?null:o.name)&&m.getAttribute("property")===(o.property==null?null:o.property)&&m.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&m.getAttribute("charset")===(o.charSet==null?null:o.charSet)){w.splice(k,1);break t}}m=f.createElement(u),Ft(m,u,o),f.head.appendChild(m);break;default:throw Error(a(468,u))}m[Ne]=t,Pt(m),u=m}t.stateNode=u}else Eg(f,t.type,t.stateNode);else t.stateNode=jg(f,u,t.memoizedProps);else m!==u?(m===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):m.count--,u===null?Eg(f,t.type,t.stateNode):jg(f,u,t.memoizedProps)):u===null&&t.stateNode!==null&&Au(t,t.memoizedProps,o.memoizedProps)}break;case 27:ts(n,t),ss(t),u&512&&(At||o===null||Us(o,o.return)),o!==null&&u&4&&Au(t,t.memoizedProps,o.memoizedProps);break;case 5:if(ts(n,t),ss(t),u&512&&(At||o===null||Us(o,o.return)),t.flags&32){f=t.stateNode;try{Hi(f,"")}catch(Ee){at(t,t.return,Ee)}}u&4&&t.stateNode!=null&&(f=t.memoizedProps,Au(t,f,o!==null?o.memoizedProps:f)),u&1024&&(zu=!0);break;case 6:if(ts(n,t),ss(t),u&4){if(t.stateNode===null)throw Error(a(162));u=t.memoizedProps,o=t.stateNode;try{o.nodeValue=u}catch(Ee){at(t,t.return,Ee)}}break;case 3:if(fo=null,f=Rs,Rs=uo(n.containerInfo),ts(n,t),Rs=f,ss(t),u&4&&o!==null&&o.memoizedState.isDehydrated)try{xa(n.containerInfo)}catch(Ee){at(t,t.return,Ee)}zu&&(zu=!1,Ep(t));break;case 4:u=Rs,Rs=uo(t.stateNode.containerInfo),ts(n,t),ss(t),Rs=u;break;case 12:ts(n,t),ss(t);break;case 31:ts(n,t),ss(t),u&4&&(u=t.updateQueue,u!==null&&(t.updateQueue=null,Xr(t,u)));break;case 13:ts(n,t),ss(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Qr=It()),u&4&&(u=t.updateQueue,u!==null&&(t.updateQueue=null,Xr(t,u)));break;case 22:f=t.memoizedState!==null;var V=o!==null&&o.memoizedState!==null,ie=dn,he=At;if(dn=ie||f,At=he||V,ts(n,t),At=he,dn=ie,ss(t),u&8192)e:for(n=t.stateNode,n._visibility=f?n._visibility&-2:n._visibility|1,f&&(o===null||V||dn||At||ji(t)),o=null,n=t;;){if(n.tag===5||n.tag===26){if(o===null){V=o=n;try{if(m=V.stateNode,f)w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{k=V.stateNode;var ve=V.memoizedProps.style,ae=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;k.style.display=ae==null||typeof ae=="boolean"?"":(""+ae).trim()}}catch(Ee){at(V,V.return,Ee)}}}else if(n.tag===6){if(o===null){V=n;try{V.stateNode.nodeValue=f?"":V.memoizedProps}catch(Ee){at(V,V.return,Ee)}}}else if(n.tag===18){if(o===null){V=n;try{var re=V.stateNode;f?pg(re,!0):pg(V.stateNode,!1)}catch(Ee){at(V,V.return,Ee)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break e;for(;n.sibling===null;){if(n.return===null||n.return===t)break e;o===n&&(o=null),n=n.return}o===n&&(o=null),n.sibling.return=n.return,n=n.sibling}u&4&&(u=t.updateQueue,u!==null&&(o=u.retryQueue,o!==null&&(u.retryQueue=null,Xr(t,o))));break;case 19:ts(n,t),ss(t),u&4&&(u=t.updateQueue,u!==null&&(t.updateQueue=null,Xr(t,u)));break;case 30:break;case 21:break;default:ts(n,t),ss(t)}}function ss(t){var n=t.flags;if(n&2){try{for(var o,u=t.return;u!==null;){if(vp(u)){o=u;break}u=u.return}if(o==null)throw Error(a(160));switch(o.tag){case 27:var f=o.stateNode,m=Lu(t);Kr(t,m,f);break;case 5:var w=o.stateNode;o.flags&32&&(Hi(w,""),o.flags&=-33);var k=Lu(t);Kr(t,k,w);break;case 3:case 4:var V=o.stateNode.containerInfo,ie=Lu(t);Ou(t,ie,V);break;default:throw Error(a(161))}}catch(he){at(t,t.return,he)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function Ep(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var n=t;Ep(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),t=t.sibling}}function mn(t,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)xp(t,n.alternate,n),n=n.sibling}function ji(t){for(t=t.child;t!==null;){var n=t;switch(n.tag){case 0:case 11:case 14:case 15:Pn(4,n,n.return),ji(n);break;case 1:Us(n,n.return);var o=n.stateNode;typeof o.componentWillUnmount=="function"&&pp(n,n.return,o),ji(n);break;case 27:El(n.stateNode);case 26:case 5:Us(n,n.return),ji(n);break;case 22:n.memoizedState===null&&ji(n);break;case 30:ji(n);break;default:ji(n)}t=t.sibling}}function pn(t,n,o){for(o=o&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var u=n.alternate,f=t,m=n,w=m.flags;switch(m.tag){case 0:case 11:case 15:pn(f,m,o),gl(4,m);break;case 1:if(pn(f,m,o),u=m,f=u.stateNode,typeof f.componentDidMount=="function")try{f.componentDidMount()}catch(ie){at(u,u.return,ie)}if(u=m,f=u.updateQueue,f!==null){var k=u.stateNode;try{var V=f.shared.hiddenCallbacks;if(V!==null)for(f.shared.hiddenCallbacks=null,f=0;f<V.length;f++)nm(V[f],k)}catch(ie){at(u,u.return,ie)}}o&&w&64&&mp(m),vl(m,m.return);break;case 27:yp(m);case 26:case 5:pn(f,m,o),o&&u===null&&w&4&&gp(m),vl(m,m.return);break;case 12:pn(f,m,o);break;case 31:pn(f,m,o),o&&w&4&&_p(f,m);break;case 13:pn(f,m,o),o&&w&4&&jp(f,m);break;case 22:m.memoizedState===null&&pn(f,m,o),vl(m,m.return);break;case 30:break;default:pn(f,m,o)}n=n.sibling}}function Iu(t,n){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&nl(o))}function Pu(t,n){t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&nl(t))}function As(t,n,o,u){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Tp(t,n,o,u),n=n.sibling}function Tp(t,n,o,u){var f=n.flags;switch(n.tag){case 0:case 11:case 15:As(t,n,o,u),f&2048&&gl(9,n);break;case 1:As(t,n,o,u);break;case 3:As(t,n,o,u),f&2048&&(t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&nl(t)));break;case 12:if(f&2048){As(t,n,o,u),t=n.stateNode;try{var m=n.memoizedProps,w=m.id,k=m.onPostCommit;typeof k=="function"&&k(w,n.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(V){at(n,n.return,V)}}else As(t,n,o,u);break;case 31:As(t,n,o,u);break;case 13:As(t,n,o,u);break;case 23:break;case 22:m=n.stateNode,w=n.alternate,n.memoizedState!==null?m._visibility&2?As(t,n,o,u):yl(t,n):m._visibility&2?As(t,n,o,u):(m._visibility|=2,ca(t,n,o,u,(n.subtreeFlags&10256)!==0||!1)),f&2048&&Iu(w,n);break;case 24:As(t,n,o,u),f&2048&&Pu(n.alternate,n);break;default:As(t,n,o,u)}}function ca(t,n,o,u,f){for(f=f&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var m=t,w=n,k=o,V=u,ie=w.flags;switch(w.tag){case 0:case 11:case 15:ca(m,w,k,V,f),gl(8,w);break;case 23:break;case 22:var he=w.stateNode;w.memoizedState!==null?he._visibility&2?ca(m,w,k,V,f):yl(m,w):(he._visibility|=2,ca(m,w,k,V,f)),f&&ie&2048&&Iu(w.alternate,w);break;case 24:ca(m,w,k,V,f),f&&ie&2048&&Pu(w.alternate,w);break;default:ca(m,w,k,V,f)}n=n.sibling}}function yl(t,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var o=t,u=n,f=u.flags;switch(u.tag){case 22:yl(o,u),f&2048&&Iu(u.alternate,u);break;case 24:yl(o,u),f&2048&&Pu(u.alternate,u);break;default:yl(o,u)}n=n.sibling}}var bl=8192;function ua(t,n,o){if(t.subtreeFlags&bl)for(t=t.child;t!==null;)kp(t,n,o),t=t.sibling}function kp(t,n,o){switch(t.tag){case 26:ua(t,n,o),t.flags&bl&&t.memoizedState!==null&&v1(o,Rs,t.memoizedState,t.memoizedProps);break;case 5:ua(t,n,o);break;case 3:case 4:var u=Rs;Rs=uo(t.stateNode.containerInfo),ua(t,n,o),Rs=u;break;case 22:t.memoizedState===null&&(u=t.alternate,u!==null&&u.memoizedState!==null?(u=bl,bl=16777216,ua(t,n,o),bl=u):ua(t,n,o));break;default:ua(t,n,o)}}function Cp(t){var n=t.alternate;if(n!==null&&(t=n.child,t!==null)){n.child=null;do n=t.sibling,t.sibling=null,t=n;while(t!==null)}}function xl(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var u=n[o];Bt=u,Dp(u,t)}Cp(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Mp(t),t=t.sibling}function Mp(t){switch(t.tag){case 0:case 11:case 15:xl(t),t.flags&2048&&Pn(9,t,t.return);break;case 3:xl(t);break;case 12:xl(t);break;case 22:var n=t.stateNode;t.memoizedState!==null&&n._visibility&2&&(t.return===null||t.return.tag!==13)?(n._visibility&=-3,Jr(t)):xl(t);break;default:xl(t)}}function Jr(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var o=0;o<n.length;o++){var u=n[o];Bt=u,Dp(u,t)}Cp(t)}for(t=t.child;t!==null;){switch(n=t,n.tag){case 0:case 11:case 15:Pn(8,n,n.return),Jr(n);break;case 22:o=n.stateNode,o._visibility&2&&(o._visibility&=-3,Jr(n));break;default:Jr(n)}t=t.sibling}}function Dp(t,n){for(;Bt!==null;){var o=Bt;switch(o.tag){case 0:case 11:case 15:Pn(8,o,n);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var u=o.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:nl(o.memoizedState.cache)}if(u=o.child,u!==null)u.return=o,Bt=u;else e:for(o=t;Bt!==null;){u=Bt;var f=u.sibling,m=u.return;if(wp(u),u===o){Bt=null;break e}if(f!==null){f.return=m,Bt=f;break e}Bt=m}}}var Rx={getCacheForType:function(t){var n=Ht(Mt),o=n.data.get(t);return o===void 0&&(o=t(),n.data.set(t,o)),o},cacheSignal:function(){return Ht(Mt).controller.signal}},Ax=typeof WeakMap=="function"?WeakMap:Map,st=0,dt=null,We=null,Ke=0,it=0,hs=null,Bn=!1,ha=!1,Bu=!1,gn=0,_t=0,$n=0,Ni=0,$u=0,ds=0,da=0,wl=null,ns=null,Uu=!1,Qr=0,Rp=0,Zr=1/0,eo=null,Un=null,zt=0,Vn=null,fa=null,vn=0,Vu=0,Hu=null,Ap=null,Sl=0,qu=null;function fs(){return(st&2)!==0&&Ke!==0?Ke&-Ke:O.T!==null?Xu():_e()}function Lp(){if(ds===0)if((Ke&536870912)===0||Je){var t=Ii;Ii<<=1,(Ii&3932160)===0&&(Ii=262144),ds=t}else ds=536870912;return t=cs.current,t!==null&&(t.flags|=32),ds}function is(t,n,o){(t===dt&&(it===2||it===9)||t.cancelPendingCommit!==null)&&(ma(t,0),Hn(t,Ke,ds,!1)),le(t,o),((st&2)===0||t!==dt)&&(t===dt&&((st&2)===0&&(Ni|=o),_t===4&&Hn(t,Ke,ds,!1)),Vs(t))}function Op(t,n,o){if((st&6)!==0)throw Error(a(327));var u=!o&&(n&127)===0&&(n&t.expiredLanes)===0||Pi(t,n),f=u?zx(t,n):Wu(t,n,!0),m=u;do{if(f===0){ha&&!u&&Hn(t,n,0,!1);break}else{if(o=t.current.alternate,m&&!Lx(o)){f=Wu(t,n,!1),m=!1;continue}if(f===2){if(m=n,t.errorRecoveryDisabledLanes&m)var w=0;else w=t.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){n=w;e:{var k=t;f=wl;var V=k.current.memoizedState.isDehydrated;if(V&&(ma(k,w).flags|=256),w=Wu(k,w,!1),w!==2){if(Bu&&!V){k.errorRecoveryDisabledLanes|=m,Ni|=m,f=4;break e}m=ns,ns=f,m!==null&&(ns===null?ns=m:ns.push.apply(ns,m))}f=w}if(m=!1,f!==2)continue}}if(f===1){ma(t,0),Hn(t,n,0,!0);break}e:{switch(u=t,m=f,m){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:Hn(u,n,ds,!Bn);break e;case 2:ns=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(f=Qr+300-It(),10<f)){if(Hn(u,n,ds,!Bn),Va(u,0,!0)!==0)break e;vn=n,u.timeoutHandle=dg(zp.bind(null,u,o,ns,eo,Uu,n,ds,Ni,da,Bn,m,"Throttled",-0,0),f);break e}zp(u,o,ns,eo,Uu,n,ds,Ni,da,Bn,m,null,-0,0)}}break}while(!0);Vs(t)}function zp(t,n,o,u,f,m,w,k,V,ie,he,ve,ae,re){if(t.timeoutHandle=-1,ve=n.subtreeFlags,ve&8192||(ve&16785408)===16785408){ve={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:tn},kp(n,m,ve);var Ee=(m&62914560)===m?Qr-It():(m&4194048)===m?Rp-It():0;if(Ee=y1(ve,Ee),Ee!==null){vn=m,t.cancelPendingCommit=Ee(qp.bind(null,t,n,m,o,u,f,w,k,V,he,ve,null,ae,re)),Hn(t,m,w,!ie);return}}qp(t,n,m,o,u,f,w,k,V)}function Lx(t){for(var n=t;;){var o=n.tag;if((o===0||o===11||o===15)&&n.flags&16384&&(o=n.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var u=0;u<o.length;u++){var f=o[u],m=f.getSnapshot;f=f.value;try{if(!rs(m(),f))return!1}catch{return!1}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Hn(t,n,o,u){n&=~$u,n&=~Ni,t.suspendedLanes|=n,t.pingedLanes&=~n,u&&(t.warmLanes|=n),u=t.expirationTimes;for(var f=n;0<f;){var m=31-bt(f),w=1<<m;u[m]=-1,f&=~w}o!==0&&xe(t,o,n)}function to(){return(st&6)===0?(_l(0),!1):!0}function Fu(){if(We!==null){if(it===0)var t=We.return;else t=We,ln=gi=null,ru(t),ia=null,al=0,t=We;for(;t!==null;)fp(t.alternate,t),t=t.return;We=null}}function ma(t,n){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,e1(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),vn=0,Fu(),dt=t,We=o=nn(t.current,null),Ke=n,it=0,hs=null,Bn=!1,ha=Pi(t,n),Bu=!1,da=ds=$u=Ni=$n=_t=0,ns=wl=null,Uu=!1,(n&8)!==0&&(n|=n&32);var u=t.entangledLanes;if(u!==0)for(t=t.entanglements,u&=n;0<u;){var f=31-bt(u),m=1<<f;n|=t[f],u&=~m}return gn=n,Sr(),o}function Ip(t,n){qe=null,O.H=fl,n===na||n===Mr?(n=Zf(),it=3):n===Kc?(n=Zf(),it=4):it=n===_u?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,hs=n,We===null&&(_t=1,qr(t,ys(n,t.current)))}function Pp(){var t=cs.current;return t===null?!0:(Ke&4194048)===Ke?Ss===null:(Ke&62914560)===Ke||(Ke&536870912)!==0?t===Ss:!1}function Bp(){var t=O.H;return O.H=fl,t===null?fl:t}function $p(){var t=O.A;return O.A=Rx,t}function so(){_t=4,Bn||(Ke&4194048)!==Ke&&cs.current!==null||(ha=!0),($n&134217727)===0&&(Ni&134217727)===0||dt===null||Hn(dt,Ke,ds,!1)}function Wu(t,n,o){var u=st;st|=2;var f=Bp(),m=$p();(dt!==t||Ke!==n)&&(eo=null,ma(t,n)),n=!1;var w=_t;e:do try{if(it!==0&&We!==null){var k=We,V=hs;switch(it){case 8:Fu(),w=6;break e;case 3:case 2:case 9:case 6:cs.current===null&&(n=!0);var ie=it;if(it=0,hs=null,pa(t,k,V,ie),o&&ha){w=0;break e}break;default:ie=it,it=0,hs=null,pa(t,k,V,ie)}}Ox(),w=_t;break}catch(he){Ip(t,he)}while(!0);return n&&t.shellSuspendCounter++,ln=gi=null,st=u,O.H=f,O.A=m,We===null&&(dt=null,Ke=0,Sr()),w}function Ox(){for(;We!==null;)Up(We)}function zx(t,n){var o=st;st|=2;var u=Bp(),f=$p();dt!==t||Ke!==n?(eo=null,Zr=It()+500,ma(t,n)):ha=Pi(t,n);e:do try{if(it!==0&&We!==null){n=We;var m=hs;t:switch(it){case 1:it=0,hs=null,pa(t,n,m,1);break;case 2:case 9:if(Jf(m)){it=0,hs=null,Vp(n);break}n=function(){it!==2&&it!==9||dt!==t||(it=7),Vs(t)},m.then(n,n);break e;case 3:it=7;break e;case 4:it=5;break e;case 7:Jf(m)?(it=0,hs=null,Vp(n)):(it=0,hs=null,pa(t,n,m,7));break;case 5:var w=null;switch(We.tag){case 26:w=We.memoizedState;case 5:case 27:var k=We;if(w?Tg(w):k.stateNode.complete){it=0,hs=null;var V=k.sibling;if(V!==null)We=V;else{var ie=k.return;ie!==null?(We=ie,no(ie)):We=null}break t}}it=0,hs=null,pa(t,n,m,5);break;case 6:it=0,hs=null,pa(t,n,m,6);break;case 8:Fu(),_t=6;break e;default:throw Error(a(462))}}Ix();break}catch(he){Ip(t,he)}while(!0);return ln=gi=null,O.H=u,O.A=f,st=o,We!==null?0:(dt=null,Ke=0,Sr(),_t)}function Ix(){for(;We!==null&&!Ms();)Up(We)}function Up(t){var n=hp(t.alternate,t,gn);t.memoizedProps=t.pendingProps,n===null?no(t):We=n}function Vp(t){var n=t,o=n.alternate;switch(n.tag){case 15:case 0:n=ap(o,n,n.pendingProps,n.type,void 0,Ke);break;case 11:n=ap(o,n,n.pendingProps,n.type.render,n.ref,Ke);break;case 5:ru(n);default:fp(o,n),n=We=$f(n,gn),n=hp(o,n,gn)}t.memoizedProps=t.pendingProps,n===null?no(t):We=n}function pa(t,n,o,u){ln=gi=null,ru(n),ia=null,al=0;var f=n.return;try{if(Nx(t,f,n,o,Ke)){_t=1,qr(t,ys(o,t.current)),We=null;return}}catch(m){if(f!==null)throw We=f,m;_t=1,qr(t,ys(o,t.current)),We=null;return}n.flags&32768?(Je||u===1?t=!0:ha||(Ke&536870912)!==0?t=!1:(Bn=t=!0,(u===2||u===9||u===3||u===6)&&(u=cs.current,u!==null&&u.tag===13&&(u.flags|=16384))),Hp(n,t)):no(n)}function no(t){var n=t;do{if((n.flags&32768)!==0){Hp(n,Bn);return}t=n.return;var o=kx(n.alternate,n,gn);if(o!==null){We=o;return}if(n=n.sibling,n!==null){We=n;return}We=n=t}while(n!==null);_t===0&&(_t=5)}function Hp(t,n){do{var o=Cx(t.alternate,t);if(o!==null){o.flags&=32767,We=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!n&&(t=t.sibling,t!==null)){We=t;return}We=t=o}while(t!==null);_t=6,We=null}function qp(t,n,o,u,f,m,w,k,V){t.cancelPendingCommit=null;do io();while(zt!==0);if((st&6)!==0)throw Error(a(327));if(n!==null){if(n===t.current)throw Error(a(177));if(m=n.lanes|n.childLanes,m|=Lc,fe(t,o,m,w,k,V),t===dt&&(We=dt=null,Ke=0),fa=n,Vn=t,vn=o,Vu=m,Hu=f,Ap=u,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Ux(ke,function(){return Kp(),null})):(t.callbackNode=null,t.callbackPriority=0),u=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||u){u=O.T,O.T=null,f=A.p,A.p=2,w=st,st|=4;try{Mx(t,n,o)}finally{st=w,A.p=f,O.T=u}}zt=1,Fp(),Wp(),Gp()}}function Fp(){if(zt===1){zt=0;var t=Vn,n=fa,o=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||o){o=O.T,O.T=null;var u=A.p;A.p=2;var f=st;st|=4;try{Np(n,t);var m=ih,w=Df(t.containerInfo),k=m.focusedElem,V=m.selectionRange;if(w!==k&&k&&k.ownerDocument&&Mf(k.ownerDocument.documentElement,k)){if(V!==null&&Cc(k)){var ie=V.start,he=V.end;if(he===void 0&&(he=ie),"selectionStart"in k)k.selectionStart=ie,k.selectionEnd=Math.min(he,k.value.length);else{var ve=k.ownerDocument||document,ae=ve&&ve.defaultView||window;if(ae.getSelection){var re=ae.getSelection(),Ee=k.textContent.length,Oe=Math.min(V.start,Ee),ct=V.end===void 0?Oe:Math.min(V.end,Ee);!re.extend&&Oe>ct&&(w=ct,ct=Oe,Oe=w);var J=Cf(k,Oe),G=Cf(k,ct);if(J&&G&&(re.rangeCount!==1||re.anchorNode!==J.node||re.anchorOffset!==J.offset||re.focusNode!==G.node||re.focusOffset!==G.offset)){var ne=ve.createRange();ne.setStart(J.node,J.offset),re.removeAllRanges(),Oe>ct?(re.addRange(ne),re.extend(G.node,G.offset)):(ne.setEnd(G.node,G.offset),re.addRange(ne))}}}}for(ve=[],re=k;re=re.parentNode;)re.nodeType===1&&ve.push({element:re,left:re.scrollLeft,top:re.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<ve.length;k++){var pe=ve[k];pe.element.scrollLeft=pe.left,pe.element.scrollTop=pe.top}}vo=!!nh,ih=nh=null}finally{st=f,A.p=u,O.T=o}}t.current=n,zt=2}}function Wp(){if(zt===2){zt=0;var t=Vn,n=fa,o=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||o){o=O.T,O.T=null;var u=A.p;A.p=2;var f=st;st|=4;try{xp(t,n.alternate,n)}finally{st=f,A.p=u,O.T=o}}zt=3}}function Gp(){if(zt===4||zt===3){zt=0,Xs();var t=Vn,n=fa,o=vn,u=Ap;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?zt=5:(zt=0,fa=Vn=null,Yp(t,t.pendingLanes));var f=t.pendingLanes;if(f===0&&(Un=null),$e(o),n=n.stateNode,Ce&&typeof Ce.onCommitFiberRoot=="function")try{Ce.onCommitFiberRoot(Me,n,void 0,(n.current.flags&128)===128)}catch{}if(u!==null){n=O.T,f=A.p,A.p=2,O.T=null;try{for(var m=t.onRecoverableError,w=0;w<u.length;w++){var k=u[w];m(k.value,{componentStack:k.stack})}}finally{O.T=n,A.p=f}}(vn&3)!==0&&io(),Vs(t),f=t.pendingLanes,(o&261930)!==0&&(f&42)!==0?t===qu?Sl++:(Sl=0,qu=t):Sl=0,_l(0)}}function Yp(t,n){(t.pooledCacheLanes&=n)===0&&(n=t.pooledCache,n!=null&&(t.pooledCache=null,nl(n)))}function io(){return Fp(),Wp(),Gp(),Kp()}function Kp(){if(zt!==5)return!1;var t=Vn,n=Vu;Vu=0;var o=$e(vn),u=O.T,f=A.p;try{A.p=32>o?32:o,O.T=null,o=Hu,Hu=null;var m=Vn,w=vn;if(zt=0,fa=Vn=null,vn=0,(st&6)!==0)throw Error(a(331));var k=st;if(st|=4,Mp(m.current),Tp(m,m.current,w,o),st=k,_l(0,!1),Ce&&typeof Ce.onPostCommitFiberRoot=="function")try{Ce.onPostCommitFiberRoot(Me,m)}catch{}return!0}finally{A.p=f,O.T=u,Yp(t,n)}}function Xp(t,n,o){n=ys(o,n),n=Su(t.stateNode,n,2),t=On(t,n,2),t!==null&&(le(t,2),Vs(t))}function at(t,n,o){if(t.tag===3)Xp(t,t,o);else for(;n!==null;){if(n.tag===3){Xp(n,t,o);break}else if(n.tag===1){var u=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Un===null||!Un.has(u))){t=ys(o,t),o=Jm(2),u=On(n,o,2),u!==null&&(Qm(o,u,n,t),le(u,2),Vs(u));break}}n=n.return}}function Gu(t,n,o){var u=t.pingCache;if(u===null){u=t.pingCache=new Ax;var f=new Set;u.set(n,f)}else f=u.get(n),f===void 0&&(f=new Set,u.set(n,f));f.has(o)||(Bu=!0,f.add(o),t=Px.bind(null,t,n,o),n.then(t,t))}function Px(t,n,o){var u=t.pingCache;u!==null&&u.delete(n),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,dt===t&&(Ke&o)===o&&(_t===4||_t===3&&(Ke&62914560)===Ke&&300>It()-Qr?(st&2)===0&&ma(t,0):$u|=o,da===Ke&&(da=0)),Vs(t)}function Jp(t,n){n===0&&(n=Ha()),t=fi(t,n),t!==null&&(le(t,n),Vs(t))}function Bx(t){var n=t.memoizedState,o=0;n!==null&&(o=n.retryLane),Jp(t,o)}function $x(t,n){var o=0;switch(t.tag){case 31:case 13:var u=t.stateNode,f=t.memoizedState;f!==null&&(o=f.retryLane);break;case 19:u=t.stateNode;break;case 22:u=t.stateNode._retryCache;break;default:throw Error(a(314))}u!==null&&u.delete(n),Jp(t,o)}function Ux(t,n){return jt(t,n)}var ao=null,ga=null,Yu=!1,lo=!1,Ku=!1,qn=0;function Vs(t){t!==ga&&t.next===null&&(ga===null?ao=ga=t:ga=ga.next=t),lo=!0,Yu||(Yu=!0,Hx())}function _l(t,n){if(!Ku&&lo){Ku=!0;do for(var o=!1,u=ao;u!==null;){if(t!==0){var f=u.pendingLanes;if(f===0)var m=0;else{var w=u.suspendedLanes,k=u.pingedLanes;m=(1<<31-bt(42|t)+1)-1,m&=f&~(w&~k),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(o=!0,tg(u,m))}else m=Ke,m=Va(u,u===dt?m:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(m&3)===0||Pi(u,m)||(o=!0,tg(u,m));u=u.next}while(o);Ku=!1}}function Vx(){Qp()}function Qp(){lo=Yu=!1;var t=0;qn!==0&&Zx()&&(t=qn);for(var n=It(),o=null,u=ao;u!==null;){var f=u.next,m=Zp(u,n);m===0?(u.next=null,o===null?ao=f:o.next=f,f===null&&(ga=o)):(o=u,(t!==0||(m&3)!==0)&&(lo=!0)),u=f}zt!==0&&zt!==5||_l(t),qn!==0&&(qn=0)}function Zp(t,n){for(var o=t.suspendedLanes,u=t.pingedLanes,f=t.expirationTimes,m=t.pendingLanes&-62914561;0<m;){var w=31-bt(m),k=1<<w,V=f[w];V===-1?((k&o)===0||(k&u)!==0)&&(f[w]=ur(k,n)):V<=n&&(t.expiredLanes|=k),m&=~k}if(n=dt,o=Ke,o=Va(t,t===n?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),u=t.callbackNode,o===0||t===n&&(it===2||it===9)||t.cancelPendingCommit!==null)return u!==null&&u!==null&&lt(u),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||Pi(t,o)){if(n=o&-o,n===t.callbackPriority)return n;switch(u!==null&&lt(u),$e(o)){case 2:case 8:o=Js;break;case 32:o=ke;break;case 268435456:o=Se;break;default:o=ke}return u=eg.bind(null,t),o=jt(o,u),t.callbackPriority=n,t.callbackNode=o,n}return u!==null&&u!==null&&lt(u),t.callbackPriority=2,t.callbackNode=null,2}function eg(t,n){if(zt!==0&&zt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(io()&&t.callbackNode!==o)return null;var u=Ke;return u=Va(t,t===dt?u:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),u===0?null:(Op(t,u,n),Zp(t,It()),t.callbackNode!=null&&t.callbackNode===o?eg.bind(null,t):null)}function tg(t,n){if(io())return null;Op(t,n,!0)}function Hx(){t1(function(){(st&6)!==0?jt(yt,Vx):Qp()})}function Xu(){if(qn===0){var t=ta;t===0&&(t=Qs,Qs<<=1,(Qs&261888)===0&&(Qs=256)),qn=t}return qn}function sg(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:mr(""+t)}function ng(t,n){var o=n.ownerDocument.createElement("input");return o.name=n.name,o.value=n.value,t.id&&o.setAttribute("form",t.id),n.parentNode.insertBefore(o,n),t=new FormData(t),o.parentNode.removeChild(o),t}function qx(t,n,o,u,f){if(n==="submit"&&o&&o.stateNode===f){var m=sg((f[Qe]||null).action),w=u.submitter;w&&(n=(n=w[Qe]||null)?sg(n.formAction):w.getAttribute("formAction"),n!==null&&(m=n,w=null));var k=new yr("action","action",null,u,f);t.push({event:k,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(qn!==0){var V=w?ng(f,w):new FormData(f);gu(o,{pending:!0,data:V,method:f.method,action:m},null,V)}}else typeof m=="function"&&(k.preventDefault(),V=w?ng(f,w):new FormData(f),gu(o,{pending:!0,data:V,method:f.method,action:m},m,V))},currentTarget:f}]})}}for(var Ju=0;Ju<Ac.length;Ju++){var Qu=Ac[Ju],Fx=Qu.toLowerCase(),Wx=Qu[0].toUpperCase()+Qu.slice(1);Ds(Fx,"on"+Wx)}Ds(Lf,"onAnimationEnd"),Ds(Of,"onAnimationIteration"),Ds(zf,"onAnimationStart"),Ds("dblclick","onDoubleClick"),Ds("focusin","onFocus"),Ds("focusout","onBlur"),Ds(ox,"onTransitionRun"),Ds(cx,"onTransitionStart"),Ds(ux,"onTransitionCancel"),Ds(If,"onTransitionEnd"),Ui("onMouseEnter",["mouseout","mouseover"]),Ui("onMouseLeave",["mouseout","mouseover"]),Ui("onPointerEnter",["pointerout","pointerover"]),Ui("onPointerLeave",["pointerout","pointerover"]),ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ci("onBeforeInput",["compositionend","keypress","textInput","paste"]),ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jl));function ig(t,n){n=(n&4)!==0;for(var o=0;o<t.length;o++){var u=t[o],f=u.event;u=u.listeners;e:{var m=void 0;if(n)for(var w=u.length-1;0<=w;w--){var k=u[w],V=k.instance,ie=k.currentTarget;if(k=k.listener,V!==m&&f.isPropagationStopped())break e;m=k,f.currentTarget=ie;try{m(f)}catch(he){wr(he)}f.currentTarget=null,m=V}else for(w=0;w<u.length;w++){if(k=u[w],V=k.instance,ie=k.currentTarget,k=k.listener,V!==m&&f.isPropagationStopped())break e;m=k,f.currentTarget=ie;try{m(f)}catch(he){wr(he)}f.currentTarget=null,m=V}}}}function Ge(t,n){var o=n[Kt];o===void 0&&(o=n[Kt]=new Set);var u=t+"__bubble";o.has(u)||(ag(n,t,2,!1),o.add(u))}function Zu(t,n,o){var u=0;n&&(u|=4),ag(o,t,u,n)}var ro="_reactListening"+Math.random().toString(36).slice(2);function eh(t){if(!t[ro]){t[ro]=!0,Jd.forEach(function(o){o!=="selectionchange"&&(Gx.has(o)||Zu(o,!1,t),Zu(o,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[ro]||(n[ro]=!0,Zu("selectionchange",!1,n))}}function ag(t,n,o,u){switch(Lg(n)){case 2:var f=w1;break;case 8:f=S1;break;default:f=ph}o=f.bind(null,n,o,t),f=void 0,!xc||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(f=!0),u?f!==void 0?t.addEventListener(n,o,{capture:!0,passive:f}):t.addEventListener(n,o,!0):f!==void 0?t.addEventListener(n,o,{passive:f}):t.addEventListener(n,o,!1)}function th(t,n,o,u,f){var m=u;if((n&1)===0&&(n&2)===0&&u!==null)e:for(;;){if(u===null)return;var w=u.tag;if(w===3||w===4){var k=u.stateNode.containerInfo;if(k===f)break;if(w===4)for(w=u.return;w!==null;){var V=w.tag;if((V===3||V===4)&&w.stateNode.containerInfo===f)return;w=w.return}for(;k!==null;){if(w=Tn(k),w===null)return;if(V=w.tag,V===5||V===6||V===26||V===27){u=m=w;continue e}k=k.parentNode}}u=u.return}uf(function(){var ie=m,he=yc(o),ve=[];e:{var ae=Pf.get(t);if(ae!==void 0){var re=yr,Ee=t;switch(t){case"keypress":if(gr(o)===0)break e;case"keydown":case"keyup":re=$b;break;case"focusin":Ee="focus",re=jc;break;case"focusout":Ee="blur",re=jc;break;case"beforeblur":case"afterblur":re=jc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=ff;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=kb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=Hb;break;case Lf:case Of:case zf:re=Db;break;case If:re=Fb;break;case"scroll":case"scrollend":re=Eb;break;case"wheel":re=Gb;break;case"copy":case"cut":case"paste":re=Ab;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=pf;break;case"toggle":case"beforetoggle":re=Kb}var Oe=(n&4)!==0,ct=!Oe&&(t==="scroll"||t==="scrollend"),J=Oe?ae!==null?ae+"Capture":null:ae;Oe=[];for(var G=ie,ne;G!==null;){var pe=G;if(ne=pe.stateNode,pe=pe.tag,pe!==5&&pe!==26&&pe!==27||ne===null||J===null||(pe=Wa(G,J),pe!=null&&Oe.push(Nl(G,pe,ne))),ct)break;G=G.return}0<Oe.length&&(ae=new re(ae,Ee,null,o,he),ve.push({event:ae,listeners:Oe}))}}if((n&7)===0){e:{if(ae=t==="mouseover"||t==="pointerover",re=t==="mouseout"||t==="pointerout",ae&&o!==vc&&(Ee=o.relatedTarget||o.fromElement)&&(Tn(Ee)||Ee[ls]))break e;if((re||ae)&&(ae=he.window===he?he:(ae=he.ownerDocument)?ae.defaultView||ae.parentWindow:window,re?(Ee=o.relatedTarget||o.toElement,re=ie,Ee=Ee?Tn(Ee):null,Ee!==null&&(ct=h(Ee),Oe=Ee.tag,Ee!==ct||Oe!==5&&Oe!==27&&Oe!==6)&&(Ee=null)):(re=null,Ee=ie),re!==Ee)){if(Oe=ff,pe="onMouseLeave",J="onMouseEnter",G="mouse",(t==="pointerout"||t==="pointerover")&&(Oe=pf,pe="onPointerLeave",J="onPointerEnter",G="pointer"),ct=re==null?ae:Fa(re),ne=Ee==null?ae:Fa(Ee),ae=new Oe(pe,G+"leave",re,o,he),ae.target=ct,ae.relatedTarget=ne,pe=null,Tn(he)===ie&&(Oe=new Oe(J,G+"enter",Ee,o,he),Oe.target=ne,Oe.relatedTarget=ct,pe=Oe),ct=pe,re&&Ee)t:{for(Oe=Yx,J=re,G=Ee,ne=0,pe=J;pe;pe=Oe(pe))ne++;pe=0;for(var De=G;De;De=Oe(De))pe++;for(;0<ne-pe;)J=Oe(J),ne--;for(;0<pe-ne;)G=Oe(G),pe--;for(;ne--;){if(J===G||G!==null&&J===G.alternate){Oe=J;break t}J=Oe(J),G=Oe(G)}Oe=null}else Oe=null;re!==null&&lg(ve,ae,re,Oe,!1),Ee!==null&&ct!==null&&lg(ve,ct,Ee,Oe,!0)}}e:{if(ae=ie?Fa(ie):window,re=ae.nodeName&&ae.nodeName.toLowerCase(),re==="select"||re==="input"&&ae.type==="file")var Ze=_f;else if(wf(ae))if(jf)Ze=ax;else{Ze=nx;var Te=sx}else re=ae.nodeName,!re||re.toLowerCase()!=="input"||ae.type!=="checkbox"&&ae.type!=="radio"?ie&&gc(ie.elementType)&&(Ze=_f):Ze=ix;if(Ze&&(Ze=Ze(t,ie))){Sf(ve,Ze,o,he);break e}Te&&Te(t,ae,ie),t==="focusout"&&ie&&ae.type==="number"&&ie.memoizedProps.value!=null&&pc(ae,"number",ae.value)}switch(Te=ie?Fa(ie):window,t){case"focusin":(wf(Te)||Te.contentEditable==="true")&&(Gi=Te,Mc=ie,el=null);break;case"focusout":el=Mc=Gi=null;break;case"mousedown":Dc=!0;break;case"contextmenu":case"mouseup":case"dragend":Dc=!1,Rf(ve,o,he);break;case"selectionchange":if(rx)break;case"keydown":case"keyup":Rf(ve,o,he)}var Fe;if(Ec)e:{switch(t){case"compositionstart":var Xe="onCompositionStart";break e;case"compositionend":Xe="onCompositionEnd";break e;case"compositionupdate":Xe="onCompositionUpdate";break e}Xe=void 0}else Wi?bf(t,o)&&(Xe="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Xe="onCompositionStart");Xe&&(gf&&o.locale!=="ko"&&(Wi||Xe!=="onCompositionStart"?Xe==="onCompositionEnd"&&Wi&&(Fe=hf()):(kn=he,wc="value"in kn?kn.value:kn.textContent,Wi=!0)),Te=oo(ie,Xe),0<Te.length&&(Xe=new mf(Xe,t,null,o,he),ve.push({event:Xe,listeners:Te}),Fe?Xe.data=Fe:(Fe=xf(o),Fe!==null&&(Xe.data=Fe)))),(Fe=Jb?Qb(t,o):Zb(t,o))&&(Xe=oo(ie,"onBeforeInput"),0<Xe.length&&(Te=new mf("onBeforeInput","beforeinput",null,o,he),ve.push({event:Te,listeners:Xe}),Te.data=Fe)),qx(ve,t,ie,o,he)}ig(ve,n)})}function Nl(t,n,o){return{instance:t,listener:n,currentTarget:o}}function oo(t,n){for(var o=n+"Capture",u=[];t!==null;){var f=t,m=f.stateNode;if(f=f.tag,f!==5&&f!==26&&f!==27||m===null||(f=Wa(t,o),f!=null&&u.unshift(Nl(t,f,m)),f=Wa(t,n),f!=null&&u.push(Nl(t,f,m))),t.tag===3)return u;t=t.return}return[]}function Yx(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function lg(t,n,o,u,f){for(var m=n._reactName,w=[];o!==null&&o!==u;){var k=o,V=k.alternate,ie=k.stateNode;if(k=k.tag,V!==null&&V===u)break;k!==5&&k!==26&&k!==27||ie===null||(V=ie,f?(ie=Wa(o,m),ie!=null&&w.unshift(Nl(o,ie,V))):f||(ie=Wa(o,m),ie!=null&&w.push(Nl(o,ie,V)))),o=o.return}w.length!==0&&t.push({event:n,listeners:w})}var Kx=/\r\n?/g,Xx=/\u0000|\uFFFD/g;function rg(t){return(typeof t=="string"?t:""+t).replace(Kx,`
`).replace(Xx,"")}function og(t,n){return n=rg(n),rg(t)===n}function ot(t,n,o,u,f,m){switch(o){case"children":typeof u=="string"?n==="body"||n==="textarea"&&u===""||Hi(t,u):(typeof u=="number"||typeof u=="bigint")&&n!=="body"&&Hi(t,""+u);break;case"className":dr(t,"class",u);break;case"tabIndex":dr(t,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":dr(t,o,u);break;case"style":of(t,u,m);break;case"data":if(n!=="object"){dr(t,"data",u);break}case"src":case"href":if(u===""&&(n!=="a"||o!=="href")){t.removeAttribute(o);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){t.removeAttribute(o);break}u=mr(""+u),t.setAttribute(o,u);break;case"action":case"formAction":if(typeof u=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(o==="formAction"?(n!=="input"&&ot(t,n,"name",f.name,f,null),ot(t,n,"formEncType",f.formEncType,f,null),ot(t,n,"formMethod",f.formMethod,f,null),ot(t,n,"formTarget",f.formTarget,f,null)):(ot(t,n,"encType",f.encType,f,null),ot(t,n,"method",f.method,f,null),ot(t,n,"target",f.target,f,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){t.removeAttribute(o);break}u=mr(""+u),t.setAttribute(o,u);break;case"onClick":u!=null&&(t.onclick=tn);break;case"onScroll":u!=null&&Ge("scroll",t);break;case"onScrollEnd":u!=null&&Ge("scrollend",t);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(a(61));if(o=u.__html,o!=null){if(f.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"multiple":t.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":t.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){t.removeAttribute("xlink:href");break}o=mr(""+u),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?t.setAttribute(o,""+u):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":u===!0?t.setAttribute(o,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?t.setAttribute(o,u):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?t.setAttribute(o,u):t.removeAttribute(o);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?t.removeAttribute(o):t.setAttribute(o,u);break;case"popover":Ge("beforetoggle",t),Ge("toggle",t),hr(t,"popover",u);break;case"xlinkActuate":en(t,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":en(t,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":en(t,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":en(t,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":en(t,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":en(t,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":en(t,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":en(t,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":en(t,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":hr(t,"is",u);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jb.get(o)||o,hr(t,o,u))}}function sh(t,n,o,u,f,m){switch(o){case"style":of(t,u,m);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(a(61));if(o=u.__html,o!=null){if(f.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"children":typeof u=="string"?Hi(t,u):(typeof u=="number"||typeof u=="bigint")&&Hi(t,""+u);break;case"onScroll":u!=null&&Ge("scroll",t);break;case"onScrollEnd":u!=null&&Ge("scrollend",t);break;case"onClick":u!=null&&(t.onclick=tn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Qd.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(f=o.endsWith("Capture"),n=o.slice(2,f?o.length-7:void 0),m=t[Qe]||null,m=m!=null?m[o]:null,typeof m=="function"&&t.removeEventListener(n,m,f),typeof u=="function")){typeof m!="function"&&m!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(n,u,f);break e}o in t?t[o]=u:u===!0?t.setAttribute(o,""):hr(t,o,u)}}}function Ft(t,n,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ge("error",t),Ge("load",t);var u=!1,f=!1,m;for(m in o)if(o.hasOwnProperty(m)){var w=o[m];if(w!=null)switch(m){case"src":u=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ot(t,n,m,w,o,null)}}f&&ot(t,n,"srcSet",o.srcSet,o,null),u&&ot(t,n,"src",o.src,o,null);return;case"input":Ge("invalid",t);var k=m=w=f=null,V=null,ie=null;for(u in o)if(o.hasOwnProperty(u)){var he=o[u];if(he!=null)switch(u){case"name":f=he;break;case"type":w=he;break;case"checked":V=he;break;case"defaultChecked":ie=he;break;case"value":m=he;break;case"defaultValue":k=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(a(137,n));break;default:ot(t,n,u,he,o,null)}}nf(t,m,k,V,ie,w,f,!1);return;case"select":Ge("invalid",t),u=w=m=null;for(f in o)if(o.hasOwnProperty(f)&&(k=o[f],k!=null))switch(f){case"value":m=k;break;case"defaultValue":w=k;break;case"multiple":u=k;default:ot(t,n,f,k,o,null)}n=m,o=w,t.multiple=!!u,n!=null?Vi(t,!!u,n,!1):o!=null&&Vi(t,!!u,o,!0);return;case"textarea":Ge("invalid",t),m=f=u=null;for(w in o)if(o.hasOwnProperty(w)&&(k=o[w],k!=null))switch(w){case"value":u=k;break;case"defaultValue":f=k;break;case"children":m=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(a(91));break;default:ot(t,n,w,k,o,null)}lf(t,u,f,m);return;case"option":for(V in o)o.hasOwnProperty(V)&&(u=o[V],u!=null)&&(V==="selected"?t.selected=u&&typeof u!="function"&&typeof u!="symbol":ot(t,n,V,u,o,null));return;case"dialog":Ge("beforetoggle",t),Ge("toggle",t),Ge("cancel",t),Ge("close",t);break;case"iframe":case"object":Ge("load",t);break;case"video":case"audio":for(u=0;u<jl.length;u++)Ge(jl[u],t);break;case"image":Ge("error",t),Ge("load",t);break;case"details":Ge("toggle",t);break;case"embed":case"source":case"link":Ge("error",t),Ge("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in o)if(o.hasOwnProperty(ie)&&(u=o[ie],u!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ot(t,n,ie,u,o,null)}return;default:if(gc(n)){for(he in o)o.hasOwnProperty(he)&&(u=o[he],u!==void 0&&sh(t,n,he,u,o,void 0));return}}for(k in o)o.hasOwnProperty(k)&&(u=o[k],u!=null&&ot(t,n,k,u,o,null))}function Jx(t,n,o,u){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var f=null,m=null,w=null,k=null,V=null,ie=null,he=null;for(re in o){var ve=o[re];if(o.hasOwnProperty(re)&&ve!=null)switch(re){case"checked":break;case"value":break;case"defaultValue":V=ve;default:u.hasOwnProperty(re)||ot(t,n,re,null,u,ve)}}for(var ae in u){var re=u[ae];if(ve=o[ae],u.hasOwnProperty(ae)&&(re!=null||ve!=null))switch(ae){case"type":m=re;break;case"name":f=re;break;case"checked":ie=re;break;case"defaultChecked":he=re;break;case"value":w=re;break;case"defaultValue":k=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(a(137,n));break;default:re!==ve&&ot(t,n,ae,re,u,ve)}}mc(t,w,k,V,ie,he,m,f);return;case"select":re=w=k=ae=null;for(m in o)if(V=o[m],o.hasOwnProperty(m)&&V!=null)switch(m){case"value":break;case"multiple":re=V;default:u.hasOwnProperty(m)||ot(t,n,m,null,u,V)}for(f in u)if(m=u[f],V=o[f],u.hasOwnProperty(f)&&(m!=null||V!=null))switch(f){case"value":ae=m;break;case"defaultValue":k=m;break;case"multiple":w=m;default:m!==V&&ot(t,n,f,m,u,V)}n=k,o=w,u=re,ae!=null?Vi(t,!!o,ae,!1):!!u!=!!o&&(n!=null?Vi(t,!!o,n,!0):Vi(t,!!o,o?[]:"",!1));return;case"textarea":re=ae=null;for(k in o)if(f=o[k],o.hasOwnProperty(k)&&f!=null&&!u.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:ot(t,n,k,null,u,f)}for(w in u)if(f=u[w],m=o[w],u.hasOwnProperty(w)&&(f!=null||m!=null))switch(w){case"value":ae=f;break;case"defaultValue":re=f;break;case"children":break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(a(91));break;default:f!==m&&ot(t,n,w,f,u,m)}af(t,ae,re);return;case"option":for(var Ee in o)ae=o[Ee],o.hasOwnProperty(Ee)&&ae!=null&&!u.hasOwnProperty(Ee)&&(Ee==="selected"?t.selected=!1:ot(t,n,Ee,null,u,ae));for(V in u)ae=u[V],re=o[V],u.hasOwnProperty(V)&&ae!==re&&(ae!=null||re!=null)&&(V==="selected"?t.selected=ae&&typeof ae!="function"&&typeof ae!="symbol":ot(t,n,V,ae,u,re));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Oe in o)ae=o[Oe],o.hasOwnProperty(Oe)&&ae!=null&&!u.hasOwnProperty(Oe)&&ot(t,n,Oe,null,u,ae);for(ie in u)if(ae=u[ie],re=o[ie],u.hasOwnProperty(ie)&&ae!==re&&(ae!=null||re!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(a(137,n));break;default:ot(t,n,ie,ae,u,re)}return;default:if(gc(n)){for(var ct in o)ae=o[ct],o.hasOwnProperty(ct)&&ae!==void 0&&!u.hasOwnProperty(ct)&&sh(t,n,ct,void 0,u,ae);for(he in u)ae=u[he],re=o[he],!u.hasOwnProperty(he)||ae===re||ae===void 0&&re===void 0||sh(t,n,he,ae,u,re);return}}for(var J in o)ae=o[J],o.hasOwnProperty(J)&&ae!=null&&!u.hasOwnProperty(J)&&ot(t,n,J,null,u,ae);for(ve in u)ae=u[ve],re=o[ve],!u.hasOwnProperty(ve)||ae===re||ae==null&&re==null||ot(t,n,ve,ae,u,re)}function cg(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Qx(){if(typeof performance.getEntriesByType=="function"){for(var t=0,n=0,o=performance.getEntriesByType("resource"),u=0;u<o.length;u++){var f=o[u],m=f.transferSize,w=f.initiatorType,k=f.duration;if(m&&k&&cg(w)){for(w=0,k=f.responseEnd,u+=1;u<o.length;u++){var V=o[u],ie=V.startTime;if(ie>k)break;var he=V.transferSize,ve=V.initiatorType;he&&cg(ve)&&(V=V.responseEnd,w+=he*(V<k?1:(k-ie)/(V-ie)))}if(--u,n+=8*(m+w)/(f.duration/1e3),t++,10<t)break}}if(0<t)return n/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var nh=null,ih=null;function co(t){return t.nodeType===9?t:t.ownerDocument}function ug(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hg(t,n){if(t===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&n==="foreignObject"?0:t}function ah(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var lh=null;function Zx(){var t=window.event;return t&&t.type==="popstate"?t===lh?!1:(lh=t,!0):(lh=null,!1)}var dg=typeof setTimeout=="function"?setTimeout:void 0,e1=typeof clearTimeout=="function"?clearTimeout:void 0,fg=typeof Promise=="function"?Promise:void 0,t1=typeof queueMicrotask=="function"?queueMicrotask:typeof fg<"u"?function(t){return fg.resolve(null).then(t).catch(s1)}:dg;function s1(t){setTimeout(function(){throw t})}function Fn(t){return t==="head"}function mg(t,n){var o=n,u=0;do{var f=o.nextSibling;if(t.removeChild(o),f&&f.nodeType===8)if(o=f.data,o==="/$"||o==="/&"){if(u===0){t.removeChild(f),xa(n);return}u--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")u++;else if(o==="html")El(t.ownerDocument.documentElement);else if(o==="head"){o=t.ownerDocument.head,El(o);for(var m=o.firstChild;m;){var w=m.nextSibling,k=m.nodeName;m[Ct]||k==="SCRIPT"||k==="STYLE"||k==="LINK"&&m.rel.toLowerCase()==="stylesheet"||o.removeChild(m),m=w}}else o==="body"&&El(t.ownerDocument.body);o=f}while(o);xa(n)}function pg(t,n){var o=t;t=0;do{var u=o.nextSibling;if(o.nodeType===1?n?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(n?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(t===0)break;t--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||t++;o=u}while(o)}function rh(t){var n=t.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var o=n;switch(n=n.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":rh(o),qa(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function n1(t,n,o,u){for(;t.nodeType===1;){var f=o;if(t.nodeName.toLowerCase()!==n.toLowerCase()){if(!u&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(u){if(!t[Ct])switch(n){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(m=t.getAttribute("rel"),m==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(m!==f.rel||t.getAttribute("href")!==(f.href==null||f.href===""?null:f.href)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin)||t.getAttribute("title")!==(f.title==null?null:f.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(m=t.getAttribute("src"),(m!==(f.src==null?null:f.src)||t.getAttribute("type")!==(f.type==null?null:f.type)||t.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin))&&m&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(n==="input"&&t.type==="hidden"){var m=f.name==null?null:""+f.name;if(f.type==="hidden"&&t.getAttribute("name")===m)return t}else return t;if(t=_s(t.nextSibling),t===null)break}return null}function i1(t,n,o){if(n==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=_s(t.nextSibling),t===null))return null;return t}function gg(t,n){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=_s(t.nextSibling),t===null))return null;return t}function oh(t){return t.data==="$?"||t.data==="$~"}function ch(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function a1(t,n){var o=t.ownerDocument;if(t.data==="$~")t._reactRetry=n;else if(t.data!=="$?"||o.readyState!=="loading")n();else{var u=function(){n(),o.removeEventListener("DOMContentLoaded",u)};o.addEventListener("DOMContentLoaded",u),t._reactRetry=u}}function _s(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return t}var uh=null;function vg(t){t=t.nextSibling;for(var n=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"||o==="/&"){if(n===0)return _s(t.nextSibling);n--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||n++}t=t.nextSibling}return null}function yg(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(n===0)return t;n--}else o!=="/$"&&o!=="/&"||n++}t=t.previousSibling}return null}function bg(t,n,o){switch(n=co(o),t){case"html":if(t=n.documentElement,!t)throw Error(a(452));return t;case"head":if(t=n.head,!t)throw Error(a(453));return t;case"body":if(t=n.body,!t)throw Error(a(454));return t;default:throw Error(a(451))}}function El(t){for(var n=t.attributes;n.length;)t.removeAttributeNode(n[0]);qa(t)}var js=new Map,xg=new Set;function uo(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var yn=A.d;A.d={f:l1,r:r1,D:o1,C:c1,L:u1,m:h1,X:f1,S:d1,M:m1};function l1(){var t=yn.f(),n=to();return t||n}function r1(t){var n=mt(t);n!==null&&n.tag===5&&n.type==="form"?Im(n):yn.r(t)}var va=typeof document>"u"?null:document;function wg(t,n,o){var u=va;if(u&&typeof n=="string"&&n){var f=gs(n);f='link[rel="'+t+'"][href="'+f+'"]',typeof o=="string"&&(f+='[crossorigin="'+o+'"]'),xg.has(f)||(xg.add(f),t={rel:t,crossOrigin:o,href:n},u.querySelector(f)===null&&(n=u.createElement("link"),Ft(n,"link",t),Pt(n),u.head.appendChild(n)))}}function o1(t){yn.D(t),wg("dns-prefetch",t,null)}function c1(t,n){yn.C(t,n),wg("preconnect",t,n)}function u1(t,n,o){yn.L(t,n,o);var u=va;if(u&&t&&n){var f='link[rel="preload"][as="'+gs(n)+'"]';n==="image"&&o&&o.imageSrcSet?(f+='[imagesrcset="'+gs(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(f+='[imagesizes="'+gs(o.imageSizes)+'"]')):f+='[href="'+gs(t)+'"]';var m=f;switch(n){case"style":m=ya(t);break;case"script":m=ba(t)}js.has(m)||(t=y({rel:"preload",href:n==="image"&&o&&o.imageSrcSet?void 0:t,as:n},o),js.set(m,t),u.querySelector(f)!==null||n==="style"&&u.querySelector(Tl(m))||n==="script"&&u.querySelector(kl(m))||(n=u.createElement("link"),Ft(n,"link",t),Pt(n),u.head.appendChild(n)))}}function h1(t,n){yn.m(t,n);var o=va;if(o&&t){var u=n&&typeof n.as=="string"?n.as:"script",f='link[rel="modulepreload"][as="'+gs(u)+'"][href="'+gs(t)+'"]',m=f;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=ba(t)}if(!js.has(m)&&(t=y({rel:"modulepreload",href:t},n),js.set(m,t),o.querySelector(f)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(kl(m)))return}u=o.createElement("link"),Ft(u,"link",t),Pt(u),o.head.appendChild(u)}}}function d1(t,n,o){yn.S(t,n,o);var u=va;if(u&&t){var f=$i(u).hoistableStyles,m=ya(t);n=n||"default";var w=f.get(m);if(!w){var k={loading:0,preload:null};if(w=u.querySelector(Tl(m)))k.loading=5;else{t=y({rel:"stylesheet",href:t,"data-precedence":n},o),(o=js.get(m))&&hh(t,o);var V=w=u.createElement("link");Pt(V),Ft(V,"link",t),V._p=new Promise(function(ie,he){V.onload=ie,V.onerror=he}),V.addEventListener("load",function(){k.loading|=1}),V.addEventListener("error",function(){k.loading|=2}),k.loading|=4,ho(w,n,u)}w={type:"stylesheet",instance:w,count:1,state:k},f.set(m,w)}}}function f1(t,n){yn.X(t,n);var o=va;if(o&&t){var u=$i(o).hoistableScripts,f=ba(t),m=u.get(f);m||(m=o.querySelector(kl(f)),m||(t=y({src:t,async:!0},n),(n=js.get(f))&&dh(t,n),m=o.createElement("script"),Pt(m),Ft(m,"link",t),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(f,m))}}function m1(t,n){yn.M(t,n);var o=va;if(o&&t){var u=$i(o).hoistableScripts,f=ba(t),m=u.get(f);m||(m=o.querySelector(kl(f)),m||(t=y({src:t,async:!0,type:"module"},n),(n=js.get(f))&&dh(t,n),m=o.createElement("script"),Pt(m),Ft(m,"link",t),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},u.set(f,m))}}function Sg(t,n,o,u){var f=(f=de.current)?uo(f):null;if(!f)throw Error(a(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(n=ya(o.href),o=$i(f).hoistableStyles,u=o.get(n),u||(u={type:"style",instance:null,count:0,state:null},o.set(n,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=ya(o.href);var m=$i(f).hoistableStyles,w=m.get(t);if(w||(f=f.ownerDocument||f,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(t,w),(m=f.querySelector(Tl(t)))&&!m._p&&(w.instance=m,w.state.loading=5),js.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},js.set(t,o),m||p1(f,t,o,w.state))),n&&u===null)throw Error(a(528,""));return w}if(n&&u!==null)throw Error(a(529,""));return null;case"script":return n=o.async,o=o.src,typeof o=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=ba(o),o=$i(f).hoistableScripts,u=o.get(n),u||(u={type:"script",instance:null,count:0,state:null},o.set(n,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,t))}}function ya(t){return'href="'+gs(t)+'"'}function Tl(t){return'link[rel="stylesheet"]['+t+"]"}function _g(t){return y({},t,{"data-precedence":t.precedence,precedence:null})}function p1(t,n,o,u){t.querySelector('link[rel="preload"][as="style"]['+n+"]")?u.loading=1:(n=t.createElement("link"),u.preload=n,n.addEventListener("load",function(){return u.loading|=1}),n.addEventListener("error",function(){return u.loading|=2}),Ft(n,"link",o),Pt(n),t.head.appendChild(n))}function ba(t){return'[src="'+gs(t)+'"]'}function kl(t){return"script[async]"+t}function jg(t,n,o){if(n.count++,n.instance===null)switch(n.type){case"style":var u=t.querySelector('style[data-href~="'+gs(o.href)+'"]');if(u)return n.instance=u,Pt(u),u;var f=y({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return u=(t.ownerDocument||t).createElement("style"),Pt(u),Ft(u,"style",f),ho(u,o.precedence,t),n.instance=u;case"stylesheet":f=ya(o.href);var m=t.querySelector(Tl(f));if(m)return n.state.loading|=4,n.instance=m,Pt(m),m;u=_g(o),(f=js.get(f))&&hh(u,f),m=(t.ownerDocument||t).createElement("link"),Pt(m);var w=m;return w._p=new Promise(function(k,V){w.onload=k,w.onerror=V}),Ft(m,"link",u),n.state.loading|=4,ho(m,o.precedence,t),n.instance=m;case"script":return m=ba(o.src),(f=t.querySelector(kl(m)))?(n.instance=f,Pt(f),f):(u=o,(f=js.get(m))&&(u=y({},o),dh(u,f)),t=t.ownerDocument||t,f=t.createElement("script"),Pt(f),Ft(f,"link",u),t.head.appendChild(f),n.instance=f);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(u=n.instance,n.state.loading|=4,ho(u,o.precedence,t));return n.instance}function ho(t,n,o){for(var u=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),f=u.length?u[u.length-1]:null,m=f,w=0;w<u.length;w++){var k=u[w];if(k.dataset.precedence===n)m=k;else if(m!==f)break}m?m.parentNode.insertBefore(t,m.nextSibling):(n=o.nodeType===9?o.head:o,n.insertBefore(t,n.firstChild))}function hh(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.title==null&&(t.title=n.title)}function dh(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.integrity==null&&(t.integrity=n.integrity)}var fo=null;function Ng(t,n,o){if(fo===null){var u=new Map,f=fo=new Map;f.set(o,u)}else f=fo,u=f.get(o),u||(u=new Map,f.set(o,u));if(u.has(t))return u;for(u.set(t,null),o=o.getElementsByTagName(t),f=0;f<o.length;f++){var m=o[f];if(!(m[Ct]||m[Ne]||t==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var w=m.getAttribute(n)||"";w=t+w;var k=u.get(w);k?k.push(m):u.set(w,[m])}}return u}function Eg(t,n,o){t=t.ownerDocument||t,t.head.insertBefore(o,n==="title"?t.querySelector("head > title"):null)}function g1(t,n,o){if(o===1||n.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(t=n.disabled,typeof n.precedence=="string"&&t==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Tg(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function v1(t,n,o,u){if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var f=ya(u.href),m=n.querySelector(Tl(f));if(m){n=m._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(t.count++,t=mo.bind(t),n.then(t,t)),o.state.loading|=4,o.instance=m,Pt(m);return}m=n.ownerDocument||n,u=_g(u),(f=js.get(f))&&hh(u,f),m=m.createElement("link"),Pt(m);var w=m;w._p=new Promise(function(k,V){w.onload=k,w.onerror=V}),Ft(m,"link",u),o.instance=m}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(o,n),(n=o.state.preload)&&(o.state.loading&3)===0&&(t.count++,o=mo.bind(t),n.addEventListener("load",o),n.addEventListener("error",o))}}var fh=0;function y1(t,n){return t.stylesheets&&t.count===0&&go(t,t.stylesheets),0<t.count||0<t.imgCount?function(o){var u=setTimeout(function(){if(t.stylesheets&&go(t,t.stylesheets),t.unsuspend){var m=t.unsuspend;t.unsuspend=null,m()}},6e4+n);0<t.imgBytes&&fh===0&&(fh=62500*Qx());var f=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&go(t,t.stylesheets),t.unsuspend)){var m=t.unsuspend;t.unsuspend=null,m()}},(t.imgBytes>fh?50:800)+n);return t.unsuspend=o,function(){t.unsuspend=null,clearTimeout(u),clearTimeout(f)}}:null}function mo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)go(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var po=null;function go(t,n){t.stylesheets=null,t.unsuspend!==null&&(t.count++,po=new Map,n.forEach(b1,t),po=null,mo.call(t))}function b1(t,n){if(!(n.state.loading&4)){var o=po.get(t);if(o)var u=o.get(null);else{o=new Map,po.set(t,o);for(var f=t.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<f.length;m++){var w=f[m];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(o.set(w.dataset.precedence,w),u=w)}u&&o.set(null,u)}f=n.instance,w=f.getAttribute("data-precedence"),m=o.get(w)||u,m===u&&o.set(null,f),o.set(w,f),this.count++,u=mo.bind(this),f.addEventListener("load",u),f.addEventListener("error",u),m?m.parentNode.insertBefore(f,m.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(f,t.firstChild)),n.state.loading|=4}}var Cl={$$typeof:H,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function x1(t,n,o,u,f,m,w,k,V){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=X(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=X(0),this.hiddenUpdates=X(null),this.identifierPrefix=u,this.onUncaughtError=f,this.onCaughtError=m,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function kg(t,n,o,u,f,m,w,k,V,ie,he,ve){return t=new x1(t,n,o,w,V,ie,he,ve,k),n=1,m===!0&&(n|=24),m=os(3,null,null,n),t.current=m,m.stateNode=t,n=Wc(),n.refCount++,t.pooledCache=n,n.refCount++,m.memoizedState={element:u,isDehydrated:o,cache:n},Xc(m),t}function Cg(t){return t?(t=Xi,t):Xi}function Mg(t,n,o,u,f,m){f=Cg(f),u.context===null?u.context=f:u.pendingContext=f,u=Ln(n),u.payload={element:o},m=m===void 0?null:m,m!==null&&(u.callback=m),o=On(t,u,n),o!==null&&(is(o,t,n),rl(o,t,n))}function Dg(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<n?o:n}}function mh(t,n){Dg(t,n),(t=t.alternate)&&Dg(t,n)}function Rg(t){if(t.tag===13||t.tag===31){var n=fi(t,67108864);n!==null&&is(n,t,67108864),mh(t,67108864)}}function Ag(t){if(t.tag===13||t.tag===31){var n=fs();n=He(n);var o=fi(t,n);o!==null&&is(o,t,n),mh(t,n)}}var vo=!0;function w1(t,n,o,u){var f=O.T;O.T=null;var m=A.p;try{A.p=2,ph(t,n,o,u)}finally{A.p=m,O.T=f}}function S1(t,n,o,u){var f=O.T;O.T=null;var m=A.p;try{A.p=8,ph(t,n,o,u)}finally{A.p=m,O.T=f}}function ph(t,n,o,u){if(vo){var f=gh(u);if(f===null)th(t,n,u,yo,o),Og(t,u);else if(j1(f,t,n,o,u))u.stopPropagation();else if(Og(t,u),n&4&&-1<_1.indexOf(t)){for(;f!==null;){var m=mt(f);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var w=Zs(m.pendingLanes);if(w!==0){var k=m;for(k.pendingLanes|=2,k.entangledLanes|=2;w;){var V=1<<31-bt(w);k.entanglements[1]|=V,w&=~V}Vs(m),(st&6)===0&&(Zr=It()+500,_l(0))}}break;case 31:case 13:k=fi(m,2),k!==null&&is(k,m,2),to(),mh(m,2)}if(m=gh(u),m===null&&th(t,n,u,yo,o),m===f)break;f=m}f!==null&&u.stopPropagation()}else th(t,n,u,null,o)}}function gh(t){return t=yc(t),vh(t)}var yo=null;function vh(t){if(yo=null,t=Tn(t),t!==null){var n=h(t);if(n===null)t=null;else{var o=n.tag;if(o===13){if(t=d(n),t!==null)return t;t=null}else if(o===31){if(t=g(n),t!==null)return t;t=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null)}}return yo=t,null}function Lg(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(En()){case yt:return 2;case Js:return 8;case ke:case me:return 32;case Se:return 268435456;default:return 32}default:return 32}}var yh=!1,Wn=null,Gn=null,Yn=null,Ml=new Map,Dl=new Map,Kn=[],_1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Og(t,n){switch(t){case"focusin":case"focusout":Wn=null;break;case"dragenter":case"dragleave":Gn=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Ml.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dl.delete(n.pointerId)}}function Rl(t,n,o,u,f,m){return t===null||t.nativeEvent!==m?(t={blockedOn:n,domEventName:o,eventSystemFlags:u,nativeEvent:m,targetContainers:[f]},n!==null&&(n=mt(n),n!==null&&Rg(n)),t):(t.eventSystemFlags|=u,n=t.targetContainers,f!==null&&n.indexOf(f)===-1&&n.push(f),t)}function j1(t,n,o,u,f){switch(n){case"focusin":return Wn=Rl(Wn,t,n,o,u,f),!0;case"dragenter":return Gn=Rl(Gn,t,n,o,u,f),!0;case"mouseover":return Yn=Rl(Yn,t,n,o,u,f),!0;case"pointerover":var m=f.pointerId;return Ml.set(m,Rl(Ml.get(m)||null,t,n,o,u,f)),!0;case"gotpointercapture":return m=f.pointerId,Dl.set(m,Rl(Dl.get(m)||null,t,n,o,u,f)),!0}return!1}function zg(t){var n=Tn(t.target);if(n!==null){var o=h(n);if(o!==null){if(n=o.tag,n===13){if(n=d(o),n!==null){t.blockedOn=n,Ve(t.priority,function(){Ag(o)});return}}else if(n===31){if(n=g(o),n!==null){t.blockedOn=n,Ve(t.priority,function(){Ag(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function bo(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var o=gh(t.nativeEvent);if(o===null){o=t.nativeEvent;var u=new o.constructor(o.type,o);vc=u,o.target.dispatchEvent(u),vc=null}else return n=mt(o),n!==null&&Rg(n),t.blockedOn=o,!1;n.shift()}return!0}function Ig(t,n,o){bo(t)&&o.delete(n)}function N1(){yh=!1,Wn!==null&&bo(Wn)&&(Wn=null),Gn!==null&&bo(Gn)&&(Gn=null),Yn!==null&&bo(Yn)&&(Yn=null),Ml.forEach(Ig),Dl.forEach(Ig)}function xo(t,n){t.blockedOn===n&&(t.blockedOn=null,yh||(yh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,N1)))}var wo=null;function Pg(t){wo!==t&&(wo=t,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){wo===t&&(wo=null);for(var n=0;n<t.length;n+=3){var o=t[n],u=t[n+1],f=t[n+2];if(typeof u!="function"){if(vh(u||o)===null)continue;break}var m=mt(o);m!==null&&(t.splice(n,3),n-=3,gu(m,{pending:!0,data:f,method:o.method,action:u},u,f))}}))}function xa(t){function n(V){return xo(V,t)}Wn!==null&&xo(Wn,t),Gn!==null&&xo(Gn,t),Yn!==null&&xo(Yn,t),Ml.forEach(n),Dl.forEach(n);for(var o=0;o<Kn.length;o++){var u=Kn[o];u.blockedOn===t&&(u.blockedOn=null)}for(;0<Kn.length&&(o=Kn[0],o.blockedOn===null);)zg(o),o.blockedOn===null&&Kn.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(u=0;u<o.length;u+=3){var f=o[u],m=o[u+1],w=f[Qe]||null;if(typeof m=="function")w||Pg(o);else if(w){var k=null;if(m&&m.hasAttribute("formAction")){if(f=m,w=m[Qe]||null)k=w.formAction;else if(vh(f)!==null)continue}else k=w.action;typeof k=="function"?o[u+1]=k:(o.splice(u,3),u-=3),Pg(o)}}}function Bg(){function t(m){m.canIntercept&&m.info==="react-transition"&&m.intercept({handler:function(){return new Promise(function(w){return f=w})},focusReset:"manual",scroll:"manual"})}function n(){f!==null&&(f(),f=null),u||setTimeout(o,20)}function o(){if(!u&&!navigation.transition){var m=navigation.currentEntry;m&&m.url!=null&&navigation.navigate(m.url,{state:m.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,f=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(o,100),function(){u=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),f!==null&&(f(),f=null)}}}function bh(t){this._internalRoot=t}So.prototype.render=bh.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(a(409));var o=n.current,u=fs();Mg(o,u,t,n,null,null)},So.prototype.unmount=bh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;Mg(t.current,2,null,t,null,null),to(),n[ls]=null}};function So(t){this._internalRoot=t}So.prototype.unstable_scheduleHydration=function(t){if(t){var n=_e();t={blockedOn:null,target:t,priority:n};for(var o=0;o<Kn.length&&n!==0&&n<Kn[o].priority;o++);Kn.splice(o,0,t),o===0&&zg(t)}};var $g=e.version;if($g!=="19.2.3")throw Error(a(527,$g,"19.2.3"));A.findDOMNode=function(t){var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(a(188)):(t=Object.keys(t).join(","),Error(a(268,t)));return t=v(n),t=t!==null?x(t):null,t=t===null?null:t.stateNode,t};var E1={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_o.isDisabled&&_o.supportsFiber)try{Me=_o.inject(E1),Ce=_o}catch{}}return Ll.createRoot=function(t,n){if(!c(t))throw Error(a(299));var o=!1,u="",f=Gm,m=Ym,w=Km;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onUncaughtError!==void 0&&(f=n.onUncaughtError),n.onCaughtError!==void 0&&(m=n.onCaughtError),n.onRecoverableError!==void 0&&(w=n.onRecoverableError)),n=kg(t,1,!1,null,null,o,u,null,f,m,w,Bg),t[ls]=n.current,eh(t),new bh(n)},Ll.hydrateRoot=function(t,n,o){if(!c(t))throw Error(a(299));var u=!1,f="",m=Gm,w=Ym,k=Km,V=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(m=o.onUncaughtError),o.onCaughtError!==void 0&&(w=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError),o.formState!==void 0&&(V=o.formState)),n=kg(t,1,!0,n,o??null,u,f,V,m,w,k,Bg),n.context=Cg(null),o=n.current,u=fs(),u=He(u),f=Ln(u),f.callback=null,On(o,f,u),o=u,n.current.lanes=o,le(n,o),Vs(n),t[ls]=n.current,eh(t),new So(n)},Ll.version="19.2.3",Ll}var Xg;function I1(){if(Xg)return Sh.exports;Xg=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Sh.exports=z1(),Sh.exports}var P1=I1();const Jg=({onBack:i,label:e=" Back"})=>l.jsx("button",{onClick:i,className:"toolbar-btn",style:{display:"inline-flex",alignItems:"center",gap:8},children:e}),nt={alpaca_config:{name:"Alpaca Data",icon:"key",color:"color-config",inputs:[],outputs:["symbol","timeframe","days"],config:[{key:"symbol",label:"Symbol",type:"text",value:"SPY"},{key:"timeframe",label:"Timeframe",type:"select",options:["1Min","5Min","15Min","1Hour","1Day"],value:"1Hour"},{key:"days",label:"Days",type:"number",value:7},{key:"keyId",label:"Alpaca Key ID",type:"text",value:""},{key:"secretKey",label:"Alpaca Secret Key",type:"text",value:""}]},input:{name:"Price Input",icon:"inbox",color:"color-input",inputs:[],outputs:["prices","volumes"],config:[{key:"symbol",label:"Symbol",type:"text",value:"SPY"},{key:"timeframe",label:"Timeframe",type:"select",options:["1Min","5Min","15Min","1Hour","1Day"],value:"1Hour"},{key:"days",label:"Days",type:"number",value:7}]},price_history:{name:"Price History",icon:"chart",color:"color-input",inputs:[],outputs:["prices"],config:[{key:"symbol",label:"Symbol",type:"text",value:"SPY"},{key:"timeframe",label:"Timeframe",type:"select",options:["1Min","5Min","15Min","1Hour","1Day"],value:"1Hour"},{key:"days",label:"Days",type:"number",value:7}]},volume_history:{name:"Volume History",icon:"chart",color:"color-volume",inputs:[],outputs:["volumes"],config:[{key:"symbol",label:"Symbol",type:"text",value:"SPY"},{key:"timeframe",label:"Timeframe",type:"select",options:["1Min","5Min","15Min","1Hour","1Day"],value:"1Hour"},{key:"days",label:"Days",type:"number",value:7}]},rsi:{name:"RSI",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["rsi"],config:[{key:"period",label:"Period",type:"number",value:14},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"overbought",label:"Overbought Level",type:"number",value:70},{key:"oversold",label:"Oversold Level",type:"number",value:30}]},ema:{name:"EMA",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["ema"],config:[{key:"period",label:"Period",type:"number",value:20},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"output",label:"Output",type:"select",options:["value","signal"],value:"value"}]},sma:{name:"SMA",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["sma"],config:[{key:"period",label:"Period",type:"number",value:20},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"output",label:"Output",type:"select",options:["value","signal"],value:"value"}]},macd:{name:"MACD",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["macd"],config:[{key:"fast",label:"Fast EMA",type:"number",value:12},{key:"slow",label:"Slow EMA",type:"number",value:26},{key:"signal",label:"Signal",type:"number",value:9},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"output",label:"Output",type:"select",options:["macd","signal","histogram"],value:"macd"}]},atr:{name:"ATR",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["atr"],config:[{key:"period",label:"Period",type:"number",value:14},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"}]},obv:{name:"OBV",icon:"drop",color:"color-volume",inputs:["prices","volumes"],outputs:["obv"],config:[]},bollinger:{name:"Bollinger Bands",icon:"chart-up",color:"color-indicator",inputs:["prices"],outputs:["upper","lower","middle"],config:[{key:"period",label:"Period",type:"number",value:20},{key:"num_std",label:"Std Dev",type:"number",value:2},{key:"source",label:"Source",type:"select",options:["current","close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"output",label:"Output",type:"select",options:["upper","lower","middle","signal"],value:"upper"}]},stochastic:{name:"Stochastic",icon:"bolt",color:"color-indicator",inputs:["prices"],outputs:["stoch"],config:[{key:"period",label:"Period",type:"number",value:14},{key:"smooth_k",label:"Smooth K",type:"number",value:3},{key:"smooth_d",label:"Smooth D",type:"number",value:3},{key:"source",label:"Source",type:"select",options:["close","open","high","low","hl2","hlc3","ohlc4"],value:"close"},{key:"overbought",label:"Overbought Level",type:"number",value:80},{key:"oversold",label:"Oversold Level",type:"number",value:20}]},vwap:{name:"VWAP",icon:"bolt",color:"color-indicator",inputs:["prices","volumes"],outputs:["vwap"],config:[{key:"output",label:"Output",type:"select",options:["value","signal"],value:"value"}]},volume_spike:{name:"Volume Spike",icon:"chart-up",color:"color-volume",inputs:["volumes"],outputs:["spike"],config:[{key:"period",label:"Period",type:"number",value:20},{key:"multiplier",label:"Multiplier",type:"number",value:1.5}]},price_levels:{name:"Price Levels",icon:"chart-up",color:"color-indicator",inputs:["prices"],outputs:["high","low","open","close"],desc:"Get high/low of day, open, close levels",config:[{key:"lookback",label:"Lookback Bars",type:"number",value:1},{key:"output",label:"Output",type:"select",options:["high","low","open","close","range"],value:"high"}]},support_resistance:{name:"Support/Resistance",icon:"chart",color:"color-indicator",inputs:["prices"],outputs:["support","resistance"],desc:"Calculate dynamic support and resistance levels",config:[{key:"period",label:"Period",type:"number",value:20},{key:"strength",label:"Strength",type:"number",value:2},{key:"output",label:"Output",type:"select",options:["support","resistance","both"],value:"support"}]},time_filter:{name:"Time Filter",icon:"clock",color:"color-logic",inputs:["signal"],outputs:["filtered"],desc:"Filter signals by market hours",config:[{key:"start_hour",label:"Start Hour (ET)",type:"number",value:9},{key:"start_minute",label:"Start Minute",type:"number",value:30},{key:"end_hour",label:"End Hour (ET)",type:"number",value:16},{key:"end_minute",label:"End Minute",type:"number",value:0},{key:"exclude_first_mins",label:"Exclude First N Mins",type:"number",value:0},{key:"exclude_last_mins",label:"Exclude Last N Mins",type:"number",value:0}]},trend_filter:{name:"Trend Filter",icon:"trending-up",color:"color-logic",inputs:["prices"],outputs:["trend"],desc:"Filter by overall trend direction",config:[{key:"fast_period",label:"Fast EMA",type:"number",value:20},{key:"slow_period",label:"Slow EMA",type:"number",value:50},{key:"output",label:"Output",type:"select",options:["bullish","bearish","neutral","signal"],value:"signal"}]},volume_filter:{name:"Volume Filter",icon:"chart-up",color:"color-volume",inputs:["volumes"],outputs:["filtered"],desc:"Filter by relative volume threshold",config:[{key:"period",label:"Avg Period",type:"number",value:20},{key:"threshold",label:"Min Rel. Volume",type:"number",value:1}]},and:{name:"AND Gate",icon:"plus",color:"color-logic",inputs:["a","b"],outputs:["result"],config:[]},or:{name:"OR Gate",icon:"plus",color:"color-logic",inputs:["a","b"],outputs:["result"],config:[]},not:{name:"NOT Gate",icon:"plus",color:"color-logic",inputs:["a"],outputs:["result"],config:[]},compare:{name:"Compare",icon:"search",color:"color-logic",inputs:["a","b"],outputs:["result"],config:[{key:"operator",label:"Operator",type:"select",options:[">","<","=",">=","<="],value:">"}]},crossover:{name:"Crossover",icon:"git-merge",color:"color-logic",inputs:["a","b"],outputs:["cross_up","cross_down"],desc:"Detect when line A crosses line B",config:[{key:"output",label:"Output",type:"select",options:["cross_up","cross_down","any"],value:"cross_up"}]},threshold:{name:"Threshold",icon:"target",color:"color-logic",inputs:["value"],outputs:["above","below"],desc:"Check if value is above or below threshold",config:[{key:"level",label:"Level",type:"number",value:50},{key:"output",label:"Output",type:"select",options:["above","below","signal"],value:"signal"}]},ai_agent:{name:"AI Agent",icon:"ai",color:"color-output",inputs:["analyse"],outputs:["signal"],config:[{key:"script",label:"Base Script",type:"textarea",value:""}]},output:{name:"Output",icon:"target",color:"color-output",inputs:["signal"],outputs:[],config:[]},note:{name:"Text Note",icon:"note",color:"color-note",inputs:[],outputs:[],isTextBox:!0,config:[{key:"content",label:"Note",type:"textarea",value:""}]}},B1=({name:i,size:e,className:s,style:a,title:c})=>{const h={width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:a};switch(i){case"chart":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("path",{d:"M3 17h2v4H3z",fill:"currentColor",fillOpacity:"0.45"}),l.jsx("path",{d:"M8 11h2v10H8z",fill:"currentColor",fillOpacity:"0.55"}),l.jsx("path",{d:"M13 5h2v16h-2z",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("path",{d:"M18 13h2v8h-2z",fill:"currentColor",fillOpacity:"0.85"})]});case"puzzle":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1",fill:"currentColor",fillOpacity:"0.12",stroke:"currentColor",strokeOpacity:"0.35"}),l.jsx("rect",{x:"13",y:"3",width:"8",height:"8",rx:"1",fill:"currentColor",fillOpacity:"0.12",stroke:"currentColor",strokeOpacity:"0.35"}),l.jsx("rect",{x:"3",y:"13",width:"8",height:"8",rx:"1",fill:"currentColor",fillOpacity:"0.12",stroke:"currentColor",strokeOpacity:"0.35"})]});case"bolt":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("path",{d:"M13 2L3 14h7l-1 8 10-12h-7l1-8z",fill:"currentColor",fillOpacity:"0.9",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"0.4"})]});case"ai":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"3",fill:"currentColor",fillOpacity:"0.08",stroke:"currentColor",strokeOpacity:"0.32"}),l.jsx("circle",{cx:"8",cy:"8",r:"1",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("circle",{cx:"16",cy:"8",r:"1",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("path",{d:"M8 16h8",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.2",strokeLinecap:"round"})]});case"drop":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("path",{d:"M12 3s5 5.5 5 9a5 5 0 11-10 0c0-3.5 5-9 5-9z",fill:"currentColor",fillOpacity:"0.7",stroke:"currentColor",strokeOpacity:"0.45"})]});case"key":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("circle",{cx:"7",cy:"12",r:"3",stroke:"currentColor",strokeOpacity:"0.5",fill:"currentColor",fillOpacity:"0.12"}),l.jsx("path",{d:"M10 12h8",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.4",strokeLinecap:"round"}),l.jsx("rect",{x:"18",y:"11",width:"2",height:"2",fill:"currentColor",fillOpacity:"0.65"})]});case"target":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("circle",{cx:"12",cy:"12",r:"8",stroke:"currentColor",strokeOpacity:"0.45",fill:"transparent"}),l.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor",fillOpacity:"0.85"})]});case"search":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("circle",{cx:"11",cy:"11",r:"5",stroke:"currentColor",strokeOpacity:"0.6"}),l.jsx("path",{d:"M20 20l-4.5-4.5",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.6",strokeLinecap:"round"})]});case"list":return l.jsxs("svg",{...h,className:s,"aria-hidden":!c,role:c?"img":"presentation",children:[c&&l.jsx("title",{children:c}),l.jsx("rect",{x:"3",y:"5",width:"3",height:"3",rx:"0.5",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("rect",{x:"3",y:"10.5",width:"3",height:"3",rx:"0.5",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("rect",{x:"3",y:"16",width:"3",height:"3",rx:"0.5",fill:"currentColor",fillOpacity:"0.7"}),l.jsx("line",{x1:"9",y1:"6.5",x2:"21",y2:"6.5",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.2",strokeLinecap:"round"}),l.jsx("line",{x1:"9",y1:"12",x2:"21",y2:"12",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.2",strokeLinecap:"round"}),l.jsx("line",{x1:"9",y1:"17.5",x2:"21",y2:"17.5",stroke:"currentColor",strokeOpacity:"0.6",strokeWidth:"1.2",strokeLinecap:"round"})]});default:return null}},Ts=({name:i,className:e="",alt:s="",size:a=18,style:c={}})=>{if(!i)return null;const h=B1({name:i,size:a,className:e,style:c,title:s||i});if(h)return h;const d=`/icons/${i}.svg`;return l.jsx("img",{src:d,alt:s||i,className:e,style:{width:a,height:a,objectFit:"contain",...c},onError:g=>{g.target.style.display="none",g.target.onerror=null}})},Na={Strategies:{desc:"Pre-built intraday trading strategies",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("path",{d:"M3 17l6-6 4 4L21 7",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M17 7h4v4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]})},Templates:{desc:"Starter strategy presets",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("path",{d:"M6 2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M13 2v6h6",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("rect",{x:"8",y:"10",width:"3",height:"2",stroke:"currentColor",strokeWidth:"1"}),l.jsx("rect",{x:"12",y:"10",width:"3",height:"2",stroke:"currentColor",strokeWidth:"1"}),l.jsx("rect",{x:"8",y:"13",width:"3",height:"2",stroke:"currentColor",strokeWidth:"1"})]})},Configuration:{desc:"Set global strategy parameters",icon:l.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:l.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.28 16.9l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.67 0 1.24-.4 1.51-1a1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.9 2.28l.06.06c.5.5 1.17.77 1.82.33.41-.26.95-.33 1.51-.33H12a2 2 0 1 1 4 0h.09c.56 0 1.1.07 1.51.33.65.44 1.32.17 1.82-.33l.06-.06A2 2 0 1 1 21.72 7.1l-.06.06c-.26.67-.33 1.24-.33 1.82V9a2 2 0 1 1 0 4h-.09c-.67 0-1.24.4-1.51 1z",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"})})},Indicators:{desc:"Add and configure technical indicators",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),l.jsx("path",{d:"M6 15l4-6 3 4 5-8",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})},Logic:{desc:"Define conditions, triggers, and rule logic",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("path",{d:"M12 3v6",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M12 9c0 3-4 3-4 6v3",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M12 9c0 3 4 3 4 6v3",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"})]})},Filters:{desc:"Filter signals by time, trend, volume",icon:l.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:l.jsx("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"})})},"AI & Output":{desc:"Use AI prediction blocks and set outputs",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("rect",{x:"4",y:"7",width:"16",height:"9",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),l.jsx("path",{d:"M9 11h.01M15 11h.01",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M12 4v3",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"})]})},Utility:{desc:"Timers, alerts, clean-up tools, helpers",icon:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[l.jsx("rect",{x:"3",y:"7",width:"18",height:"11",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),l.jsx("path",{d:"M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round"})]})}},Qg={"template-golden-cross":"Templates","template-rsi-volume":"Templates",alpaca_config:"Configuration",input:"Configuration",price_history:"Configuration",volume_history:"Configuration",rsi:"Indicators",ema:"Indicators",macd:"Indicators",atr:"Indicators",obv:"Indicators",bollinger:"Indicators",stochastic:"Indicators",vwap:"Indicators",volume_spike:"Indicators",and:"Logic",or:"Logic",not:"Logic",compare:"Logic",ai_agent:"AI & Output",output:"AI & Output",note:"Utility"},zy={"momentum-trading":{name:"Momentum Trading",desc:"EMA crossover with volume confirmation for trending moves",icon:"trending-up",timeframes:["1m","5m"],tags:["trend","momentum","ema"],nodes:[{id:1,type:"input",x:80,y:120,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:1}},{id:2,type:"volume_history",x:80,y:280,title:"Volume Data",configValues:{}},{id:3,type:"volume_spike",x:280,y:280,title:"Volume Filter",configValues:{period:20,multiplier:1.5}},{id:4,type:"ema",x:280,y:80,title:"Fast EMA (9)",configValues:{period:9,source:"close",output:"value"}},{id:5,type:"ema",x:280,y:160,title:"Slow EMA (20)",configValues:{period:20,source:"close",output:"value"}},{id:6,type:"compare",x:480,y:120,title:"EMA Cross Up",configValues:{operator:">"}},{id:7,type:"and",x:680,y:180,title:"Confirm Signal",configValues:{}},{id:8,type:"output",x:880,y:180,title:"Signal Output",configValues:{}},{id:9,type:"note",x:80,y:400,title:"Strategy Notes",configValues:{content:`MOMENTUM TRADING

Entry: Fast EMA crosses above Slow EMA with volume spike
Exit: Fast EMA crosses below Slow EMA or momentum loss
Risk: Stop below recent pullback low

Best for: Trending markets, high relative volume`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:5,port:"prices"}},{id:"c3",from:{nodeId:2,port:"volumes"},to:{nodeId:3,port:"volumes"}},{id:"c4",from:{nodeId:4,port:"ema"},to:{nodeId:6,port:"a"}},{id:"c5",from:{nodeId:5,port:"ema"},to:{nodeId:6,port:"b"}},{id:"c6",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"a"}},{id:"c7",from:{nodeId:3,port:"spike"},to:{nodeId:7,port:"b"}},{id:"c8",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"signal"}}]},scalping:{name:"VWAP Scalping",desc:"Quick trades on VWAP reactions during liquid hours",icon:"zap",timeframes:["30s","1m"],tags:["scalp","vwap","quick"],nodes:[{id:1,type:"input",x:80,y:120,title:"Price Input",configValues:{symbol:"SPY",timeframe:"1Min",days:1}},{id:2,type:"volume_history",x:80,y:260,title:"Volume Data",configValues:{}},{id:3,type:"vwap",x:280,y:180,title:"VWAP",configValues:{output:"signal",condition:"near"}},{id:4,type:"rsi",x:280,y:300,title:"RSI Momentum",configValues:{period:7,source:"close",overbought:70,oversold:30}},{id:5,type:"and",x:480,y:220,title:"Confirm Entry",configValues:{}},{id:6,type:"output",x:680,y:220,title:"Signal Output",configValues:{}},{id:7,type:"note",x:80,y:420,title:"Strategy Notes",configValues:{content:`VWAP SCALPING

Entry: Price reacts at VWAP with RSI confirmation
Exit: Quick profit target (2-5 ticks) or VWAP failure
Risk: Tight stop (1-2 ticks)

Best for: High liquidity stocks, market open hours
Timing: First 90 min and last 60 min of session`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c2",from:{nodeId:2,port:"volumes"},to:{nodeId:3,port:"volumes"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:3,port:"signal"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:4,port:"signal"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:5,port:"result"},to:{nodeId:6,port:"signal"}}]},breakout:{name:"Breakout Trading",desc:"Bollinger Band breakout with volume confirmation (entry + exit)",icon:"arrow-up-right",timeframes:["1m","5m"],tags:["breakout","bollinger","volume"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:1}},{id:2,type:"volume_history",x:80,y:300,title:"Volume Data",configValues:{}},{id:3,type:"bollinger",x:280,y:80,title:"BB Upper",configValues:{period:20,num_std:2,source:"close",output:"upper"}},{id:4,type:"bollinger",x:280,y:180,title:"BB Lower",configValues:{period:20,num_std:2,source:"close",output:"lower"}},{id:5,type:"volume_spike",x:280,y:300,title:"Volume Spike",configValues:{period:20,multiplier:1.5}},{id:6,type:"compare",x:480,y:80,title:"Price > Upper BB",configValues:{operator:">"}},{id:7,type:"compare",x:480,y:180,title:"Price < Lower BB",configValues:{operator:"<"}},{id:8,type:"and",x:680,y:100,title:"Breakout UP",configValues:{}},{id:9,type:"signal",x:880,y:100,title:"BUY Signal",configValues:{type:"BUY"}},{id:10,type:"signal",x:880,y:200,title:"SELL Signal",configValues:{type:"SELL"}},{id:11,type:"note",x:80,y:450,title:"Strategy Notes",configValues:{content:`BREAKOUT TRADING

BUY: Price closes above upper BB with volume spike (1.5x avg)
SELL: Price closes below lower BB (exit/reversal)

Risk: Use stop-loss below entry candle low
Key: Wait for candle CLOSE above resistance, not just a wick`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c3",from:{nodeId:2,port:"volumes"},to:{nodeId:5,port:"volumes"}},{id:"c4",from:{nodeId:1,port:"prices"},to:{nodeId:6,port:"a"}},{id:"c5",from:{nodeId:3,port:"upper"},to:{nodeId:6,port:"b"}},{id:"c6",from:{nodeId:1,port:"prices"},to:{nodeId:7,port:"a"}},{id:"c7",from:{nodeId:4,port:"lower"},to:{nodeId:7,port:"b"}},{id:"c8",from:{nodeId:6,port:"result"},to:{nodeId:8,port:"a"}},{id:"c9",from:{nodeId:5,port:"spike"},to:{nodeId:8,port:"b"}},{id:"c10",from:{nodeId:8,port:"result"},to:{nodeId:9,port:"signal"}},{id:"c11",from:{nodeId:7,port:"result"},to:{nodeId:10,port:"signal"}}]},"range-trading":{name:"Range Trading",desc:"Fade moves at support/resistance with RSI extremes",icon:"git-merge",timeframes:["5m","15m"],tags:["range","rsi","mean-reversion"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:2}},{id:2,type:"bollinger",x:280,y:80,title:"BB Upper (Resistance)",configValues:{period:20,num_std:2,source:"close",output:"upper"}},{id:3,type:"bollinger",x:280,y:180,title:"BB Lower (Support)",configValues:{period:20,num_std:2,source:"close",output:"lower"}},{id:4,type:"rsi",x:280,y:300,title:"RSI",configValues:{period:14,source:"close",overbought:70,oversold:30}},{id:5,type:"compare",x:480,y:120,title:"At Resistance",configValues:{operator:">="}},{id:6,type:"compare",x:480,y:260,title:"RSI Overbought",configValues:{operator:">="}},{id:7,type:"and",x:680,y:180,title:"Sell Signal",configValues:{}},{id:8,type:"output",x:880,y:180,title:"Signal Output",configValues:{}},{id:9,type:"note",x:80,y:450,title:"Strategy Notes",configValues:{content:`RANGE TRADING

Entry: Price at BB boundary + RSI extreme
- At upper band + RSI overbought = SELL
- At lower band + RSI oversold = BUY

Exit: Middle of range (BB middle) or opposite boundary
Risk: Stop outside the range boundary

Best for: Choppy, non-trending markets`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:2,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:1,port:"prices"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:2,port:"upper"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:4,port:"rsi"},to:{nodeId:6,port:"a"}},{id:"c7",from:{nodeId:5,port:"result"},to:{nodeId:7,port:"a"}},{id:"c8",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"b"}},{id:"c9",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"signal"}}]},pullback:{name:"Pullback Trading",desc:"Enter on pullbacks to EMAs in trending markets",icon:"corner-down-right",timeframes:["3m","5m"],tags:["trend","pullback","ema"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:1}},{id:2,type:"ema",x:280,y:80,title:"Fast EMA (9)",configValues:{period:9,source:"close",output:"value"}},{id:3,type:"ema",x:280,y:180,title:"Slow EMA (20)",configValues:{period:20,source:"close",output:"value"}},{id:4,type:"ema",x:280,y:280,title:"Trend EMA (50)",configValues:{period:50,source:"close",output:"value"}},{id:5,type:"compare",x:480,y:80,title:"Trend Up (9>20)",configValues:{operator:">"}},{id:6,type:"compare",x:480,y:180,title:"Trend Up (20>50)",configValues:{operator:">"}},{id:7,type:"compare",x:480,y:280,title:"Price at EMA Zone",configValues:{operator:"<="}},{id:8,type:"and",x:680,y:130,title:"Trend Confirmed",configValues:{}},{id:9,type:"and",x:880,y:180,title:"Pullback Entry",configValues:{}},{id:10,type:"output",x:1080,y:180,title:"Signal Output",configValues:{}},{id:11,type:"note",x:80,y:420,title:"Strategy Notes",configValues:{content:`PULLBACK TRADING

Setup: EMAs stacked (9 > 20 > 50) = uptrend
Entry: Price pulls back to the 9-20 EMA zone
Exit: Trend continuation target or structure break
Risk: Stop below pullback low

Key: Only trade in direction of the larger trend`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:2,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:2,port:"ema"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:3,port:"ema"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:3,port:"ema"},to:{nodeId:6,port:"a"}},{id:"c7",from:{nodeId:4,port:"ema"},to:{nodeId:6,port:"b"}},{id:"c8",from:{nodeId:1,port:"prices"},to:{nodeId:7,port:"a"}},{id:"c9",from:{nodeId:2,port:"ema"},to:{nodeId:7,port:"b"}},{id:"c10",from:{nodeId:5,port:"result"},to:{nodeId:8,port:"a"}},{id:"c11",from:{nodeId:6,port:"result"},to:{nodeId:8,port:"b"}},{id:"c12",from:{nodeId:8,port:"result"},to:{nodeId:9,port:"a"}},{id:"c13",from:{nodeId:7,port:"result"},to:{nodeId:9,port:"b"}},{id:"c14",from:{nodeId:9,port:"result"},to:{nodeId:10,port:"signal"}}]},"vwap-reversion":{name:"VWAP Mean Reversion",desc:"Trade mean reversion when price extends from VWAP",icon:"refresh-cw",timeframes:["1m","5m"],tags:["vwap","mean-reversion","fade"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"1Min",days:1}},{id:2,type:"volume_history",x:80,y:300,title:"Volume Data",configValues:{}},{id:3,type:"vwap",x:280,y:200,title:"VWAP",configValues:{output:"value"}},{id:4,type:"atr",x:280,y:320,title:"ATR (Extension)",configValues:{period:14,source:"close"}},{id:5,type:"rsi",x:480,y:100,title:"RSI Extreme",configValues:{period:7,source:"close",overbought:80,oversold:20}},{id:6,type:"compare",x:480,y:240,title:"Extended from VWAP",configValues:{operator:">"}},{id:7,type:"and",x:680,y:180,title:"Reversion Setup",configValues:{}},{id:8,type:"output",x:880,y:180,title:"Signal Output",configValues:{}},{id:9,type:"note",x:80,y:460,title:"Strategy Notes",configValues:{content:`VWAP MEAN REVERSION

Setup: Price extended > 1 ATR from VWAP
Entry: RSI extreme + extension from VWAP
Exit: Return to VWAP
Risk: Stop beyond the extension high/low

Key: Best in ranging/choppy conditions, avoid strong trends`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c2",from:{nodeId:2,port:"volumes"},to:{nodeId:3,port:"volumes"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:1,port:"prices"},to:{nodeId:5,port:"prices"}},{id:"c5",from:{nodeId:4,port:"atr"},to:{nodeId:6,port:"b"}},{id:"c6",from:{nodeId:5,port:"signal"},to:{nodeId:7,port:"a"}},{id:"c7",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"b"}},{id:"c8",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"signal"}}]},reversal:{name:"Reversal Trading",desc:"Counter-trend entries on exhaustion signals",icon:"rotate-ccw",timeframes:["1m","5m"],tags:["reversal","rsi","counter-trend"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:1}},{id:2,type:"volume_history",x:80,y:300,title:"Volume Data",configValues:{}},{id:3,type:"rsi",x:280,y:100,title:"RSI Extreme",configValues:{period:14,source:"close",overbought:80,oversold:20}},{id:4,type:"volume_spike",x:280,y:300,title:"Exhaustion Volume",configValues:{period:20,multiplier:2.5}},{id:5,type:"stochastic",x:280,y:420,title:"Stochastic Cross",configValues:{period:14,smooth_k:3,smooth_d:3,source:"close",overbought:80,oversold:20}},{id:6,type:"and",x:480,y:180,title:"RSI + Volume",configValues:{}},{id:7,type:"and",x:680,y:250,title:"Reversal Confirm",configValues:{}},{id:8,type:"output",x:880,y:250,title:"Signal Output",configValues:{}},{id:9,type:"note",x:80,y:550,title:"Strategy Notes",configValues:{content:`REVERSAL TRADING

Setup: RSI extreme + exhaustion volume spike
Confirmation: Stochastic cross in overbought/oversold
Entry: Counter to prevailing move
Exit: VWAP or prior structure level
Risk: Tight stop beyond the extreme

Caution: High risk strategy, use smaller size`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c2",from:{nodeId:2,port:"volumes"},to:{nodeId:4,port:"volumes"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:5,port:"prices"}},{id:"c4",from:{nodeId:3,port:"signal"},to:{nodeId:6,port:"a"}},{id:"c5",from:{nodeId:4,port:"spike"},to:{nodeId:6,port:"b"}},{id:"c6",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"a"}},{id:"c7",from:{nodeId:5,port:"signal"},to:{nodeId:7,port:"b"}},{id:"c8",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"signal"}}]},"gap-and-go":{name:"Gap and Go",desc:"Trade gap continuation at market open",icon:"sunrise",timeframes:["1m","5m"],tags:["gap","open","momentum"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"1Min",days:1}},{id:2,type:"volume_history",x:80,y:300,title:"Volume Data",configValues:{}},{id:3,type:"volume_spike",x:280,y:300,title:"High Volume",configValues:{period:20,multiplier:2}},{id:4,type:"vwap",x:280,y:150,title:"VWAP",configValues:{output:"signal"}},{id:5,type:"ema",x:480,y:80,title:"Fast EMA (9)",configValues:{period:9,source:"close",output:"value"}},{id:6,type:"compare",x:480,y:200,title:"Above VWAP",configValues:{operator:">"}},{id:7,type:"and",x:680,y:180,title:"Gap Continuation",configValues:{}},{id:11,type:"compare",x:680,y:80,title:"Price > EMA",configValues:{operator:">"}},{id:8,type:"and",x:880,y:240,title:"Final Signal",configValues:{}},{id:9,type:"output",x:1080,y:240,title:"Signal Output",configValues:{}},{id:10,type:"note",x:80,y:460,title:"Strategy Notes",configValues:{content:`GAP AND GO

Timing: First 30-60 minutes of market open
Setup: Gap up + high pre-market volume
Entry: Break and hold above pre-market high / VWAP
Exit: Momentum stall or target hit
Risk: Stop below VWAP or opening range low

Key: Focus on stocks with catalyst (news, earnings)`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c2",from:{nodeId:2,port:"volumes"},to:{nodeId:4,port:"volumes"}},{id:"c3",from:{nodeId:2,port:"volumes"},to:{nodeId:3,port:"volumes"}},{id:"c4",from:{nodeId:1,port:"prices"},to:{nodeId:5,port:"prices"}},{id:"c5",from:{nodeId:1,port:"prices"},to:{nodeId:6,port:"a"}},{id:"c6",from:{nodeId:4,port:"vwap"},to:{nodeId:6,port:"b"}},{id:"c7",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"a"}},{id:"c8",from:{nodeId:3,port:"spike"},to:{nodeId:7,port:"b"}},{id:"c9",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"a"}},{id:"c12",from:{nodeId:1,port:"prices"},to:{nodeId:11,port:"a"}},{id:"c13",from:{nodeId:5,port:"ema"},to:{nodeId:11,port:"b"}},{id:"c10",from:{nodeId:11,port:"result"},to:{nodeId:8,port:"b"}},{id:"c11",from:{nodeId:8,port:"result"},to:{nodeId:9,port:"signal"}}]},"news-momentum":{name:"News Momentum",desc:"Ride strong directional moves after news events",icon:"radio",timeframes:["1m"],tags:["news","momentum","volume"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"1Min",days:1}},{id:2,type:"volume_history",x:80,y:300,title:"Volume Data",configValues:{}},{id:3,type:"volume_spike",x:280,y:300,title:"Volume Surge",configValues:{period:20,multiplier:3}},{id:4,type:"macd",x:280,y:150,title:"MACD Momentum",configValues:{fast:12,slow:26,signal:9,source:"close",output:"histogram"}},{id:8,type:"compare",x:380,y:150,title:"MACD > 0",configValues:{operator:">",threshold:0}},{id:5,type:"and",x:480,y:220,title:"News Signal",configValues:{}},{id:6,type:"output",x:680,y:220,title:"Signal Output",configValues:{}},{id:7,type:"note",x:80,y:460,title:"Strategy Notes",configValues:{content:`NEWS MOMENTUM

Trigger: Relative volume surge (3x+ normal)
Entry: Direction of strong candles post-news (MACD bullish)
Exit: Momentum stall (MACD histogram shrinking)

Key: Quick reaction required, use hotkeys
Caution: Wide spreads during news events`}}],connections:[{id:"c1",from:{nodeId:2,port:"volumes"},to:{nodeId:3,port:"volumes"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c3",from:{nodeId:3,port:"spike"},to:{nodeId:5,port:"a"}},{id:"c6",from:{nodeId:4,port:"macd"},to:{nodeId:8,port:"a"}},{id:"c4",from:{nodeId:8,port:"result"},to:{nodeId:5,port:"b"}},{id:"c5",from:{nodeId:5,port:"result"},to:{nodeId:6,port:"signal"}}]},"intraday-trend":{name:"Intraday Trend Following",desc:"Follow the intraday trend with EMA alignment",icon:"trending-up",timeframes:["5m","15m"],tags:["trend","ema","follow"],nodes:[{id:1,type:"input",x:80,y:180,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:2}},{id:2,type:"ema",x:280,y:80,title:"EMA 20",configValues:{period:20,source:"close",output:"value"}},{id:3,type:"ema",x:280,y:180,title:"EMA 50",configValues:{period:50,source:"close",output:"value"}},{id:4,type:"macd",x:280,y:300,title:"MACD",configValues:{fast:12,slow:26,signal:9,source:"close",output:"histogram"}},{id:5,type:"compare",x:480,y:130,title:"EMA 20 > EMA 50",configValues:{operator:">"}},{id:6,type:"compare",x:480,y:250,title:"MACD Positive",configValues:{operator:">"}},{id:7,type:"compare",x:480,y:360,title:"Price > EMA 20",configValues:{operator:">"}},{id:8,type:"and",x:680,y:180,title:"Trend Aligned",configValues:{}},{id:9,type:"and",x:880,y:240,title:"Final Confirm",configValues:{}},{id:10,type:"output",x:1080,y:240,title:"Signal Output",configValues:{}},{id:11,type:"note",x:80,y:480,title:"Strategy Notes",configValues:{content:`INTRADAY TREND FOLLOWING

Setup: 20 EMA above 50 EMA + MACD positive
Entry: Price above 20 EMA (trend continuation)
Exit: Trend break (price closes below 20 EMA)
Risk: Trailing stop using structure or ATR

Key: Let winners run, cut losers quickly`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:2,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:2,port:"ema"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:3,port:"ema"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:4,port:"macd"},to:{nodeId:6,port:"a"}},{id:"c7",from:{nodeId:1,port:"prices"},to:{nodeId:7,port:"a"}},{id:"c8",from:{nodeId:2,port:"ema"},to:{nodeId:7,port:"b"}},{id:"c9",from:{nodeId:5,port:"result"},to:{nodeId:8,port:"a"}},{id:"c10",from:{nodeId:6,port:"result"},to:{nodeId:8,port:"b"}},{id:"c11",from:{nodeId:8,port:"result"},to:{nodeId:9,port:"a"}},{id:"c12",from:{nodeId:7,port:"result"},to:{nodeId:9,port:"b"}},{id:"c13",from:{nodeId:9,port:"result"},to:{nodeId:10,port:"signal"}}]},"rsi-divergence":{name:"RSI Divergence",desc:"Spot divergence between price and RSI for reversals",icon:"git-branch",timeframes:["5m","15m"],tags:["divergence","rsi","reversal"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:2}},{id:2,type:"rsi",x:280,y:120,title:"RSI",configValues:{period:14,source:"close",overbought:70,oversold:30}},{id:3,type:"stochastic",x:280,y:260,title:"Stochastic",configValues:{period:14,smooth_k:3,smooth_d:3,source:"close",overbought:80,oversold:20}},{id:4,type:"macd",x:480,y:80,title:"MACD Confirm",configValues:{fast:12,slow:26,signal:9,source:"close",output:"histogram"}},{id:9,type:"compare",x:580,y:80,title:"MACD > 0",configValues:{operator:">",threshold:0}},{id:5,type:"and",x:480,y:200,title:"RSI + Stoch",configValues:{}},{id:6,type:"and",x:680,y:150,title:"Divergence Signal",configValues:{}},{id:7,type:"output",x:880,y:150,title:"Signal Output",configValues:{}},{id:8,type:"note",x:80,y:400,title:"Strategy Notes",configValues:{content:`RSI DIVERGENCE

Bullish Divergence: Price makes lower low, RSI makes higher low
Bearish Divergence: Price makes higher high, RSI makes lower high

Entry: After divergence confirmed + MACD cross
Exit: Prior swing high/low or trend structure
Risk: Stop beyond the divergence extreme

Key: Higher timeframe divergence is more reliable`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:2,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:2,port:"signal"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:3,port:"signal"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:5,port:"result"},to:{nodeId:6,port:"a"}},{id:"c9",from:{nodeId:4,port:"macd"},to:{nodeId:9,port:"a"}},{id:"c7",from:{nodeId:9,port:"result"},to:{nodeId:6,port:"b"}},{id:"c8",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"signal"}}]},"macd-crossover":{name:"MACD Crossover",desc:"Classic MACD signal line crossover strategy",icon:"activity",timeframes:["5m","15m"],tags:["macd","crossover","trend"],nodes:[{id:1,type:"input",x:80,y:150,title:"Price Input",configValues:{symbol:"SPY",timeframe:"5Min",days:2}},{id:2,type:"macd",x:280,y:100,title:"MACD Line",configValues:{fast:12,slow:26,signal:9,source:"close",output:"macd"}},{id:3,type:"macd",x:280,y:220,title:"Signal Line",configValues:{fast:12,slow:26,signal:9,source:"close",output:"signal"}},{id:4,type:"ema",x:280,y:340,title:"Trend Filter (EMA 50)",configValues:{period:50,source:"close",output:"value"}},{id:5,type:"compare",x:480,y:160,title:"MACD Cross Up",configValues:{operator:">"}},{id:6,type:"compare",x:480,y:300,title:"Above Trend EMA",configValues:{operator:">"}},{id:7,type:"and",x:680,y:220,title:"Buy Signal",configValues:{}},{id:8,type:"output",x:880,y:220,title:"Signal Output",configValues:{}},{id:9,type:"note",x:80,y:480,title:"Strategy Notes",configValues:{content:`MACD CROSSOVER

Buy: MACD line crosses above signal line (while above zero preferred)
Sell: MACD line crosses below signal line

Filter: Only take signals in direction of EMA 50 trend
Exit: Opposite crossover or histogram shrinking
Risk: Stop below recent swing low

Key: Works best in trending markets`}}],connections:[{id:"c1",from:{nodeId:1,port:"prices"},to:{nodeId:2,port:"prices"}},{id:"c2",from:{nodeId:1,port:"prices"},to:{nodeId:3,port:"prices"}},{id:"c3",from:{nodeId:1,port:"prices"},to:{nodeId:4,port:"prices"}},{id:"c4",from:{nodeId:2,port:"macd"},to:{nodeId:5,port:"a"}},{id:"c5",from:{nodeId:3,port:"macd"},to:{nodeId:5,port:"b"}},{id:"c6",from:{nodeId:1,port:"prices"},to:{nodeId:6,port:"a"}},{id:"c7",from:{nodeId:4,port:"ema"},to:{nodeId:6,port:"b"}},{id:"c8",from:{nodeId:5,port:"result"},to:{nodeId:7,port:"a"}},{id:"c9",from:{nodeId:6,port:"result"},to:{nodeId:7,port:"b"}},{id:"c10",from:{nodeId:7,port:"result"},to:{nodeId:8,port:"signal"}}]}},$1=()=>Object.entries(zy).map(([i,e])=>({type:`template-${i}`,name:e.name,desc:e.desc,icon:e.icon||"puzzle",timeframes:e.timeframes,tags:e.tags})),U1=i=>{const e=i.replace("template-",""),s=zy[e];return s?{name:s.name,nodes:JSON.parse(JSON.stringify(s.nodes)),connections:JSON.parse(JSON.stringify(s.connections))}:null},V1=$1(),H1=[{category:"Strategies",items:V1},{category:"Configuration",items:[{...nt.input,type:"input"},{...nt.price_history,type:"price_history"},{...nt.volume_history,type:"volume_history"}]},{category:"Indicators",items:[{...nt.rsi,type:"rsi"},{...nt.sma,type:"sma"},{...nt.ema,type:"ema"},{...nt.macd,type:"macd"},{...nt.atr,type:"atr"},{...nt.obv,type:"obv"},{...nt.bollinger,type:"bollinger"},{...nt.stochastic,type:"stochastic"},{...nt.vwap,type:"vwap"},{...nt.volume_spike,type:"volume_spike"},{...nt.price_levels,type:"price_levels"},{...nt.support_resistance,type:"support_resistance"}]},{category:"Logic",items:[{...nt.and,type:"and"},{...nt.or,type:"or"},{...nt.not,type:"not"},{...nt.compare,type:"compare"},{...nt.crossover,type:"crossover"},{...nt.threshold,type:"threshold"}]},{category:"Filters",items:[{...nt.time_filter,type:"time_filter"},{...nt.trend_filter,type:"trend_filter"},{...nt.volume_filter,type:"volume_filter"}]},{category:"AI & Output",items:[{...nt.ai_agent,type:"ai_agent"},{...nt.output,type:"output"}]},{category:"Utility",items:[{...nt.note,type:"note"}]}],q1=()=>{const[i,e]=D.useState({}),[s,a]=D.useState({}),c=d=>{e(g=>({...g,[d]:!g[d]}))},h=(d,g)=>{a(p=>({...p,[d]:g}))};return l.jsxs("div",{className:"sidebar",children:[l.jsxs("div",{className:"sidebar-header",children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[l.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"logoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",style:{stopColor:"#2962ff",stopOpacity:1}}),l.jsx("stop",{offset:"100%",style:{stopColor:"#5e8cff",stopOpacity:1}})]})}),l.jsx("path",{d:"M4 8 L16 8 L16 12 L4 12 Z",fill:"url(#logoGradient)",opacity:"0.9"}),l.jsx("path",{d:"M4 14 L28 14 L28 18 L4 18 Z",fill:"url(#logoGradient)"}),l.jsx("path",{d:"M4 20 L22 20 L22 24 L4 24 Z",fill:"url(#logoGradient)",opacity:"0.8"}),l.jsx("circle",{cx:"26",cy:"10",r:"2",fill:"#5e8cff"}),l.jsx("circle",{cx:"24",cy:"22",r:"2",fill:"#2962ff"})]}),l.jsx("h2",{style:{fontSize:16,fontWeight:700,color:"#f8f9fa",margin:0},children:"FLOWTRADE"})]}),l.jsx("p",{children:"Drag blocks to canvas to build your strategy"})]}),H1.map(d=>l.jsxs("div",{className:`block-category${i[d.category]?" collapsed":""}`,children:[l.jsx("div",{className:"category-title",onClick:()=>c(d.category),title:Na[d.category]?.desc||"","aria-label":Na[d.category]?.desc||"",children:l.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[l.jsx("span",{style:{color:"var(--text-secondary)"},children:Na[d.category]?.icon||null}),l.jsx("span",{children:d.category})]})}),l.jsxs("div",{className:"category-blocks",children:[l.jsx("input",{type:"text",className:"category-search",placeholder:`Search ${d.category.toLowerCase()}...`,value:s[d.category]||"",onChange:g=>h(d.category,g.target.value)}),d.items.filter(g=>!s[d.category]||g.name.toLowerCase().includes(s[d.category].toLowerCase())||g.desc&&g.desc.toLowerCase().includes(s[d.category].toLowerCase())).map(g=>l.jsxs("div",{className:"block-item",draggable:"true","data-block-type":g.type,onDragStart:p=>p.dataTransfer.setData("blockType",g.type),children:[l.jsx("div",{className:`block-icon ${g.color||""}`,children:g.icon?l.jsx(Ts,{name:g.icon,size:14}):Na[d.category]?.icon||null}),l.jsxs("div",{className:"block-info",children:[l.jsx("div",{className:"block-name",children:g.name}),l.jsx("div",{className:"block-desc",children:g.desc})]})]},g.type))]})]},d.category))]})},F1=({onSave:i,onLoad:e,onExport:s,onImport:a,onClear:c,onOrganize:h,onRun:d,onSample:g,onToggleMonitor:p,onRunToggle:v,onBacktest:x,liveRunning:y,extraBefore:b=null,onNew:S=null})=>{const N=(E,R)=>()=>{if(R)return R();const _=document.getElementById(E);_?_.click():(E==="organizeBtn"&&window.organizeWorkflow&&window.organizeWorkflow(),E==="runBtn"&&window.runWorkflow&&window.runWorkflow())};return l.jsxs("div",{className:"toolbar",children:[b,l.jsx("button",{className:"toolbar-btn",id:"organizeBtn",onClick:N("organizeBtn",h),title:"Auto-arrange blocks",children:"Organize"}),l.jsx("button",{className:"toolbar-btn",id:"clearBtn",onClick:N("clearBtn",c),title:"Clear canvas",children:"Clear"}),l.jsx("div",{style:{width:"1px",height:"20px",background:"var(--border, #2a2e39)",margin:"0 4px"}}),l.jsx("button",{className:"toolbar-btn",id:"saveBtn",onClick:N("saveBtn",i),title:"Save workflow",children:"Save"}),l.jsx("button",{className:"toolbar-btn",id:"importBtn",onClick:N("importBtn",a),title:"Load workflow from file",children:"Import"}),l.jsx("button",{className:"toolbar-btn",id:"exportBtn",onClick:N("exportBtn",s),title:"Export workflow",children:"Export"}),l.jsxs("div",{className:"toolbar-run",children:[l.jsx("span",{children:"Run Strategy"}),l.jsxs("label",{id:"runBtn",className:`run-switch ${y?"on":"off"}`,title:"Toggle continuous run",children:[l.jsx("input",{"aria-label":"Run Strategy",type:"checkbox",checked:!!y,onChange:()=>{v?v():N("runBtn",d)()}}),l.jsx("span",{className:"slider"})]})]})]})},W1=({node:i,onUpdatePosition:e,onDelete:s,onStartConnection:a,onEndConnection:c,onOpenSettings:h,onUpdateConfig:d})=>{const g=D.useRef(null),[p,v]=D.useState(!1),[x,y]=D.useState(!1),[b,S]=D.useState(i.config?.content||""),N=D.useRef(null);D.useEffect(()=>{S(i.config?.content||"")},[i.config?.content]),D.useEffect(()=>{const j=g.current;j&&(j.style.left=`${i.x}px`,j.style.top=`${i.y}px`)},[i.x,i.y]),D.useEffect(()=>{x&&N.current&&(N.current.focus(),N.current.select())},[x]),D.useEffect(()=>{let j=null,K=null;const I={current:null},U={x:null,y:null},Y=$=>{I.current||(I.current=window.requestAnimationFrame(()=>{I.current=null,U.x!==null&&U.y!==null&&e($,U.x,U.y)}))};return p&&(j=$=>{try{$.preventDefault()}catch{}const Q=typeof $.pageX<"u"?$.pageX:$.touches&&$.touches[0]&&$.touches[0].pageX||0,q=typeof $.pageY<"u"?$.pageY:$.touches&&$.touches[0]&&$.touches[0].pageY||0,ge=Q-E.current.x,O=q-E.current.y;U.x=ge,U.y=O,Y(i.id)},K=$=>{v(!1),I.current&&(window.cancelAnimationFrame(I.current),I.current=null),document.removeEventListener("pointermove",j),document.removeEventListener("pointerup",K),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",K)},document.addEventListener("pointermove",j,{passive:!1}),document.addEventListener("pointerup",K),document.addEventListener("mousemove",j,{passive:!1}),document.addEventListener("mouseup",K)),()=>{j&&(document.removeEventListener("pointermove",j),document.removeEventListener("mousemove",j)),K&&(document.removeEventListener("pointerup",K),document.removeEventListener("mouseup",K)),I.current&&(window.cancelAnimationFrame(I.current),I.current=null)}},[p]);const E=D.useRef({x:0,y:0});D.useRef(null),D.useRef({x:null,y:null});const R=j=>{if(j.pointerType==="mouse"&&j.button!==0||j.target.closest("button"))return;try{j.preventDefault()}catch{}try{j.target.setPointerCapture&&j.target.setPointerCapture(j.pointerId)}catch{}const K=i.x,I=i.y,U=typeof j.pageX<"u"?j.pageX:j.touches&&j.touches[0]&&j.touches[0].pageX||0,Y=typeof j.pageY<"u"?j.pageY:j.touches&&j.touches[0]&&j.touches[0].pageY||0;E.current={x:U-K,y:Y-I},v(!0)},_=j=>{j.stopPropagation(),x||y(!0)},F=j=>{S(j.target.value)},H=()=>{y(!1),d&&b!==(i.config?.content||"")&&d(i.id,{...i.config,content:b})},z=j=>{j.key==="Escape"&&(S(i.config?.content||""),y(!1)),j.stopPropagation()},L=i.execStatus==="executing"?"executing":i.execStatus==="passed"?"node-passed":i.execStatus==="failed"?"node-failed":i.execStatus==="skipped"?"node-skipped":"";return i.type==="note"||i.def?.isTextBox?l.jsxs("div",{className:`node text-note-node${i.selected?" selected":""}${p?" dragging":""}${x?" editing":""}`,id:`node-${i.id}`,ref:g,style:{left:i.x,top:i.y,position:"absolute",userSelect:p?"none":"auto"},children:[l.jsxs("div",{className:"text-note-header",onPointerDown:R,style:{cursor:"grab",userSelect:"none"},children:[l.jsx("div",{className:"node-icon color-note",children:l.jsx(Ts,{name:"note",size:14})}),l.jsx("span",{className:"text-note-label",children:"Note"}),l.jsx("button",{type:"button",className:"node-delete",onMouseDown:j=>{j.stopPropagation(),j.preventDefault()},onClick:j=>{j.stopPropagation(),s(i.id)},children:""})]}),l.jsx("div",{className:"text-note-content",onClick:_,children:x?l.jsx("textarea",{ref:N,className:"text-note-textarea",value:b,onChange:F,onBlur:H,onKeyDown:z,placeholder:"Click to add note...",rows:3}):l.jsx("div",{className:"text-note-display",children:b||l.jsx("span",{className:"text-note-placeholder",children:"Click to add note..."})})})]}):l.jsxs("div",{className:`node${i.selected?" selected":""}${L?" "+L:""}${p?" dragging":""}`,id:`node-${i.id}`,ref:g,style:{left:i.x,top:i.y,position:"absolute",userSelect:p?"none":"auto"},children:[l.jsxs("div",{className:"node-header",onPointerDown:R,style:{cursor:"grab",userSelect:"none"},children:[l.jsx("div",{className:`node-icon ${i.def?.color||""}`,children:i.def?.icon?l.jsx(Ts,{name:i.def.icon,size:18}):Na[Qg[i.type]]&&Na[Qg[i.type]].icon||""}),l.jsx("div",{className:"node-title",children:i.def?.name||i.type}),l.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:[i.def&&Array.isArray(i.def.config)&&i.def.config.length>0&&l.jsxs("button",{type:"button",className:"node-settings",onMouseDown:j=>{j.stopPropagation(),j.preventDefault()},onClick:j=>{j.stopPropagation(),h&&h(i)},title:"Settings",children:[" ",l.jsx(Ts,{name:"plus",size:14})," "]}),l.jsx("button",{type:"button",className:"node-delete",onMouseDown:j=>{j.stopPropagation(),j.preventDefault()},onClick:j=>{j.stopPropagation(),s(i.id)},children:""})]})]}),l.jsxs("div",{className:"node-body",children:[l.jsx("div",{className:"node-inputs",children:i.def?.inputs?.map(j=>l.jsxs("div",{className:"node-port input","data-port":j,"data-node-id":i.id,"data-port-type":"input",children:[l.jsx("span",{className:"port-dot","data-port":j,"data-node-id":i.id,"data-port-type":"input",onMouseUp:K=>{K.stopPropagation(),c&&c(i.id,j,"input")}}),l.jsx("span",{children:j})]},j))}),l.jsx("div",{className:"node-outputs",children:i.def?.outputs?.map(j=>l.jsxs("div",{className:"node-port output","data-port":j,"data-node-id":i.id,"data-port-type":"output",children:[l.jsx("span",{children:j}),l.jsx("span",{className:"port-dot","data-port":j,"data-node-id":i.id,"data-port-type":"output",onClick:K=>{K.stopPropagation(),a&&a(i.id,j,"output")}})]},j))})]})]})},G1=({svgRef:i,connections:e=[],connecting:s=null,selectedId:a=null,onSelect:c=()=>{},onDelete:h=()=>{},nodes:d=[],canvasScale:g=1,canvasOffset:p={x:0,y:0}})=>{const[v,x]=D.useState([]);D.useEffect(()=>{let b=!0,S=null;const N=()=>{const F=i?.current;if(!F)return[];const H=F.getBoundingClientRect(),z=g||1,L=j=>{if(!j)return null;const K=j.getBoundingClientRect();return{x:(K.left+K.width/2-H.left)/z,y:(K.top+K.height/2-H.top)/z}},C=[];if(e.forEach(j=>{const K=document.querySelector(`.port-dot[data-node-id="${j.from.nodeId}"][data-port="${j.from.port}"][data-port-type="output"]`),I=document.querySelector(`.port-dot[data-node-id="${j.to.nodeId}"][data-port="${j.to.port}"][data-port-type="input"]`),U=L(K),Y=L(I);if(!U||!Y)return;const $=Math.max(40,Math.abs(Y.x-U.x)*.5),Q=`M ${U.x} ${U.y} C ${U.x+$} ${U.y} ${Y.x-$} ${Y.y} ${Y.x} ${Y.y}`,q={x:(U.x+Y.x)/2,y:(U.y+Y.y)/2};C.push({id:j.id,d:Q,mid:q})}),s&&F){const j=document.querySelector(`.port-dot[data-node-id="${s.from.nodeId}"][data-port="${s.from.port}"][data-port-type="output"]`),K=L(j),I=F.getBoundingClientRect();if(K&&typeof s.x=="number"&&typeof s.y=="number"){const U={x:(s.x-I.left)/z,y:(s.y-I.top)/z},Y=Math.max(40,Math.abs(U.x-K.x)*.5),$=`M ${K.x} ${K.y} C ${K.x+Y} ${K.y} ${U.x-Y} ${U.y} ${U.x} ${U.y}`,Q={x:(K.x+U.x)/2,y:(K.y+U.y)/2};C.push({id:"__temp__",d:$,mid:Q})}}return C},E=()=>{S||(S=window.requestAnimationFrame(()=>{if(S=null,!!b)try{const F=N();x(F)}catch{}}))};E();let R=null;try{const F=document.querySelector(".canvas");F&&typeof MutationObserver<"u"&&(R=new MutationObserver(E),R.observe(F,{attributes:!0,childList:!0,subtree:!0}))}catch{}const _=()=>E();return window.addEventListener("resize",_),()=>{b=!1,S&&window.cancelAnimationFrame(S),window.removeEventListener("resize",_);try{R&&R.disconnect()}catch{}}},[e,s,i,JSON.stringify(d||[]),g,p.x,p.y]);const y=l.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"8",refY:"3.5",orient:"auto",markerUnits:"strokeWidth",children:l.jsx("path",{d:"M0,0 L10,3.5 L0,7",fill:"#60a5fa"})});return l.jsxs("g",{className:"connection-layer",children:[l.jsx("defs",{children:y}),v.map(b=>l.jsxs("g",{children:[l.jsx("path",{d:b.d,stroke:"#6e7380",strokeWidth:12,fill:"none",opacity:0,style:{cursor:"pointer"},onClick:()=>c(b.id)}),l.jsx("path",{d:b.d,className:b.id==="__temp__"?"temp-connection connection-wire":"connection-wire",stroke:b.id===a?"#60a5fa":"#6e7380",strokeWidth:b.id===a?3.2:2.2,fill:"none",markerEnd:"url(#arrowhead)",style:{pointerEvents:"auto",cursor:"pointer",opacity:b.id==="__temp__"?.5:.8,filter:b.id===a?"drop-shadow(0 0 6px #60a5fa)":b.id==="__temp__"?"drop-shadow(0 0 6px #787b86)":"none",strokeDasharray:b.id==="__temp__"?"6 4":void 0,animation:b.id==="__temp__"?"dashmove 1s linear infinite":void 0,transition:"stroke 0.18s, filter 0.18s"},onMouseEnter:S=>{b.id!=="__temp__"&&(S.target.style.stroke="#2962ff"),b.id!=="__temp__"&&(S.target.style.opacity=1),b.id!=="__temp__"&&(S.target.style.strokeWidth=3)},onMouseLeave:S=>{b.id!=="__temp__"&&(S.target.style.stroke=b.id===a?"#60a5fa":"#6e7380"),b.id!=="__temp__"&&(S.target.style.opacity=.8),b.id!=="__temp__"&&(S.target.style.strokeWidth=b.id===a?3.2:2.2)},onClick:()=>c(b.id)}),b.id===a&&l.jsxs("g",{children:[l.jsx("circle",{cx:b.mid.x,cy:b.mid.y,r:12,fill:"#1f2937",stroke:"#374151"}),l.jsx("text",{x:b.mid.x,y:b.mid.y+5,textAnchor:"middle",fontSize:"16",fill:"#f8fafc",style:{cursor:"pointer"},onClick:()=>h(b.id),children:""})]})]},b.id))]})},Y1=(i,e)=>{if(!i||!e||e.length<2)return;const s=i.getContext("2d"),a=i.clientWidth,c=i.clientHeight;i.width=a,i.height=c,s.clearRect(0,0,a,c),s.strokeStyle="#60a5fa",s.lineWidth=2,s.beginPath();const h=e.map(v=>typeof v.v<"u"?v.v:v.value||v.y||0);if(!h.length)return;const d=Math.min(...h),p=Math.max(...h)-d||1;h.forEach((v,x)=>{const y=x/(h.length-1||1)*a,b=c-(v-d)/p*c;x===0?s.moveTo(y,b):s.lineTo(y,b)}),s.stroke()},K1=({series:i=[],width:e=120,height:s=26,color:a="#60a5fa"})=>{const c=D.useRef(null);return D.useEffect(()=>{const h=c.current;if(!h||!i||i.length===0)return;h.width=e,h.height=s;const d=h.getContext("2d");d.clearRect(0,0,e,s);const g=Math.min(...i),v=Math.max(...i)-g||1;d.strokeStyle=a,d.lineWidth=1.2,d.beginPath(),i.forEach((x,y)=>{const b=y/(i.length-1||1)*e,S=s-(x-g)/v*s;y===0?d.moveTo(b,S):d.lineTo(b,S)}),d.stroke()},[i,e,s,a]),l.jsx("canvas",{ref:c,style:{width:e,height:s}})},X1=({data:i={},open:e=!0,onClose:s=()=>{},onRerun:a=()=>{},onDownload:c=()=>{}})=>{const h=D.useRef(null),[d,g]=D.useState(new Set),[p,v]=D.useState(new Set),[x,y]=D.useState(()=>{try{const z=localStorage.getItem("resultsPanelWidth");return z?Number(z):420}catch{return 420}}),b=D.useRef(!1),S=D.useRef(null),N=D.useRef(x),E=D.useRef(null);if(D.useEffect(()=>{i?.equityCurve&&h.current&&Y1(h.current,i.equityCurve)},[i]),D.useEffect(()=>{try{localStorage.setItem("resultsPanelWidth",String(x))}catch{}},[x]),D.useEffect(()=>{const z=C=>{if(!b.current)return;const j=C.touches&&C.touches[0]?C.touches[0].clientX:C.clientX,K=Math.max(300,Math.min(window.innerWidth-80,window.innerWidth-j));N.current=K,E.current||(E.current=window.requestAnimationFrame(()=>{E.current=null;try{S.current&&(S.current.style.width=`${N.current}px`)}catch{}})),C.cancelable&&C.preventDefault()},L=()=>{b.current&&(b.current=!1,document.body.style.cursor="",document.body.style.userSelect="",E.current&&(window.cancelAnimationFrame(E.current),E.current=null),y(N.current))};return window.addEventListener("mousemove",z),window.addEventListener("mouseup",L),window.addEventListener("touchmove",z,{passive:!1}),window.addEventListener("touchend",L),()=>{window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",L),window.removeEventListener("touchmove",z),window.removeEventListener("touchend",L),E.current&&(window.cancelAnimationFrame(E.current),E.current=null)}},[]),!e)return null;const R=z=>{g(L=>{const C=new Set(L);return C.has(z)?C.delete(z):C.add(z),C})},_=z=>{v(L=>{const C=new Set(L);return C.has(z)?C.delete(z):C.add(z),C})},F=[{label:"Final Signal",value:i?.finalSignal||"--",color:"#2962ff",bold:!0},{label:"Confidence",value:i?.confidence!==null&&i?.confidence!==void 0?(i.confidence*100).toFixed(1)+"%":"--"},...i?.latest_data?Object.entries(i.latest_data).map(([z,L])=>{let C=z.replace(/_/g," ").replace(/\b\w/g,K=>K.toUpperCase()),j=L;return typeof L=="number"&&(z.toLowerCase().includes("price")||z==="open"||z==="high"||z==="low"||z==="close"?j="$"+L.toFixed(2):z.toLowerCase().includes("volume")?j=L.toLocaleString():j=L.toFixed(2)),{label:C,value:j}}):[]],H=z=>{z.preventDefault(),b.current=!0;try{S.current&&S.current.classList.add("dragging")}catch{}document.body.style.cursor="col-resize",document.body.style.userSelect="none"};return l.jsxs("div",{ref:S,className:"output-panel open",id:"outputPanel",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",minHeight:"100vh",background:"#1e222d",boxShadow:"-4px 0 24px rgba(0,0,0,0.3)",width:x},children:[l.jsx("div",{className:"output-panel-resize-handle",id:"resizeHandle",onMouseDown:H,onTouchStart:H}),l.jsxs("div",{className:"output-header",style:{width:"100%",maxWidth:600,margin:"0 auto",padding:"0 0 12px 0"},children:[l.jsxs("div",{className:"output-header-top",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[l.jsxs("div",{className:"output-header-title-group",style:{textAlign:"center"},children:[l.jsx("h3",{id:"outputHeaderTitle",style:{fontSize:22,fontWeight:700,color:"#f8f9fa",marginBottom:2},children:i?.summary?.strategyName||"Strategy Results"}),l.jsxs("div",{className:"output-header-meta",style:{display:"flex",justifyContent:"center",gap:16,marginBottom:4},children:[l.jsx("span",{id:"outputTimestamp",style:{color:"#787b86",fontSize:13},children:new Date().toLocaleTimeString()}),l.jsx("span",{id:"outputHeaderBadge",className:`output-status-badge ${i?.summary?.status||"completed"}`,children:i?.summary?.status||""})]})]}),l.jsxs("div",{className:"output-header-actions",style:{display:"flex",gap:12,justifyContent:"center",marginTop:8},children:[l.jsx("button",{className:"output-action-btn",id:"rerunBtn",onClick:a,children:" Re-run"}),l.jsx("button",{className:"output-action-btn",id:"downloadBtn",onClick:c,children:" Download"}),l.jsxs("button",{className:"output-action-btn",id:"exportChartBtn",onClick:()=>{try{const z=h.current;if(!z)return;const L=z.toDataURL("image/png"),C=document.createElement("a");C.href=L,C.download=`equity-chart-${Date.now()}.png`,C.click()}catch(z){console.warn(z)}},children:[l.jsx(Ts,{name:"bolt",size:14,style:{marginRight:6}}),"Export Chart"]}),l.jsx("button",{className:"output-close",id:"closeOutput",onClick:s,children:""})]})]}),l.jsx("div",{style:{display:"flex",gap:32,margin:"24px auto 12px auto",flexWrap:"wrap",justifyContent:"center",borderBottom:"1px solid #232634",paddingBottom:12,width:"100%"},children:F.map((z,L)=>l.jsxs("div",{style:{minWidth:90,textAlign:"center"},children:[l.jsx("div",{className:"output-label",style:{color:"#787b86",fontSize:12},children:z.label}),l.jsx("div",{className:"output-value",style:{fontWeight:z.bold?700:500,fontSize:z.bold?20:15,color:z.color||"#d1d4dc",marginTop:2},children:z.value})]},L))})]}),Array.isArray(i?.trades)&&l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("trades"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"puzzle",size:16,style:{marginRight:8}}),"Trades"]}),l.jsx("div",{className:`output-section-toggle ${d.has("trades")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("trades")?"none":void 0},children:l.jsxs("div",{style:{overflowX:"auto"},children:[l.jsxs("table",{className:"results-table trades-table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Time"}),l.jsx("th",{children:"Side"}),l.jsx("th",{children:"Price"}),l.jsx("th",{children:"Size"}),l.jsx("th",{children:"Profit"})]})}),l.jsx("tbody",{children:i.trades.map((z,L)=>l.jsxs("tr",{className:"trade-row",children:[l.jsx("td",{className:"trade-time",children:z.time?new Date(z.time).toLocaleString():"--"}),l.jsx("td",{className:"trade-side",children:z.side||"--"}),l.jsx("td",{className:"trade-price",children:z.price?"$"+Number(z.price).toFixed(2):"--"}),l.jsx("td",{className:"trade-size",children:z.size||"--"}),l.jsx("td",{className:"trade-profit",style:{color:typeof z.pnl<"u"?z.pnl>=0?"#089981":"#f23645":"#787b86"},children:typeof z.pnl<"u"?(z.pnl>=0?"+":"")+Number(z.pnl).toFixed(2):"--"})]},L))})]}),i.trades&&i.trades.length>0&&l.jsx("button",{className:"download-csv-btn",style:{marginTop:"10px",float:"right",background:"#232634",color:"#d1d4dc",border:"none",borderRadius:"4px",padding:"6px 14px",fontSize:"11px",cursor:"pointer"},onClick:()=>{const L=[["Time","Side","Price","Size","Profit"],...i.trades.map(I=>[I.time?new Date(I.time).toLocaleString():"",I.side||"",I.price||"",I.size||"",typeof I.pnl<"u"?I.pnl:""])].map(I=>I.map(U=>`"${String(U).replace(/"/g,'""')}`).join(",")).join(`
`),C=new Blob([L],{type:"text/csv"}),j=URL.createObjectURL(C),K=document.createElement("a");K.href=j,K.download="trades.csv",document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(j)},children:"Download CSV"})]})})]}),l.jsxs("div",{className:"output-content",id:"outputContent",children:[l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("ai"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"ai",size:16,style:{marginRight:8}}),"AI Summary"]}),l.jsx("div",{className:`output-section-toggle ${d.has("ai")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("ai")?"none":void 0},children:l.jsx("div",{className:"ai-summary-box",children:i?.aiAnalysis||"No AI analysis available."})})]}),l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("blocks"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"puzzle",size:16,style:{marginRight:8}}),"Block Execution Details"]}),l.jsx("div",{className:`output-section-toggle ${d.has("blocks")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("blocks")?"none":void 0},children:(i?.blocks||[]).map((z,L)=>{const C=p.has(z.id),j=z.status||"skipped",I=($=>{if(!$||typeof $!="object")return $;const Q={},q=["prices","volumes","highs","lows","opens","closes","price_series","volume_history","close_history","high_history","low_history","open_history"];for(const[ge,O]of Object.entries($))if(Array.isArray(O)&&(q.includes(ge)||O.length>10)){const A=O.length>0?O[O.length-1]:null,W=typeof A=="number"?A.toFixed(2):A;Q[ge]=`[${O.length} values${A!==null?`, last: ${W}`:""}]`}else Q[ge]=O;return Q})(z.params||z.inputs||{}),U=[],Y=z.params||z.inputs||{};return Y.price!==void 0?U.push({label:"Price",value:"$"+Number(Y.price).toFixed(2)}):Y.close!==void 0&&U.push({label:"Close",value:"$"+Number(Y.close).toFixed(2)}),Y.rsi!==void 0&&U.push({label:"RSI",value:Number(Y.rsi).toFixed(2)}),Y.ema!==void 0&&U.push({label:"EMA",value:Number(Y.ema).toFixed(2)}),Y.macd!==void 0&&U.push({label:"MACD",value:Number(Y.macd).toFixed(4)}),Y.vwap!==void 0&&U.push({label:"VWAP",value:Y.vwap!==null?"$"+Number(Y.vwap).toFixed(2):"null"}),Y.condition_met!==void 0&&U.push({label:"Met",value:Y.condition_met?"":""}),l.jsxs("div",{className:`block-details ${j}`,children:[l.jsxs("div",{className:"block-header",onClick:()=>_(z.id),children:[l.jsxs("span",{className:"block-title",children:["Block ",L+1,": ",z.name||z.block_type]}),l.jsx("span",{className:"block-type",children:z.type||z.block_type||""}),l.jsxs("span",{className:"block-time",children:[(z.execution_time_ms||0).toFixed(1),"ms"]}),l.jsx("button",{className:"block-expand",children:C?"":""})]}),l.jsx("div",{className:"block-message",children:z.message}),U.length>0&&l.jsx("div",{className:"block-key-values",style:{display:"flex",gap:16,flexWrap:"wrap",padding:"6px 0",borderBottom:"1px solid #2a2e39"},children:U.map(($,Q)=>l.jsxs("span",{style:{fontSize:12},children:[l.jsxs("span",{style:{color:"#787b86"},children:[$.label,": "]}),l.jsx("span",{style:{color:"#d1d4dc",fontWeight:500},children:$.value})]},Q))}),C&&l.jsxs("div",{className:"block-params",style:{maxHeight:200,overflow:"auto"},children:[l.jsx("strong",{children:"Params"}),l.jsx("pre",{style:{fontSize:11},children:JSON.stringify(I,null,2)})]}),l.jsxs("div",{className:"block-logs",children:[l.jsx("strong",{children:"Logs"}),l.jsx("div",{children:z.logs&&z.logs.join(`
`)||z.output||"No logs available"})]}),z.price_series&&l.jsxs("div",{className:"block-sparkline",children:[l.jsx("strong",{children:"Price Sparkline"}),l.jsx(K1,{series:z.price_series,width:200,height:36})]})]},L)})})]}),l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("signals"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"bolt",size:16,style:{marginRight:8}}),"Last Signals"]}),l.jsx("div",{className:`output-section-toggle ${d.has("signals")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("signals")?"none":void 0},children:l.jsx("table",{className:"signals-table",children:l.jsx("tbody",{children:(i?.signals||[]).map((z,L)=>l.jsxs("tr",{children:[l.jsx("td",{children:z.time}),l.jsx("td",{children:z.signal}),l.jsx("td",{children:z.price})]},L))})})})]}),l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("performance"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"bolt",size:16,style:{marginRight:8}}),"Strategy Performance"]}),l.jsx("div",{className:`output-section-toggle ${d.has("performance")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("performance")?"none":void 0},children:l.jsx("canvas",{ref:h,style:{width:"100%",height:200}})})]}),l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("market"),children:[l.jsxs("div",{className:"output-section-title",children:[l.jsx(Ts,{name:"bolt",size:16,style:{marginRight:8}}),"Market Data"]}),l.jsx("div",{className:`output-section-toggle ${d.has("market")?"collapsed":""}`,children:""})]}),l.jsxs("div",{className:"output-section-body",style:{display:d.has("market")?"none":void 0},children:[l.jsx("div",{className:"output-label",children:"Final Signal"}),l.jsx("div",{className:"output-value",style:{fontWeight:700,fontSize:18,color:"#2962ff"},children:i?.finalSignal||"--"}),l.jsx("div",{className:"output-label",children:"Confidence"}),l.jsx("div",{className:"output-value",children:i?.confidence!==null&&i?.confidence!==void 0?(i.confidence*100).toFixed(1)+"%":"--"}),i?.latest_data&&l.jsx(l.Fragment,{children:Object.entries(i.latest_data).map(([z,L],C)=>{let j=z.replace(/_/g," ").replace(/\b\w/g,I=>I.toUpperCase()),K=L;return typeof L=="number"&&(z.toLowerCase().includes("price")||z==="open"||z==="high"||z==="low"||z==="close"?K="$"+L.toFixed(2):z.toLowerCase().includes("volume")?K=L.toLocaleString():K=L.toFixed(2)),l.jsxs(Ql.Fragment,{children:[l.jsx("div",{className:"output-label",children:j}),l.jsx("div",{className:"output-value",children:K})]},C)})})]})]}),l.jsxs("div",{className:"output-section",children:[l.jsxs("div",{className:"output-section-header",onClick:()=>R("raw"),children:[l.jsx("div",{className:"output-section-title",children:" Raw Response"}),l.jsx("div",{className:`output-section-toggle ${d.has("raw")?"collapsed":""}`,children:""})]}),l.jsx("div",{className:"output-section-body",style:{display:d.has("raw")?"none":void 0},children:l.jsx("div",{style:{maxHeight:240,overflow:"auto",background:"#0b0f14",padding:12,borderRadius:6,border:"1px solid #1f2937"},children:l.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",color:"#cbd5e1",fontSize:12},children:JSON.stringify(i||{},null,2)})})})]})]})]})},J1=({node:i,open:e,onClose:s,onSave:a})=>{const[c,h]=D.useState({});if(D.useEffect(()=>{i&&h(i.configValues||{})},[i]),!e||!i)return null;const d=(p,v)=>h(x=>({...x,[p]:v})),g=()=>{a&&a({...i,configValues:c}),s&&s()};return l.jsxs("div",{style:{position:"fixed",top:0,right:0,width:320,height:"100%",background:"#1e222d",borderLeft:"1px solid #2a2e39",boxShadow:"-2px 0 8px rgba(0,0,0,0.3)",zIndex:6e3,pointerEvents:"auto",display:"flex",flexDirection:"column",fontFamily:"Inter, sans-serif",transition:"transform .2s",transform:e?"translateX(0)":"translateX(100%)"},children:[l.jsxs("div",{style:{padding:"10px 14px",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid #2a2e39",background:"#131722"},children:[l.jsxs("div",{style:{fontWeight:600,color:"#f8f9fa",fontSize:12,letterSpacing:"-0.1px"},children:["Properties  ",i.def?.name||i.type]}),l.jsx("button",{onClick:s,style:{marginLeft:"auto",background:"transparent",border:"1px solid #2a2e39",color:"#787b86",cursor:"pointer",padding:"4px 10px",borderRadius:4,fontSize:11,transition:"all 0.15s"},children:"Close"})]}),l.jsxs("div",{style:{flex:1,overflowY:"auto",padding:14},children:[l.jsx("div",{style:{marginBottom:8},children:l.jsx("small",{style:{color:"#9ca3af"},children:"Edit configuration values for this node."})}),(!i.def.config||i.def.config.length===0)&&l.jsx("div",{style:{color:"#9ca3af"},children:"No configurable parameters."}),i.def.config&&i.def.config.map(p=>l.jsxs("div",{style:{marginBottom:14},children:[l.jsx("label",{style:{display:"block",color:"#cbd5e1",fontSize:11,marginBottom:4},children:p.label||p.key}),p.type==="select"?l.jsx("select",{value:c[p.key]??p.value,onChange:v=>d(p.key,v.target.value),style:{width:"100%",padding:"4px 6px",borderRadius:4,border:"1px solid #2a2e39",background:"#131722",color:"#e5e7eb",fontSize:11},children:p.options.map(v=>l.jsx("option",{value:v,children:v},v))}):p.type==="textarea"?l.jsx("textarea",{value:c[p.key]??p.value,onChange:v=>d(p.key,v.target.value),style:{width:"100%",minHeight:60,padding:"4px 6px",borderRadius:4,border:"1px solid #2a2e39",background:"#131722",color:"#e5e7eb",fontSize:11}}):l.jsx("input",{type:p.type,value:c[p.key]??p.value,onChange:v=>d(p.key,v.target.value),style:{width:"100%",padding:"4px 6px",borderRadius:4,border:"1px solid #2a2e39",background:"#131722",color:"#e5e7eb",fontSize:11}})]},p.key))]}),l.jsxs("div",{style:{padding:"10px 14px",borderTop:"1px solid #2a2e39",display:"flex",gap:8,alignItems:"center",background:"#131722"},children:[l.jsx("button",{onClick:g,style:{marginLeft:"auto",background:"#2962ff",border:"1px solid #2962ff",color:"#fff",cursor:"pointer",padding:"6px 16px",borderRadius:4,fontSize:12,fontWeight:600,transition:"all 0.15s"},children:"Save Changes"}),l.jsx("button",{onClick:s,style:{background:"transparent",border:"1px solid #2a2e39",color:"#787b86",cursor:"pointer",padding:"6px 16px",borderRadius:4,fontSize:12,fontWeight:500,transition:"all 0.15s"},children:"Discard"})]})]})},Q1=({data:i=[],height:e=140,stroke:s="#5e8cff",fill:a=!0,grid:c=!0,highlightNew:h=!0,showXAxis:d=!1,overlays:g=[]})=>{const p=D.useRef(null),v=D.useRef(null),x=D.useRef(null),[y,b]=D.useState(0),[S,N]=D.useState(null),E=D.useRef(null),R=D.useRef([]);D.useEffect(()=>{const L=p.current;if(!L)return;E.current;let C;try{const M=L.parentElement;M&&typeof ResizeObserver<"u"&&(C=new ResizeObserver(()=>{try{const T=L.getBoundingClientRect()}catch{}}),C.observe(M))}catch{}const j=window.devicePixelRatio||1,K=L.getBoundingClientRect();L.width=K.width*j,L.height=e*j;const I=L.getContext("2d");I.scale(j,j),I.clearRect(0,0,K.width,e);const U=M=>{if(M==null)return NaN;if(typeof M=="number")return M;try{let T=String(M).trim();return T=T.replace(/\$/g,"").replace(/,/g,""),parseFloat(T)}catch{return NaN}},Y=(i||[]).map((M,T)=>{if(M==null)return{t:null,v:NaN};if(typeof M=="number"||typeof M=="string")return{t:null,v:U(M)};const P=M.t??M.time??M.timestamp??M.tms??null,B=M.v??M.value??M.y??M.close??M.price??null,te=P!=null?typeof P=="number"?P:Date.parse(String(P)):null;return{t:Number.isFinite(te)?te:null,v:U(B)}}).filter(M=>Number.isFinite(M.v)),$=Y.map(M=>M.v);if($.length===0){if(I.fillStyle="rgba(255,255,255,0.02)",I.fillRect(0,0,K.width,e),C)try{C.disconnect()}catch{}R.current=[];return}const Q=Math.max(...$),q=Math.min(...$),ge=Math.max(1e-6,Q-q),O=K.width,A=e;if(c){I.strokeStyle="rgba(255,255,255,0.03)",I.lineWidth=1;const M=3;for(let T=0;T<=M;T++){const P=A/M*T;I.beginPath(),I.moveTo(0,P+.5),I.lineTo(O,P+.5),I.stroke()}}I.beginPath();let W=[];const ce=Y.some(M=>M.t!==null);if(ce){const T=Y.map(de=>Number.isFinite(de.t)?de.t:NaN).filter(de=>Number.isFinite(de)),P=T.length?Math.min(...T):0,B=T.length?Math.max(...T):P+1,te=Math.max(1,B-P);W=Y.map((de,oe)=>{const ue=Number.isFinite(de.t)?de.t:P+oe/Math.max(1,Y.length-1)*te,ee=(ue-P)/te*O,Z=A-(de.v-q)/ge*A;return{x:ee,y:Z,v:de.v,t:ue}})}else{const M=O/Math.max(1,$.length-1);W=$.map((T,P)=>({x:P*M,y:A-(T-q)/ge*A,v:T}))}if(R.current=W,W.forEach((M,T)=>{T===0?I.moveTo(M.x,M.y):I.lineTo(M.x,M.y)}),I.strokeStyle=s,I.lineWidth=2,I.lineJoin="round",I.lineCap="round",I.stroke(),a){W.length&&(I.lineTo(O,A),I.lineTo(0,A),I.closePath());const M=I.createLinearGradient(0,0,0,A),T=(P,B=.18)=>{if(!P)return`rgba(94,140,255,${B})`;if(P.startsWith("rgb")){const Z=P.match(/\d+,?\s*\d+,?\s*\d+/);if(Z)return`rgba(${Z[0]},${B})`}const te=P.replace("#",""),de=parseInt(te.length===3?te.split("").map(Z=>Z+Z).join(""):te,16),oe=de>>16&255,ue=de>>8&255,ee=de&255;return`rgba(${oe},${ue},${ee},${B})`};M.addColorStop(0,T(s,.18)),M.addColorStop(1,T(s,.02));try{I.fillStyle=M,I.fill()}catch{}}const se=W[W.length-1];se&&(I.beginPath(),I.fillStyle="#ffffff",I.globalAlpha=.95,I.arc(se.x,se.y,3,0,Math.PI*2),I.fill(),I.globalAlpha=1);try{Array.isArray(g)&&g.length&&g.forEach(M=>{const T=M.series||[];if(!T||T.length===0)return;I.beginPath();let P=!0;T.forEach(B=>{const te=B.t||null;let de=0;if(ce){const ue=Number.isFinite(te)?te:null,ee=ue!=null?ue-(Y[0].t||Y[0].t||0):null,Z=Math.min(...Y.map(Be=>Be.t||0)),ye=Math.max(...Y.map(Be=>Be.t||0)),we=Math.max(1,ye-Z);de=((Number.isFinite(B.t)?B.t:Z)-Z)/we*O}else{const ue=Math.floor(T.indexOf(B)/Math.max(1,T.length-1)*(W.length-1));de=W[Math.max(0,Math.min(W.length-1,ue))].x}const oe=A-(B.v-q)/ge*A;P?(I.moveTo(de,oe),P=!1):I.lineTo(de,oe)}),I.strokeStyle=M.stroke||"#ff8a00",I.lineWidth=1.6,I.setLineDash([]),I.stroke()})}catch{}if(h){const M=$[$.length-1],T=v.current;if(T==null||T!==M){v.current=M,b(1);const P=performance.now(),B=480;x.current&&cancelAnimationFrame(x.current);const te=de=>{const oe=Math.min(1,(de-P)/B);b(1-oe),oe<1?x.current=requestAnimationFrame(te):(x.current=null,b(0))};x.current=requestAnimationFrame(te)}}if(y>0&&W.length){const M=W[W.length-1];I.beginPath();const T=6+(1-y)*18,P=.22*y;I.fillStyle=`rgba(94,140,255,${P})`,I.arc(M.x,M.y,T,0,Math.PI*2),I.fill()}if(C)try{C.disconnect()}catch{}},[i,e,s,a,c,y,h,S]),D.useEffect(()=>()=>{x.current&&cancelAnimationFrame(x.current)},[]),D.useEffect(()=>{const L=p.current,C=E.current;if(!L||!C)return;let j=null;const K=U=>{try{j=L.getBoundingClientRect();const Y=U.clientX-j.left,$=U.clientY-j.top,Q=R.current||[];if(!Q.length){N(null);return}let q=null;for(let ge=0;ge<Q.length;ge++){const O=Q[ge],A=Math.abs(O.x-Y);(!q||A<q.dx)&&(q={p:O,dx:A})}q&&q.p?N({clientX:Math.max(0,Math.min(j.width,q.p.x)),clientY:Math.max(0,Math.min(j.height,q.p.y)),p:q.p}):N(null)}catch{}},I=()=>N(null);return C.addEventListener("pointermove",K),C.addEventListener("pointerleave",I),()=>{C.removeEventListener("pointermove",K),C.removeEventListener("pointerleave",I)}},[p,E]);const _=R.current||[],F=_.length&&_.some(L=>L.t!=null);let H=null;if(S&&S.p){const L=S.p,C=Math.min(Math.max(6,S.clientX+12),E.current?E.current.getBoundingClientRect().width-140:400),j=Math.max(6,S.clientY-36),K=L.t?new Date(L.t).toLocaleString():"",I=Number.isFinite(L.v)?L.v.toFixed(2):String(L.v),U={position:"absolute",left:`${C}px`,top:`${j}px`,pointerEvents:"none",background:"rgba(0,0,0,0.75)",color:"#fff",padding:"6px 8px",borderRadius:6,fontSize:12,zIndex:20,minWidth:120};H=l.jsxs("div",{style:U,children:[K,"  ",I]})}let z=null;if(d&&F){const L=_[0],C=_[Math.floor(_.length/2)],j=_[_.length-1],K=I=>{if(!I)return null;const U=I&&I.t?new Date(I.t).toLocaleString():"",Y={position:"absolute",left:`${Math.max(6,I.x)}px`,top:`${e+6}px`,transform:"translateX(-50%)",color:"rgba(255,255,255,0.75)",fontSize:11,pointerEvents:"none"};return l.jsx("div",{style:Y,children:U},(I.t||"")+"-"+Math.round(I.x||0))};z=l.jsxs(l.Fragment,{children:[K(L),K(C),K(j)]})}return l.jsxs("div",{ref:E,style:{position:"relative",width:"100%",height:e},children:[l.jsx("canvas",{ref:p,style:{width:"100%",height:e}}),H,z]})},Z1={},wa=typeof import.meta<"u"&&Z1?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000",ew=({open:i,onClose:e})=>{const[s,a]=D.useState("SPY"),[c,h]=D.useState("1Hour"),[d,g]=D.useState(90),[p,v]=D.useState(""),[x,y]=D.useState(""),[b,S]=D.useState(""),[N,E]=D.useState(""),[R,_]=D.useState(""),[F,H]=D.useState("[]"),[z,L]=D.useState(null),[C,j]=D.useState(null),[K,I]=D.useState(0),[U,Y]=D.useState(null),[$,Q]=D.useState(null),[q,ge]=D.useState(!1);D.useEffect(()=>{i||(L(null),j(null),I(0),Y(null),ge(!1))},[i]),D.useEffect(()=>{i&&(async()=>{try{if(!z){const T=localStorage.getItem("lastBacktestJob");if(T){L(T);const P=await fetch(`${wa}/api/backtest/status/${T}`);if(P.ok){const B=await P.json();if(j(B.status),I(B.progress||0),Q(B.error||null),B.status==="completed"||B.status==="failed"){const te=await fetch(`${wa}/api/backtest/results/${T}`);if(te.ok){const de=await te.json(),oe=de.result||null,ue=W(oe);Y(ue),Q(de.error||null);try{typeof window.displayWorkflowResultsV2=="function"&&window.displayWorkflowResultsV2(oe)}catch{}try{typeof window.toggleResultsPanel=="function"&&window.toggleResultsPanel(!0)}catch{}try{typeof window.setMonitorTab=="function"&&window.setMonitorTab("backtest")}catch{}}}else ge(!0)}}}}catch(T){console.warn("restore last job error",T)}try{const T=localStorage.getItem("backtestExecutionDefaults");if(T){const P=JSON.parse(T);P.position_size&&v(String(P.position_size)),P.position_size_pct&&y(String(P.position_size_pct)),P.commission_fixed&&S(String(P.commission_fixed)),P.commission_pct&&E(String(P.commission_pct)),P.slippage_pct&&_(String(P.slippage_pct))}}catch{}try{const T=F&&F.trim();if((!T||T==="[]")&&typeof window.getReactNodes=="function"){const P=window.getReactNodes()||[],B=typeof window.getReactConnections=="function"?window.getReactConnections()||[]:[],te=[...P].sort((we,Re)=>(we.y||0)-(Re.y||0)),de=new Set(["input","price_history","volume_history"]),oe=te.map(we=>{let Re=we.configValues||{};if(de.has(we.type)&&Re){const{symbol:Be,timeframe:Le,days:Ie,...ut}=Re;Re=ut}return{id:we.id,type:we.type,params:Re}});let ue="SPY",ee="1Hour",Z=7;for(let we=P.length-1;we>=0;we--){const Re=P[we];if(Re&&Re.type==="alpaca_config"&&Re.configValues){ue=Re.configValues.symbol||ue,ee=Re.configValues.timeframe||ee,Z=Re.configValues.days||Z;break}}const ye={symbol:ue,timeframe:ee,days:Z,workflow:oe,priceType:"current"};H(JSON.stringify(oe,null,2))}}catch(T){console.warn("auto-load workflow failed",T)}})()},[i]),D.useEffect(()=>{let T;return z&&q&&(T=setInterval(async()=>{try{const P=await fetch(`${wa}/api/backtest/status/${z}`);if(P.ok){const B=await P.json();if(j(B.status),I(B.progress||0),Q(B.error||null),B.status==="completed"||B.status==="failed"){ge(!1);const te=await fetch(`${wa}/api/backtest/results/${z}`);if(te.ok){const de=await te.json(),oe=W(de.result||null);Y(oe),Q(de.error||null)}}}}catch(P){console.warn("poll error",P)}},1e3)),()=>{T&&clearInterval(T)}},[z,q]);const O=async()=>{try{const T=JSON.parse(F||"[]");if(p&&x){alert("Please specify either Position Size (units) OR Position Size (%), not both.");return}const P={};p&&(P.position_size=Number(p)),x&&(P.position_size_pct=Number(x)),b&&(P.commission_fixed=Number(b)),N&&(P.commission_pct=Number(N)),R&&(P.slippage_pct=Number(R));const B={symbol:s,timeframe:c,days:d,workflow:T,execution:P};try{const oe={position_size:P.position_size,position_size_pct:P.position_size_pct,commission_fixed:P.commission_fixed,commission_pct:P.commission_pct,slippage_pct:P.slippage_pct};localStorage.setItem("backtestExecutionDefaults",JSON.stringify(oe))}catch{}const te=await fetch(`${wa}/api/backtest/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!te.ok){const oe=await te.text();alert("Failed to start backtest: "+oe);return}const de=await te.json();L(de.job_id);try{localStorage.setItem("lastBacktestJob",de.job_id)}catch{}j("queued"),I(0),ge(!0)}catch(T){alert("Invalid workflow JSON or network error"),console.error(T)}},A=async()=>{if(z)try{const T=await fetch(`${wa}/api/backtest/results/${z}`);if(T.ok){const P=await T.json(),B=W(P.result||null);Y(B),j(P.status||C),Q(P.error||null);try{typeof window.displayWorkflowResultsV2=="function"&&window.displayWorkflowResultsV2(r)}catch{}try{typeof window.toggleResultsPanel=="function"&&window.toggleResultsPanel(!0)}catch{}try{typeof window.setMonitorTab=="function"&&window.setMonitorTab("backtest")}catch{}}else{const P=await T.text().catch(()=>null);alert("Failed to fetch results: "+(P||T.status))}}catch(T){console.warn("fetch results error",T)}},W=T=>{if(!T)return null;const P={...T};try{Array.isArray(P.equityCurve)&&P.equityCurve.length>1||(Array.isArray(P.equity_curve)&&P.equity_curve.length?P.equityCurve=P.equity_curve.map(te=>({t:Date.parse(te.time),v:Number(te.equity)})):Array.isArray(P.equityCurve)&&P.equityCurve.length===1&&P.equityCurve[0].t&&P.equityCurve[0].v||(P.equityCurve=P.equityCurve||[]))}catch{P.equityCurve=P.equityCurve||[]}return P},ce=()=>{const T=U||null;if(!T){alert("No result to download");return}const P=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),B=URL.createObjectURL(P),te=document.createElement("a");te.href=B,te.download=`backtest-${z||Date.now()}.json`,te.click(),URL.revokeObjectURL(B)},se=T=>typeof T=="number"?new Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format(T):T,M=T=>typeof T=="number"?`${(T*100).toFixed(2)}%`:T;return i?l.jsx("div",{style:{position:"fixed",left:0,right:0,top:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsxs("div",{style:{width:900,maxHeight:"90vh",overflow:"auto",background:"#0f1724",padding:18,borderRadius:8,border:"1px solid #1f2937"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[l.jsx("div",{style:{fontSize:16,fontWeight:700},children:"Backtest Runner (MVP)"}),l.jsx("div",{children:l.jsx("button",{onClick:e,style:{background:"transparent",color:"#9ca3af",border:"none",fontSize:18},children:""})})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12},children:[l.jsxs("div",{style:{flex:1},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Symbol"}),l.jsx("input",{value:s,onChange:T=>a(T.target.value.toUpperCase()),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:160},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Timeframe"}),l.jsxs("select",{value:c,onChange:T=>h(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"},children:[l.jsx("option",{value:"1Min",children:"1m"}),l.jsx("option",{value:"5Min",children:"5m"}),l.jsx("option",{value:"15Min",children:"15m"}),l.jsx("option",{value:"1Hour",children:"1h"}),l.jsx("option",{value:"1Day",children:"1d"})]})]}),l.jsxs("div",{style:{width:120},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Days"}),l.jsx("input",{type:"number",value:d,onChange:T=>g(Number(T.target.value)),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:180},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Position Size (units)"}),l.jsx("input",{placeholder:"e.g. 1",value:p,onChange:T=>v(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:180},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Position Size (% of equity)"}),l.jsx("input",{placeholder:"0.1 for 10%",value:x,onChange:T=>y(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:140},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Commission (fixed)"}),l.jsx("input",{placeholder:"e.g. 1.0",value:b,onChange:T=>S(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:140},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Commission (%)"}),l.jsx("input",{placeholder:"0.001",value:N,onChange:T=>E(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{width:140},children:[l.jsx("label",{style:{display:"block",color:"#9ca3af",fontSize:12},children:"Slippage (%)"}),l.jsx("input",{placeholder:"0.001",value:R,onChange:T=>_(T.target.value),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]})]}),l.jsxs("div",{style:{marginBottom:12},children:[l.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Workflow JSON (array of blocks)"}),l.jsx("textarea",{value:F,onChange:T=>H(T.target.value),rows:6,style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #263141",background:"#071025",color:"#e5e7eb"}})]}),l.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[l.jsx("button",{onClick:O,style:{padding:"8px 12px",background:"#2563eb",color:"#fff",borderRadius:6,border:"none"},children:"Start Backtest"}),l.jsx("button",{onClick:()=>{H("[]"),Y(null),L(null),j(null),I(0)},style:{padding:"8px 12px",background:"#111827",color:"#9ca3af",borderRadius:6,border:"1px solid #263141"},children:"Reset"}),l.jsx("button",{onClick:A,disabled:!z,style:{padding:"8px 12px",background:"#0b1220",color:"#9ca3af",borderRadius:6,border:"1px solid #263141"},children:"Fetch Results"}),l.jsx("button",{onClick:ce,disabled:!U,style:{padding:"8px 12px",background:"#062e2f",color:"#9ca3af",borderRadius:6,border:"1px solid #174a49"},children:"Download JSON"}),z&&l.jsxs("div",{style:{marginLeft:"auto",color:"#9ca3af"},children:["Job: ",z]})]}),l.jsxs("div",{style:{display:"flex",gap:12},children:[l.jsxs("div",{style:{flex:1,padding:12,background:"#071025",borderRadius:8,border:"1px solid #1f2937"},children:[l.jsx("div",{style:{color:"#9ca3af",fontSize:12,marginBottom:8},children:"Status"}),l.jsx("div",{style:{fontWeight:700,fontSize:14},children:C||"idle"}),l.jsx("div",{style:{height:8,background:"#08101a",borderRadius:4,marginTop:8},children:l.jsx("div",{style:{width:`${K}%`,height:8,background:"#2563eb",borderRadius:4}})}),U&&l.jsxs("div",{style:{marginTop:12},children:[l.jsx("div",{style:{color:"#9ca3af",fontSize:12},children:"Metrics"}),l.jsxs("div",{children:["Final Equity: ",l.jsx("strong",{children:se(U.metrics?.final_equity)})]}),l.jsxs("div",{children:["Total Return: ",l.jsx("strong",{children:M(U.metrics?.total_return)})]}),l.jsxs("div",{children:["Max Drawdown: ",l.jsx("strong",{children:M(U.metrics?.max_drawdown)})]}),l.jsxs("div",{children:["Win Rate: ",l.jsx("strong",{children:M(U.metrics?.win_rate)})]}),l.jsxs("div",{children:["Signals: ",l.jsx("strong",{children:U.signals?U.signals.length:0})]}),$&&l.jsxs("div",{style:{marginTop:8,color:"#fca5a5",fontSize:12},children:["Error: ",$]})]})]}),l.jsxs("div",{style:{width:420,padding:12,background:"#071025",borderRadius:8,border:"1px solid #1f2937"},children:[l.jsx("div",{style:{color:"#9ca3af",fontSize:12,marginBottom:8},children:"Equity Curve"}),U&&U.equityCurve&&U.equityCurve.length?l.jsx(Q1,{data:U.equityCurve.map(T=>({t:T.t,v:T.v})),height:200,stroke:"#3b82f6",showXAxis:!0,highlightNew:!0}):l.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",color:"#6b7280"},children:"No equity data yet"})]})]}),l.jsxs("div",{style:{marginTop:12},children:[l.jsx("div",{style:{color:"#9ca3af",fontSize:12,marginBottom:8},children:"Trades"}),l.jsx("div",{style:{maxHeight:200,overflow:"auto",borderRadius:6,border:"1px solid #16202a",padding:8},children:U&&U.trades&&U.trades.length?U.trades.map((T,P)=>l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"6px 4px",borderBottom:"1px dashed #0f1724"},children:[l.jsxs("div",{children:[T.type," @ ",T.price]}),l.jsx("div",{children:T.pnl?`P&L: ${T.pnl}`:""})]},P)):l.jsx("div",{style:{color:"#6b7280"},children:"No trades yet"})})]})]})}):null},Iy="flowgrid_live_trades_v1",ad="flowgrid_live_position_v1";function tw(){try{const i=localStorage.getItem(Iy);return i?JSON.parse(i):[]}catch(i){return console.warn("[TradeTracker] Failed to read trades",i),[]}}function sw(){try{const i=localStorage.getItem(ad);return i?JSON.parse(i):null}catch(i){return console.warn("[TradeTracker] Failed to read position",i),null}}function Sa(i){try{i===null?localStorage.removeItem(ad):localStorage.setItem(ad,JSON.stringify(i))}catch(e){console.warn("[TradeTracker] Failed to save position",e)}}function Zg(i){try{const e=tw();e.push(i),localStorage.setItem(Iy,JSON.stringify(e)),console.log(`[TradeTracker] Saved trade: ${i.direction} ${i.symbol} @ ${i.exitPrice}, P&L: $${i.netPnL.toFixed(2)}`);try{window.dispatchEvent(new Event("flowgrid:trades-updated")),window.dispatchEvent(new CustomEvent("flowgrid:trade-completed",{detail:i}))}catch{}}catch(e){console.warn("[TradeTracker] Failed to save trade",e)}}function jo(i,e){return 0+i*e*1e-4}function nw(i,e){try{const s=iw(i.finalSignal||i.final_decision||i.summary?.status||"HOLD"),a=i.latest_data?.close||i.latest_data?.price||null;if(a==null)return console.warn("[TradeTracker] No price data in result"),null;const c=new Date().toISOString(),h=sw(),d=e.shares||100;if(!h){if(s==="BUY"){const g={strategyId:e.strategyId,type:"LONG",entryTime:c,entryPrice:a,entrySignal:"BUY",symbol:e.symbol,timeframe:e.timeframe,shares:d};return Sa(g),console.log(`[TradeTracker] Opened LONG position: ${e.symbol} @ ${a}`),null}else if(s==="SELL"){const g={strategyId:e.strategyId,type:"SHORT",entryTime:c,entryPrice:a,entrySignal:"SELL",symbol:e.symbol,timeframe:e.timeframe,shares:d};return Sa(g),console.log(`[TradeTracker] Opened SHORT position: ${e.symbol} @ ${a}`),null}return null}if(h.type==="LONG"){if(s==="SELL"||s==="HOLD"){const g=new Date(h.entryTime),v=new Date(c).getTime()-g.getTime(),x=(a-h.entryPrice)*h.shares,y=jo(h.shares,h.entryPrice)+jo(h.shares,a),b=x-y,S={id:Date.now(),strategyId:h.strategyId,strategyName:e.strategyName||h.strategyId,direction:"LONG",symbol:h.symbol,timeframe:h.timeframe,entryTime:h.entryTime,entryPrice:h.entryPrice,entrySignal:h.entrySignal,exitTime:c,exitPrice:a,exitSignal:s,grossPnL:x,netPnL:b,fees:y,holdingDuration:v,shares:h.shares};if(Zg(S),s==="SELL"){const N={strategyId:e.strategyId,type:"SHORT",entryTime:c,entryPrice:a,entrySignal:"SELL",symbol:e.symbol,timeframe:e.timeframe,shares:d};Sa(N),console.log(`[TradeTracker] Reversed: LONG  SHORT @ ${a}`)}else Sa(null),console.log(`[TradeTracker] Closed LONG position @ ${a}`);return S}}else if(h.type==="SHORT"&&(s==="BUY"||s==="HOLD")){const g=new Date(h.entryTime),v=new Date(c).getTime()-g.getTime(),x=(h.entryPrice-a)*h.shares,y=jo(h.shares,h.entryPrice)+jo(h.shares,a),b=x-y,S={id:Date.now(),strategyId:h.strategyId,strategyName:e.strategyName||h.strategyId,direction:"SHORT",symbol:h.symbol,timeframe:h.timeframe,entryTime:h.entryTime,entryPrice:h.entryPrice,entrySignal:h.entrySignal,exitTime:c,exitPrice:a,exitSignal:s,grossPnL:x,netPnL:b,fees:y,holdingDuration:v,shares:h.shares};if(Zg(S),s==="BUY"){const N={strategyId:e.strategyId,type:"LONG",entryTime:c,entryPrice:a,entrySignal:"BUY",symbol:e.symbol,timeframe:e.timeframe,shares:d};Sa(N),console.log(`[TradeTracker] Reversed: SHORT  LONG @ ${a}`)}else Sa(null),console.log(`[TradeTracker] Closed SHORT position @ ${a}`);return S}return null}catch(s){return console.error("[TradeTracker] Error tracking trade",s),null}}function iw(i){const e=String(i).toUpperCase().trim();return e==="BUY"||e==="LONG"?"BUY":e==="SELL"||e==="SHORT"?"SELL":"HOLD"}const aw=({onNavigate:i})=>{const[e,s]=D.useState(1),[a,c]=D.useState({x:0,y:0}),[h,d]=D.useState(!1),[g,p]=D.useState([]),v=D.useRef(null),x=D.useRef(null),[y,b]=D.useState([]),[S,N]=D.useState(null),[E,R]=D.useState(null),_=D.useRef(1),F="flowgrid_workflow_v1",H=`${F}::saves`,z="flowgrid_alerts_v1",L=D.useRef(null),C=()=>{const X=prompt("Save workflow as (provide a name):",`workflow-${new Date().toISOString().replace(/[:.]/g,"-")}`);if(!X)return;const le={nodes:g,connections:y,savedAt:new Date().toISOString()};try{const fe=localStorage.getItem(H),xe=fe?JSON.parse(fe):{};xe[X]=le,localStorage.setItem(H,JSON.stringify(xe));try{localStorage.setItem("workflow_active_id",X)}catch{}window.dispatchEvent(new CustomEvent("flowgrid:strategy-saved",{detail:{name:X,payload:le}})),alert(`Workflow saved as "${X}"`)}catch(fe){console.error("save error",fe),alert("Failed to save workflow")}},j=()=>{try{const X=localStorage.getItem(H);if(!X){alert("No saved workflows found");return}const le=JSON.parse(X),fe=Object.keys(le);if(fe.length===0){alert("No saved workflows found");return}const xe=prompt(`Saved workflows:
${fe.map((_e,Ve)=>`${Ve+1}. ${_e}`).join(`
`)}

Enter name or number to load:`);if(!xe)return;let je=null;const ze=parseInt(xe,10);if(!isNaN(ze)&&ze>=1&&ze<=fe.length?je=fe[ze-1]:le[xe]&&(je=xe),!je){alert("No matching saved workflow");return}const He=le[je],$e=ce(He.nodes||[],He.connections||[]);p($e.nodes),b($e.connections);try{localStorage.setItem("workflow_active_id",je)}catch{}alert(`Loaded workflow "${je}"`)}catch(X){console.error("load error",X),alert("Failed to load workflow")}},K=()=>{try{const X=localStorage.getItem(H)||"{}",le=JSON.parse(X);return Object.keys(le).map(fe=>({name:fe,savedAt:le[fe]?.savedAt||null}))}catch{return[]}},I=X=>{if(confirm(`Delete saved workflow "${X}"?`))try{const le=localStorage.getItem(H)||"{}",fe=JSON.parse(le);delete fe[X],localStorage.setItem(H,JSON.stringify(fe)),alert(`Deleted "${X}"`)}catch(le){console.error(le),alert("Failed to delete")}},U=D.useCallback(X=>{if(!X)return"HOLD";const le=String(X).toUpperCase();return le.includes("BUY")||le.includes("LONG")?"BUY":le.includes("SELL")||le.includes("SHORT")?"SELL":(le.includes("HOLD"),"HOLD")},[]),Y=D.useCallback((X,le="manual-run")=>{if(X)try{const fe=U(X.finalSignal||X.final_decision||X.summary?.status||""),xe=X.latest_data||{},je=xe.price??xe.close??xe.last??xe.current_price??null,ze=je!=null&&!Number.isNaN(Number(je))?Number(je):null,He=(()=>{try{return localStorage.getItem("workflow_active_id")}catch{return null}})(),$e=He||"Builder Session",_e=X.summary?.symbol||xe.symbol||"",Ve=X.summary?.timeframe||"",ht={id:`${Date.now()}`,strategyId:He,strategyName:$e,signal:fe,price:ze,symbol:_e,timeframe:Ve,timestamp:new Date().toISOString(),source:le},Ne=ze!=null?ze.toFixed(4):"na",Qe=`${ht.strategyId||"adhoc"}|${fe}|${Ne}|${_e}|${Ve}`,ls=L.current;L.current=Qe;const Kt=localStorage.getItem(z),Ut=Kt?JSON.parse(Kt):[];let Nt=Array.isArray(Ut)?[...Ut]:[];ls===Qe&&Nt.length?Nt[0]={...Nt[0],...ht,signature:Qe}:Nt.length&&Nt[0]?.strategyId===ht.strategyId&&Nt[0]?.signal===ht.signal&&Nt[0]?.symbol===ht.symbol?Nt[0]={...Nt[0],...ht,signature:Qe}:Nt.unshift({...ht,signature:Qe}),Nt.length>15&&(Nt=Nt.slice(0,15)),localStorage.setItem(z,JSON.stringify(Nt)),window.dispatchEvent(new Event("flowgrid:alerts-updated"))}catch(fe){console.warn("[Builder] Failed to persist alert entry",fe)}},[U]),$=D.useCallback((X,le={})=>{if(!X)return!1;try{const fe=localStorage.getItem(H)||"{}",je=JSON.parse(fe)[X];if(!je||!Array.isArray(je.nodes)||je.nodes.length===0)return!1;const ze=ce(je.nodes||[],je.connections||[]);if(p(ze.nodes),b(ze.connections),le.setActive!==!1)try{localStorage.setItem("workflow_active_id",X)}catch{}if(le.emitLoadRequest!==!1)try{localStorage.setItem("flowgrid_workflow_v1::load_request",X)}catch{}if(le.autoStart){try{localStorage.setItem("flowgrid_pending_live_start","1")}catch{}try{localStorage.setItem("workflow_live","1")}catch{}}return!0}catch(fe){return console.error("[Builder] loadWorkflowById error",fe),!1}},[p,b]),Q=()=>{const X={nodes:g,connections:y},le=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),fe=URL.createObjectURL(le),xe=document.createElement("a");xe.href=fe,xe.download=`workflow-${Date.now()}.json`,xe.click(),URL.revokeObjectURL(fe)},q=D.useRef(null),ge=()=>{q.current&&q.current.click()},O=X=>{const le=X.target.files&&X.target.files[0];if(!le)return;const fe=new FileReader;fe.onload=xe=>{try{const je=JSON.parse(xe.target.result),ze=ce(je.nodes||[],je.connections||[]);p(ze.nodes),b(ze.connections),alert("Workflow imported")}catch(je){console.error("import error",je),alert("Invalid workflow file")}},fe.readAsText(le),X.target.value=""},A=()=>{if(confirm("Clear all nodes and connections?")){p([]),b([]);try{localStorage.removeItem("workflow_active_id")}catch{}try{localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}}},W=()=>{p([]),b([]),jt();try{localStorage.setItem("workflow_live","0"),localStorage.removeItem("workflow_active_id"),localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}console.log("[Builder] Started new workflow (cleared canvas)")};D.useEffect(()=>(window.listSavedWorkflows=K,window.deleteSavedWorkflow=I,()=>{try{delete window.listSavedWorkflows}catch{}try{delete window.deleteSavedWorkflow}catch{}}),[]);function ce(X,le){const fe=X.map(_e=>Number(_e.id)),xe=fe.every(_e=>!Number.isNaN(_e)),je=new Set(fe.filter(_e=>!Number.isNaN(_e))).size;if(xe&&je===X.length){const _e=fe.length?Math.max(...fe):0;return _.current=Math.max(_.current,_e+1),{nodes:X.map(Ve=>({...Ve,id:Number(Ve.id)})),connections:le}}const ze=new Map,He=[];X.forEach(_e=>{const Ve=_.current++;ze.set(_e.id,Ve),He.push({..._e,id:Ve})});const $e=(le||[]).map(_e=>{const Ve=ze.has(_e.from?.nodeId)?ze.get(_e.from.nodeId):Number(_e.from?.nodeId),ht=ze.has(_e.to?.nodeId)?ze.get(_e.to.nodeId):Number(_e.to?.nodeId);return{..._e,from:{..._e.from||{},nodeId:Ve},to:{..._e.to||{},nodeId:ht}}});return{nodes:He,connections:$e}}D.useEffect(()=>{const X=document.getElementById("nodeCount");X&&(X.textContent=`${g.length} blocks`)},[g]),D.useEffect(()=>{let X=0;g.forEach(le=>{const fe=Number(le.id);!Number.isNaN(fe)&&fe>X&&(X=fe)}),_.current=Math.max(_.current,X+1)},[g]),D.useEffect(()=>(window.getReactNodes=()=>g,window.getReactConnections=()=>y,()=>{try{delete window.getReactNodes}catch{}try{delete window.getReactConnections}catch{}}),[g,y]);const[se,M]=D.useState(null),[T,P]=D.useState(!1),[B,te]=D.useState(!1),[de,oe]=D.useState(!1),ue=D.useRef(!1),ee=D.useRef(null),Z=D.useRef(null),ye=D.useRef(!1),[we,Re]=D.useState(null),[Be,Le]=D.useState(!1);D.useEffect(()=>{window.displayWorkflowResultsV2=X=>{try{M(X),P(!0)}catch(le){console.warn(le)}};try{window.toggleResultsPanel=X=>{try{P(typeof X=="boolean"?!!X:le=>!le)}catch(le){console.warn("toggleResultsPanel error",le)}}}catch{}return()=>{try{delete window.displayWorkflowResultsV2}catch{}}},[]);const Ie=()=>{if(!g||g.length===0)return null;const X=[...g].sort((Ne,Qe)=>Ne.y-Qe.y),le=new Set(["input","price_history","volume_history"]),fe=X.map(Ne=>{let Qe=Ne.configValues||{};if(le.has(Ne.type)&&Qe){const{symbol:ls,timeframe:Kt,days:Ut,...Nt}=Qe;Qe=Nt}return{id:Ne.id,type:Ne.type,params:Qe}});let xe="SPY",je="1Hour",ze=7;const He=g.slice().reverse().find(Ne=>le.has(Ne.type)&&Ne.configValues&&(Ne.configValues.symbol||Ne.configValues.timeframe||Ne.configValues.days));He&&He.configValues&&(xe=He.configValues.symbol||xe,je=He.configValues.timeframe||je,ze=He.configValues.days||ze);let $e=null,_e=null;try{$e=localStorage.getItem("alpaca_key_id")||null,_e=localStorage.getItem("alpaca_secret_key")||null}catch{}let Ve=null;try{Ve=localStorage.getItem("workflow_active_id")||null}catch{}const ht=(y||[]).map(Ne=>({id:Ne.id,from:{nodeId:Ne.from?.nodeId||Ne.fromNodeId,port:Ne.from?.port||Ne.fromPort},to:{nodeId:Ne.to?.nodeId||Ne.toNodeId,port:Ne.to?.port||Ne.toPort}}));return{symbol:xe,timeframe:je,days:ze,workflow:fe,connections:ht,priceType:"current",alpacaKeyId:$e,alpacaSecretKey:_e,strategy_name:Ve}},ut=async(X,le)=>{if(!X)throw new Error("No workflow defined");const fe=JSON.stringify(X),je=["http://localhost:5000/execute_workflow_v2","/execute_workflow_v2",`${typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000"}/execute_workflow_v2`,"http://localhost:5000/execute_workflow_v2"];let ze=null;for(const He of je)try{const $e=await fetch(He,{method:"POST",headers:{"Content-Type":"application/json"},body:fe,signal:le});if(!$e.ok){const _e=await $e.text().catch(()=>null);throw new Error(`HTTP ${$e.status} ${$e.statusText} - ${_e||""}`)}return await $e.json()}catch($e){ze=$e}throw ze||new Error("No endpoints available")},Yt=async()=>{if(!g||g.length===0){alert("Add blocks to create a workflow first");return}const X=Ie();try{const le=await ut(X,null);if(le.error)throw new Error(le.error);M(le);try{window.__monitor_resultsData=le}catch{}try{localStorage.setItem("monitor_results",JSON.stringify(le))}catch{}try{localStorage.setItem(F,JSON.stringify({nodes:g,connections:y}))}catch{}try{window.toggleResultsPanel&&window.toggleResultsPanel(!0)}catch{}P(!0),le&&le.historical_bars&&Object.keys(le.historical_bars).length>0?te(!0):te(!1),Y(le,"manual-run")}catch(le){console.error("runWorkflow error",le);try{const fe=await fetch("/health");if(fe&&fe.ok){const xe=await fe.json().catch(()=>null),je=le&&le.message?le.message:String(le);alert(`Failed to execute workflow: backend returned error.

Error: `+je+`

Backend health: `+JSON.stringify(xe))}else{const xe=le&&le.message?le.message:String(le);alert(`Failed to execute workflow: cannot reach backend.

Error: `+xe+`

Please ensure the backend is running on port 5000. See console for details.`)}}catch{const xe=le&&le.message?le.message:String(le);alert(`Failed to execute workflow: network error (could not reach backend).

Error: `+xe+`

Check backend is running and CORS settings. See console for details.`)}}},Ot=()=>{ye.current||(oe(!0),ue.current=!0,ye.current=!0,(async()=>{for(;ue.current;){const X=Ie(),le=new AbortController;ee.current=le;try{const fe=await ut(X,le.signal);if(fe&&!fe.error){M(fe);try{window.__monitor_resultsData=fe}catch{}try{localStorage.setItem("monitor_results",JSON.stringify(fe))}catch{}try{localStorage.setItem(F,JSON.stringify({nodes:g,connections:y}))}catch{}try{window.toggleResultsPanel&&window.toggleResultsPanel(!0)}catch{}P(!0),fe&&fe.historical_bars&&Object.keys(fe.historical_bars).length>0?te(!0):te(!1),Y(fe,"live-tick");try{const xe=localStorage.getItem("workflow_active_id")||"Unnamed Strategy",je=X.symbol||"SPY",ze=X.timeframe||"1Hour";nw(fe,{strategyId:xe,strategyName:xe,symbol:je,timeframe:ze,shares:100})}catch(xe){console.warn("[WorkflowBuilder] Trade tracking error",xe)}}else console.warn("Live run returned error payload",fe)}catch(fe){fe.name==="AbortError"||console.warn("Live run error",fe)}await new Promise(fe=>{Z.current=setTimeout(fe,1e3)})}ye.current=!1,ee.current=null,oe(!1)})())},jt=()=>{ue.current=!1,oe(!1);try{ee.current&&ee.current.abort()}catch{}try{Z.current&&(clearTimeout(Z.current),Z.current=null)}catch{}},lt=()=>{if(ue.current){jt();try{localStorage.setItem("workflow_live","0")}catch{}}else{Ot();try{localStorage.setItem("workflow_live","1")}catch{}}};D.useEffect(()=>{const X={loadWorkflowById:$,startLive:()=>{if(!ue.current){try{localStorage.setItem("workflow_live","1")}catch{}Ot()}},stopLive:()=>{if(ue.current){jt();try{localStorage.setItem("workflow_live","0")}catch{}}},isLiveRunning:()=>!!ue.current,resetWorkflow:(le={})=>{p([]),b([]),jt();try{localStorage.setItem("workflow_live","0"),localStorage.removeItem("workflow_active_id"),localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}console.log("[Builder] Reset workflow via bridge")}};return window.flowgridLiveBridge=X,()=>{window.flowgridLiveBridge===X&&delete window.flowgridLiveBridge}},[$,Ot,jt]),D.useEffect(()=>()=>{try{jt()}catch{}},[]),D.useEffect(()=>{if(g.length>0)try{localStorage.getItem("flowgrid_pending_live_start")==="1"&&(console.log(`[Builder] Nodes ready (${g.length} nodes), starting pending live run...`),localStorage.removeItem("flowgrid_pending_live_start"),ue.current||Ot())}catch(X){console.error("[Builder] pending live start check error",X)}},[g]),D.useEffect(()=>{console.log("[Builder] Checking workflow_live on mount...");try{const le=localStorage.getItem("workflow_live");console.log(`[Builder] workflow_live = "${le}", liveRunning = ${ue.current}`),le==="1"&&!ue.current&&(console.log("[Builder] Starting live run from mount..."),Ot())}catch(le){console.error("[Builder] mount check error",le)}const X=le=>{try{if(!le)return;console.log(`[Builder] storage event: key="${le.key}", newValue="${le.newValue}"`),le.key==="workflow_live"&&(le.newValue==="1"?(console.log("[Builder] workflow_live changed to 1, starting..."),ue.current||Ot()):(console.log("[Builder] workflow_live changed to 0, stopping..."),ue.current&&jt()))}catch(fe){console.error("[Builder] storage handler error",fe)}};return window.addEventListener("storage",X),()=>window.removeEventListener("storage",X)},[]),D.useEffect(()=>{const X=()=>{try{if(localStorage.getItem("flowgrid_new_workflow_request")){console.log("[Builder] New workflow request detected, skipping load request");try{localStorage.removeItem("flowgrid_new_workflow_request")}catch{}try{localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}return}const je=localStorage.getItem("flowgrid_workflow_v1::load_request");if(console.log("[Builder] tryLoadRequest - load_request value:",je),!je)return;const ze=localStorage.getItem(H)||"{}",He=JSON.parse(ze);if(!He[je]){console.warn("[Builder] load_request for unknown save:",je);try{localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}return}const $e=He[je];if(!$e||!$e.nodes){console.warn("[Builder] Saved workflow has no nodes:",je);try{localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}return}const _e=ce($e.nodes||[],$e.connections||[]);console.log(`[Builder] Loading workflow "${je}" with ${_e.nodes.length} nodes`),p(_e.nodes),b(_e.connections);try{localStorage.setItem("workflow_active_id",je)}catch{}console.log(`[Builder] Loaded workflow from load_request: "${je}" with ${_e.nodes.length} nodes`);try{localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}if(_e.nodes.length>0)try{localStorage.getItem("workflow_live")==="1"&&(console.log("[Builder] workflow_live is 1, will start after nodes render"),localStorage.setItem("flowgrid_pending_live_start","1"))}catch(Ve){console.error("[Builder] failed to check workflow_live",Ve)}}catch(xe){console.error("[Builder] failed to process load_request",xe)}};X();const le=xe=>{!xe||!xe.key||xe.key==="flowgrid_workflow_v1::load_request"&&(console.log("[Builder] Storage event for load_request"),X())},fe=xe=>{console.log("[Builder] Custom load-request event:",xe.detail),setTimeout(X,10)};return window.addEventListener("storage",le),window.addEventListener("flowgrid:load-request",fe),()=>{window.removeEventListener("storage",le),window.removeEventListener("flowgrid:load-request",fe)}},[]),D.useEffect(()=>{const X=le=>{try{if(!le)return;if(le.key==="monitor_stop")try{jt()}catch{}}catch{}};return window.addEventListener("storage",X),()=>window.removeEventListener("storage",X)},[]),D.useEffect(()=>{const X=()=>{console.log("[Builder] Received clear-builder event, clearing canvas"),p([]),b([]);try{localStorage.removeItem("workflow_active_id"),localStorage.removeItem("flowgrid_workflow_v1::load_request")}catch{}};return window.addEventListener("flowgrid:clear-builder",X),()=>window.removeEventListener("flowgrid:clear-builder",X)},[]),D.useEffect(()=>{const X=()=>{console.log("[Builder] Received new-workflow event, resetting canvas"),p([]),b([]),jt();try{localStorage.setItem("workflow_live","0"),localStorage.removeItem("workflow_active_id"),localStorage.removeItem("flowgrid_workflow_v1::load_request");const le=localStorage.getItem(H);if(le){const fe=JSON.parse(le);Object.keys(fe).forEach(xe=>{try{localStorage.setItem(`flowgrid_saved_enabled::${xe}`,"0")}catch{}})}}catch{}};return window.addEventListener("flowgrid:new-workflow",X),()=>window.removeEventListener("flowgrid:new-workflow",X)},[]);const[Ms,Xs]=D.useState({});D.useEffect(()=>{try{window.__monitor_nodeBuffers=Ms}catch{}try{const X={};Object.entries(Ms||{}).forEach(([le,fe])=>{X[le]=fe&&fe.last!=null?fe.last:null}),localStorage.setItem("monitor_node_buffers",JSON.stringify(X))}catch{}},[Ms]),D.useEffect(()=>{let X=null,le=!1,fe=500,xe=!0;const je=240,ze=()=>{try{X=new WebSocket("ws://127.0.0.1:6789")}catch{He();return}X.onopen=()=>{console.debug("[WS] connected"),fe=500;try{window.__wsConnected=!0}catch{}},X.onmessage=$e=>{try{const _e=JSON.parse($e.data);if(!_e||!_e.node_id)return;const Ve=_e.tick&&(_e.tick.ts||_e.tick.t||_e.tick.time)?Number(_e.tick.ts||_e.tick.t||_e.tick.time):null,ht=Ve?Ve>1e12?Ve:Ve*1e3:Date.now();let Ne=_e.value;Ne&&typeof Ne=="object"&&(typeof Ne.v<"u"?Ne=Ne.v:typeof Ne.value<"u"?Ne=Ne.value:typeof Ne.macd<"u"?Ne=Ne.macd:Ne=null);const Qe=Ne==null?null:Number(Ne);Xs(ls=>{const Kt={...ls||{}},Ut=Kt[_e.node_id]||{name:_e.node_name||_e.node_id,buf:[],last:null};Number.isFinite(Qe)?(Ut.buf=[...Ut.buf.slice(-je+1),{t:ht,v:Qe}],Ut.last=Qe):Ut.last=_e.value!=null?_e.value:Ut.last,Ut.name=_e.node_name||Ut.name,Kt[_e.node_id]=Ut;try{window.__nodeBuffers=Kt}catch{}return Kt})}catch(_e){console.warn("Failed to parse WS message",_e)}},X.onclose=()=>{console.debug("[WS] closed");try{window.__wsConnected=!1}catch{}!le&&xe&&He()},X.onerror=$e=>{try{X.close()}catch{}}},He=()=>{setTimeout(()=>{le||!xe||(fe=Math.min(1e4,fe*1.5),ze())},fe)};return ze(),()=>{le=!0,xe=!1;try{X&&X.close()}catch{}try{window.__wsConnected=!1}catch{}}},[]);const[It,En]=D.useState(!1),[yt,Js]=D.useState(null);D.useEffect(()=>{if(!se)return;En(!0),Js(Date.now());const X=setTimeout(()=>En(!1),480);return()=>clearTimeout(X)},[se]);const ke=()=>{const X=[{id:1,type:"fetch",x:120,y:80,title:"Fetch Price"},{id:2,type:"rsi",x:360,y:80,title:"RSI Check"},{id:3,type:"signal",x:600,y:80,title:"Signal"}],le=[{id:"c_1",from:{nodeId:1,port:"out"},to:{nodeId:2,port:"in"}},{id:"c_2",from:{nodeId:2,port:"out"},to:{nodeId:3,port:"in"}}];_.current=Math.max(_.current,4),p(X),b(le);const fe=Date.now(),xe=(ze=100,He=20)=>Array.from({length:He},($e,_e)=>+(ze+Math.sin(_e/3)*(_e%3+1)+(Math.random()-.5)*2).toFixed(2)),je={summary:{strategyName:"Demo Strategy",status:"completed"},aiAnalysis:"Sample AI analysis: no anomalies detected. Strategy would have produced modest gains in this demo.",blocks:[{id:1,block_type:"fetch",status:"passed",execution_time_ms:12.4,message:"Fetched price history",params:{symbol:"NVDA"},price_series:xe(300)},{id:2,block_type:"rsi",status:"passed",execution_time_ms:8.9,message:"RSI computed",params:{period:14},price_series:xe(305)},{id:3,block_type:"signal",status:"passed",execution_time_ms:3.1,message:"Signal emitted: BUY",logs:["Signal BUY at 345.22"]}],signals:[{time:fe-1e3*60*60,signal:"BUY",price:345.22,series:xe(340,18)},{time:fe-1e3*60*30,signal:"HOLD",price:347.1,series:xe(346,18)}],equityCurve:Array.from({length:30},(ze,He)=>({t:He,v:1e4+He*(He%5===0?80:12)})),latest_data:{close:345.22,volume:1234500}};try{window.lastPanelData=je}catch{}M(je),P(!0)},me=()=>{const X=se||window.lastPanelData||null;if(!X){alert("No results available to download");return}const le=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),fe=URL.createObjectURL(le),xe=document.createElement("a");xe.href=fe,xe.download=`strategy-results-${Date.now()}.json`,xe.click(),URL.revokeObjectURL(fe)},Se=X=>{X.preventDefault();const le=X.dataTransfer.getData("blockType");if(!le)return;if(le.startsWith("template-")){const Ve=U1(le);if(Ve){const Ne=v.current.getBoundingClientRect(),Qe=X.clientX-Ne.left,ls=X.clientY-Ne.top,Kt=Qe-80,Ut=ls-120,Nt=Ve.nodes.map(Ct=>({...Ct,x:Ct.x+Kt,y:Ct.y+Ut,def:nt[Ct.type]||{name:Ct.title||Ct.type,icon:"",inputs:[],outputs:[]}})),Bi=Math.max(...Ve.nodes.map(Ct=>Ct.id));if(_.current=Math.max(_.current,Bi+1),g.length===0)p(Nt),b(Ve.connections);else{const Ct=_.current,qa=Ve.nodes.map(mt=>({...mt,id:mt.id+Ct,x:mt.x+Kt,y:mt.y+Ut,def:nt[mt.type]||{name:mt.title||mt.type,icon:"",inputs:[],outputs:[]}})),Tn=Ve.connections.map(mt=>({...mt,id:`${mt.id}_${Ct}`,from:{...mt.from,nodeId:mt.from.nodeId+Ct},to:{...mt.to,nodeId:mt.to.nodeId+Ct}}));_.current=Ct+Bi+1,p(mt=>[...mt,...qa]),b(mt=>[...mt,...Tn])}return}}const xe=v.current.getBoundingClientRect(),je=X.clientX-xe.left,ze=X.clientY-xe.top,He=_.current++,$e=nt[le]||{name:le,icon:"",inputs:[],outputs:[]},_e={id:He,type:le,x:je,y:ze,title:$e.name,def:$e};p(Ve=>[...Ve,_e]),Re(_e),Le(!0)},Ae=X=>{Re(X),Le(!0)},Ye=()=>{Le(!1),Re(null)},Me=X=>{p(le=>le.map(fe=>fe.id===X.id?{...fe,...X}:fe))},Ce=(X,le)=>{p(fe=>fe.map(xe=>xe.id===X?{...xe,config:le}:xe))},tt=X=>{X.preventDefault()},bt=(X,le,fe)=>{const xe=ht=>Math.round(ht/15)*15,_e=Math.max(0,Math.min(5e3,xe(le))),Ve=Math.max(0,Math.min(5e3,xe(fe)));p(ht=>ht.map(Ne=>Ne.id===X?{...Ne,x:_e,y:Ve}:Ne))};D.useEffect(()=>{const X=v.current;if(!X)return;const le=fe=>{if(fe.ctrlKey||fe.metaKey){fe.preventDefault();const xe=fe.deltaY<0?.1:-.1;s(je=>Math.max(.3,Math.min(2.5,+(je+xe).toFixed(2))))}};return X.addEventListener("wheel",le,{passive:!1}),()=>X.removeEventListener("wheel",le)},[]);const oi=X=>{const le=document.querySelector(".workflow-builder-root .app-container > .Toolbar");if(le&&le.contains(X.target))return;const fe=X.target===v.current||X.target.classList.contains("canvas");if(!(X.button===1||X.ctrlKey||X.metaKey||X.button===0&&fe))return;d(!0);const xe={x:X.clientX,y:X.clientY},je={...a},ze=$e=>{c({x:je.x+($e.clientX-xe.x),y:je.y+($e.clientY-xe.y)})},He=()=>{d(!1),document.removeEventListener("mousemove",ze),document.removeEventListener("mouseup",He)};document.addEventListener("mousemove",ze),document.addEventListener("mouseup",He)},$t=X=>{p(le=>le.filter(fe=>fe.id!==X))},$a=(X,le,fe)=>{if(fe!=="output")return;N({from:{nodeId:X,port:le},x:null,y:null});const xe=ze=>{N(He=>He?{...He,x:ze.clientX,y:ze.clientY}:null)},je=()=>{document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",je)};document.addEventListener("mousemove",xe),document.addEventListener("mouseup",je)},Qs=(X,le,fe)=>{if(!S||fe!=="input")return;const xe={id:`c_${Date.now()}_${Math.floor(Math.random()*1e3)}`,from:{...S.from},to:{nodeId:X,port:le}};b(je=>[...je,xe]),N(null)},Ii=X=>{b(le=>le.filter(fe=>fe.id!==X)),E===X&&R(null)};D.useEffect(()=>{const X=le=>{(le.key==="Delete"||le.key==="Backspace")&&E&&Ii(E)};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[E]);const[Ua,Zs]=D.useState(!1),[Va,Pi]=D.useState(!1),[ur,Ha]=D.useState(!1);return l.jsx("div",{className:"workflow-builder-root",children:l.jsxs("div",{className:"app-container",children:[l.jsx(q1,{}),l.jsx(F1,{extraBefore:typeof i=="function"?l.jsx(Jg,{onBack:()=>i("home"),label:"Back to Home"}):l.jsx(Jg,{onBack:()=>{try{window.navigate&&window.navigate("home")}catch{window.location.href="/"}},label:"Back to Home"}),onNew:W,onSave:C,onLoad:j,onExport:Q,onImport:ge,onClear:A,onOrganize:null,onRun:Yt,onSample:ke,onToggleMonitor:()=>Zs(X=>!X),onRunToggle:lt,onBacktest:()=>Ha(!0),liveRunning:de}),l.jsxs("div",{className:"canvas-container",children:[l.jsx("div",{style:{position:"absolute",bottom:24,right:32,zIndex:100,display:"flex",alignItems:"flex-end",gap:12},children:l.jsxs("div",{className:"zoom-controls",style:{display:"flex",flexDirection:"column",gap:8},children:[l.jsx("button",{className:"toolbar-btn",title:"Zoom In",onClick:()=>s(X=>Math.min(2.5,+(X+.15).toFixed(2))),children:""}),l.jsx("button",{className:"toolbar-btn",title:"Zoom Out",onClick:()=>s(X=>Math.max(.3,+(X-.15).toFixed(2))),children:""}),l.jsx("button",{className:"toolbar-btn",title:"Reset Zoom",onClick:()=>{s(1),c({x:0,y:0})},children:""})]})}),l.jsxs("svg",{className:"connection-layer",id:"connectionLayer",ref:x,style:{transform:`scale(${e}) translate(${a.x}px,${a.y}px)`},children:[l.jsx("defs",{children:l.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:l.jsx("polygon",{points:"0 0, 10 3, 0 6",fill:"#5e8cff"})})}),l.jsx(G1,{svgRef:x,connections:y,connecting:S&&S.x!==null&&S.y!==null?S:null,nodes:g,canvasScale:e,canvasOffset:a})]}),l.jsx("div",{className:`canvas${h?" panning":""}`,id:"canvas",ref:v,onDrop:Se,onDragOver:tt,onMouseDown:oi,style:{transform:`scale(${e}) translate(${a.x}px,${a.y}px)`},children:g.map(X=>l.jsx(W1,{node:X,onUpdatePosition:bt,onDelete:$t,onStartConnection:$a,onEndConnection:Qs,onOpenSettings:Ae,onUpdateConfig:Ce},X.id))}),l.jsx("input",{ref:q,type:"file",accept:"application/json",style:{display:"none"},onChange:O}),l.jsxs("div",{className:"status-bar",children:[l.jsxs("div",{className:"status-item",children:[l.jsx("div",{className:`status-dot ${de?"live":""}`}),l.jsx("span",{children:de?"Live":"Ready"}),yt?l.jsx("span",{className:"last-update",children:new Date(yt).toLocaleTimeString()}):null]}),l.jsx("div",{className:"status-item",children:l.jsx("span",{id:"nodeCount",children:"0 blocks"})}),l.jsx("div",{className:"status-item",children:l.jsx("span",{id:"connectionCount",children:"0 connections"})})]})]}),(()=>{const X=se?{...se}:{};X.latest_data={...se&&se.latest_data?se.latest_data:{}};try{Object.values(Ms||{}).forEach(le=>{const fe=(le.name||"").replace(/\s+/g,"_").toLowerCase()||null;fe&&(X.latest_data[fe]=le.last)})}catch{}return l.jsx(X1,{data:X,open:T,onClose:()=>P(!1),onRerun:Yt,onDownload:me})})(),l.jsx(J1,{node:we,open:Be,onClose:Ye,onSave:Me}),ur?l.jsx(ew,{open:ur,onClose:()=>Ha(!1)}):null]})})},lw=({size:i=36})=>l.jsxs("svg",{width:i,height:i,viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"logoGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),l.jsx("stop",{offset:"100%",stopColor:"#8B5CF6"})]})}),l.jsx("rect",{x:"2",y:"6",width:"12",height:"4",rx:"1",fill:"url(#logoGrad)",opacity:"0.85"}),l.jsx("rect",{x:"2",y:"13",width:"28",height:"5",rx:"1.5",fill:"url(#logoGrad)"}),l.jsx("rect",{x:"2",y:"21",width:"20",height:"4",rx:"1",fill:"url(#logoGrad)",opacity:"0.7"}),l.jsx("circle",{cx:"26",cy:"8",r:"2.5",fill:"#8B5CF6"}),l.jsx("circle",{cx:"24",cy:"23",r:"2",fill:"#3B82F6"})]}),ev=({name:i,size:e=24})=>({home:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),l.jsx("polyline",{points:"9,22 9,12 15,12 15,22"})]}),dashboard:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),l.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),l.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),l.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})]}),builder:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),l.jsx("path",{d:"M3 9h18"}),l.jsx("path",{d:"M9 21V9"})]}),backtest:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 3v18h18"}),l.jsx("path",{d:"M18 9l-5 5-4-4-3 3"}),l.jsx("circle",{cx:"18",cy:"9",r:"2"})]}),analytics:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M18 20V10"}),l.jsx("path",{d:"M12 20V4"}),l.jsx("path",{d:"M6 20v-6"})]}),trades:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),l.jsx("path",{d:"M2 17l10 5 10-5"}),l.jsx("path",{d:"M2 12l10 5 10-5"})]}),calendar:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),l.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),l.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),l.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),journal:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),l.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"}),l.jsx("line",{x1:"8",y1:"7",x2:"16",y2:"7"}),l.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]}),reports:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),l.jsx("polyline",{points:"14,2 14,8 20,8"}),l.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),l.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),l.jsx("line",{x1:"10",y1:"9",x2:"8",y2:"9"})]}),playbook:l.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("polygon",{points:"5,3 19,12 5,21 5,3"})}),notebook:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),l.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),account:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"3"}),l.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),help:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),l.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),add:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),user:l.jsxs("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),l.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})[i]||l.jsx("span",{style:{width:e,height:e}}),rw=[{key:"home",icon:"dashboard",label:"Dashboard",tooltip:"Dashboard"},{key:"builder",icon:"builder",label:"Strategy Builder",tooltip:"Strategy Builder"},{key:"backtest",icon:"backtest",label:"Backtesting",tooltip:"Backtesting"},{key:"analytics",icon:"analytics",label:"Analytics",tooltip:"Analytics"}],ow=[{key:"settings",icon:"account",label:"Settings",tooltip:"Settings"}],Zl=({onNavigate:i=()=>{},hideHome:e=!1,activeRoute:s="home"})=>{const[a,c]=D.useState(null);return l.jsxs("aside",{className:"sidebar",children:[l.jsx("div",{className:"sidebar-logo",onClick:()=>i("home"),children:l.jsx(lw,{size:36})}),l.jsx("nav",{className:"sidebar-nav",children:rw.filter(h=>!(e&&h.key==="home")).map(h=>l.jsxs("button",{className:`sidebar-nav-item ${h.key===s?"active":""}`,onClick:()=>i(h.key),title:h.tooltip,onMouseEnter:()=>c(h.key),onMouseLeave:()=>c(null),children:[l.jsx(ev,{name:h.icon,size:22}),a===h.key&&l.jsx("span",{className:"sidebar-tooltip",children:h.tooltip})]},h.key))}),l.jsx("div",{className:"sidebar-spacer"}),l.jsx("div",{className:"sidebar-bottom",children:ow.map(h=>l.jsxs("button",{className:`sidebar-nav-item ${h.key===s?"active":""}`,onClick:()=>i(h.key==="settings"?"settings":h.key),title:h.tooltip,onMouseEnter:()=>c(h.key),onMouseLeave:()=>c(null),children:[l.jsx(ev,{name:h.icon,size:22}),a===h.key&&l.jsx("span",{className:"sidebar-tooltip",children:h.tooltip})]},h.key))})]})},cw="flowgrid_workflow_v1::saves",uw=({onRun:i,loading:e})=>{const[s,a]=D.useState([]),[c,h]=D.useState({strategyName:"",symbol:"SPY",timeframe:"1Hour",startDate:g(),endDate:p(),startingCapital:1e4,fees:.001,slippage:5e-4,orderType:"market",takeProfitPct:0,stopLossPct:0,commissionPerTrade:0});D.useEffect(()=>{d()},[]);function d(){try{const y=localStorage.getItem(cw);if(!y)return;const b=JSON.parse(y),S=Object.keys(b).map(N=>({name:N,savedAt:b[N].savedAt}));a(S),S.length>0&&!c.strategyName&&h(N=>({...N,strategyName:S[0].name}))}catch(y){console.error("Failed to load strategies",y)}}function g(){const y=new Date;return y.setMonth(y.getMonth()-3),y.toISOString().split("T")[0]}function p(){const y=new Date;return y.setDate(y.getDate()-1),y.toISOString().split("T")[0]}const v=(y,b)=>{h(S=>({...S,[y]:b}))},x=()=>{if(!c.strategyName){alert("Please select a strategy");return}if(!c.symbol){alert("Please enter a ticker symbol");return}const y=new Date(c.startDate),b=new Date(c.endDate),S=new Date;if(S.setHours(0,0,0,0),y>=b){alert(" Start date must be before end date");return}if(b>=S){alert(` End date should be at least yesterday or earlier.

Today's market data may be incomplete or unavailable.`);return}const N=localStorage.getItem("alpaca_key_id"),E=localStorage.getItem("alpaca_secret_key");if(!N||!E){alert(` Alpaca API credentials not configured.

Please go to Dashboard  Settings and enter your Alpaca API Key ID and Secret Key to fetch historical market data.`);return}i(c)};return l.jsxs("div",{className:"backtest-input-panel",children:[l.jsx("div",{className:"input-panel-header",children:l.jsx("h2",{children:"Configuration"})}),l.jsxs("div",{className:"input-panel-body",children:[l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Strategy"}),l.jsxs("select",{value:c.strategyName,onChange:y=>v("strategyName",y.target.value),disabled:e,children:[l.jsx("option",{value:"",children:"Select a strategy..."}),s.map(y=>l.jsx("option",{value:y.name,children:y.name},y.name))]}),s.length===0&&l.jsx("small",{className:"input-hint",children:"No saved strategies found. Create one in the Strategy Builder first."})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Ticker Symbol"}),l.jsx("input",{type:"text",value:c.symbol,onChange:y=>v("symbol",y.target.value.toUpperCase()),placeholder:"e.g., SPY, AAPL, NVDA",disabled:e})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Timeframe"}),l.jsxs("select",{value:c.timeframe,onChange:y=>v("timeframe",y.target.value),disabled:e,children:[l.jsx("option",{value:"1Min",children:"1 Minute"}),l.jsx("option",{value:"5Min",children:"5 Minutes"}),l.jsx("option",{value:"15Min",children:"15 Minutes"}),l.jsx("option",{value:"1Hour",children:"1 Hour"}),l.jsx("option",{value:"4Hour",children:"4 Hours"}),l.jsx("option",{value:"1Day",children:"1 Day"})]})]}),l.jsxs("div",{className:"input-row",children:[l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Start Date"}),l.jsx("input",{type:"date",value:c.startDate,onChange:y=>v("startDate",y.target.value),disabled:e})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"End Date"}),l.jsx("input",{type:"date",value:c.endDate,onChange:y=>v("endDate",y.target.value),disabled:e})]})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Starting Capital ($)"}),l.jsx("input",{type:"number",value:c.startingCapital,onChange:y=>v("startingCapital",parseFloat(y.target.value)),min:"100",step:"100",disabled:e})]}),l.jsxs("details",{className:"advanced-settings",children:[l.jsx("summary",{children:"Advanced Settings"}),l.jsxs("div",{className:"advanced-content",children:[l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Take Profit (%)"}),l.jsx("input",{type:"number",value:c.takeProfitPct,onChange:y=>v("takeProfitPct",parseFloat(y.target.value)||0),min:"0",step:"0.5",disabled:e}),l.jsx("small",{className:"input-hint",children:"Auto-exit when profit reaches this % (0 = disabled)"})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Stop Loss (%)"}),l.jsx("input",{type:"number",value:c.stopLossPct,onChange:y=>v("stopLossPct",parseFloat(y.target.value)||0),min:"0",step:"0.5",disabled:e}),l.jsx("small",{className:"input-hint",children:"Auto-exit when loss reaches this % (0 = disabled)"})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Commission Per Trade ($)"}),l.jsx("input",{type:"number",value:c.commissionPerTrade,onChange:y=>v("commissionPerTrade",parseFloat(y.target.value)||0),min:"0",step:"0.01",disabled:e}),l.jsx("small",{className:"input-hint",children:"Fixed commission per trade (default: $0)"})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Fees (%)"}),l.jsx("input",{type:"number",value:c.fees*100,onChange:y=>v("fees",parseFloat(y.target.value)/100),min:"0",step:"0.01",disabled:e}),l.jsx("small",{className:"input-hint",children:"Trading fees per side (default: 0.1%)"})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Slippage (%)"}),l.jsx("input",{type:"number",value:c.slippage*100,onChange:y=>v("slippage",parseFloat(y.target.value)/100),min:"0",step:"0.01",disabled:e}),l.jsx("small",{className:"input-hint",children:"Estimated slippage per trade (default: 0.05%)"})]}),l.jsxs("div",{className:"input-group",children:[l.jsx("label",{children:"Order Type"}),l.jsxs("select",{value:c.orderType,onChange:y=>v("orderType",y.target.value),disabled:e,children:[l.jsx("option",{value:"market",children:"Market Order"}),l.jsx("option",{value:"limit",children:"Limit Order"})]})]})]})]}),l.jsx("button",{className:"run-backtest-btn",onClick:x,disabled:e||!c.strategyName||!c.symbol,children:e?"Running...":"Run Backtest"})]})]})},hw=({results:i})=>{const{metrics:e,config:s,trades:a,equityCurve:c,drawdownData:h}=i,d=L=>`$${L?.toFixed(2)||"0.00"}`,g=L=>`${L?.toFixed(2)||"0.00"}%`,p=L=>L?.toFixed(2)||"0.00",v=L=>{if(!L)return"0m";const C=L/(1e3*60*60);return C<1?`${(L/(1e3*60)).toFixed(0)}m`:C<24?`${C.toFixed(1)}h`:`${(C/24).toFixed(1)}d`},x=a?.filter(L=>L.netProfit>0)||[],y=a?.filter(L=>L.netProfit<=0)||[],b=x.length>0?x.reduce((L,C)=>L+C.netProfit,0)/x.length:0,S=y.length>0?Math.abs(y.reduce((L,C)=>L+C.netProfit,0)/y.length):0,N=e?.expectancy||e?.winRate/100*b-(1-e?.winRate/100)*S,E=S>0?b/S:b>0?1/0:0,R=x.reduce((L,C)=>L+C.netProfit,0),_=Math.abs(y.reduce((L,C)=>L+C.netProfit,0)),F=_>0?R/_:R>0?1/0:0,z=(()=>{let L=0;return e?.winRate>50&&(L+=20),e?.winRate>60&&(L+=10),F>1.5&&(L+=20),F>2&&(L+=10),e?.sharpeRatio>1&&(L+=15),e?.sharpeRatio>2&&(L+=10),E>1&&(L+=15),E>2&&(L+=10),e?.netProfit>0&&(L+=10),L>=90?{grade:"A+",color:"#3b82f6"}:L>=80?{grade:"A",color:"#3b82f6"}:L>=70?{grade:"B+",color:"#60a5fa"}:L>=60?{grade:"B",color:"#84cc16"}:L>=50?{grade:"C+",color:"#f59e0b"}:L>=40?{grade:"C",color:"#f97316"}:L>=30?{grade:"D",color:"#ef4444"}:{grade:"F",color:"#dc2626"}})();return l.jsxs("div",{className:"metrics-summary-enhanced",children:[l.jsxs("div",{className:"summary-header",children:[l.jsxs("div",{className:"header-left",children:[l.jsx("h3",{children:"Strategy Performance"}),l.jsxs("div",{className:"strategy-info",children:[l.jsx("span",{className:"symbol-badge",children:s?.symbol||"N/A"}),l.jsx("span",{className:"timeframe-badge",children:s?.timeframe||"N/A"}),l.jsxs("span",{className:"period-badge",children:[s?.startDate,"  ",s?.endDate]})]})]}),l.jsx("div",{className:"header-right",children:l.jsxs("div",{className:"performance-grade",style:{borderColor:z.color},children:[l.jsx("span",{className:"grade-label",children:"Grade"}),l.jsx("span",{className:"grade-value",style:{color:z.color},children:z.grade})]})})]}),l.jsx("div",{className:"kpi-section",children:l.jsxs("div",{className:"kpi-row",children:[l.jsxs("div",{className:`kpi-card primary ${e?.netProfit>=0?"profit":"loss"}`,children:[l.jsx("div",{className:"kpi-icon",children:l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})})}),l.jsxs("div",{className:"kpi-content",children:[l.jsx("span",{className:"kpi-label",children:"Net Profit/Loss"}),l.jsx("span",{className:"kpi-value",children:d(e?.netProfit)}),l.jsxs("span",{className:`kpi-change ${e?.netProfitPercent>=0?"up":"down"}`,children:[e?.netProfitPercent>=0?"":""," ",g(Math.abs(e?.netProfitPercent||0))]})]})]}),l.jsxs("div",{className:"kpi-card",children:[l.jsx("div",{className:"kpi-icon blue",children:l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})}),l.jsxs("div",{className:"kpi-content",children:[l.jsx("span",{className:"kpi-label",children:"Total Trades"}),l.jsx("span",{className:"kpi-value",children:e?.totalTrades||0}),l.jsxs("span",{className:"kpi-sub",children:[p(e?.tradesPerDay||0)," / day"]})]})]}),l.jsxs("div",{className:"kpi-card",children:[l.jsx("div",{className:"kpi-icon",style:{color:e?.winRate>=50?"#3b82f6":"#f59e0b"},children:l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),l.jsx("polyline",{points:"22,4 12,14.01 9,11.01"})]})}),l.jsxs("div",{className:"kpi-content",children:[l.jsx("span",{className:"kpi-label",children:"Win Rate"}),l.jsx("span",{className:"kpi-value",style:{color:e?.winRate>=50?"#3b82f6":"#f59e0b"},children:g(e?.winRate)}),l.jsxs("span",{className:"kpi-sub",children:[x.length,"W / ",y.length,"L"]})]})]}),l.jsxs("div",{className:"kpi-card",children:[l.jsx("div",{className:"kpi-icon",style:{color:F>=1?"#3b82f6":"#ef4444"},children:l.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M3 3v18h18"}),l.jsx("path",{d:"M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"})]})}),l.jsxs("div",{className:"kpi-content",children:[l.jsx("span",{className:"kpi-label",children:"Profit Factor"}),l.jsx("span",{className:"kpi-value",style:{color:F>=1?"#3b82f6":"#ef4444"},children:F===1/0?"":p(F)}),l.jsxs("span",{className:"kpi-sub",children:["Gross: ",d(R)]})]})]})]})}),l.jsxs("div",{className:"metrics-grid-section",children:[l.jsx("h4",{children:"Performance Metrics"}),l.jsxs("div",{className:"metrics-cards-grid",children:[l.jsxs("div",{className:"metric-card-new",children:[l.jsxs("div",{className:"metric-header",children:[l.jsx("span",{className:"metric-title",children:"Risk-Reward Ratio"}),l.jsx("span",{className:`metric-badge ${E>=1?"good":"bad"}`,children:E>=2?"Excellent":E>=1?"Good":"Poor"})]}),l.jsx("div",{className:"metric-main",style:{color:E>=1?"#3b82f6":"#ef4444"},children:E===1/0?"":`${p(E)}:1`}),l.jsxs("div",{className:"metric-details",children:[l.jsxs("span",{children:["Avg Win: ",l.jsx("b",{style:{color:"#3b82f6"},children:d(b)})]}),l.jsxs("span",{children:["Avg Loss: ",l.jsx("b",{style:{color:"#ef4444"},children:d(S)})]})]})]}),l.jsxs("div",{className:"metric-card-new",children:[l.jsxs("div",{className:"metric-header",children:[l.jsx("span",{className:"metric-title",children:"Sharpe Ratio"}),l.jsx("span",{className:`metric-badge ${e?.sharpeRatio>=1?"good":"neutral"}`,children:e?.sharpeRatio>=2?"Excellent":e?.sharpeRatio>=1?"Good":"Low"})]}),l.jsx("div",{className:"metric-main",style:{color:e?.sharpeRatio>=1?"#3b82f6":"#f59e0b"},children:p(e?.sharpeRatio)}),l.jsx("div",{className:"metric-details",children:l.jsx("span",{children:"Risk-adjusted returns"})})]}),l.jsxs("div",{className:"metric-card-new",children:[l.jsxs("div",{className:"metric-header",children:[l.jsx("span",{className:"metric-title",children:"Expectancy"}),l.jsx("span",{className:`metric-badge ${N>=0?"good":"bad"}`,children:N>=0?"Positive":"Negative"})]}),l.jsx("div",{className:"metric-main",style:{color:N>=0?"#3b82f6":"#ef4444"},children:d(N)}),l.jsx("div",{className:"metric-details",children:l.jsx("span",{children:"Per trade expected value"})})]}),l.jsxs("div",{className:"metric-card-new",children:[l.jsxs("div",{className:"metric-header",children:[l.jsx("span",{className:"metric-title",children:"Max Drawdown"}),l.jsx("span",{className:`metric-badge ${(h?.maxDrawdown||0)<10?"good":"bad"}`,children:(h?.maxDrawdown||0)<10?"Low Risk":"High Risk"})]}),l.jsx("div",{className:"metric-main",style:{color:"#ef4444"},children:d(h?.maxDrawdown||0)}),l.jsx("div",{className:"metric-details",children:l.jsx("span",{children:"Peak to trough decline"})})]})]})]}),l.jsxs("div",{className:"trade-stats-section",children:[l.jsx("h4",{children:"Trade Statistics"}),l.jsxs("div",{className:"stats-container",children:[l.jsxs("div",{className:"stats-column winners",children:[l.jsxs("div",{className:"stats-header",children:[l.jsx("span",{className:"stats-icon win",children:""}),l.jsx("span",{children:"Winning Trades"})]}),l.jsx("div",{className:"stats-number",children:x.length}),l.jsxs("div",{className:"stats-breakdown",children:[l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Total Profit"}),l.jsx("span",{className:"win",children:d(R)})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Average Win"}),l.jsx("span",{className:"win",children:d(b)})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Best Trade"}),l.jsx("span",{className:"win",children:d(e?.bestTrade)})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Avg Win %"}),l.jsx("span",{className:"win",children:x.length>0?g(x.reduce((L,C)=>L+C.profitPercent,0)/x.length):"0%"})]})]})]}),l.jsx("div",{className:"stats-divider",children:l.jsx("div",{className:"divider-circle",children:"VS"})}),l.jsxs("div",{className:"stats-column losers",children:[l.jsxs("div",{className:"stats-header",children:[l.jsx("span",{className:"stats-icon loss",children:""}),l.jsx("span",{children:"Losing Trades"})]}),l.jsx("div",{className:"stats-number",children:y.length}),l.jsxs("div",{className:"stats-breakdown",children:[l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Total Loss"}),l.jsx("span",{className:"loss",children:d(_)})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Average Loss"}),l.jsx("span",{className:"loss",children:d(S)})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Worst Trade"}),l.jsx("span",{className:"loss",children:d(Math.abs(e?.worstTrade||0))})]}),l.jsxs("div",{className:"stat-row",children:[l.jsx("span",{children:"Avg Loss %"}),l.jsx("span",{className:"loss",children:y.length>0?g(Math.abs(y.reduce((L,C)=>L+C.profitPercent,0)/y.length)):"0%"})]})]})]})]})]}),l.jsxs("div",{className:"quick-stats-bar",children:[l.jsxs("div",{className:"quick-stat",children:[l.jsx("span",{className:"quick-label",children:"Starting Capital"}),l.jsx("span",{className:"quick-value",children:d(s?.startingCapital)})]}),l.jsxs("div",{className:"quick-stat",children:[l.jsx("span",{className:"quick-label",children:"Current Capital"}),l.jsx("span",{className:"quick-value",style:{color:(e?.currentCapital||s?.startingCapital)>=s?.startingCapital?"#3b82f6":"#ef4444"},children:d(e?.currentCapital||s?.startingCapital)})]}),l.jsxs("div",{className:"quick-stat",children:[l.jsx("span",{className:"quick-label",children:"Open P&L"}),l.jsx("span",{className:"quick-value",style:{color:(e?.openPnL||0)>=0?"#3b82f6":"#ef4444"},children:d(e?.openPnL||0)})]}),l.jsxs("div",{className:"quick-stat",children:[l.jsx("span",{className:"quick-label",children:"Avg Hold Time"}),l.jsx("span",{className:"quick-value",children:v(e?.avgHoldingTime)})]}),l.jsxs("div",{className:"quick-stat",children:[l.jsx("span",{className:"quick-label",children:"Fees Paid"}),l.jsx("span",{className:"quick-value",style:{color:"#f59e0b"},children:d((s?.fees||0)*(e?.totalTrades||0)*2)})]})]})]})},dw=({trades:i})=>{const[e,s]=D.useState("entryTime"),[a,c]=D.useState("asc"),h=b=>{e===b?c(a==="asc"?"desc":"asc"):(s(b),c("asc"))},d=[...i].sort((b,S)=>{let N=b[e],E=S[e];return(e==="entryTime"||e==="exitTime")&&(N=new Date(N).getTime(),E=new Date(E).getTime()),a==="asc"?N>E?1:-1:N<E?1:-1}),g=b=>new Date(b).toLocaleString(),p=b=>`$${b.toFixed(2)}`,v=b=>`${b.toFixed(2)}%`,x=b=>{const S=b/36e5;return S<1?`${(b/(1e3*60)).toFixed(0)}m`:S<24?`${S.toFixed(1)}h`:`${(S/24).toFixed(1)}d`},y=({field:b})=>e!==b?l.jsx("span",{className:"sort-icon",children:""}):l.jsx("span",{className:"sort-icon active",children:a==="asc"?"":""});return l.jsxs("div",{className:"trades-table-container",children:[l.jsx("div",{className:"table-header",children:l.jsxs("h3",{children:["Trade Log (",i.length," trades)"]})}),l.jsx("div",{className:"table-wrapper",children:l.jsxs("table",{className:"trades-table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsxs("th",{onClick:()=>h("entryTime"),children:["Entry Time ",l.jsx(y,{field:"entryTime"})]}),l.jsxs("th",{onClick:()=>h("exitTime"),children:["Exit Time ",l.jsx(y,{field:"exitTime"})]}),l.jsxs("th",{onClick:()=>h("direction"),children:["Direction ",l.jsx(y,{field:"direction"})]}),l.jsxs("th",{onClick:()=>h("shares"),children:["Shares ",l.jsx(y,{field:"shares"})]}),l.jsxs("th",{onClick:()=>h("entryPrice"),children:["Entry Price ",l.jsx(y,{field:"entryPrice"})]}),l.jsxs("th",{onClick:()=>h("exitPrice"),children:["Exit Price ",l.jsx(y,{field:"exitPrice"})]}),l.jsxs("th",{onClick:()=>h("netProfit"),children:["Net P/L ",l.jsx(y,{field:"netProfit"})]}),l.jsxs("th",{onClick:()=>h("profitPercent"),children:["P/L % ",l.jsx(y,{field:"profitPercent"})]}),l.jsx("th",{children:"Exit Reason"}),l.jsxs("th",{onClick:()=>h("holdingDuration"),children:["Duration ",l.jsx(y,{field:"holdingDuration"})]}),l.jsxs("th",{onClick:()=>h("mae"),children:["MAE ",l.jsx(y,{field:"mae"})]}),l.jsxs("th",{onClick:()=>h("mfe"),children:["MFE ",l.jsx(y,{field:"mfe"})]})]})}),l.jsx("tbody",{children:d.map((b,S)=>l.jsxs("tr",{className:b.netProfit>0?"win":"loss",children:[l.jsx("td",{children:g(b.entryTime)}),l.jsx("td",{children:g(b.exitTime)}),l.jsx("td",{children:l.jsx("span",{className:`direction-badge ${b.direction}`,children:b.direction==="long"?"LONG":"SHORT"})}),l.jsx("td",{children:b.shares||100}),l.jsx("td",{children:p(b.entryPrice)}),l.jsx("td",{children:p(b.exitPrice)}),l.jsx("td",{className:b.netProfit>0?"profit":"loss",children:p(b.netProfit)}),l.jsx("td",{className:b.profitPercent>0?"profit":"loss",children:v(b.profitPercent)}),l.jsx("td",{children:l.jsx("span",{className:`exit-reason ${b.exitReason||"signal"}`,children:b.exitReason==="take-profit"?"TP":b.exitReason==="stop-loss"?"SL":b.exitReason==="auto-exit"?"Auto":"Signal"})}),l.jsx("td",{children:x(b.holdingDuration)}),l.jsx("td",{children:p(b.mae)}),l.jsx("td",{children:p(b.mfe)})]},S))})]})})]})},fw=({data:i,trades:e})=>{const s=D.useRef(null);D.useRef(null);const[a,c]=D.useState(null),[h,d]=D.useState(null),[g,p]=D.useState(null),v=D.useRef({xScale:null,yScale:null,margin:null,data:null});D.useEffect(()=>{!i||i.length===0||(x(),y())},[i,a]);const x=()=>{if(!i||i.length<2)return;const R=i[0].equity,_=i[i.length-1].equity,F=[];let H=R,z=0,L=0;for(let se=1;se<i.length;se++){const M=(i[se].equity-i[se-1].equity)/i[se-1].equity*100;F.push(M),i[se].equity>H&&(H=i[se].equity),L=(H-i[se].equity)/H*100,L>z&&(z=L)}const C=F.reduce((se,M)=>se+M,0)/F.length,j=F.reduce((se,M)=>se+Math.pow(M-C,2),0)/F.length,K=Math.sqrt(j),I=K>0?C/K*Math.sqrt(252):0,U=(_-R)/R*100,Q=i.length/252,q=Q>0?(Math.pow(1+U/100,1/Q)-1)*100:U,ge=K*Math.sqrt(252),O=F.filter(se=>se<0),A=O.length>0?O.reduce((se,M)=>se+Math.pow(M,2),0)/O.length:0,W=Math.sqrt(A),ce=W>0?C/W*Math.sqrt(252):0;d({totalReturn:U,cagr:q,maxDrawdown:z,sharpe:I,sortino:ce,volatility:ge,peak:H,startEquity:R,endEquity:_})},y=()=>{const R=s.current;if(!R)return;const _=R.getContext("2d"),F=window.devicePixelRatio||1,H=R.getBoundingClientRect();R.width=H.width*F,R.height=H.height*F,_.scale(F,F);const z=H.width,L=H.height;_.clearRect(0,0,z,L);const C={top:30,right:80,bottom:50,left:70},j=z-C.left-C.right,K=L-C.top-C.bottom,I=Math.min(...i.map(ue=>ue.equity))*.995,U=Math.max(...i.map(ue=>ue.equity))*1.005,Y=i[0].time,$=i[i.length-1].time,Q=i[0].equity,q=i[i.length-1].equity,ge=q>=Q,O=ge?"#3b82f6":"#ef4444",A=ge?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)",W=ge?"rgba(59, 130, 246, 0.02)":"rgba(239, 68, 68, 0.02)",ce=ue=>C.left+(ue-Y)/($-Y)*j,se=ue=>L-C.bottom-(ue-I)/(U-I)*K;_.strokeStyle="rgba(42, 46, 57, 0.5)",_.lineWidth=1,_.setLineDash([5,5]);for(let ue=0;ue<=5;ue++){const ee=C.top+K/5*ue;_.beginPath(),_.moveTo(C.left,ee),_.lineTo(z-C.right,ee),_.stroke()}for(let ue=0;ue<=6;ue++){const ee=C.left+j/6*ue;_.beginPath(),_.moveTo(ee,C.top),_.lineTo(ee,L-C.bottom),_.stroke()}_.setLineDash([]),_.strokeStyle="rgba(59, 130, 246, 0.4)",_.lineWidth=1,_.setLineDash([8,4]),_.beginPath();const M=se(Q);_.moveTo(C.left,M),_.lineTo(z-C.right,M),_.stroke(),_.setLineDash([]);const T=_.createLinearGradient(0,C.top,0,L-C.bottom);if(T.addColorStop(0,A),T.addColorStop(1,W),_.fillStyle=T,_.beginPath(),_.moveTo(ce(i[0].time),L-C.bottom),i.forEach(ue=>{_.lineTo(ce(ue.time),se(ue.equity))}),_.lineTo(ce(i[i.length-1].time),L-C.bottom),_.closePath(),_.fill(),v.current={xScale:ce,yScale:se,margin:C,data:i,minTime:Y,maxTime:$,minEquity:I,maxEquity:U,chartWidth:j,chartHeight:K},_.strokeStyle=O,_.lineWidth=2,_.lineJoin="round",_.lineCap="round",_.beginPath(),i.forEach((ue,ee)=>{const Z=ce(ue.time),ye=se(ue.equity);ee===0?_.moveTo(Z,ye):_.lineTo(Z,ye)}),_.stroke(),a!==null&&a>=0&&a<i.length){const ue=i[a],ee=ce(ue.time),Z=se(ue.equity);_.strokeStyle="rgba(156, 163, 175, 0.5)",_.lineWidth=1,_.setLineDash([4,4]),_.beginPath(),_.moveTo(ee,C.top),_.lineTo(ee,L-C.bottom),_.stroke(),_.beginPath(),_.moveTo(C.left,Z),_.lineTo(z-C.right,Z),_.stroke(),_.setLineDash([]),_.fillStyle=O,_.beginPath(),_.arc(ee,Z,6,0,Math.PI*2),_.fill(),_.fillStyle="#0d1117",_.beginPath(),_.arc(ee,Z,3,0,Math.PI*2),_.fill()}const P=i.reduce((ue,ee)=>ee.equity>ue.equity?ee:ue,i[0]),B=ce(P.time),te=se(P.equity);_.fillStyle="#3b82f6",_.beginPath(),_.arc(B,te,5,0,Math.PI*2),_.fill(),_.fillStyle="#3b82f6",_.font="11px sans-serif",_.textAlign="center",_.fillText("Peak",B,te-10);const de=ce(i[i.length-1].time),oe=se(q);_.fillStyle=O,_.beginPath(),_.arc(de,oe,6,0,Math.PI*2),_.fill(),_.fillStyle="#0d1117",_.beginPath(),_.arc(de,oe,3,0,Math.PI*2),_.fill(),_.fillStyle="#9aa6c6",_.font="11px sans-serif",_.textAlign="right";for(let ue=0;ue<=5;ue++){const ee=I+(U-I)/5*ue,Z=L-C.bottom-K/5*ue;_.fillText(`$${ee.toLocaleString(void 0,{maximumFractionDigits:0})}`,C.left-10,Z+4)}_.textAlign="center";for(let ue=0;ue<=6;ue++){const ee=Y+($-Y)/6*ue,Z=C.left+j/6*ue,ye=new Date(ee);_.fillText(ye.toLocaleDateString("en-US",{month:"short",day:"numeric"}),Z,L-C.bottom+20)}_.textAlign="left",_.fillStyle=O,_.font="bold 12px sans-serif",_.fillText(`$${q.toLocaleString(void 0,{maximumFractionDigits:0})}`,z-C.right+8,oe+4)},b=R=>`${R>=0?"+":""}${R?.toFixed(2)}%`,S=R=>`$${R?.toLocaleString(void 0,{maximumFractionDigits:0})}`,N=D.useCallback(R=>{const _=s.current;if(!_||!v.current.data)return;const F=_.getBoundingClientRect(),H=R.clientX-F.left;R.clientY-F.top;const{margin:z,data:L,minTime:C,maxTime:j,chartWidth:K}=v.current;if(H>=z.left&&H<=F.width-z.right){const I=C+(H-z.left)/K*(j-C);let U=0,Y=1/0;L.forEach(($,Q)=>{const q=Math.abs($.time-I);q<Y&&(Y=q,U=Q)}),c(U),p({x:R.clientX-F.left,y:R.clientY-F.top})}else c(null),p(null)},[]),E=D.useCallback(()=>{c(null),p(null)},[]);return l.jsxs("div",{className:"equity-curve-enhanced",children:[h&&l.jsxs("div",{className:"equity-stats-bar",children:[l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"Total Return"}),l.jsx("span",{className:`eq-value ${h.totalReturn>=0?"positive":"negative"}`,children:b(h.totalReturn)})]}),l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"CAGR"}),l.jsx("span",{className:`eq-value ${h.cagr>=0?"positive":"negative"}`,children:b(h.cagr)})]}),l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"Max Drawdown"}),l.jsxs("span",{className:"eq-value negative",children:["-",h.maxDrawdown?.toFixed(2),"%"]})]}),l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"Sharpe"}),l.jsx("span",{className:`eq-value ${h.sharpe>=1?"positive":"neutral"}`,children:h.sharpe?.toFixed(2)})]}),l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"Sortino"}),l.jsx("span",{className:`eq-value ${h.sortino>=1?"positive":"neutral"}`,children:h.sortino?.toFixed(2)})]}),l.jsxs("div",{className:"eq-stat",children:[l.jsx("span",{className:"eq-label",children:"Volatility"}),l.jsxs("span",{className:"eq-value neutral",children:[h.volatility?.toFixed(2),"%"]})]})]}),l.jsxs("div",{className:"equity-chart-container",onMouseMove:N,onMouseLeave:E,children:[l.jsx("canvas",{ref:s}),a!==null&&i&&i[a]&&g&&l.jsxs("div",{className:"chart-tooltip",style:{left:g.x>200?g.x-150:g.x+10,top:g.y>100?g.y-80:g.y+10},children:[l.jsx("div",{className:"tooltip-date",children:new Date(i[a].time).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),l.jsxs("div",{className:`tooltip-value ${i[a].equity>=h?.startEquity?"positive":"negative"}`,children:["$",i[a].equity.toLocaleString(void 0,{maximumFractionDigits:2})]}),l.jsxs("div",{className:"tooltip-change",children:[((i[a].equity-h?.startEquity)/h?.startEquity*100).toFixed(2),"% from start"]})]})]}),h&&l.jsxs("div",{className:"equity-summary-row",children:[l.jsxs("div",{className:"equity-start",children:[l.jsx("span",{className:"label",children:"Start"}),l.jsx("span",{className:"value",children:S(h.startEquity)})]}),l.jsx("div",{className:"equity-arrow",children:l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})}),l.jsxs("div",{className:"equity-end",children:[l.jsx("span",{className:"label",children:"End"}),l.jsx("span",{className:`value ${h.endEquity>=h.startEquity?"positive":"negative"}`,children:S(h.endEquity)})]}),l.jsxs("div",{className:"equity-peak",children:[l.jsx("span",{className:"label",children:"Peak"}),l.jsx("span",{className:"value positive",children:S(h.peak)})]})]})]})},mw=({historicalData:i,signals:e,trades:s})=>{const a=D.useRef(null),c=D.useRef(null),[h,d]=D.useState(null),[g,p]=D.useState(!0),[v,x]=D.useState(!0),[y,b]=D.useState(null),[S,N]=D.useState(null),E=D.useRef({});D.useEffect(()=>{!i||i.length===0||(R(),_(),H())},[i,e,g,v,s,y]);const R=()=>{if(!i||i.length<2)return;const C=i.map(B=>({open:parseFloat(B.o||B.open||0),high:parseFloat(B.h||B.high||0),low:parseFloat(B.l||B.low||0),close:parseFloat(B.c||B.close||0),volume:parseFloat(B.v||B.volume||0)})),j=C[0].close,K=C[C.length-1].close,I=Math.max(...C.map(B=>B.high)),U=Math.min(...C.map(B=>B.low)),Y=K-j,$=Y/j*100,Q=[];for(let B=1;B<C.length;B++)Q.push((C[B].close-C[B-1].close)/C[B-1].close*100);const q=Q.reduce((B,te)=>B+te,0)/Q.length,ge=Q.reduce((B,te)=>B+Math.pow(te-q,2),0)/Q.length,O=Math.sqrt(ge);let A=0;for(let B=1;B<C.length;B++){const te=Math.max(C[B].high-C[B].low,Math.abs(C[B].high-C[B-1].close),Math.abs(C[B].low-C[B-1].close));A+=te}A=A/(C.length-1);const W=C.reduce((B,te)=>B+te.volume,0)/C.length,ce=C.reduce((B,te)=>B+te.volume,0),se=C.filter(B=>B.close>=B.open).length,M=C.length-se,T=e?.filter(B=>(B.signal||B.action||"").toUpperCase()==="BUY").length||0,P=e?.filter(B=>(B.signal||B.action||"").toUpperCase()==="SELL").length||0;d({startPrice:j,endPrice:K,highPrice:I,lowPrice:U,priceChange:Y,priceChangePct:$,volatility:O,atr:A,avgVolume:W,totalVolume:ce,bullishCandles:se,bearishCandles:M,totalCandles:C.length,buySignals:T,sellSignals:P})},_=()=>{const C=a.current;if(!C)return;const j=C.getContext("2d"),K=window.devicePixelRatio||1,I=C.getBoundingClientRect();C.width=I.width*K,C.height=I.height*K,j.scale(K,K);const U=I.width,Y=I.height;j.clearRect(0,0,U,Y);const $=g?60:0,Q={top:20,right:80,bottom:40+$,left:70},q=U-Q.left-Q.right,ge=Y-Q.top-Q.bottom;let O=i,A=1;i.length>400&&(A=Math.ceil(i.length/400),O=i.filter((ee,Z)=>Z%A===0));const W=O.map(ee=>({time:new Date(ee.t||ee.time||ee.timestamp).getTime(),open:parseFloat(ee.o||ee.open||0),high:parseFloat(ee.h||ee.high||0),low:parseFloat(ee.l||ee.low||0),close:parseFloat(ee.c||ee.close||0),volume:parseFloat(ee.v||ee.volume||0)})),ce=Math.min(...W.map(ee=>ee.low))*.999,se=Math.max(...W.map(ee=>ee.high))*1.001,M=Math.max(...W.map(ee=>ee.volume)),T=ee=>Q.left+ee/(O.length-1)*q,P=ee=>Q.top+(se-ee)/(se-ce)*ge,B=ee=>Y-Q.bottom+$-ee/M*$;j.strokeStyle="rgba(42, 46, 57, 0.5)",j.lineWidth=1,j.setLineDash([5,5]);for(let ee=0;ee<=5;ee++){const Z=Q.top+ge/5*ee;j.beginPath(),j.moveTo(Q.left,Z),j.lineTo(U-Q.right,Z),j.stroke()}if(j.setLineDash([]),g&&$>0){const ee=Math.max(1,q/O.length*.7);W.forEach((Z,ye)=>{const we=T(ye),Re=B(Z.volume),Be=Y-Q.bottom+$-Re,Le=Z.close>=Z.open;j.fillStyle=Le?"rgba(59, 130, 246, 0.3)":"rgba(239, 68, 68, 0.3)",j.fillRect(we-ee/2,Re,ee,Be)})}const te=Math.max(1,Math.min(8,q/O.length*.8));if(W.forEach((ee,Z)=>{const ye=T(Z),we=P(ee.high),Re=P(ee.low),Be=P(ee.open),Le=P(ee.close),ut=ee.close>=ee.open?"#3b82f6":"#ef4444";j.strokeStyle=ut,j.lineWidth=1,j.beginPath(),j.moveTo(ye,we),j.lineTo(ye,Re),j.stroke(),j.fillStyle=ut;const Yt=Math.abs(Le-Be);j.fillRect(ye-te/2,Math.min(Be,Le),te,Math.max(1,Yt))}),v&&e&&e.length>0&&e.forEach(ee=>{const Z=(ee.signal||ee.action||"").toUpperCase();if(Z!=="BUY"&&Z!=="SELL")return;const ye=new Date(ee.time||ee.timestamp||ee.t).getTime(),we=parseFloat(ee.price||ee.close||0);let Re=0,Be=1/0;W.forEach((Yt,Ot)=>{const jt=Math.abs(Yt.time-ye);jt<Be&&(Be=jt,Re=Ot)});const Le=T(Re),Ie=P(we),ut=Z==="BUY";j.fillStyle=ut?"#3b82f6":"#ef4444",j.beginPath(),ut?(j.moveTo(Le,Ie-12),j.lineTo(Le-6,Ie),j.lineTo(Le+6,Ie)):(j.moveTo(Le,Ie+12),j.lineTo(Le-6,Ie),j.lineTo(Le+6,Ie)),j.closePath(),j.fill()}),y!==null&&y>=0&&y<W.length){W[y];const ee=T(y);j.strokeStyle="rgba(156, 163, 175, 0.5)",j.lineWidth=1,j.setLineDash([4,4]),j.beginPath(),j.moveTo(ee,Q.top),j.lineTo(ee,Y-Q.bottom),j.stroke(),j.setLineDash([])}E.current={xScale:T,yScale:P,margin:Q,prices:W,chartWidth:q},j.fillStyle="#9aa6c6",j.font="11px sans-serif",j.textAlign="right";for(let ee=0;ee<=5;ee++){const Z=se-(se-ce)/5*ee,ye=Q.top+ge/5*ee;j.fillText(`$${Z.toFixed(2)}`,Q.left-10,ye+4)}j.textAlign="center";const de=Math.min(6,O.length);for(let ee=0;ee<de;ee++){const Z=Math.floor((O.length-1)*(ee/(de-1))),ye=T(Z),we=new Date(W[Z].time);j.fillText(we.toLocaleDateString("en-US",{month:"short",day:"numeric"}),ye,Y-(g?$+20:20))}const oe=W[W.length-1],ue=P(oe.close);j.textAlign="left",j.fillStyle=oe.close>=W[0].close?"#3b82f6":"#ef4444",j.font="bold 12px sans-serif",j.fillText(`$${oe.close.toFixed(2)}`,U-Q.right+8,ue+4)},F=C=>C>=1e6?`${(C/1e6).toFixed(1)}M`:C>=1e3?`${(C/1e3).toFixed(1)}K`:C.toFixed(0),H=()=>{const C=c.current;if(!C||!s||s.length===0)return;const j=C.getContext("2d"),K=window.devicePixelRatio||1,I=C.getBoundingClientRect();C.width=I.width*K,C.height=I.height*K,j.scale(K,K);const U=I.width,Y=I.height,$={top:20,right:60,bottom:30,left:50},Q=U-$.left-$.right,q=Y-$.top-$.bottom;j.clearRect(0,0,U,Y);let ge=0;const O=s.map((B,te)=>(ge+=B.netProfit||0,{x:te,equity:ge,profit:B.netProfit||0,isWin:(B.netProfit||0)>0})),A=Math.min(0,...O.map(B=>B.equity)),ce=Math.max(...O.map(B=>B.equity))-A||1,se=B=>$.left+B/(s.length-1||1)*Q,M=B=>$.top+q-(B-A)/ce*q;j.strokeStyle="rgba(42, 46, 57, 0.3)",j.lineWidth=1;for(let B=0;B<=4;B++){const te=$.top+q/4*B;j.beginPath(),j.moveTo($.left,te),j.lineTo(U-$.right,te),j.stroke()}const T=M(0);T>=$.top&&T<=Y-$.bottom&&(j.strokeStyle="rgba(156, 163, 175, 0.4)",j.setLineDash([4,4]),j.beginPath(),j.moveTo($.left,T),j.lineTo(U-$.right,T),j.stroke(),j.setLineDash([])),j.strokeStyle="rgba(156, 163, 175, 0.3)",j.lineWidth=1,j.beginPath(),O.forEach((B,te)=>{const de=se(B.x),oe=M(B.equity);te===0?j.moveTo(de,oe):j.lineTo(de,oe)}),j.stroke(),O.forEach((B,te)=>{const de=se(B.x),oe=M(B.equity),ue=5;j.beginPath(),j.arc(de,oe,ue,0,Math.PI*2),j.fillStyle=B.isWin?"#3b82f6":"#ef5350",j.fill()}),j.fillStyle="#787b86",j.font="10px -apple-system, BlinkMacSystemFont, sans-serif",j.textAlign="right";for(let B=0;B<=4;B++){const te=A+ce/4*(4-B),de=$.top+q/4*B;j.fillText(`$${te.toFixed(0)}`,$.left-8,de+3)}j.textAlign="center";const P=Math.max(1,Math.floor(s.length/6));for(let B=0;B<s.length;B+=P){const te=se(B);j.fillText(`#${B+1}`,te,Y-10)}if(O.length>0){const B=O[O.length-1],te=M(B.equity);j.textAlign="left",j.fillStyle=B.equity>=0?"#3b82f6":"#ef5350",j.font="bold 11px -apple-system, BlinkMacSystemFont, sans-serif",j.fillText(`$${B.equity.toFixed(2)}`,U-$.right+8,te+3)}},z=D.useCallback(C=>{const j=a.current;if(!j||!E.current.prices)return;const K=j.getBoundingClientRect(),I=C.clientX-K.left,{margin:U,prices:Y,chartWidth:$}=E.current;if(I>=U.left&&I<=K.width-U.right){const Q=Math.round((I-U.left)/$*(Y.length-1));b(Math.max(0,Math.min(Y.length-1,Q))),N({x:C.clientX-K.left,y:C.clientY-K.top})}else b(null),N(null)},[]),L=D.useCallback(()=>{b(null),N(null)},[]);return l.jsxs("div",{className:"price-chart-enhanced",children:[h&&l.jsxs("div",{className:"price-stats-bar",children:[l.jsxs("div",{className:"price-stat main",children:[l.jsx("span",{className:"price-label",children:"Price Change"}),l.jsxs("span",{className:`price-value ${h.priceChangePct>=0?"positive":"negative"}`,children:[h.priceChangePct>=0?"+":"",h.priceChangePct?.toFixed(2),"%"]}),l.jsxs("span",{className:`price-sub ${h.priceChange>=0?"positive":"negative"}`,children:[h.priceChange>=0?"+":"","$",h.priceChange?.toFixed(2)]})]}),l.jsxs("div",{className:"price-stat",children:[l.jsx("span",{className:"price-label",children:"High"}),l.jsxs("span",{className:"price-value positive",children:["$",h.highPrice?.toFixed(2)]})]}),l.jsxs("div",{className:"price-stat",children:[l.jsx("span",{className:"price-label",children:"Low"}),l.jsxs("span",{className:"price-value negative",children:["$",h.lowPrice?.toFixed(2)]})]}),l.jsxs("div",{className:"price-stat",children:[l.jsx("span",{className:"price-label",children:"ATR"}),l.jsxs("span",{className:"price-value",children:["$",h.atr?.toFixed(2)]})]}),l.jsxs("div",{className:"price-stat",children:[l.jsx("span",{className:"price-label",children:"Volatility"}),l.jsxs("span",{className:"price-value neutral",children:[h.volatility?.toFixed(2),"%"]})]}),l.jsxs("div",{className:"price-stat",children:[l.jsx("span",{className:"price-label",children:"Avg Volume"}),l.jsx("span",{className:"price-value",children:F(h.avgVolume||0)})]})]}),l.jsxs("div",{className:"chart-controls",children:[l.jsxs("label",{className:"control-toggle",children:[l.jsx("input",{type:"checkbox",checked:g,onChange:C=>p(C.target.checked)}),l.jsx("span",{children:"Volume"})]}),l.jsxs("label",{className:"control-toggle",children:[l.jsx("input",{type:"checkbox",checked:v,onChange:C=>x(C.target.checked)}),l.jsx("span",{children:"Signals"})]})]}),l.jsxs("div",{className:"price-chart-container",onMouseMove:z,onMouseLeave:L,children:[l.jsx("canvas",{ref:a}),y!==null&&E.current.prices&&E.current.prices[y]&&S&&l.jsxs("div",{className:"price-tooltip",style:{left:S.x>300?S.x-160:S.x+10,top:10},children:[l.jsx("div",{className:"tooltip-date",children:new Date(E.current.prices[y].time).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),l.jsxs("div",{className:"tooltip-ohlc",children:[l.jsxs("span",{children:["O: ",l.jsxs("b",{children:["$",E.current.prices[y].open.toFixed(2)]})]}),l.jsxs("span",{children:["H: ",l.jsxs("b",{className:"positive",children:["$",E.current.prices[y].high.toFixed(2)]})]}),l.jsxs("span",{children:["L: ",l.jsxs("b",{className:"negative",children:["$",E.current.prices[y].low.toFixed(2)]})]}),l.jsxs("span",{children:["C: ",l.jsxs("b",{children:["$",E.current.prices[y].close.toFixed(2)]})]})]}),l.jsxs("div",{className:"tooltip-volume",children:["Vol: ",F(E.current.prices[y].volume)]})]})]}),s&&s.length>0&&l.jsxs("div",{className:"equity-dots-section",children:[l.jsxs("div",{className:"section-header",children:[l.jsx("h4",{children:"Trade Equity Progress"}),l.jsxs("div",{className:"dots-legend",children:[l.jsx("span",{className:"legend-dot win"}),l.jsx("span",{children:"Win"}),l.jsx("span",{className:"legend-dot loss"}),l.jsx("span",{children:"Loss"})]})]}),l.jsx("div",{className:"equity-dots-container",children:l.jsx("canvas",{ref:c})})]}),h&&l.jsxs("div",{className:"price-summary-row",children:[l.jsxs("div",{className:"summary-item",children:[l.jsx("span",{className:"summary-icon bullish",children:""}),l.jsx("span",{className:"summary-label",children:"Bullish"}),l.jsx("span",{className:"summary-value",children:h.bullishCandles})]}),l.jsxs("div",{className:"summary-item",children:[l.jsx("span",{className:"summary-icon bearish",children:""}),l.jsx("span",{className:"summary-label",children:"Bearish"}),l.jsx("span",{className:"summary-value",children:h.bearishCandles})]}),l.jsxs("div",{className:"summary-item",children:[l.jsx("span",{className:"summary-icon buy",children:""}),l.jsx("span",{className:"summary-label",children:"Buy Signals"}),l.jsx("span",{className:"summary-value",children:h.buySignals})]}),l.jsxs("div",{className:"summary-item",children:[l.jsx("span",{className:"summary-icon sell",children:""}),l.jsx("span",{className:"summary-label",children:"Sell Signals"}),l.jsx("span",{className:"summary-value",children:h.sellSignals})]}),l.jsxs("div",{className:"summary-item",children:[l.jsx("span",{className:"summary-label",children:"Total Candles"}),l.jsx("span",{className:"summary-value",children:h.totalCandles})]})]})]})};function vt(i){var e=i.width,s=i.height;if(e<0)throw new Error("Negative width is not allowed for Size");if(s<0)throw new Error("Negative height is not allowed for Size");return{width:e,height:s}}function Mi(i,e){return i.width===e.width&&i.height===e.height}var pw=(function(){function i(e){var s=this;this._resolutionListener=function(){return s._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=e,this._installResolutionListener()}return i.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(i.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),i.prototype.subscribe=function(e){var s=this,a={next:e};return this._observers.push(a),{unsubscribe:function(){s._observers=s._observers.filter(function(c){return c!==a})}}},i.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var e=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(e,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},i.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},i.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},i.prototype._onResolutionChanged=function(){var e=this;this._observers.forEach(function(s){return s.next(e._window.devicePixelRatio)}),this._reinstallResolutionListener()},i})();function gw(i){return new pw(i)}var vw=(function(){function i(e,s,a){var c;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=e,this._canvasElementClientSize=vt({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=s??(function(h){return h}),this._allowResizeObserver=(c=a?.allowResizeObserver)!==null&&c!==void 0?c:!0,this._chooseAndInitObserver()}return i.prototype.dispose=function(){var e,s;if(this._canvasElement===null)throw new Error("Object is disposed");(e=this._canvasElementResizeObserver)===null||e===void 0||e.disconnect(),this._canvasElementResizeObserver=null,(s=this._devicePixelRatioObservable)===null||s===void 0||s.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(i.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bitmapSize",{get:function(){return vt({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),i.prototype.resizeCanvasElement=function(e){this._canvasElementClientSize=vt(e),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},i.prototype.subscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners.push(e)},i.prototype.unsubscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(s){return s!==e})},Object.defineProperty(i.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),i.prototype.subscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners.push(e)},i.prototype.unsubscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(s){return s!==e})},i.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var e=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(e),this._emitSuggestedBitmapSizeChanged(e,this._suggestedBitmapSize)}},i.prototype._resizeBitmap=function(e){var s=this.bitmapSize;Mi(s,e)||(this.canvasElement.width=e.width,this.canvasElement.height=e.height,this._emitBitmapSizeChanged(s,e))},i.prototype._emitBitmapSizeChanged=function(e,s){var a=this;this._bitmapSizeChangedListeners.forEach(function(c){return c.call(a,e,s)})},i.prototype._suggestNewBitmapSize=function(e){var s=this._suggestedBitmapSize,a=vt(this._transformBitmapSize(e,this._canvasElementClientSize)),c=Mi(this.bitmapSize,a)?null:a;s===null&&c===null||s!==null&&c!==null&&Mi(s,c)||(this._suggestedBitmapSize=c,this._emitSuggestedBitmapSizeChanged(s,c))},i.prototype._emitSuggestedBitmapSizeChanged=function(e,s){var a=this;this._suggestedBitmapSizeChangedListeners.forEach(function(c){return c.call(a,e,s)})},i.prototype._chooseAndInitObserver=function(){var e=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}bw().then(function(s){return s?e._initResizeObserver():e._initDevicePixelRatioObservable()})},i.prototype._initDevicePixelRatioObservable=function(){var e=this;if(this._canvasElement!==null){var s=tv(this._canvasElement);if(s===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=gw(s),this._devicePixelRatioObservable.subscribe(function(){return e._invalidateBitmapSize()}),this._invalidateBitmapSize()}},i.prototype._invalidateBitmapSize=function(){var e,s;if(this._canvasElement!==null){var a=tv(this._canvasElement);if(a!==null){var c=(s=(e=this._devicePixelRatioObservable)===null||e===void 0?void 0:e.value)!==null&&s!==void 0?s:a.devicePixelRatio,h=this._canvasElement.getClientRects(),d=h[0]!==void 0?xw(h[0],c):vt({width:this._canvasElementClientSize.width*c,height:this._canvasElementClientSize.height*c});this._suggestNewBitmapSize(d)}}},i.prototype._initResizeObserver=function(){var e=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(s){var a=s.find(function(d){return d.target===e._canvasElement});if(!(!a||!a.devicePixelContentBoxSize||!a.devicePixelContentBoxSize[0])){var c=a.devicePixelContentBoxSize[0],h=vt({width:c.inlineSize,height:c.blockSize});e._suggestNewBitmapSize(h)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},i})();function yw(i,e){return new vw(i,e.transform,e.options)}function tv(i){return i.ownerDocument.defaultView}function bw(){return new Promise(function(i){var e=new ResizeObserver(function(s){i(s.every(function(a){return"devicePixelContentBoxSize"in a})),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function xw(i,e){return vt({width:Math.round(i.left*e+i.width*e)-Math.round(i.left*e),height:Math.round(i.top*e+i.height*e)-Math.round(i.top*e)})}var ww=(function(){function i(e,s,a){if(s.width===0||s.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=s,a.width===0||a.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=a,this._context=e}return i.prototype.useMediaCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),e({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},i.prototype.useBitmapCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),e({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(i.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),i})();function Ri(i,e){var s=i.canvasElementClientSize;if(s.width===0||s.height===0)return null;var a=i.bitmapSize;if(a.width===0||a.height===0)return null;var c=i.canvasElement.getContext("2d",e);return c===null?null:new ww(c,s,a)}const Sw={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},_w={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},jw={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Nw={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Ew={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},Tw={color:"#26a69a",base:0},Py={color:"#2196f3"},By={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var sv,nv;function Ai(i,e){const s={0:[],1:[i.lineWidth,i.lineWidth],2:[2*i.lineWidth,2*i.lineWidth],3:[6*i.lineWidth,6*i.lineWidth],4:[i.lineWidth,4*i.lineWidth]}[e];i.setLineDash(s)}function $y(i,e,s,a){i.beginPath();const c=i.lineWidth%2?.5:0;i.moveTo(s,e+c),i.lineTo(a,e+c),i.stroke()}function ai(i,e){if(!i)throw new Error("Assertion failed"+(e?": "+e:""))}function Jt(i){if(i===void 0)throw new Error("Value is undefined");return i}function be(i){if(i===null)throw new Error("Value is null");return i}function Ea(i){return be(Jt(i))}(function(i){i[i.Simple=0]="Simple",i[i.WithSteps=1]="WithSteps",i[i.Curved=2]="Curved"})(sv||(sv={})),(function(i){i[i.Solid=0]="Solid",i[i.Dotted=1]="Dotted",i[i.Dashed=2]="Dashed",i[i.LargeDashed=3]="LargeDashed",i[i.SparseDotted=4]="SparseDotted"})(nv||(nv={}));const iv={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function Es(i){return i<0?0:i>255?255:Math.round(i)||0}function Uy(i){return i<=0||i>1?Math.min(Math.max(i,0),1):Math.round(1e4*i)/1e4}const kw=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,Cw=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,Mw=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,Dw=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function ql(i){(i=i.toLowerCase())in iv&&(i=iv[i]);{const e=Dw.exec(i)||Mw.exec(i);if(e)return[Es(parseInt(e[1],10)),Es(parseInt(e[2],10)),Es(parseInt(e[3],10)),Uy(e.length<5?1:parseFloat(e[4]))]}{const e=Cw.exec(i);if(e)return[Es(parseInt(e[1],16)),Es(parseInt(e[2],16)),Es(parseInt(e[3],16)),1]}{const e=kw.exec(i);if(e)return[Es(17*parseInt(e[1],16)),Es(17*parseInt(e[2],16)),Es(17*parseInt(e[3],16)),1]}throw new Error(`Cannot parse color: ${i}`)}function Vy(i){return .199*i[0]+.687*i[1]+.114*i[2]}function sc(i){const e=ql(i);return{t:`rgb(${e[0]}, ${e[1]}, ${e[2]})`,i:Vy(e)>160?"black":"white"}}class kt{constructor(){this.h=[]}l(e,s,a){const c={o:e,_:s,u:a===!0};this.h.push(c)}v(e){const s=this.h.findIndex((a=>e===a.o));s>-1&&this.h.splice(s,1)}p(e){this.h=this.h.filter((s=>s._!==e))}m(e,s,a){const c=[...this.h];this.h=this.h.filter((h=>!h.u)),c.forEach((h=>h.o(e,s,a)))}M(){return this.h.length>0}S(){this.h=[]}}function Is(i,...e){for(const s of e)for(const a in s)s[a]!==void 0&&Object.prototype.hasOwnProperty.call(s,a)&&!["__proto__","constructor","prototype"].includes(a)&&(typeof s[a]!="object"||i[a]===void 0||Array.isArray(s[a])?i[a]=s[a]:Is(i[a],s[a]));return i}function Gs(i){return typeof i=="number"&&isFinite(i)}function Fl(i){return typeof i=="number"&&i%1==0}function er(i){return typeof i=="string"}function No(i){return typeof i=="boolean"}function xn(i){const e=i;if(!e||typeof e!="object")return e;let s,a,c;for(a in s=Array.isArray(e)?[]:{},e)e.hasOwnProperty(a)&&(c=e[a],s[a]=c&&typeof c=="object"?xn(c):c);return s}function Rw(i){return i!==null}function Wl(i){return i===null?void 0:i}const Nd="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function La(i,e,s){return e===void 0&&(e=Nd),`${s=s!==void 0?`${s} `:""}${i}px ${e}`}class Aw{constructor(e){this.k={C:1,T:5,P:NaN,R:"",D:"",V:"",O:"",B:0,A:0,I:0,L:0,N:0},this.F=e}W(){const e=this.k,s=this.j(),a=this.H();return e.P===s&&e.D===a||(e.P=s,e.D=a,e.R=La(s,a),e.L=2.5/12*s,e.B=e.L,e.A=s/12*e.T,e.I=s/12*e.T,e.N=0),e.V=this.$(),e.O=this.U(),this.k}$(){return this.F.W().layout.textColor}U(){return this.F.q()}j(){return this.F.W().layout.fontSize}H(){return this.F.W().layout.fontFamily}}class Ed{constructor(){this.Y=[]}Z(e){this.Y=e}X(e,s,a){this.Y.forEach((c=>{c.X(e,s,a)}))}}class Ps{X(e,s,a){e.useBitmapCoordinateSpace((c=>this.K(c,s,a)))}}class Lw extends Ps{constructor(){super(...arguments),this.G=null}J(e){this.G=e}K({context:e,horizontalPixelRatio:s,verticalPixelRatio:a}){if(this.G===null||this.G.tt===null)return;const c=this.G.tt,h=this.G,d=Math.max(1,Math.floor(s))%2/2,g=p=>{e.beginPath();for(let v=c.to-1;v>=c.from;--v){const x=h.it[v],y=Math.round(x.nt*s)+d,b=x.st*a,S=p*a+d;e.moveTo(y,b),e.arc(y,b,S,0,2*Math.PI)}e.fill()};h.et>0&&(e.fillStyle=h.rt,g(h.ht+h.et)),e.fillStyle=h.lt,g(h.ht)}}function Ow(){return{it:[{nt:0,st:0,ot:0,_t:0}],lt:"",rt:"",ht:0,et:0,tt:null}}const zw={from:0,to:1};class Iw{constructor(e,s){this.ut=new Ed,this.ct=[],this.dt=[],this.ft=!0,this.F=e,this.vt=s,this.ut.Z(this.ct)}bt(e){const s=this.F.wt();s.length!==this.ct.length&&(this.dt=s.map(Ow),this.ct=this.dt.map((a=>{const c=new Lw;return c.J(a),c})),this.ut.Z(this.ct)),this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.ut}Mt(){const e=this.vt.W().mode===2,s=this.F.wt(),a=this.vt.xt(),c=this.F.St();s.forEach(((h,d)=>{var g;const p=this.dt[d],v=h.kt(a);if(e||v===null||!h.yt())return void(p.tt=null);const x=be(h.Ct());p.lt=v.Tt,p.ht=v.ht,p.et=v.Pt,p.it[0]._t=v._t,p.it[0].st=h.Dt().Rt(v._t,x.Vt),p.rt=(g=v.Ot)!==null&&g!==void 0?g:this.F.Bt(p.it[0].st/h.Dt().At()),p.it[0].ot=a,p.it[0].nt=c.It(a),p.tt=zw}))}}class Pw extends Ps{constructor(e){super(),this.zt=e}K({context:e,bitmapSize:s,horizontalPixelRatio:a,verticalPixelRatio:c}){if(this.zt===null)return;const h=this.zt.Lt.yt,d=this.zt.Et.yt;if(!h&&!d)return;const g=Math.round(this.zt.nt*a),p=Math.round(this.zt.st*c);e.lineCap="butt",h&&g>=0&&(e.lineWidth=Math.floor(this.zt.Lt.et*a),e.strokeStyle=this.zt.Lt.V,e.fillStyle=this.zt.Lt.V,Ai(e,this.zt.Lt.Nt),(function(v,x,y,b){v.beginPath();const S=v.lineWidth%2?.5:0;v.moveTo(x+S,y),v.lineTo(x+S,b),v.stroke()})(e,g,0,s.height)),d&&p>=0&&(e.lineWidth=Math.floor(this.zt.Et.et*c),e.strokeStyle=this.zt.Et.V,e.fillStyle=this.zt.Et.V,Ai(e,this.zt.Et.Nt),$y(e,p,0,s.width))}}class Bw{constructor(e){this.ft=!0,this.Ft={Lt:{et:1,Nt:0,V:"",yt:!1},Et:{et:1,Nt:0,V:"",yt:!1},nt:0,st:0},this.Wt=new Pw(this.Ft),this.jt=e}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const e=this.jt.yt(),s=be(this.jt.Ht()),a=s.$t().W().crosshair,c=this.Ft;if(a.mode===2)return c.Et.yt=!1,void(c.Lt.yt=!1);c.Et.yt=e&&this.jt.Ut(s),c.Lt.yt=e&&this.jt.qt(),c.Et.et=a.horzLine.width,c.Et.Nt=a.horzLine.style,c.Et.V=a.horzLine.color,c.Lt.et=a.vertLine.width,c.Lt.Nt=a.vertLine.style,c.Lt.V=a.vertLine.color,c.nt=this.jt.Yt(),c.st=this.jt.Zt()}}function $w(i,e,s,a,c,h){i.fillRect(e+h,s,a-2*h,h),i.fillRect(e+h,s+c-h,a-2*h,h),i.fillRect(e,s,h,c),i.fillRect(e+a-h,s,h,c)}function nc(i,e,s,a,c,h){i.save(),i.globalCompositeOperation="copy",i.fillStyle=h,i.fillRect(e,s,a,c),i.restore()}function av(i,e,s,a,c,h){i.beginPath(),i.roundRect?i.roundRect(e,s,a,c,h):(i.lineTo(e+a-h[1],s),h[1]!==0&&i.arcTo(e+a,s,e+a,s+h[1],h[1]),i.lineTo(e+a,s+c-h[2]),h[2]!==0&&i.arcTo(e+a,s+c,e+a-h[2],s+c,h[2]),i.lineTo(e+h[3],s+c),h[3]!==0&&i.arcTo(e,s+c,e,s+c-h[3],h[3]),i.lineTo(e,s+h[0]),h[0]!==0&&i.arcTo(e,s,e+h[0],s,h[0]))}function lv(i,e,s,a,c,h,d=0,g=[0,0,0,0],p=""){if(i.save(),!d||!p||p===h)return av(i,e,s,a,c,g),i.fillStyle=h,i.fill(),void i.restore();const v=d/2;var x;av(i,e+v,s+v,a-d,c-d,(x=-v,g.map((y=>y===0?y:y+x)))),h!=="transparent"&&(i.fillStyle=h,i.fill()),p!=="transparent"&&(i.lineWidth=d,i.strokeStyle=p,i.closePath(),i.stroke()),i.restore()}function Hy(i,e,s,a,c,h,d){i.save(),i.globalCompositeOperation="copy";const g=i.createLinearGradient(0,0,0,c);g.addColorStop(0,h),g.addColorStop(1,d),i.fillStyle=g,i.fillRect(e,s,a,c),i.restore()}class rv{constructor(e,s){this.J(e,s)}J(e,s){this.zt=e,this.Xt=s}At(e,s){return this.zt.yt?e.P+e.L+e.B:0}X(e,s,a,c){if(!this.zt.yt||this.zt.Kt.length===0)return;const h=this.zt.V,d=this.Xt.t,g=e.useBitmapCoordinateSpace((p=>{const v=p.context;v.font=s.R;const x=this.Gt(p,s,a,c),y=x.Jt;return x.Qt?lv(v,y.ti,y.ii,y.ni,y.si,d,y.ei,[y.ht,0,0,y.ht],d):lv(v,y.ri,y.ii,y.ni,y.si,d,y.ei,[0,y.ht,y.ht,0],d),this.zt.hi&&(v.fillStyle=h,v.fillRect(y.ri,y.li,y.ai-y.ri,y.oi)),this.zt._i&&(v.fillStyle=s.O,v.fillRect(x.Qt?y.ui-y.ei:0,y.ii,y.ei,y.ci-y.ii)),x}));e.useMediaCoordinateSpace((({context:p})=>{const v=g.di;p.font=s.R,p.textAlign=g.Qt?"right":"left",p.textBaseline="middle",p.fillStyle=h,p.fillText(this.zt.Kt,v.fi,(v.ii+v.ci)/2+v.pi)}))}Gt(e,s,a,c){var h;const{context:d,bitmapSize:g,mediaSize:p,horizontalPixelRatio:v,verticalPixelRatio:x}=e,y=this.zt.hi||!this.zt.mi?s.T:0,b=this.zt.bi?s.C:0,S=s.L+this.Xt.wi,N=s.B+this.Xt.gi,E=s.A,R=s.I,_=this.zt.Kt,F=s.P,H=a.Mi(d,_),z=Math.ceil(a.xi(d,_)),L=F+S+N,C=s.C+E+R+z+y,j=Math.max(1,Math.floor(x));let K=Math.round(L*x);K%2!=j%2&&(K+=1);const I=b>0?Math.max(1,Math.floor(b*v)):0,U=Math.round(C*v),Y=Math.round(y*v),$=(h=this.Xt.Si)!==null&&h!==void 0?h:this.Xt.ki,Q=Math.round($*x)-Math.floor(.5*x),q=Math.floor(Q+j/2-K/2),ge=q+K,O=c==="right",A=O?p.width-b:b,W=O?g.width-I:I;let ce,se,M;return O?(ce=W-U,se=W-Y,M=A-y-E-b):(ce=W+U,se=W+Y,M=A+y+E),{Qt:O,Jt:{ii:q,li:Q,ci:ge,ni:U,si:K,ht:2*v,ei:I,ti:ce,ri:W,ai:se,oi:j,ui:g.width},di:{ii:q/x,ci:ge/x,fi:M,pi:H}}}}class ic{constructor(e){this.yi={ki:0,t:"#000",gi:0,wi:0},this.Ci={Kt:"",yt:!1,hi:!0,mi:!1,Ot:"",V:"#FFF",_i:!1,bi:!1},this.Ti={Kt:"",yt:!1,hi:!1,mi:!0,Ot:"",V:"#FFF",_i:!0,bi:!0},this.ft=!0,this.Pi=new(e||rv)(this.Ci,this.yi),this.Ri=new(e||rv)(this.Ti,this.yi)}Kt(){return this.Di(),this.Ci.Kt}ki(){return this.Di(),this.yi.ki}bt(){this.ft=!0}At(e,s=!1){return Math.max(this.Pi.At(e,s),this.Ri.At(e,s))}Vi(){return this.yi.Si||0}Oi(e){this.yi.Si=e}Bi(){return this.Di(),this.Ci.yt||this.Ti.yt}Ai(){return this.Di(),this.Ci.yt}gt(e){return this.Di(),this.Ci.hi=this.Ci.hi&&e.W().ticksVisible,this.Ti.hi=this.Ti.hi&&e.W().ticksVisible,this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Pi}Ii(){return this.Di(),this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Ri}Di(){this.ft&&(this.Ci.hi=!0,this.Ti.hi=!1,this.zi(this.Ci,this.Ti,this.yi))}}class Uw extends ic{constructor(e,s,a){super(),this.jt=e,this.Li=s,this.Ei=a}zi(e,s,a){if(e.yt=!1,this.jt.W().mode===2)return;const c=this.jt.W().horzLine;if(!c.labelVisible)return;const h=this.Li.Ct();if(!this.jt.yt()||this.Li.Ni()||h===null)return;const d=sc(c.labelBackgroundColor);a.t=d.t,e.V=d.i;const g=2/12*this.Li.P();a.wi=g,a.gi=g;const p=this.Ei(this.Li);a.ki=p.ki,e.Kt=this.Li.Fi(p._t,h),e.yt=!0}}const Vw=/[1-9]/g;class qy{constructor(){this.zt=null}J(e){this.zt=e}X(e,s){if(this.zt===null||this.zt.yt===!1||this.zt.Kt.length===0)return;const a=e.useMediaCoordinateSpace((({context:b})=>(b.font=s.R,Math.round(s.Wi.xi(b,be(this.zt).Kt,Vw)))));if(a<=0)return;const c=s.ji,h=a+2*c,d=h/2,g=this.zt.Hi;let p=this.zt.ki,v=Math.floor(p-d)+.5;v<0?(p+=Math.abs(0-v),v=Math.floor(p-d)+.5):v+h>g&&(p-=Math.abs(g-(v+h)),v=Math.floor(p-d)+.5);const x=v+h,y=Math.ceil(0+s.C+s.T+s.L+s.P+s.B);e.useBitmapCoordinateSpace((({context:b,horizontalPixelRatio:S,verticalPixelRatio:N})=>{const E=be(this.zt);b.fillStyle=E.t;const R=Math.round(v*S),_=Math.round(0*N),F=Math.round(x*S),H=Math.round(y*N),z=Math.round(2*S);if(b.beginPath(),b.moveTo(R,_),b.lineTo(R,H-z),b.arcTo(R,H,R+z,H,z),b.lineTo(F-z,H),b.arcTo(F,H,F,H-z,z),b.lineTo(F,_),b.fill(),E.hi){const L=Math.round(E.ki*S),C=_,j=Math.round((C+s.T)*N);b.fillStyle=E.V;const K=Math.max(1,Math.floor(S)),I=Math.floor(.5*S);b.fillRect(L-I,C,K,j-C)}})),e.useMediaCoordinateSpace((({context:b})=>{const S=be(this.zt),N=0+s.C+s.T+s.L+s.P/2;b.font=s.R,b.textAlign="left",b.textBaseline="middle",b.fillStyle=S.V;const E=s.Wi.Mi(b,"Apr0");b.translate(v+c,N+E),b.fillText(S.Kt,0,0)}))}}class Hw{constructor(e,s,a){this.ft=!0,this.Wt=new qy,this.Ft={yt:!1,t:"#4c525e",V:"white",Kt:"",Hi:0,ki:NaN,hi:!0},this.vt=e,this.$i=s,this.Ei=a}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt.J(this.Ft),this.Wt}Mt(){const e=this.Ft;if(e.yt=!1,this.vt.W().mode===2)return;const s=this.vt.W().vertLine;if(!s.labelVisible)return;const a=this.$i.St();if(a.Ni())return;e.Hi=a.Hi();const c=this.Ei();if(c===null)return;e.ki=c.ki;const h=a.Ui(this.vt.xt());e.Kt=a.qi(be(h)),e.yt=!0;const d=sc(s.labelBackgroundColor);e.t=d.t,e.V=d.i,e.hi=a.W().ticksVisible}}class Td{constructor(){this.Yi=null,this.Zi=0}Xi(){return this.Zi}Ki(e){this.Zi=e}Dt(){return this.Yi}Gi(e){this.Yi=e}Ji(e){return[]}Qi(){return[]}yt(){return!0}}var ld;(function(i){i[i.Normal=0]="Normal",i[i.Magnet=1]="Magnet",i[i.Hidden=2]="Hidden"})(ld||(ld={}));class qw extends Td{constructor(e,s){super(),this.tn=null,this.nn=NaN,this.sn=0,this.en=!0,this.rn=new Map,this.hn=!1,this.ln=NaN,this.an=NaN,this._n=NaN,this.un=NaN,this.$i=e,this.cn=s,this.dn=new Iw(e,this),this.fn=((c,h)=>d=>{const g=h(),p=c();if(d===be(this.tn).vn())return{_t:p,ki:g};{const v=be(d.Ct());return{_t:d.pn(g,v),ki:g}}})((()=>this.nn),(()=>this.an));const a=((c,h)=>()=>{const d=this.$i.St().mn(c()),g=h();return d&&Number.isFinite(g)?{ot:d,ki:g}:null})((()=>this.sn),(()=>this.Yt()));this.bn=new Hw(this,e,a),this.wn=new Bw(this)}W(){return this.cn}gn(e,s){this._n=e,this.un=s}Mn(){this._n=NaN,this.un=NaN}xn(){return this._n}Sn(){return this.un}kn(e,s,a){this.hn||(this.hn=!0),this.en=!0,this.yn(e,s,a)}xt(){return this.sn}Yt(){return this.ln}Zt(){return this.an}yt(){return this.en}Cn(){this.en=!1,this.Tn(),this.nn=NaN,this.ln=NaN,this.an=NaN,this.tn=null,this.Mn()}Pn(e){return this.tn!==null?[this.wn,this.dn]:[]}Ut(e){return e===this.tn&&this.cn.horzLine.visible}qt(){return this.cn.vertLine.visible}Rn(e,s){this.en&&this.tn===e||this.rn.clear();const a=[];return this.tn===e&&a.push(this.Dn(this.rn,s,this.fn)),a}Qi(){return this.en?[this.bn]:[]}Ht(){return this.tn}Vn(){this.wn.bt(),this.rn.forEach((e=>e.bt())),this.bn.bt(),this.dn.bt()}On(e){return e&&!e.vn().Ni()?e.vn():null}yn(e,s,a){this.Bn(e,s,a)&&this.Vn()}Bn(e,s,a){const c=this.ln,h=this.an,d=this.nn,g=this.sn,p=this.tn,v=this.On(a);this.sn=e,this.ln=isNaN(e)?NaN:this.$i.St().It(e),this.tn=a;const x=v!==null?v.Ct():null;return v!==null&&x!==null?(this.nn=s,this.an=v.Rt(s,x)):(this.nn=NaN,this.an=NaN),c!==this.ln||h!==this.an||g!==this.sn||d!==this.nn||p!==this.tn}Tn(){const e=this.$i.wt().map((a=>a.In().An())).filter(Rw),s=e.length===0?null:Math.max(...e);this.sn=s!==null?s:NaN}Dn(e,s,a){let c=e.get(s);return c===void 0&&(c=new Uw(this,s,a),e.set(s,c)),c}}function ac(i){return i==="left"||i==="right"}class Wt{constructor(e){this.zn=new Map,this.Ln=[],this.En=e}Nn(e,s){const a=(function(c,h){return c===void 0?h:{Fn:Math.max(c.Fn,h.Fn),Wn:c.Wn||h.Wn}})(this.zn.get(e),s);this.zn.set(e,a)}jn(){return this.En}Hn(e){const s=this.zn.get(e);return s===void 0?{Fn:this.En}:{Fn:Math.max(this.En,s.Fn),Wn:s.Wn}}$n(){this.Un(),this.Ln=[{qn:0}]}Yn(e){this.Un(),this.Ln=[{qn:1,Vt:e}]}Zn(e){this.Xn(),this.Ln.push({qn:5,Vt:e})}Un(){this.Xn(),this.Ln.push({qn:6})}Kn(){this.Un(),this.Ln=[{qn:4}]}Gn(e){this.Un(),this.Ln.push({qn:2,Vt:e})}Jn(e){this.Un(),this.Ln.push({qn:3,Vt:e})}Qn(){return this.Ln}ts(e){for(const s of e.Ln)this.ns(s);this.En=Math.max(this.En,e.En),e.zn.forEach(((s,a)=>{this.Nn(a,s)}))}static ss(){return new Wt(2)}static es(){return new Wt(3)}ns(e){switch(e.qn){case 0:this.$n();break;case 1:this.Yn(e.Vt);break;case 2:this.Gn(e.Vt);break;case 3:this.Jn(e.Vt);break;case 4:this.Kn();break;case 5:this.Zn(e.Vt);break;case 6:this.Xn()}}Xn(){const e=this.Ln.findIndex((s=>s.qn===5));e!==-1&&this.Ln.splice(e,1)}}const ov=".";function wn(i,e){if(!Gs(i))return"n/a";if(!Fl(e))throw new TypeError("invalid length");if(e<0||e>16)throw new TypeError("invalid length");return e===0?i.toString():("0000000000000000"+i.toString()).slice(-e)}class lc{constructor(e,s){if(s||(s=1),Gs(e)&&Fl(e)||(e=100),e<0)throw new TypeError("invalid base");this.Li=e,this.rs=s,this.hs()}format(e){const s=e<0?"":"";return e=Math.abs(e),s+this.ls(e)}hs(){if(this._s=0,this.Li>0&&this.rs>0){let e=this.Li;for(;e>1;)e/=10,this._s++}}ls(e){const s=this.Li/this.rs;let a=Math.floor(e),c="";const h=this._s!==void 0?this._s:NaN;if(s>1){let d=+(Math.round(e*s)-a*s).toFixed(this._s);d>=s&&(d-=s,a+=1),c=ov+wn(+d.toFixed(this._s)*this.rs,h)}else a=Math.round(a*s)/s,h>0&&(c=ov+wn(0,h));return a.toFixed(0)+c}}class Fy extends lc{constructor(e=100){super(e)}format(e){return`${super.format(e)}%`}}class Fw{constructor(e){this.us=e}format(e){let s="";return e<0&&(s="-",e=-e),e<995?s+this.cs(e):e<999995?s+this.cs(e/1e3)+"K":e<999999995?(e=1e3*Math.round(e/1e3),s+this.cs(e/1e6)+"M"):(e=1e6*Math.round(e/1e6),s+this.cs(e/1e9)+"B")}cs(e){let s;const a=Math.pow(10,this.us);return s=(e=Math.round(e*a)/a)>=1e-15&&e<1?e.toFixed(this.us).replace(/\.?0+$/,""):String(e),s.replace(/(\.[1-9]*)0+$/,((c,h)=>h))}}function Wy(i,e,s,a,c,h,d){if(e.length===0||a.from>=e.length||a.to<=0)return;const{context:g,horizontalPixelRatio:p,verticalPixelRatio:v}=i,x=e[a.from];let y=h(i,x),b=x;if(a.to-a.from<2){const S=c/2;g.beginPath();const N={nt:x.nt-S,st:x.st},E={nt:x.nt+S,st:x.st};g.moveTo(N.nt*p,N.st*v),g.lineTo(E.nt*p,E.st*v),d(i,y,N,E)}else{const S=(E,R)=>{d(i,y,b,R),g.beginPath(),y=E,b=R};let N=b;g.beginPath(),g.moveTo(x.nt*p,x.st*v);for(let E=a.from+1;E<a.to;++E){N=e[E];const R=h(i,N);switch(s){case 0:g.lineTo(N.nt*p,N.st*v);break;case 1:g.lineTo(N.nt*p,e[E-1].st*v),R!==y&&(S(R,N),g.lineTo(N.nt*p,e[E-1].st*v)),g.lineTo(N.nt*p,N.st*v);break;case 2:{const[_,F]=Ww(e,E-1,E);g.bezierCurveTo(_.nt*p,_.st*v,F.nt*p,F.st*v,N.nt*p,N.st*v);break}}s!==1&&R!==y&&(S(R,N),g.moveTo(N.nt*p,N.st*v))}(b!==N||b===N&&s===1)&&d(i,y,b,N)}}const cv=6;function Eh(i,e){return{nt:i.nt-e.nt,st:i.st-e.st}}function uv(i,e){return{nt:i.nt/e,st:i.st/e}}function Ww(i,e,s){const a=Math.max(0,e-1),c=Math.min(i.length-1,s+1);var h,d;return[(h=i[e],d=uv(Eh(i[s],i[a]),cv),{nt:h.nt+d.nt,st:h.st+d.st}),Eh(i[s],uv(Eh(i[c],i[e]),cv))]}function Gw(i,e,s,a,c){const{context:h,horizontalPixelRatio:d,verticalPixelRatio:g}=e;h.lineTo(c.nt*d,i*g),h.lineTo(a.nt*d,i*g),h.closePath(),h.fillStyle=s,h.fill()}class Gy extends Ps{constructor(){super(...arguments),this.G=null}J(e){this.G=e}K(e){var s;if(this.G===null)return;const{it:a,tt:c,ds:h,et:d,Nt:g,fs:p}=this.G,v=(s=this.G.vs)!==null&&s!==void 0?s:this.G.ps?0:e.mediaSize.height;if(c===null)return;const x=e.context;x.lineCap="butt",x.lineJoin="round",x.lineWidth=d,Ai(x,g),x.lineWidth=1,Wy(e,a,p,c,h,this.bs.bind(this),Gw.bind(null,v))}}function rd(i,e,s){return Math.min(Math.max(i,e),s)}function Eo(i,e,s){return e-i<=s}function Yy(i){const e=Math.ceil(i);return e%2==0?e-1:e}class kd{ws(e,s){const a=this.gs,{Ms:c,xs:h,Ss:d,ks:g,ys:p,vs:v}=s;if(this.Cs===void 0||a===void 0||a.Ms!==c||a.xs!==h||a.Ss!==d||a.ks!==g||a.vs!==v||a.ys!==p){const x=e.context.createLinearGradient(0,0,0,p);if(x.addColorStop(0,c),v!=null){const y=rd(v*e.verticalPixelRatio/p,0,1);x.addColorStop(y,h),x.addColorStop(y,d)}x.addColorStop(1,g),this.Cs=x,this.gs=s}return this.Cs}}class Yw extends Gy{constructor(){super(...arguments),this.Ts=new kd}bs(e,s){return this.Ts.ws(e,{Ms:s.Ps,xs:"",Ss:"",ks:s.Rs,ys:e.bitmapSize.height})}}function Kw(i,e){const s=i.context;s.strokeStyle=e,s.stroke()}class Ky extends Ps{constructor(){super(...arguments),this.G=null}J(e){this.G=e}K(e){if(this.G===null)return;const{it:s,tt:a,ds:c,fs:h,et:d,Nt:g,Ds:p}=this.G;if(a===null)return;const v=e.context;v.lineCap="butt",v.lineWidth=d*e.verticalPixelRatio,Ai(v,g),v.lineJoin="round";const x=this.Vs.bind(this);h!==void 0&&Wy(e,s,h,a,c,x,Kw),p&&(function(y,b,S,N,E){const{horizontalPixelRatio:R,verticalPixelRatio:_,context:F}=y;let H=null;const z=Math.max(1,Math.floor(R))%2/2,L=S*_+z;for(let C=N.to-1;C>=N.from;--C){const j=b[C];if(j){const K=E(y,j);K!==H&&(F.beginPath(),H!==null&&F.fill(),F.fillStyle=K,H=K);const I=Math.round(j.nt*R)+z,U=j.st*_;F.moveTo(I,U),F.arc(I,U,L,0,2*Math.PI)}}F.fill()})(e,s,p,a,x)}}class Xy extends Ky{Vs(e,s){return s.lt}}function Jy(i,e,s,a,c=0,h=e.length){let d=h-c;for(;0<d;){const g=d>>1,p=c+g;a(e[p],s)===i?(c=p+1,d-=g+1):d=g}return c}const tr=Jy.bind(null,!0),Qy=Jy.bind(null,!1);function Xw(i,e){return i.ot<e}function Jw(i,e){return e<i.ot}function Zy(i,e,s){const a=e.Os(),c=e.ui(),h=tr(i,a,Xw),d=Qy(i,c,Jw);if(!s)return{from:h,to:d};let g=h,p=d;return h>0&&h<i.length&&i[h].ot>=a&&(g=h-1),d>0&&d<i.length&&i[d-1].ot<=c&&(p=d+1),{from:g,to:p}}class Cd{constructor(e,s,a){this.Bs=!0,this.As=!0,this.Is=!0,this.zs=[],this.Ls=null,this.Es=e,this.Ns=s,this.Fs=a}bt(e){this.Bs=!0,e==="data"&&(this.As=!0),e==="options"&&(this.Is=!0)}gt(){return this.Es.yt()?(this.Ws(),this.Ls===null?null:this.js):null}Hs(){this.zs=this.zs.map((e=>Object.assign(Object.assign({},e),this.Es.Us().$s(e.ot))))}qs(){this.Ls=null}Ws(){this.As&&(this.Ys(),this.As=!1),this.Is&&(this.Hs(),this.Is=!1),this.Bs&&(this.Zs(),this.Bs=!1)}Zs(){const e=this.Es.Dt(),s=this.Ns.St();if(this.qs(),s.Ni()||e.Ni())return;const a=s.Xs();if(a===null||this.Es.In().Ks()===0)return;const c=this.Es.Ct();c!==null&&(this.Ls=Zy(this.zs,a,this.Fs),this.Gs(e,s,c.Vt),this.Js())}}class rc extends Cd{constructor(e,s){super(e,s,!0)}Gs(e,s,a){s.Qs(this.zs,Wl(this.Ls)),e.te(this.zs,a,Wl(this.Ls))}ie(e,s){return{ot:e,_t:s,nt:NaN,st:NaN}}Ys(){const e=this.Es.Us();this.zs=this.Es.In().ne().map((s=>{const a=s.Vt[3];return this.se(s.ee,a,e)}))}}class Qw extends rc{constructor(e,s){super(e,s),this.js=new Ed,this.re=new Yw,this.he=new Xy,this.js.Z([this.re,this.he])}se(e,s,a){return Object.assign(Object.assign({},this.ie(e,s)),a.$s(e))}Js(){const e=this.Es.W();this.re.J({fs:e.lineType,it:this.zs,Nt:e.lineStyle,et:e.lineWidth,vs:null,ps:e.invertFilledArea,tt:this.Ls,ds:this.Ns.St().le()}),this.he.J({fs:e.lineVisible?e.lineType:void 0,it:this.zs,Nt:e.lineStyle,et:e.lineWidth,tt:this.Ls,ds:this.Ns.St().le(),Ds:e.pointMarkersVisible?e.pointMarkersRadius||e.lineWidth/2+2:void 0})}}class Zw extends Ps{constructor(){super(...arguments),this.zt=null,this.ae=0,this.oe=0}J(e){this.zt=e}K({context:e,horizontalPixelRatio:s,verticalPixelRatio:a}){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;this.ae=this._e(s),this.ae>=2&&Math.max(1,Math.floor(s))%2!=this.ae%2&&this.ae--,this.oe=this.zt.ue?Math.min(this.ae,Math.floor(s)):this.ae;let c=null;const h=this.oe<=this.ae&&this.zt.le>=Math.floor(1.5*s);for(let d=this.zt.tt.from;d<this.zt.tt.to;++d){const g=this.zt.In[d];c!==g.ce&&(e.fillStyle=g.ce,c=g.ce);const p=Math.floor(.5*this.oe),v=Math.round(g.nt*s),x=v-p,y=this.oe,b=x+y-1,S=Math.min(g.de,g.fe),N=Math.max(g.de,g.fe),E=Math.round(S*a)-p,R=Math.round(N*a)+p,_=Math.max(R-E,this.oe);e.fillRect(x,E,y,_);const F=Math.ceil(1.5*this.ae);if(h){if(this.zt.ve){const C=v-F;let j=Math.max(E,Math.round(g.pe*a)-p),K=j+y-1;K>E+_-1&&(K=E+_-1,j=K-y+1),e.fillRect(C,j,x-C,K-j+1)}const H=v+F;let z=Math.max(E,Math.round(g.me*a)-p),L=z+y-1;L>E+_-1&&(L=E+_-1,z=L-y+1),e.fillRect(b+1,z,H-b,L-z+1)}}}_e(e){const s=Math.floor(e);return Math.max(s,Math.floor((function(a,c){return Math.floor(.3*a*c)})(be(this.zt).le,e)))}}class e0 extends Cd{constructor(e,s){super(e,s,!1)}Gs(e,s,a){s.Qs(this.zs,Wl(this.Ls)),e.be(this.zs,a,Wl(this.Ls))}we(e,s,a){return{ot:e,ge:s.Vt[0],Me:s.Vt[1],xe:s.Vt[2],Se:s.Vt[3],nt:NaN,pe:NaN,de:NaN,fe:NaN,me:NaN}}Ys(){const e=this.Es.Us();this.zs=this.Es.In().ne().map((s=>this.se(s.ee,s,e)))}}class eS extends e0{constructor(){super(...arguments),this.js=new Zw}se(e,s,a){return Object.assign(Object.assign({},this.we(e,s,a)),a.$s(e))}Js(){const e=this.Es.W();this.js.J({In:this.zs,le:this.Ns.St().le(),ve:e.openVisible,ue:e.thinBars,tt:this.Ls})}}class tS extends Gy{constructor(){super(...arguments),this.Ts=new kd}bs(e,s){const a=this.G;return this.Ts.ws(e,{Ms:s.ke,xs:s.ye,Ss:s.Ce,ks:s.Te,ys:e.bitmapSize.height,vs:a.vs})}}class sS extends Ky{constructor(){super(...arguments),this.Pe=new kd}Vs(e,s){const a=this.G;return this.Pe.ws(e,{Ms:s.Re,xs:s.Re,Ss:s.De,ks:s.De,ys:e.bitmapSize.height,vs:a.vs})}}class nS extends rc{constructor(e,s){super(e,s),this.js=new Ed,this.Ve=new tS,this.Oe=new sS,this.js.Z([this.Ve,this.Oe])}se(e,s,a){return Object.assign(Object.assign({},this.ie(e,s)),a.$s(e))}Js(){const e=this.Es.Ct();if(e===null)return;const s=this.Es.W(),a=this.Es.Dt().Rt(s.baseValue.price,e.Vt),c=this.Ns.St().le();this.Ve.J({it:this.zs,et:s.lineWidth,Nt:s.lineStyle,fs:s.lineType,vs:a,ps:!1,tt:this.Ls,ds:c}),this.Oe.J({it:this.zs,et:s.lineWidth,Nt:s.lineStyle,fs:s.lineVisible?s.lineType:void 0,Ds:s.pointMarkersVisible?s.pointMarkersRadius||s.lineWidth/2+2:void 0,vs:a,tt:this.Ls,ds:c})}}class iS extends Ps{constructor(){super(...arguments),this.zt=null,this.ae=0}J(e){this.zt=e}K(e){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;const{horizontalPixelRatio:s}=e;this.ae=(function(h,d){if(h>=2.5&&h<=4)return Math.floor(3*d);const g=1-.2*Math.atan(Math.max(4,h)-4)/(.5*Math.PI),p=Math.floor(h*g*d),v=Math.floor(h*d),x=Math.min(p,v);return Math.max(Math.floor(d),x)})(this.zt.le,s),this.ae>=2&&Math.floor(s)%2!=this.ae%2&&this.ae--;const a=this.zt.In;this.zt.Be&&this.Ae(e,a,this.zt.tt),this.zt._i&&this.Ie(e,a,this.zt.tt);const c=this.ze(s);(!this.zt._i||this.ae>2*c)&&this.Le(e,a,this.zt.tt)}Ae(e,s,a){if(this.zt===null)return;const{context:c,horizontalPixelRatio:h,verticalPixelRatio:d}=e;let g="",p=Math.min(Math.floor(h),Math.floor(this.zt.le*h));p=Math.max(Math.floor(h),Math.min(p,this.ae));const v=Math.floor(.5*p);let x=null;for(let y=a.from;y<a.to;y++){const b=s[y];b.Ee!==g&&(c.fillStyle=b.Ee,g=b.Ee);const S=Math.round(Math.min(b.pe,b.me)*d),N=Math.round(Math.max(b.pe,b.me)*d),E=Math.round(b.de*d),R=Math.round(b.fe*d);let _=Math.round(h*b.nt)-v;const F=_+p-1;x!==null&&(_=Math.max(x+1,_),_=Math.min(_,F));const H=F-_+1;c.fillRect(_,E,H,S-E),c.fillRect(_,N+1,H,R-N),x=F}}ze(e){let s=Math.floor(1*e);this.ae<=2*s&&(s=Math.floor(.5*(this.ae-1)));const a=Math.max(Math.floor(e),s);return this.ae<=2*a?Math.max(Math.floor(e),Math.floor(1*e)):a}Ie(e,s,a){if(this.zt===null)return;const{context:c,horizontalPixelRatio:h,verticalPixelRatio:d}=e;let g="";const p=this.ze(h);let v=null;for(let x=a.from;x<a.to;x++){const y=s[x];y.Ne!==g&&(c.fillStyle=y.Ne,g=y.Ne);let b=Math.round(y.nt*h)-Math.floor(.5*this.ae);const S=b+this.ae-1,N=Math.round(Math.min(y.pe,y.me)*d),E=Math.round(Math.max(y.pe,y.me)*d);if(v!==null&&(b=Math.max(v+1,b),b=Math.min(b,S)),this.zt.le*h>2*p)$w(c,b,N,S-b+1,E-N+1,p);else{const R=S-b+1;c.fillRect(b,N,R,E-N+1)}v=S}}Le(e,s,a){if(this.zt===null)return;const{context:c,horizontalPixelRatio:h,verticalPixelRatio:d}=e;let g="";const p=this.ze(h);for(let v=a.from;v<a.to;v++){const x=s[v];let y=Math.round(Math.min(x.pe,x.me)*d),b=Math.round(Math.max(x.pe,x.me)*d),S=Math.round(x.nt*h)-Math.floor(.5*this.ae),N=S+this.ae-1;if(x.ce!==g){const E=x.ce;c.fillStyle=E,g=E}this.zt._i&&(S+=p,y+=p,N-=p,b-=p),y>b||c.fillRect(S,y,N-S+1,b-y+1)}}}class aS extends e0{constructor(){super(...arguments),this.js=new iS}se(e,s,a){return Object.assign(Object.assign({},this.we(e,s,a)),a.$s(e))}Js(){const e=this.Es.W();this.js.J({In:this.zs,le:this.Ns.St().le(),Be:e.wickVisible,_i:e.borderVisible,tt:this.Ls})}}class lS{constructor(e,s){this.Fe=e,this.Li=s}X(e,s,a){this.Fe.draw(e,this.Li,s,a)}}class Th extends Cd{constructor(e,s,a){super(e,s,!1),this.wn=a,this.js=new lS(this.wn.renderer(),(c=>{const h=e.Ct();return h===null?null:e.Dt().Rt(c,h.Vt)}))}We(e){return this.wn.priceValueBuilder(e)}je(e){return this.wn.isWhitespace(e)}Ys(){const e=this.Es.Us();this.zs=this.Es.In().ne().map((s=>Object.assign(Object.assign({ot:s.ee,nt:NaN},e.$s(s.ee)),{He:s.$e})))}Gs(e,s){s.Qs(this.zs,Wl(this.Ls))}Js(){this.wn.update({bars:this.zs.map(rS),barSpacing:this.Ns.St().le(),visibleRange:this.Ls},this.Es.W())}}function rS(i){return{x:i.nt,time:i.ot,originalData:i.He,barColor:i.ce}}class oS extends Ps{constructor(){super(...arguments),this.zt=null,this.Ue=[]}J(e){this.zt=e,this.Ue=[]}K({context:e,horizontalPixelRatio:s,verticalPixelRatio:a}){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return;this.Ue.length||this.qe(s);const c=Math.max(1,Math.floor(a)),h=Math.round(this.zt.Ye*a)-Math.floor(c/2),d=h+c;for(let g=this.zt.tt.from;g<this.zt.tt.to;g++){const p=this.zt.it[g],v=this.Ue[g-this.zt.tt.from],x=Math.round(p.st*a);let y,b;e.fillStyle=p.ce,x<=h?(y=x,b=d):(y=h,b=x-Math.floor(c/2)+c),e.fillRect(v.Os,y,v.ui-v.Os+1,b-y)}}qe(e){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return void(this.Ue=[]);const s=Math.ceil(this.zt.le*e)<=1?0:Math.max(1,Math.floor(e)),a=Math.round(this.zt.le*e)-s;this.Ue=new Array(this.zt.tt.to-this.zt.tt.from);for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const d=this.zt.it[h],g=Math.round(d.nt*e);let p,v;if(a%2){const x=(a-1)/2;p=g-x,v=g+x}else{const x=a/2;p=g-x,v=g+x-1}this.Ue[h-this.zt.tt.from]={Os:p,ui:v,Ze:g,Xe:d.nt*e,ot:d.ot}}for(let h=this.zt.tt.from+1;h<this.zt.tt.to;h++){const d=this.Ue[h-this.zt.tt.from],g=this.Ue[h-this.zt.tt.from-1];d.ot===g.ot+1&&d.Os-g.ui!==s+1&&(g.Ze>g.Xe?g.ui=d.Os-s-1:d.Os=g.ui+s+1)}let c=Math.ceil(this.zt.le*e);for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const d=this.Ue[h-this.zt.tt.from];d.ui<d.Os&&(d.ui=d.Os);const g=d.ui-d.Os+1;c=Math.min(g,c)}if(s>0&&c<4)for(let h=this.zt.tt.from;h<this.zt.tt.to;h++){const d=this.Ue[h-this.zt.tt.from];d.ui-d.Os+1>c&&(d.Ze>d.Xe?d.ui-=1:d.Os+=1)}}}class cS extends rc{constructor(){super(...arguments),this.js=new oS}se(e,s,a){return Object.assign(Object.assign({},this.ie(e,s)),a.$s(e))}Js(){const e={it:this.zs,le:this.Ns.St().le(),tt:this.Ls,Ye:this.Es.Dt().Rt(this.Es.W().base,be(this.Es.Ct()).Vt)};this.js.J(e)}}class uS extends rc{constructor(){super(...arguments),this.js=new Xy}se(e,s,a){return Object.assign(Object.assign({},this.ie(e,s)),a.$s(e))}Js(){const e=this.Es.W(),s={it:this.zs,Nt:e.lineStyle,fs:e.lineVisible?e.lineType:void 0,et:e.lineWidth,Ds:e.pointMarkersVisible?e.pointMarkersRadius||e.lineWidth/2+2:void 0,tt:this.Ls,ds:this.Ns.St().le()};this.js.J(s)}}const hS=/[2-9]/g;class Gl{constructor(e=50){this.Ke=0,this.Ge=1,this.Je=1,this.Qe={},this.tr=new Map,this.ir=e}nr(){this.Ke=0,this.tr.clear(),this.Ge=1,this.Je=1,this.Qe={}}xi(e,s,a){return this.sr(e,s,a).width}Mi(e,s,a){const c=this.sr(e,s,a);return((c.actualBoundingBoxAscent||0)-(c.actualBoundingBoxDescent||0))/2}sr(e,s,a){const c=a||hS,h=String(s).replace(c,"0");if(this.tr.has(h))return Jt(this.tr.get(h)).er;if(this.Ke===this.ir){const g=this.Qe[this.Je];delete this.Qe[this.Je],this.tr.delete(g),this.Je++,this.Ke--}e.save(),e.textBaseline="middle";const d=e.measureText(h);return e.restore(),d.width===0&&s.length||(this.tr.set(h,{er:d,rr:this.Ge}),this.Qe[this.Ge]=h,this.Ke++,this.Ge++),d}}class dS{constructor(e){this.hr=null,this.k=null,this.lr="right",this.ar=e}_r(e,s,a){this.hr=e,this.k=s,this.lr=a}X(e){this.k!==null&&this.hr!==null&&this.hr.X(e,this.k,this.ar,this.lr)}}class t0{constructor(e,s,a){this.ur=e,this.ar=new Gl(50),this.cr=s,this.F=a,this.j=-1,this.Wt=new dS(this.ar)}gt(){const e=this.F.dr(this.cr);if(e===null)return null;const s=e.vr(this.cr)?e.pr():this.cr.Dt();if(s===null)return null;const a=e.mr(s);if(a==="overlay")return null;const c=this.F.br();return c.P!==this.j&&(this.j=c.P,this.ar.nr()),this.Wt._r(this.ur.Ii(),c,a),this.Wt}}class fS extends Ps{constructor(){super(...arguments),this.zt=null}J(e){this.zt=e}wr(e,s){var a;if(!(!((a=this.zt)===null||a===void 0)&&a.yt))return null;const{st:c,et:h,gr:d}=this.zt;return s>=c-h-7&&s<=c+h+7?{Mr:this.zt,gr:d}:null}K({context:e,bitmapSize:s,horizontalPixelRatio:a,verticalPixelRatio:c}){if(this.zt===null||this.zt.yt===!1)return;const h=Math.round(this.zt.st*c);h<0||h>s.height||(e.lineCap="butt",e.strokeStyle=this.zt.V,e.lineWidth=Math.floor(this.zt.et*a),Ai(e,this.zt.Nt),$y(e,h,0,s.width))}}class Md{constructor(e){this.Sr={st:0,V:"rgba(0, 0, 0, 0)",et:1,Nt:0,yt:!1},this.kr=new fS,this.ft=!0,this.Es=e,this.Ns=e.$t(),this.kr.J(this.Sr)}bt(){this.ft=!0}gt(){return this.Es.yt()?(this.ft&&(this.yr(),this.ft=!1),this.kr):null}}class mS extends Md{constructor(e){super(e)}yr(){this.Sr.yt=!1;const e=this.Es.Dt(),s=e.Cr().Cr;if(s!==2&&s!==3)return;const a=this.Es.W();if(!a.baseLineVisible||!this.Es.yt())return;const c=this.Es.Ct();c!==null&&(this.Sr.yt=!0,this.Sr.st=e.Rt(c.Vt,c.Vt),this.Sr.V=a.baseLineColor,this.Sr.et=a.baseLineWidth,this.Sr.Nt=a.baseLineStyle)}}class pS extends Ps{constructor(){super(...arguments),this.zt=null}J(e){this.zt=e}$e(){return this.zt}K({context:e,horizontalPixelRatio:s,verticalPixelRatio:a}){const c=this.zt;if(c===null)return;const h=Math.max(1,Math.floor(s)),d=h%2/2,g=Math.round(c.Xe.x*s)+d,p=c.Xe.y*a;e.fillStyle=c.Tr,e.beginPath();const v=Math.max(2,1.5*c.Pr)*s;e.arc(g,p,v,0,2*Math.PI,!1),e.fill(),e.fillStyle=c.Rr,e.beginPath(),e.arc(g,p,c.ht*s,0,2*Math.PI,!1),e.fill(),e.lineWidth=h,e.strokeStyle=c.Dr,e.beginPath(),e.arc(g,p,c.ht*s+h/2,0,2*Math.PI,!1),e.stroke()}}const gS=[{Vr:0,Or:.25,Br:4,Ar:10,Ir:.25,zr:0,Lr:.4,Er:.8},{Vr:.25,Or:.525,Br:10,Ar:14,Ir:0,zr:0,Lr:.8,Er:0},{Vr:.525,Or:1,Br:14,Ar:14,Ir:0,zr:0,Lr:0,Er:0}];function hv(i,e,s,a){return(function(c,h){if(c==="transparent")return c;const d=ql(c),g=d[3];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${h*g})`})(i,s+(a-s)*e)}function dv(i,e){const s=i%2600/2600;let a;for(const p of gS)if(s>=p.Vr&&s<=p.Or){a=p;break}ai(a!==void 0,"Last price animation internal logic error");const c=(s-a.Vr)/(a.Or-a.Vr);return{Rr:hv(e,c,a.Ir,a.zr),Dr:hv(e,c,a.Lr,a.Er),ht:(h=c,d=a.Br,g=a.Ar,d+(g-d)*h)};var h,d,g}class vS{constructor(e){this.Wt=new pS,this.ft=!0,this.Nr=!0,this.Fr=performance.now(),this.Wr=this.Fr-1,this.jr=e}Hr(){this.Wr=this.Fr-1,this.bt()}$r(){if(this.bt(),this.jr.W().lastPriceAnimation===2){const e=performance.now(),s=this.Wr-e;if(s>0)return void(s<650&&(this.Wr+=2600));this.Fr=e,this.Wr=e+2600}}bt(){this.ft=!0}Ur(){this.Nr=!0}yt(){return this.jr.W().lastPriceAnimation!==0}qr(){switch(this.jr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Wr}}gt(){return this.ft?(this.Mt(),this.ft=!1,this.Nr=!1):this.Nr&&(this.Yr(),this.Nr=!1),this.Wt}Mt(){this.Wt.J(null);const e=this.jr.$t().St(),s=e.Xs(),a=this.jr.Ct();if(s===null||a===null)return;const c=this.jr.Zr(!0);if(c.Xr||!s.Kr(c.ee))return;const h={x:e.It(c.ee),y:this.jr.Dt().Rt(c._t,a.Vt)},d=c.V,g=this.jr.W().lineWidth,p=dv(this.Gr(),d);this.Wt.J({Tr:d,Pr:g,Rr:p.Rr,Dr:p.Dr,ht:p.ht,Xe:h})}Yr(){const e=this.Wt.$e();if(e!==null){const s=dv(this.Gr(),e.Tr);e.Rr=s.Rr,e.Dr=s.Dr,e.ht=s.ht}}Gr(){return this.qr()?performance.now()-this.Fr:2599}}function Pl(i,e){return Yy(Math.min(Math.max(i,12),30)*e)}function Yl(i,e){switch(i){case"arrowDown":case"arrowUp":return Pl(e,1);case"circle":return Pl(e,.8);case"square":return Pl(e,.7)}}function s0(i){return(function(e){const s=Math.ceil(e);return s%2!=0?s-1:s})(Pl(i,1))}function fv(i){return Math.max(Pl(i,.1),3)}function mv(i,e,s){return e?i:s?Math.ceil(i/2):0}function n0(i,e,s,a,c){const h=Yl("square",s),d=(h-1)/2,g=i-d,p=e-d;return a>=g&&a<=g+h&&c>=p&&c<=p+h}function pv(i,e,s,a){const c=(Yl("arrowUp",a)-1)/2*s.Jr,h=(Yy(a/2)-1)/2*s.Jr;e.beginPath(),i?(e.moveTo(s.nt-c,s.st),e.lineTo(s.nt,s.st-c),e.lineTo(s.nt+c,s.st),e.lineTo(s.nt+h,s.st),e.lineTo(s.nt+h,s.st+c),e.lineTo(s.nt-h,s.st+c),e.lineTo(s.nt-h,s.st)):(e.moveTo(s.nt-c,s.st),e.lineTo(s.nt,s.st+c),e.lineTo(s.nt+c,s.st),e.lineTo(s.nt+h,s.st),e.lineTo(s.nt+h,s.st-c),e.lineTo(s.nt-h,s.st-c),e.lineTo(s.nt-h,s.st)),e.fill()}function yS(i,e,s,a,c,h){return n0(e,s,a,c,h)}class bS extends Ps{constructor(){super(...arguments),this.zt=null,this.ar=new Gl,this.j=-1,this.H="",this.Qr=""}J(e){this.zt=e}_r(e,s){this.j===e&&this.H===s||(this.j=e,this.H=s,this.Qr=La(e,s),this.ar.nr())}wr(e,s){if(this.zt===null||this.zt.tt===null)return null;for(let a=this.zt.tt.from;a<this.zt.tt.to;a++){const c=this.zt.it[a];if(wS(c,e,s))return{Mr:c.th,gr:c.gr}}return null}K({context:e,horizontalPixelRatio:s,verticalPixelRatio:a},c,h){if(this.zt!==null&&this.zt.tt!==null){e.textBaseline="middle",e.font=this.Qr;for(let d=this.zt.tt.from;d<this.zt.tt.to;d++){const g=this.zt.it[d];g.Kt!==void 0&&(g.Kt.Hi=this.ar.xi(e,g.Kt.ih),g.Kt.At=this.j,g.Kt.nt=g.nt-g.Kt.Hi/2),xS(g,e,s,a)}}}}function xS(i,e,s,a){e.fillStyle=i.V,i.Kt!==void 0&&(function(c,h,d,g,p,v){c.save(),c.scale(p,v),c.fillText(h,d,g),c.restore()})(e,i.Kt.ih,i.Kt.nt,i.Kt.st,s,a),(function(c,h,d){if(c.Ks!==0){switch(c.nh){case"arrowDown":return void pv(!1,h,d,c.Ks);case"arrowUp":return void pv(!0,h,d,c.Ks);case"circle":return void(function(g,p,v){const x=(Yl("circle",v)-1)/2;g.beginPath(),g.arc(p.nt,p.st,x*p.Jr,0,2*Math.PI,!1),g.fill()})(h,d,c.Ks);case"square":return void(function(g,p,v){const x=Yl("square",v),y=(x-1)*p.Jr/2,b=p.nt-y,S=p.st-y;g.fillRect(b,S,x*p.Jr,x*p.Jr)})(h,d,c.Ks)}c.nh}})(i,e,(function(c,h,d){const g=Math.max(1,Math.floor(h))%2/2;return{nt:Math.round(c.nt*h)+g,st:c.st*d,Jr:h}})(i,s,a))}function wS(i,e,s){return!(i.Kt===void 0||!(function(a,c,h,d,g,p){const v=d/2;return g>=a&&g<=a+h&&p>=c-v&&p<=c+v})(i.Kt.nt,i.Kt.st,i.Kt.Hi,i.Kt.At,e,s))||(function(a,c,h){if(a.Ks===0)return!1;switch(a.nh){case"arrowDown":case"arrowUp":return yS(0,a.nt,a.st,a.Ks,c,h);case"circle":return(function(d,g,p,v,x){const y=2+Yl("circle",p)/2,b=d-v,S=g-x;return Math.sqrt(b*b+S*S)<=y})(a.nt,a.st,a.Ks,c,h);case"square":return n0(a.nt,a.st,a.Ks,c,h)}})(i,e,s)}function SS(i,e,s,a,c,h,d,g,p){const v=Gs(s)?s:s.Se,x=Gs(s)?s:s.Me,y=Gs(s)?s:s.xe,b=Gs(e.size)?Math.max(e.size,0):1,S=s0(g.le())*b,N=S/2;switch(i.Ks=S,e.position){case"inBar":return i.st=d.Rt(v,p),void(i.Kt!==void 0&&(i.Kt.st=i.st+N+h+.6*c));case"aboveBar":return i.st=d.Rt(x,p)-N-a.sh,i.Kt!==void 0&&(i.Kt.st=i.st-N-.6*c,a.sh+=1.2*c),void(a.sh+=S+h);case"belowBar":return i.st=d.Rt(y,p)+N+a.eh,i.Kt!==void 0&&(i.Kt.st=i.st+N+h+.6*c,a.eh+=1.2*c),void(a.eh+=S+h)}e.position}class _S{constructor(e,s){this.ft=!0,this.rh=!0,this.hh=!0,this.ah=null,this.oh=null,this.Wt=new bS,this.jr=e,this.$i=s,this.zt={it:[],tt:null}}bt(e){this.ft=!0,this.hh=!0,e==="data"&&(this.rh=!0,this.oh=null)}gt(e){if(!this.jr.yt())return null;this.ft&&this._h();const s=this.$i.W().layout;return this.Wt._r(s.fontSize,s.fontFamily),this.Wt.J(this.zt),this.Wt}uh(){if(this.hh){if(this.jr.dh().length>0){const e=this.$i.St().le(),s=fv(e),a=1.5*s0(e)+2*s,c=this.fh();this.ah={above:mv(a,c.aboveBar,c.inBar),below:mv(a,c.belowBar,c.inBar)}}else this.ah=null;this.hh=!1}return this.ah}fh(){return this.oh===null&&(this.oh=this.jr.dh().reduce(((e,s)=>(e[s.position]||(e[s.position]=!0),e)),{inBar:!1,aboveBar:!1,belowBar:!1})),this.oh}_h(){const e=this.jr.Dt(),s=this.$i.St(),a=this.jr.dh();this.rh&&(this.zt.it=a.map((x=>({ot:x.time,nt:0,st:0,Ks:0,nh:x.shape,V:x.color,th:x.th,gr:x.id,Kt:void 0}))),this.rh=!1);const c=this.$i.W().layout;this.zt.tt=null;const h=s.Xs();if(h===null)return;const d=this.jr.Ct();if(d===null||this.zt.it.length===0)return;let g=NaN;const p=fv(s.le()),v={sh:p,eh:p};this.zt.tt=Zy(this.zt.it,h,!0);for(let x=this.zt.tt.from;x<this.zt.tt.to;x++){const y=a[x];y.time!==g&&(v.sh=p,v.eh=p,g=y.time);const b=this.zt.it[x];b.nt=s.It(y.time),y.text!==void 0&&y.text.length>0&&(b.Kt={ih:y.text,nt:0,st:0,Hi:0,At:0});const S=this.jr.ph(y.time);S!==null&&SS(b,y,S,v,c.fontSize,p,e,s,d.Vt)}this.ft=!1}}class jS extends Md{constructor(e){super(e)}yr(){const e=this.Sr;e.yt=!1;const s=this.Es.W();if(!s.priceLineVisible||!this.Es.yt())return;const a=this.Es.Zr(s.priceLineSource===0);a.Xr||(e.yt=!0,e.st=a.ki,e.V=this.Es.mh(a.V),e.et=s.priceLineWidth,e.Nt=s.priceLineStyle)}}class NS extends ic{constructor(e){super(),this.jt=e}zi(e,s,a){e.yt=!1,s.yt=!1;const c=this.jt;if(!c.yt())return;const h=c.W(),d=h.lastValueVisible,g=c.bh()!=="",p=h.seriesLastValueMode===0,v=c.Zr(!1);if(v.Xr)return;d&&(e.Kt=this.wh(v,d,p),e.yt=e.Kt.length!==0),(g||p)&&(s.Kt=this.gh(v,d,g,p),s.yt=s.Kt.length>0);const x=c.mh(v.V),y=sc(x);a.t=y.t,a.ki=v.ki,s.Ot=c.$t().Bt(v.ki/c.Dt().At()),e.Ot=x,e.V=y.i,s.V=y.i}gh(e,s,a,c){let h="";const d=this.jt.bh();return a&&d.length!==0&&(h+=`${d} `),s&&c&&(h+=this.jt.Dt().Mh()?e.xh:e.Sh),h.trim()}wh(e,s,a){return s?a?this.jt.Dt().Mh()?e.Sh:e.xh:e.Kt:""}}function gv(i,e,s,a){const c=Number.isFinite(e),h=Number.isFinite(s);return c&&h?i(e,s):c||h?c?e:s:a}class as{constructor(e,s){this.kh=e,this.yh=s}Ch(e){return e!==null&&this.kh===e.kh&&this.yh===e.yh}Th(){return new as(this.kh,this.yh)}Ph(){return this.kh}Rh(){return this.yh}Dh(){return this.yh-this.kh}Ni(){return this.yh===this.kh||Number.isNaN(this.yh)||Number.isNaN(this.kh)}ts(e){return e===null?this:new as(gv(Math.min,this.Ph(),e.Ph(),-1/0),gv(Math.max,this.Rh(),e.Rh(),1/0))}Vh(e){if(!Gs(e)||this.yh-this.kh===0)return;const s=.5*(this.yh+this.kh);let a=this.yh-s,c=this.kh-s;a*=e,c*=e,this.yh=s+a,this.kh=s+c}Oh(e){Gs(e)&&(this.yh+=e,this.kh+=e)}Bh(){return{minValue:this.kh,maxValue:this.yh}}static Ah(e){return e===null?null:new as(e.minValue,e.maxValue)}}class qo{constructor(e,s){this.Ih=e,this.zh=s||null}Lh(){return this.Ih}Eh(){return this.zh}Bh(){return this.Ih===null?null:{priceRange:this.Ih.Bh(),margins:this.zh||void 0}}static Ah(e){return e===null?null:new qo(as.Ah(e.priceRange),e.margins)}}class ES extends Md{constructor(e,s){super(e),this.Nh=s}yr(){const e=this.Sr;e.yt=!1;const s=this.Nh.W();if(!this.Es.yt()||!s.lineVisible)return;const a=this.Nh.Fh();a!==null&&(e.yt=!0,e.st=a,e.V=s.color,e.et=s.lineWidth,e.Nt=s.lineStyle,e.gr=this.Nh.W().id)}}class TS extends ic{constructor(e,s){super(),this.jr=e,this.Nh=s}zi(e,s,a){e.yt=!1,s.yt=!1;const c=this.Nh.W(),h=c.axisLabelVisible,d=c.title!=="",g=this.jr;if(!h||!g.yt())return;const p=this.Nh.Fh();if(p===null)return;d&&(s.Kt=c.title,s.yt=!0),s.Ot=g.$t().Bt(p/g.Dt().At()),e.Kt=this.Wh(c.price),e.yt=!0;const v=sc(c.axisLabelColor||c.color);a.t=v.t;const x=c.axisLabelTextColor||v.i;e.V=x,s.V=x,a.ki=p}Wh(e){const s=this.jr.Ct();return s===null?"":this.jr.Dt().Fi(e,s.Vt)}}class kS{constructor(e,s){this.jr=e,this.cn=s,this.jh=new ES(e,this),this.ur=new TS(e,this),this.Hh=new t0(this.ur,e,e.$t())}$h(e){Is(this.cn,e),this.bt(),this.jr.$t().Uh()}W(){return this.cn}qh(){return this.jh}Yh(){return this.Hh}Zh(){return this.ur}bt(){this.jh.bt(),this.ur.bt()}Fh(){const e=this.jr,s=e.Dt();if(e.$t().St().Ni()||s.Ni())return null;const a=e.Ct();return a===null?null:s.Rt(this.cn.price,a.Vt)}}class CS extends Td{constructor(e){super(),this.$i=e}$t(){return this.$i}}const MS={Bar:(i,e,s,a)=>{var c;const h=e.upColor,d=e.downColor,g=be(i(s,a)),p=Ea(g.Vt[0])<=Ea(g.Vt[3]);return{ce:(c=g.V)!==null&&c!==void 0?c:p?h:d}},Candlestick:(i,e,s,a)=>{var c,h,d;const g=e.upColor,p=e.downColor,v=e.borderUpColor,x=e.borderDownColor,y=e.wickUpColor,b=e.wickDownColor,S=be(i(s,a)),N=Ea(S.Vt[0])<=Ea(S.Vt[3]);return{ce:(c=S.V)!==null&&c!==void 0?c:N?g:p,Ne:(h=S.Ot)!==null&&h!==void 0?h:N?v:x,Ee:(d=S.Xh)!==null&&d!==void 0?d:N?y:b}},Custom:(i,e,s,a)=>{var c;return{ce:(c=be(i(s,a)).V)!==null&&c!==void 0?c:e.color}},Area:(i,e,s,a)=>{var c,h,d,g;const p=be(i(s,a));return{ce:(c=p.lt)!==null&&c!==void 0?c:e.lineColor,lt:(h=p.lt)!==null&&h!==void 0?h:e.lineColor,Ps:(d=p.Ps)!==null&&d!==void 0?d:e.topColor,Rs:(g=p.Rs)!==null&&g!==void 0?g:e.bottomColor}},Baseline:(i,e,s,a)=>{var c,h,d,g,p,v;const x=be(i(s,a));return{ce:x.Vt[3]>=e.baseValue.price?e.topLineColor:e.bottomLineColor,Re:(c=x.Re)!==null&&c!==void 0?c:e.topLineColor,De:(h=x.De)!==null&&h!==void 0?h:e.bottomLineColor,ke:(d=x.ke)!==null&&d!==void 0?d:e.topFillColor1,ye:(g=x.ye)!==null&&g!==void 0?g:e.topFillColor2,Ce:(p=x.Ce)!==null&&p!==void 0?p:e.bottomFillColor1,Te:(v=x.Te)!==null&&v!==void 0?v:e.bottomFillColor2}},Line:(i,e,s,a)=>{var c,h;const d=be(i(s,a));return{ce:(c=d.V)!==null&&c!==void 0?c:e.color,lt:(h=d.V)!==null&&h!==void 0?h:e.color}},Histogram:(i,e,s,a)=>{var c;return{ce:(c=be(i(s,a)).V)!==null&&c!==void 0?c:e.color}}};class DS{constructor(e){this.Kh=(s,a)=>a!==void 0?a.Vt:this.jr.In().Gh(s),this.jr=e,this.Jh=MS[e.Qh()]}$s(e,s){return this.Jh(this.Kh,this.jr.W(),e,s)}}var vv;(function(i){i[i.NearestLeft=-1]="NearestLeft",i[i.None=0]="None",i[i.NearestRight=1]="NearestRight"})(vv||(vv={}));const Jn=30;class RS{constructor(){this.tl=[],this.il=new Map,this.nl=new Map}sl(){return this.Ks()>0?this.tl[this.tl.length-1]:null}el(){return this.Ks()>0?this.rl(0):null}An(){return this.Ks()>0?this.rl(this.tl.length-1):null}Ks(){return this.tl.length}Ni(){return this.Ks()===0}Kr(e){return this.hl(e,0)!==null}Gh(e){return this.ll(e)}ll(e,s=0){const a=this.hl(e,s);return a===null?null:Object.assign(Object.assign({},this.al(a)),{ee:this.rl(a)})}ne(){return this.tl}ol(e,s,a){if(this.Ni())return null;let c=null;for(const h of a)c=To(c,this._l(e,s,h));return c}J(e){this.nl.clear(),this.il.clear(),this.tl=e}rl(e){return this.tl[e].ee}al(e){return this.tl[e]}hl(e,s){const a=this.ul(e);if(a===null&&s!==0)switch(s){case-1:return this.cl(e);case 1:return this.dl(e);default:throw new TypeError("Unknown search mode")}return a}cl(e){let s=this.fl(e);return s>0&&(s-=1),s!==this.tl.length&&this.rl(s)<e?s:null}dl(e){const s=this.vl(e);return s!==this.tl.length&&e<this.rl(s)?s:null}ul(e){const s=this.fl(e);return s===this.tl.length||e<this.tl[s].ee?null:s}fl(e){return tr(this.tl,e,((s,a)=>s.ee<a))}vl(e){return Qy(this.tl,e,((s,a)=>s.ee>a))}pl(e,s,a){let c=null;for(let h=e;h<s;h++){const d=this.tl[h].Vt[a];Number.isNaN(d)||(c===null?c={ml:d,bl:d}:(d<c.ml&&(c.ml=d),d>c.bl&&(c.bl=d)))}return c}_l(e,s,a){if(this.Ni())return null;let c=null;const h=be(this.el()),d=be(this.An()),g=Math.max(e,h),p=Math.min(s,d),v=Math.ceil(g/Jn)*Jn,x=Math.max(v,Math.floor(p/Jn)*Jn);{const b=this.fl(g),S=this.vl(Math.min(p,v,s));c=To(c,this.pl(b,S,a))}let y=this.il.get(a);y===void 0&&(y=new Map,this.il.set(a,y));for(let b=Math.max(v+1,g);b<x;b+=Jn){const S=Math.floor(b/Jn);let N=y.get(S);if(N===void 0){const E=this.fl(S*Jn),R=this.vl((S+1)*Jn-1);N=this.pl(E,R,a),y.set(S,N)}c=To(c,N)}{const b=this.fl(x),S=this.vl(p);c=To(c,this.pl(b,S,a))}return c}}function To(i,e){return i===null?e:e===null?i:{ml:Math.min(i.ml,e.ml),bl:Math.max(i.bl,e.bl)}}class AS{constructor(e){this.wl=e}X(e,s,a){this.wl.draw(e)}gl(e,s,a){var c,h;(h=(c=this.wl).drawBackground)===null||h===void 0||h.call(c,e)}}class kh{constructor(e){this.tr=null,this.wn=e}gt(){var e;const s=this.wn.renderer();if(s===null)return null;if(((e=this.tr)===null||e===void 0?void 0:e.Ml)===s)return this.tr.xl;const a=new AS(s);return this.tr={Ml:s,xl:a},a}Sl(){var e,s,a;return(a=(s=(e=this.wn).zOrder)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:"normal"}}function i0(i){var e,s,a,c,h;return{Kt:i.text(),ki:i.coordinate(),Si:(e=i.fixedCoordinate)===null||e===void 0?void 0:e.call(i),V:i.textColor(),t:i.backColor(),yt:(a=(s=i.visible)===null||s===void 0?void 0:s.call(i))===null||a===void 0||a,hi:(h=(c=i.tickVisible)===null||c===void 0?void 0:c.call(i))===null||h===void 0||h}}class LS{constructor(e,s){this.Wt=new qy,this.kl=e,this.yl=s}gt(){return this.Wt.J(Object.assign({Hi:this.yl.Hi()},i0(this.kl))),this.Wt}}class OS extends ic{constructor(e,s){super(),this.kl=e,this.Li=s}zi(e,s,a){const c=i0(this.kl);a.t=c.t,e.V=c.V;const h=2/12*this.Li.P();a.wi=h,a.gi=h,a.ki=c.ki,a.Si=c.Si,e.Kt=c.Kt,e.yt=c.yt,e.hi=c.hi}}class zS{constructor(e,s){this.Cl=null,this.Tl=null,this.Pl=null,this.Rl=null,this.Dl=null,this.Vl=e,this.jr=s}Ol(){return this.Vl}Vn(){var e,s;(s=(e=this.Vl).updateAllViews)===null||s===void 0||s.call(e)}Pn(){var e,s,a,c;const h=(a=(s=(e=this.Vl).paneViews)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:[];if(((c=this.Cl)===null||c===void 0?void 0:c.Ml)===h)return this.Cl.xl;const d=h.map((g=>new kh(g)));return this.Cl={Ml:h,xl:d},d}Qi(){var e,s,a,c;const h=(a=(s=(e=this.Vl).timeAxisViews)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:[];if(((c=this.Tl)===null||c===void 0?void 0:c.Ml)===h)return this.Tl.xl;const d=this.jr.$t().St(),g=h.map((p=>new LS(p,d)));return this.Tl={Ml:h,xl:g},g}Rn(){var e,s,a,c;const h=(a=(s=(e=this.Vl).priceAxisViews)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:[];if(((c=this.Pl)===null||c===void 0?void 0:c.Ml)===h)return this.Pl.xl;const d=this.jr.Dt(),g=h.map((p=>new OS(p,d)));return this.Pl={Ml:h,xl:g},g}Bl(){var e,s,a,c;const h=(a=(s=(e=this.Vl).priceAxisPaneViews)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:[];if(((c=this.Rl)===null||c===void 0?void 0:c.Ml)===h)return this.Rl.xl;const d=h.map((g=>new kh(g)));return this.Rl={Ml:h,xl:d},d}Al(){var e,s,a,c;const h=(a=(s=(e=this.Vl).timeAxisPaneViews)===null||s===void 0?void 0:s.call(e))!==null&&a!==void 0?a:[];if(((c=this.Dl)===null||c===void 0?void 0:c.Ml)===h)return this.Dl.xl;const d=h.map((g=>new kh(g)));return this.Dl={Ml:h,xl:d},d}Il(e,s){var a,c,h;return(h=(c=(a=this.Vl).autoscaleInfo)===null||c===void 0?void 0:c.call(a,e,s))!==null&&h!==void 0?h:null}wr(e,s){var a,c,h;return(h=(c=(a=this.Vl).hitTest)===null||c===void 0?void 0:c.call(a,e,s))!==null&&h!==void 0?h:null}}function Ch(i,e,s,a){i.forEach((c=>{e(c).forEach((h=>{h.Sl()===s&&a.push(h)}))}))}function Mh(i){return i.Pn()}function IS(i){return i.Bl()}function PS(i){return i.Al()}class Dd extends CS{constructor(e,s,a,c,h){super(e),this.zt=new RS,this.jh=new jS(this),this.zl=[],this.Ll=new mS(this),this.El=null,this.Nl=null,this.Fl=[],this.Wl=[],this.jl=null,this.Hl=[],this.cn=s,this.$l=a;const d=new NS(this);this.rn=[d],this.Hh=new t0(d,this,e),a!=="Area"&&a!=="Line"&&a!=="Baseline"||(this.El=new vS(this)),this.Ul(),this.ql(h)}S(){this.jl!==null&&clearTimeout(this.jl)}mh(e){return this.cn.priceLineColor||e}Zr(e){const s={Xr:!0},a=this.Dt();if(this.$t().St().Ni()||a.Ni()||this.zt.Ni())return s;const c=this.$t().St().Xs(),h=this.Ct();if(c===null||h===null)return s;let d,g;if(e){const y=this.zt.sl();if(y===null)return s;d=y,g=y.ee}else{const y=this.zt.ll(c.ui(),-1);if(y===null||(d=this.zt.Gh(y.ee),d===null))return s;g=y.ee}const p=d.Vt[3],v=this.Us().$s(g,{Vt:d}),x=a.Rt(p,h.Vt);return{Xr:!1,_t:p,Kt:a.Fi(p,h.Vt),xh:a.Yl(p),Sh:a.Zl(p,h.Vt),V:v.ce,ki:x,ee:g}}Us(){return this.Nl!==null||(this.Nl=new DS(this)),this.Nl}W(){return this.cn}$h(e){const s=e.priceScaleId;s!==void 0&&s!==this.cn.priceScaleId&&this.$t().Xl(this,s),Is(this.cn,e),e.priceFormat!==void 0&&(this.Ul(),this.$t().Kl()),this.$t().Gl(this),this.$t().Jl(),this.wn.bt("options")}J(e,s){this.zt.J(e),this.Ql(),this.wn.bt("data"),this.dn.bt("data"),this.El!==null&&(s&&s.ta?this.El.$r():e.length===0&&this.El.Hr());const a=this.$t().dr(this);this.$t().ia(a),this.$t().Gl(this),this.$t().Jl(),this.$t().Uh()}na(e){this.Fl=e,this.Ql();const s=this.$t().dr(this);this.dn.bt("data"),this.$t().ia(s),this.$t().Gl(this),this.$t().Jl(),this.$t().Uh()}sa(){return this.Fl}dh(){return this.Wl}ea(e){const s=new kS(this,e);return this.zl.push(s),this.$t().Gl(this),s}ra(e){const s=this.zl.indexOf(e);s!==-1&&this.zl.splice(s,1),this.$t().Gl(this)}Qh(){return this.$l}Ct(){const e=this.ha();return e===null?null:{Vt:e.Vt[3],la:e.ot}}ha(){const e=this.$t().St().Xs();if(e===null)return null;const s=e.Os();return this.zt.ll(s,1)}In(){return this.zt}ph(e){const s=this.zt.Gh(e);return s===null?null:this.$l==="Bar"||this.$l==="Candlestick"||this.$l==="Custom"?{ge:s.Vt[0],Me:s.Vt[1],xe:s.Vt[2],Se:s.Vt[3]}:s.Vt[3]}aa(e){const s=[];Ch(this.Hl,Mh,"top",s);const a=this.El;return a!==null&&a.yt()&&(this.jl===null&&a.qr()&&(this.jl=setTimeout((()=>{this.jl=null,this.$t().oa()}),0)),a.Ur(),s.unshift(a)),s}Pn(){const e=[];this._a()||e.push(this.Ll),e.push(this.wn,this.jh,this.dn);const s=this.zl.map((a=>a.qh()));return e.push(...s),Ch(this.Hl,Mh,"normal",e),e}ua(){return this.ca(Mh,"bottom")}da(e){return this.ca(IS,e)}fa(e){return this.ca(PS,e)}va(e,s){return this.Hl.map((a=>a.wr(e,s))).filter((a=>a!==null))}Ji(e){return[this.Hh,...this.zl.map((s=>s.Yh()))]}Rn(e,s){if(s!==this.Yi&&!this._a())return[];const a=[...this.rn];for(const c of this.zl)a.push(c.Zh());return this.Hl.forEach((c=>{a.push(...c.Rn())})),a}Qi(){const e=[];return this.Hl.forEach((s=>{e.push(...s.Qi())})),e}Il(e,s){if(this.cn.autoscaleInfoProvider!==void 0){const a=this.cn.autoscaleInfoProvider((()=>{const c=this.pa(e,s);return c===null?null:c.Bh()}));return qo.Ah(a)}return this.pa(e,s)}ma(){return this.cn.priceFormat.minMove}ba(){return this.wa}Vn(){var e;this.wn.bt(),this.dn.bt();for(const s of this.rn)s.bt();for(const s of this.zl)s.bt();this.jh.bt(),this.Ll.bt(),(e=this.El)===null||e===void 0||e.bt(),this.Hl.forEach((s=>s.Vn()))}Dt(){return be(super.Dt())}kt(e){if(!((this.$l==="Line"||this.$l==="Area"||this.$l==="Baseline")&&this.cn.crosshairMarkerVisible))return null;const s=this.zt.Gh(e);return s===null?null:{_t:s.Vt[3],ht:this.ga(),Ot:this.Ma(),Pt:this.xa(),Tt:this.Sa(e)}}bh(){return this.cn.title}yt(){return this.cn.visible}ka(e){this.Hl.push(new zS(e,this))}ya(e){this.Hl=this.Hl.filter((s=>s.Ol()!==e))}Ca(){if(this.wn instanceof Th)return e=>this.wn.We(e)}Ta(){if(this.wn instanceof Th)return e=>this.wn.je(e)}_a(){return!ac(this.Dt().Pa())}pa(e,s){if(!Fl(e)||!Fl(s)||this.zt.Ni())return null;const a=this.$l==="Line"||this.$l==="Area"||this.$l==="Baseline"||this.$l==="Histogram"?[3]:[2,1],c=this.zt.ol(e,s,a);let h=c!==null?new as(c.ml,c.bl):null;if(this.Qh()==="Histogram"){const g=this.cn.base,p=new as(g,g);h=h!==null?h.ts(p):p}let d=this.dn.uh();return this.Hl.forEach((g=>{const p=g.Il(e,s);if(p?.priceRange){const S=new as(p.priceRange.minValue,p.priceRange.maxValue);h=h!==null?h.ts(S):S}var v,x,y,b;p?.margins&&(v=d,x=p.margins,d={above:Math.max((y=v?.above)!==null&&y!==void 0?y:0,x.above),below:Math.max((b=v?.below)!==null&&b!==void 0?b:0,x.below)})})),new qo(h,d)}ga(){switch(this.$l){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}Ma(){switch(this.$l){case"Line":case"Area":case"Baseline":{const e=this.cn.crosshairMarkerBorderColor;if(e.length!==0)return e}}return null}xa(){switch(this.$l){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}Sa(e){switch(this.$l){case"Line":case"Area":case"Baseline":{const s=this.cn.crosshairMarkerBackgroundColor;if(s.length!==0)return s}}return this.Us().$s(e).ce}Ul(){switch(this.cn.priceFormat.type){case"custom":this.wa={format:this.cn.priceFormat.formatter};break;case"volume":this.wa=new Fw(this.cn.priceFormat.precision);break;case"percent":this.wa=new Fy(this.cn.priceFormat.precision);break;default:{const e=Math.pow(10,this.cn.priceFormat.precision);this.wa=new lc(e,this.cn.priceFormat.minMove*e)}}this.Yi!==null&&this.Yi.Ra()}Ql(){const e=this.$t().St();if(!e.Da()||this.zt.Ni())return void(this.Wl=[]);const s=be(this.zt.el());this.Wl=this.Fl.map(((a,c)=>{const h=be(e.Va(a.time,!0)),d=h<s?1:-1;return{time:be(this.zt.ll(h,d)).ee,position:a.position,shape:a.shape,color:a.color,id:a.id,th:c,text:a.text,size:a.size,originalTime:a.originalTime}}))}ql(e){switch(this.dn=new _S(this,this.$t()),this.$l){case"Bar":this.wn=new eS(this,this.$t());break;case"Candlestick":this.wn=new aS(this,this.$t());break;case"Line":this.wn=new uS(this,this.$t());break;case"Custom":this.wn=new Th(this,this.$t(),Jt(e));break;case"Area":this.wn=new Qw(this,this.$t());break;case"Baseline":this.wn=new nS(this,this.$t());break;case"Histogram":this.wn=new cS(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.$l)}}ca(e,s){const a=[];return Ch(this.Hl,e,s,a),a}}class BS{constructor(e){this.cn=e}Oa(e,s,a){let c=e;if(this.cn.mode===0)return c;const h=a.vn(),d=h.Ct();if(d===null)return c;const g=h.Rt(e,d),p=a.Ba().filter((x=>x instanceof Dd)).reduce(((x,y)=>{if(a.vr(y)||!y.yt())return x;const b=y.Dt(),S=y.In();if(b.Ni()||!S.Kr(s))return x;const N=S.Gh(s);if(N===null)return x;const E=Ea(y.Ct());return x.concat([b.Rt(N.Vt[3],E.Vt)])}),[]);if(p.length===0)return c;p.sort(((x,y)=>Math.abs(x-g)-Math.abs(y-g)));const v=p[0];return c=h.pn(v,d),c}}class $S extends Ps{constructor(){super(...arguments),this.zt=null}J(e){this.zt=e}K({context:e,bitmapSize:s,horizontalPixelRatio:a,verticalPixelRatio:c}){if(this.zt===null)return;const h=Math.max(1,Math.floor(a));e.lineWidth=h,(function(d,g){d.save(),d.lineWidth%2&&d.translate(.5,.5),g(),d.restore()})(e,(()=>{const d=be(this.zt);if(d.Aa){e.strokeStyle=d.Ia,Ai(e,d.za),e.beginPath();for(const g of d.La){const p=Math.round(g.Ea*a);e.moveTo(p,-h),e.lineTo(p,s.height+h)}e.stroke()}if(d.Na){e.strokeStyle=d.Fa,Ai(e,d.Wa),e.beginPath();for(const g of d.ja){const p=Math.round(g.Ea*c);e.moveTo(-h,p),e.lineTo(s.width+h,p)}e.stroke()}}))}}class US{constructor(e){this.Wt=new $S,this.ft=!0,this.tn=e}bt(){this.ft=!0}gt(){if(this.ft){const e=this.tn.$t().W().grid,s={Na:e.horzLines.visible,Aa:e.vertLines.visible,Fa:e.horzLines.color,Ia:e.vertLines.color,Wa:e.horzLines.style,za:e.vertLines.style,ja:this.tn.vn().Ha(),La:(this.tn.$t().St().Ha()||[]).map((a=>({Ea:a.coord})))};this.Wt.J(s),this.ft=!1}return this.Wt}}class VS{constructor(e){this.wn=new US(e)}qh(){return this.wn}}const Dh={$a:4,Ua:1e-4};function Ta(i,e){const s=100*(i-e)/e;return e<0?-s:s}function HS(i,e){const s=Ta(i.Ph(),e),a=Ta(i.Rh(),e);return new as(s,a)}function Bl(i,e){const s=100*(i-e)/e+100;return e<0?-s:s}function qS(i,e){const s=Bl(i.Ph(),e),a=Bl(i.Rh(),e);return new as(s,a)}function Fo(i,e){const s=Math.abs(i);if(s<1e-15)return 0;const a=Math.log10(s+e.Ua)+e.$a;return i<0?-a:a}function $l(i,e){const s=Math.abs(i);if(s<1e-15)return 0;const a=Math.pow(10,s-e.$a)-e.Ua;return i<0?-a:a}function Ol(i,e){if(i===null)return null;const s=Fo(i.Ph(),e),a=Fo(i.Rh(),e);return new as(s,a)}function ko(i,e){if(i===null)return null;const s=$l(i.Ph(),e),a=$l(i.Rh(),e);return new as(s,a)}function Rh(i){if(i===null)return Dh;const e=Math.abs(i.Rh()-i.Ph());if(e>=1||e<1e-15)return Dh;const s=Math.ceil(Math.abs(Math.log10(e))),a=Dh.$a+s;return{$a:a,Ua:1/Math.pow(10,a)}}class Ah{constructor(e,s){if(this.qa=e,this.Ya=s,(function(a){if(a<0)return!1;for(let c=a;c>1;c/=10)if(c%10!=0)return!1;return!0})(this.qa))this.Za=[2,2.5,2];else{this.Za=[];for(let a=this.qa;a!==1;){if(a%2==0)this.Za.push(2),a/=2;else{if(a%5!=0)throw new Error("unexpected base");this.Za.push(2,2.5),a/=5}if(this.Za.length>100)throw new Error("something wrong with base")}}}Xa(e,s,a){const c=this.qa===0?0:1/this.qa;let h=Math.pow(10,Math.max(0,Math.ceil(Math.log10(e-s)))),d=0,g=this.Ya[0];for(;;){const y=Eo(h,c,1e-14)&&h>c+1e-14,b=Eo(h,a*g,1e-14),S=Eo(h,1,1e-14);if(!(y&&b&&S))break;h/=g,g=this.Ya[++d%this.Ya.length]}if(h<=c+1e-14&&(h=c),h=Math.max(1,h),this.Za.length>0&&(p=h,v=1,x=1e-14,Math.abs(p-v)<x))for(d=0,g=this.Za[0];Eo(h,a*g,1e-14)&&h>c+1e-14;)h/=g,g=this.Za[++d%this.Za.length];var p,v,x;return h}}class yv{constructor(e,s,a,c){this.Ka=[],this.Li=e,this.qa=s,this.Ga=a,this.Ja=c}Xa(e,s){if(e<s)throw new Error("high < low");const a=this.Li.At(),c=(e-s)*this.Qa()/a,h=new Ah(this.qa,[2,2.5,2]),d=new Ah(this.qa,[2,2,2.5]),g=new Ah(this.qa,[2.5,2,2]),p=[];return p.push(h.Xa(e,s,c),d.Xa(e,s,c),g.Xa(e,s,c)),(function(v){if(v.length<1)throw Error("array is empty");let x=v[0];for(let y=1;y<v.length;++y)v[y]<x&&(x=v[y]);return x})(p)}io(){const e=this.Li,s=e.Ct();if(s===null)return void(this.Ka=[]);const a=e.At(),c=this.Ga(a-1,s),h=this.Ga(0,s),d=this.Li.W().entireTextOnly?this.no()/2:0,g=d,p=a-1-d,v=Math.max(c,h),x=Math.min(c,h);if(v===x)return void(this.Ka=[]);let y=this.Xa(v,x),b=v%y;b+=b<0?y:0;const S=v>=x?1:-1;let N=null,E=0;for(let R=v-b;R>x;R-=y){const _=this.Ja(R,s,!0);N!==null&&Math.abs(_-N)<this.Qa()||_<g||_>p||(E<this.Ka.length?(this.Ka[E].Ea=_,this.Ka[E].so=e.eo(R)):this.Ka.push({Ea:_,so:e.eo(R)}),E++,N=_,e.ro()&&(y=this.Xa(R*S,x)))}this.Ka.length=E}Ha(){return this.Ka}no(){return this.Li.P()}Qa(){return Math.ceil(2.5*this.no())}}function a0(i){return i.slice().sort(((e,s)=>be(e.Xi())-be(s.Xi())))}var bv;(function(i){i[i.Normal=0]="Normal",i[i.Logarithmic=1]="Logarithmic",i[i.Percentage=2]="Percentage",i[i.IndexedTo100=3]="IndexedTo100"})(bv||(bv={}));const xv=new Fy,wv=new lc(100,1);class FS{constructor(e,s,a,c){this.ho=0,this.lo=null,this.Ih=null,this.ao=null,this.oo={_o:!1,uo:null},this.co=0,this.do=0,this.fo=new kt,this.vo=new kt,this.po=[],this.mo=null,this.bo=null,this.wo=null,this.Mo=null,this.wa=wv,this.xo=Rh(null),this.So=e,this.cn=s,this.ko=a,this.yo=c,this.Co=new yv(this,100,this.To.bind(this),this.Po.bind(this))}Pa(){return this.So}W(){return this.cn}$h(e){if(Is(this.cn,e),this.Ra(),e.mode!==void 0&&this.Ro({Cr:e.mode}),e.scaleMargins!==void 0){const s=Jt(e.scaleMargins.top),a=Jt(e.scaleMargins.bottom);if(s<0||s>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${s}`);if(a<0||a>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${a}`);if(s+a>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${s+a}`);this.Do(),this.bo=null}}Vo(){return this.cn.autoScale}ro(){return this.cn.mode===1}Mh(){return this.cn.mode===2}Oo(){return this.cn.mode===3}Cr(){return{Wn:this.cn.autoScale,Bo:this.cn.invertScale,Cr:this.cn.mode}}Ro(e){const s=this.Cr();let a=null;e.Wn!==void 0&&(this.cn.autoScale=e.Wn),e.Cr!==void 0&&(this.cn.mode=e.Cr,e.Cr!==2&&e.Cr!==3||(this.cn.autoScale=!0),this.oo._o=!1),s.Cr===1&&e.Cr!==s.Cr&&((function(h,d){if(h===null)return!1;const g=$l(h.Ph(),d),p=$l(h.Rh(),d);return isFinite(g)&&isFinite(p)})(this.Ih,this.xo)?(a=ko(this.Ih,this.xo),a!==null&&this.Ao(a)):this.cn.autoScale=!0),e.Cr===1&&e.Cr!==s.Cr&&(a=Ol(this.Ih,this.xo),a!==null&&this.Ao(a));const c=s.Cr!==this.cn.mode;c&&(s.Cr===2||this.Mh())&&this.Ra(),c&&(s.Cr===3||this.Oo())&&this.Ra(),e.Bo!==void 0&&s.Bo!==e.Bo&&(this.cn.invertScale=e.Bo,this.Io()),this.vo.m(s,this.Cr())}zo(){return this.vo}P(){return this.ko.fontSize}At(){return this.ho}Lo(e){this.ho!==e&&(this.ho=e,this.Do(),this.bo=null)}Eo(){if(this.lo)return this.lo;const e=this.At()-this.No()-this.Fo();return this.lo=e,e}Lh(){return this.Wo(),this.Ih}Ao(e,s){const a=this.Ih;(s||a===null&&e!==null||a!==null&&!a.Ch(e))&&(this.bo=null,this.Ih=e)}Ni(){return this.Wo(),this.ho===0||!this.Ih||this.Ih.Ni()}jo(e){return this.Bo()?e:this.At()-1-e}Rt(e,s){return this.Mh()?e=Ta(e,s):this.Oo()&&(e=Bl(e,s)),this.Po(e,s)}te(e,s,a){this.Wo();const c=this.Fo(),h=be(this.Lh()),d=h.Ph(),g=h.Rh(),p=this.Eo()-1,v=this.Bo(),x=p/(g-d),y=a===void 0?0:a.from,b=a===void 0?e.length:a.to,S=this.Ho();for(let N=y;N<b;N++){const E=e[N],R=E._t;if(isNaN(R))continue;let _=R;S!==null&&(_=S(E._t,s));const F=c+x*(_-d),H=v?F:this.ho-1-F;E.st=H}}be(e,s,a){this.Wo();const c=this.Fo(),h=be(this.Lh()),d=h.Ph(),g=h.Rh(),p=this.Eo()-1,v=this.Bo(),x=p/(g-d),y=a===void 0?0:a.from,b=a===void 0?e.length:a.to,S=this.Ho();for(let N=y;N<b;N++){const E=e[N];let R=E.ge,_=E.Me,F=E.xe,H=E.Se;S!==null&&(R=S(E.ge,s),_=S(E.Me,s),F=S(E.xe,s),H=S(E.Se,s));let z=c+x*(R-d),L=v?z:this.ho-1-z;E.pe=L,z=c+x*(_-d),L=v?z:this.ho-1-z,E.de=L,z=c+x*(F-d),L=v?z:this.ho-1-z,E.fe=L,z=c+x*(H-d),L=v?z:this.ho-1-z,E.me=L}}pn(e,s){const a=this.To(e,s);return this.$o(a,s)}$o(e,s){let a=e;return this.Mh()?a=(function(c,h){return h<0&&(c=-c),c/100*h+h})(a,s):this.Oo()&&(a=(function(c,h){return c-=100,h<0&&(c=-c),c/100*h+h})(a,s)),a}Ba(){return this.po}Uo(){if(this.mo)return this.mo;let e=[];for(let s=0;s<this.po.length;s++){const a=this.po[s];a.Xi()===null&&a.Ki(s+1),e.push(a)}return e=a0(e),this.mo=e,this.mo}qo(e){this.po.indexOf(e)===-1&&(this.po.push(e),this.Ra(),this.Yo())}Zo(e){const s=this.po.indexOf(e);if(s===-1)throw new Error("source is not attached to scale");this.po.splice(s,1),this.po.length===0&&(this.Ro({Wn:!0}),this.Ao(null)),this.Ra(),this.Yo()}Ct(){let e=null;for(const s of this.po){const a=s.Ct();a!==null&&(e===null||a.la<e.la)&&(e=a)}return e===null?null:e.Vt}Bo(){return this.cn.invertScale}Ha(){const e=this.Ct()===null;if(this.bo!==null&&(e||this.bo.Xo===e))return this.bo.Ha;this.Co.io();const s=this.Co.Ha();return this.bo={Ha:s,Xo:e},this.fo.m(),s}Ko(){return this.fo}Go(e){this.Mh()||this.Oo()||this.wo===null&&this.ao===null&&(this.Ni()||(this.wo=this.ho-e,this.ao=be(this.Lh()).Th()))}Jo(e){if(this.Mh()||this.Oo()||this.wo===null)return;this.Ro({Wn:!1}),(e=this.ho-e)<0&&(e=0);let s=(this.wo+.2*(this.ho-1))/(e+.2*(this.ho-1));const a=be(this.ao).Th();s=Math.max(s,.1),a.Vh(s),this.Ao(a)}Qo(){this.Mh()||this.Oo()||(this.wo=null,this.ao=null)}t_(e){this.Vo()||this.Mo===null&&this.ao===null&&(this.Ni()||(this.Mo=e,this.ao=be(this.Lh()).Th()))}i_(e){if(this.Vo()||this.Mo===null)return;const s=be(this.Lh()).Dh()/(this.Eo()-1);let a=e-this.Mo;this.Bo()&&(a*=-1);const c=a*s,h=be(this.ao).Th();h.Oh(c),this.Ao(h,!0),this.bo=null}n_(){this.Vo()||this.Mo!==null&&(this.Mo=null,this.ao=null)}ba(){return this.wa||this.Ra(),this.wa}Fi(e,s){switch(this.cn.mode){case 2:return this.s_(Ta(e,s));case 3:return this.ba().format(Bl(e,s));default:return this.Wh(e)}}eo(e){switch(this.cn.mode){case 2:return this.s_(e);case 3:return this.ba().format(e);default:return this.Wh(e)}}Yl(e){return this.Wh(e,be(this.e_()).ba())}Zl(e,s){return e=Ta(e,s),this.s_(e,xv)}r_(){return this.po}h_(e){this.oo={uo:e,_o:!1}}Vn(){this.po.forEach((e=>e.Vn()))}Ra(){this.bo=null;const e=this.e_();let s=100;e!==null&&(s=Math.round(1/e.ma())),this.wa=wv,this.Mh()?(this.wa=xv,s=100):this.Oo()?(this.wa=new lc(100,1),s=100):e!==null&&(this.wa=e.ba()),this.Co=new yv(this,s,this.To.bind(this),this.Po.bind(this)),this.Co.io()}Yo(){this.mo=null}e_(){return this.po[0]||null}No(){return this.Bo()?this.cn.scaleMargins.bottom*this.At()+this.do:this.cn.scaleMargins.top*this.At()+this.co}Fo(){return this.Bo()?this.cn.scaleMargins.top*this.At()+this.co:this.cn.scaleMargins.bottom*this.At()+this.do}Wo(){this.oo._o||(this.oo._o=!0,this.l_())}Do(){this.lo=null}Po(e,s){if(this.Wo(),this.Ni())return 0;e=this.ro()&&e?Fo(e,this.xo):e;const a=be(this.Lh()),c=this.Fo()+(this.Eo()-1)*(e-a.Ph())/a.Dh();return this.jo(c)}To(e,s){if(this.Wo(),this.Ni())return 0;const a=this.jo(e),c=be(this.Lh()),h=c.Ph()+c.Dh()*((a-this.Fo())/(this.Eo()-1));return this.ro()?$l(h,this.xo):h}Io(){this.bo=null,this.Co.io()}l_(){const e=this.oo.uo;if(e===null)return;let s=null;const a=this.r_();let c=0,h=0;for(const p of a){if(!p.yt())continue;const v=p.Ct();if(v===null)continue;const x=p.Il(e.Os(),e.ui());let y=x&&x.Lh();if(y!==null){switch(this.cn.mode){case 1:y=Ol(y,this.xo);break;case 2:y=HS(y,v.Vt);break;case 3:y=qS(y,v.Vt)}if(s=s===null?y:s.ts(be(y)),x!==null){const b=x.Eh();b!==null&&(c=Math.max(c,b.above),h=Math.max(h,b.below))}}}if(c===this.co&&h===this.do||(this.co=c,this.do=h,this.bo=null,this.Do()),s!==null){if(s.Ph()===s.Rh()){const p=this.e_(),v=5*(p===null||this.Mh()||this.Oo()?1:p.ma());this.ro()&&(s=ko(s,this.xo)),s=new as(s.Ph()-v,s.Rh()+v),this.ro()&&(s=Ol(s,this.xo))}if(this.ro()){const p=ko(s,this.xo),v=Rh(p);if(d=v,g=this.xo,d.$a!==g.$a||d.Ua!==g.Ua){const x=this.ao!==null?ko(this.ao,this.xo):null;this.xo=v,s=Ol(p,v),x!==null&&(this.ao=Ol(x,v))}}this.Ao(s)}else this.Ih===null&&(this.Ao(new as(-.5,.5)),this.xo=Rh(null));var d,g;this.oo._o=!0}Ho(){return this.Mh()?Ta:this.Oo()?Bl:this.ro()?e=>Fo(e,this.xo):null}a_(e,s,a){return s===void 0?(a===void 0&&(a=this.ba()),a.format(e)):s(e)}Wh(e,s){return this.a_(e,this.yo.priceFormatter,s)}s_(e,s){return this.a_(e,this.yo.percentageFormatter,s)}}class WS{constructor(e,s){this.po=[],this.o_=new Map,this.ho=0,this.__=0,this.u_=1e3,this.mo=null,this.c_=new kt,this.yl=e,this.$i=s,this.d_=new VS(this);const a=s.W();this.f_=this.v_("left",a.leftPriceScale),this.p_=this.v_("right",a.rightPriceScale),this.f_.zo().l(this.m_.bind(this,this.f_),this),this.p_.zo().l(this.m_.bind(this,this.p_),this),this.b_(a)}b_(e){if(e.leftPriceScale&&this.f_.$h(e.leftPriceScale),e.rightPriceScale&&this.p_.$h(e.rightPriceScale),e.localization&&(this.f_.Ra(),this.p_.Ra()),e.overlayPriceScales){const s=Array.from(this.o_.values());for(const a of s){const c=be(a[0].Dt());c.$h(e.overlayPriceScales),e.localization&&c.Ra()}}}w_(e){switch(e){case"left":return this.f_;case"right":return this.p_}return this.o_.has(e)?Jt(this.o_.get(e))[0].Dt():null}S(){this.$t().g_().p(this),this.f_.zo().p(this),this.p_.zo().p(this),this.po.forEach((e=>{e.S&&e.S()})),this.c_.m()}M_(){return this.u_}x_(e){this.u_=e}$t(){return this.$i}Hi(){return this.__}At(){return this.ho}S_(e){this.__=e,this.k_()}Lo(e){this.ho=e,this.f_.Lo(e),this.p_.Lo(e),this.po.forEach((s=>{if(this.vr(s)){const a=s.Dt();a!==null&&a.Lo(e)}})),this.k_()}Ba(){return this.po}vr(e){const s=e.Dt();return s===null||this.f_!==s&&this.p_!==s}qo(e,s,a){const c=a!==void 0?a:this.C_().y_+1;this.T_(e,s,c)}Zo(e){const s=this.po.indexOf(e);ai(s!==-1,"removeDataSource: invalid data source"),this.po.splice(s,1);const a=be(e.Dt()).Pa();if(this.o_.has(a)){const h=Jt(this.o_.get(a)),d=h.indexOf(e);d!==-1&&(h.splice(d,1),h.length===0&&this.o_.delete(a))}const c=e.Dt();c&&c.Ba().indexOf(e)>=0&&c.Zo(e),c!==null&&(c.Yo(),this.P_(c)),this.mo=null}mr(e){return e===this.f_?"left":e===this.p_?"right":"overlay"}R_(){return this.f_}D_(){return this.p_}V_(e,s){e.Go(s)}O_(e,s){e.Jo(s),this.k_()}B_(e){e.Qo()}A_(e,s){e.t_(s)}I_(e,s){e.i_(s),this.k_()}z_(e){e.n_()}k_(){this.po.forEach((e=>{e.Vn()}))}vn(){let e=null;return this.$i.W().rightPriceScale.visible&&this.p_.Ba().length!==0?e=this.p_:this.$i.W().leftPriceScale.visible&&this.f_.Ba().length!==0?e=this.f_:this.po.length!==0&&(e=this.po[0].Dt()),e===null&&(e=this.p_),e}pr(){let e=null;return this.$i.W().rightPriceScale.visible?e=this.p_:this.$i.W().leftPriceScale.visible&&(e=this.f_),e}P_(e){e!==null&&e.Vo()&&this.L_(e)}E_(e){const s=this.yl.Xs();e.Ro({Wn:!0}),s!==null&&e.h_(s),this.k_()}N_(){this.L_(this.f_),this.L_(this.p_)}F_(){this.P_(this.f_),this.P_(this.p_),this.po.forEach((e=>{this.vr(e)&&this.P_(e.Dt())})),this.k_(),this.$i.Uh()}Uo(){return this.mo===null&&(this.mo=a0(this.po)),this.mo}W_(){return this.c_}j_(){return this.d_}L_(e){const s=e.r_();if(s&&s.length>0&&!this.yl.Ni()){const a=this.yl.Xs();a!==null&&e.h_(a)}e.Vn()}C_(){const e=this.Uo();if(e.length===0)return{H_:0,y_:0};let s=0,a=0;for(let c=0;c<e.length;c++){const h=e[c].Xi();h!==null&&(h<s&&(s=h),h>a&&(a=h))}return{H_:s,y_:a}}T_(e,s,a){let c=this.w_(s);if(c===null&&(c=this.v_(s,this.$i.W().overlayPriceScales)),this.po.push(e),!ac(s)){const h=this.o_.get(s)||[];h.push(e),this.o_.set(s,h)}c.qo(e),e.Gi(c),e.Ki(a),this.P_(c),this.mo=null}m_(e,s,a){s.Cr!==a.Cr&&this.L_(e)}v_(e,s){const a=Object.assign({visible:!0,autoScale:!0},xn(s)),c=new FS(e,a,this.$i.W().layout,this.$i.W().localization);return c.Lo(this.At()),c}}class GS{constructor(e,s,a=50){this.Ke=0,this.Ge=1,this.Je=1,this.tr=new Map,this.Qe=new Map,this.U_=e,this.q_=s,this.ir=a}Y_(e){const s=e.time,a=this.q_.cacheKey(s),c=this.tr.get(a);if(c!==void 0)return c.Z_;if(this.Ke===this.ir){const d=this.Qe.get(this.Je);this.Qe.delete(this.Je),this.tr.delete(Jt(d)),this.Je++,this.Ke--}const h=this.U_(e);return this.tr.set(a,{Z_:h,rr:this.Ge}),this.Qe.set(this.Ge,a),this.Ke++,this.Ge++,h}}class Ul{constructor(e,s){ai(e<=s,"right should be >= left"),this.X_=e,this.K_=s}Os(){return this.X_}ui(){return this.K_}G_(){return this.K_-this.X_+1}Kr(e){return this.X_<=e&&e<=this.K_}Ch(e){return this.X_===e.Os()&&this.K_===e.ui()}}function Sv(i,e){return i===null||e===null?i===e:i.Ch(e)}class YS{constructor(){this.J_=new Map,this.tr=null,this.Q_=!1}tu(e){this.Q_=e,this.tr=null}iu(e,s){this.nu(s),this.tr=null;for(let a=s;a<e.length;++a){const c=e[a];let h=this.J_.get(c.timeWeight);h===void 0&&(h=[],this.J_.set(c.timeWeight,h)),h.push({index:a,time:c.time,weight:c.timeWeight,originalTime:c.originalTime})}}su(e,s){const a=Math.ceil(s/e);return this.tr!==null&&this.tr.eu===a||(this.tr={Ha:this.ru(a),eu:a}),this.tr.Ha}nu(e){if(e===0)return void this.J_.clear();const s=[];this.J_.forEach(((a,c)=>{e<=a[0].index?s.push(c):a.splice(tr(a,e,(h=>h.index<e)),1/0)}));for(const a of s)this.J_.delete(a)}ru(e){let s=[];for(const a of Array.from(this.J_.keys()).sort(((c,h)=>h-c))){if(!this.J_.get(a))continue;const c=s;s=[];const h=c.length;let d=0;const g=Jt(this.J_.get(a)),p=g.length;let v=1/0,x=-1/0;for(let y=0;y<p;y++){const b=g[y],S=b.index;for(;d<h;){const N=c[d],E=N.index;if(!(E<S)){v=E;break}d++,s.push(N),x=E,v=1/0}if(v-S>=e&&S-x>=e)s.push(b),x=S;else if(this.Q_)return c}for(;d<h;d++)s.push(c[d])}return s}}class ka{constructor(e){this.hu=e}lu(){return this.hu===null?null:new Ul(Math.floor(this.hu.Os()),Math.ceil(this.hu.ui()))}au(){return this.hu}static ou(){return new ka(null)}}function KS(i,e){return i.weight>e.weight?i:e}class XS{constructor(e,s,a,c){this.__=0,this._u=null,this.uu=[],this.Mo=null,this.wo=null,this.cu=new YS,this.du=new Map,this.fu=ka.ou(),this.vu=!0,this.pu=new kt,this.mu=new kt,this.bu=new kt,this.wu=null,this.gu=null,this.Mu=[],this.cn=s,this.yo=a,this.xu=s.rightOffset,this.Su=s.barSpacing,this.$i=e,this.q_=c,this.ku(),this.cu.tu(s.uniformDistribution)}W(){return this.cn}yu(e){Is(this.yo,e),this.Cu(),this.ku()}$h(e,s){var a;Is(this.cn,e),this.cn.fixLeftEdge&&this.Tu(),this.cn.fixRightEdge&&this.Pu(),e.barSpacing!==void 0&&this.$i.Gn(e.barSpacing),e.rightOffset!==void 0&&this.$i.Jn(e.rightOffset),e.minBarSpacing!==void 0&&this.$i.Gn((a=e.barSpacing)!==null&&a!==void 0?a:this.Su),this.Cu(),this.ku(),this.bu.m()}mn(e){var s,a;return(a=(s=this.uu[e])===null||s===void 0?void 0:s.time)!==null&&a!==void 0?a:null}Ui(e){var s;return(s=this.uu[e])!==null&&s!==void 0?s:null}Va(e,s){if(this.uu.length<1)return null;if(this.q_.key(e)>this.q_.key(this.uu[this.uu.length-1].time))return s?this.uu.length-1:null;const a=tr(this.uu,this.q_.key(e),((c,h)=>this.q_.key(c.time)<h));return this.q_.key(e)<this.q_.key(this.uu[a].time)?s?a:null:a}Ni(){return this.__===0||this.uu.length===0||this._u===null}Da(){return this.uu.length>0}Xs(){return this.Ru(),this.fu.lu()}Du(){return this.Ru(),this.fu.au()}Vu(){const e=this.Xs();if(e===null)return null;const s={from:e.Os(),to:e.ui()};return this.Ou(s)}Ou(e){const s=Math.round(e.from),a=Math.round(e.to),c=be(this.Bu()),h=be(this.Au());return{from:be(this.Ui(Math.max(c,s))),to:be(this.Ui(Math.min(h,a)))}}Iu(e){return{from:be(this.Va(e.from,!0)),to:be(this.Va(e.to,!0))}}Hi(){return this.__}S_(e){if(!isFinite(e)||e<=0||this.__===e)return;const s=this.Du(),a=this.__;if(this.__=e,this.vu=!0,this.cn.lockVisibleTimeRangeOnResize&&a!==0){const c=this.Su*e/a;this.Su=c}if(this.cn.fixLeftEdge&&s!==null&&s.Os()<=0){const c=a-e;this.xu-=Math.round(c/this.Su)+1,this.vu=!0}this.zu(),this.Lu()}It(e){if(this.Ni()||!Fl(e))return 0;const s=this.Eu()+this.xu-e;return this.__-(s+.5)*this.Su-1}Qs(e,s){const a=this.Eu(),c=s===void 0?0:s.from,h=s===void 0?e.length:s.to;for(let d=c;d<h;d++){const g=e[d].ot,p=a+this.xu-g,v=this.__-(p+.5)*this.Su-1;e[d].nt=v}}Nu(e){return Math.ceil(this.Fu(e))}Jn(e){this.vu=!0,this.xu=e,this.Lu(),this.$i.Wu(),this.$i.Uh()}le(){return this.Su}Gn(e){this.ju(e),this.Lu(),this.$i.Wu(),this.$i.Uh()}Hu(){return this.xu}Ha(){if(this.Ni())return null;if(this.gu!==null)return this.gu;const e=this.Su,s=5*(this.$i.W().layout.fontSize+4)/8*(this.cn.tickMarkMaxCharacterLength||8),a=Math.round(s/e),c=be(this.Xs()),h=Math.max(c.Os(),c.Os()-a),d=Math.max(c.ui(),c.ui()-a),g=this.cu.su(e,s),p=this.Bu()+a,v=this.Au()-a,x=this.$u(),y=this.cn.fixLeftEdge||x,b=this.cn.fixRightEdge||x;let S=0;for(const N of g){if(!(h<=N.index&&N.index<=d))continue;let E;S<this.Mu.length?(E=this.Mu[S],E.coord=this.It(N.index),E.label=this.Uu(N),E.weight=N.weight):(E={needAlignCoordinate:!1,coord:this.It(N.index),label:this.Uu(N),weight:N.weight},this.Mu.push(E)),this.Su>s/2&&!x?E.needAlignCoordinate=!1:E.needAlignCoordinate=y&&N.index<=p||b&&N.index>=v,S++}return this.Mu.length=S,this.gu=this.Mu,this.Mu}qu(){this.vu=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}Yu(e){this.vu=!0,this._u=e,this.Lu(),this.Tu()}Zu(e,s){const a=this.Fu(e),c=this.le(),h=c+s*(c/10);this.Gn(h),this.cn.rightBarStaysOnScroll||this.Jn(this.Hu()+(a-this.Fu(e)))}Go(e){this.Mo&&this.n_(),this.wo===null&&this.wu===null&&(this.Ni()||(this.wo=e,this.Xu()))}Jo(e){if(this.wu===null)return;const s=rd(this.__-e,0,this.__),a=rd(this.__-be(this.wo),0,this.__);s!==0&&a!==0&&this.Gn(this.wu.le*s/a)}Qo(){this.wo!==null&&(this.wo=null,this.Ku())}t_(e){this.Mo===null&&this.wu===null&&(this.Ni()||(this.Mo=e,this.Xu()))}i_(e){if(this.Mo===null)return;const s=(this.Mo-e)/this.le();this.xu=be(this.wu).Hu+s,this.vu=!0,this.Lu()}n_(){this.Mo!==null&&(this.Mo=null,this.Ku())}Gu(){this.Ju(this.cn.rightOffset)}Ju(e,s=400){if(!isFinite(e))throw new RangeError("offset is required and must be finite number");if(!isFinite(s)||s<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const a=this.xu,c=performance.now();this.$i.Zn({Qu:h=>(h-c)/s>=1,tc:h=>{const d=(h-c)/s;return d>=1?e:a+(e-a)*d}})}bt(e,s){this.vu=!0,this.uu=e,this.cu.iu(e,s),this.Lu()}nc(){return this.pu}sc(){return this.mu}ec(){return this.bu}Eu(){return this._u||0}rc(e){const s=e.G_();this.ju(this.__/s),this.xu=e.ui()-this.Eu(),this.Lu(),this.vu=!0,this.$i.Wu(),this.$i.Uh()}hc(){const e=this.Bu(),s=this.Au();e!==null&&s!==null&&this.rc(new Ul(e,s+this.cn.rightOffset))}lc(e){const s=new Ul(e.from,e.to);this.rc(s)}qi(e){return this.yo.timeFormatter!==void 0?this.yo.timeFormatter(e.originalTime):this.q_.formatHorzItem(e.time)}$u(){const{handleScroll:e,handleScale:s}=this.$i.W();return!(e.horzTouchDrag||e.mouseWheel||e.pressedMouseMove||e.vertTouchDrag||s.axisDoubleClickReset.time||s.axisPressedMouseMove.time||s.mouseWheel||s.pinch)}Bu(){return this.uu.length===0?null:0}Au(){return this.uu.length===0?null:this.uu.length-1}ac(e){return(this.__-1-e)/this.Su}Fu(e){const s=this.ac(e),a=this.Eu()+this.xu-s;return Math.round(1e6*a)/1e6}ju(e){const s=this.Su;this.Su=e,this.zu(),s!==this.Su&&(this.vu=!0,this.oc())}Ru(){if(!this.vu)return;if(this.vu=!1,this.Ni())return void this._c(ka.ou());const e=this.Eu(),s=this.__/this.Su,a=this.xu+e,c=new Ul(a-s+1,a);this._c(new ka(c))}zu(){const e=this.uc();if(this.Su<e&&(this.Su=e,this.vu=!0),this.__!==0){const s=.5*this.__;this.Su>s&&(this.Su=s,this.vu=!0)}}uc(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&this.uu.length!==0?this.__/this.uu.length:this.cn.minBarSpacing}Lu(){const e=this.cc();e!==null&&this.xu<e&&(this.xu=e,this.vu=!0);const s=this.dc();this.xu>s&&(this.xu=s,this.vu=!0)}cc(){const e=this.Bu(),s=this._u;return e===null||s===null?null:e-s-1+(this.cn.fixLeftEdge?this.__/this.Su:Math.min(2,this.uu.length))}dc(){return this.cn.fixRightEdge?0:this.__/this.Su-Math.min(2,this.uu.length)}Xu(){this.wu={le:this.le(),Hu:this.Hu()}}Ku(){this.wu=null}Uu(e){let s=this.du.get(e.weight);return s===void 0&&(s=new GS((a=>this.fc(a)),this.q_),this.du.set(e.weight,s)),s.Y_(e)}fc(e){return this.q_.formatTickmark(e,this.yo)}_c(e){const s=this.fu;this.fu=e,Sv(s.lu(),this.fu.lu())||this.pu.m(),Sv(s.au(),this.fu.au())||this.mu.m(),this.oc()}oc(){this.gu=null}Cu(){this.oc(),this.du.clear()}ku(){this.q_.updateFormatter(this.yo)}Tu(){if(!this.cn.fixLeftEdge)return;const e=this.Bu();if(e===null)return;const s=this.Xs();if(s===null)return;const a=s.Os()-e;if(a<0){const c=this.xu-a-1;this.Jn(c)}this.zu()}Pu(){this.Lu(),this.zu()}}class JS{X(e,s,a){e.useMediaCoordinateSpace((c=>this.K(c,s,a)))}gl(e,s,a){e.useMediaCoordinateSpace((c=>this.vc(c,s,a)))}vc(e,s,a){}}class QS extends JS{constructor(e){super(),this.mc=new Map,this.zt=e}K(e){}vc(e){if(!this.zt.yt)return;const{context:s,mediaSize:a}=e;let c=0;for(const d of this.zt.bc){if(d.Kt.length===0)continue;s.font=d.R;const g=this.wc(s,d.Kt);g>a.width?d.Zu=a.width/g:d.Zu=1,c+=d.gc*d.Zu}let h=0;switch(this.zt.Mc){case"top":h=0;break;case"center":h=Math.max((a.height-c)/2,0);break;case"bottom":h=Math.max(a.height-c,0)}s.fillStyle=this.zt.V;for(const d of this.zt.bc){s.save();let g=0;switch(this.zt.xc){case"left":s.textAlign="left",g=d.gc/2;break;case"center":s.textAlign="center",g=a.width/2;break;case"right":s.textAlign="right",g=a.width-1-d.gc/2}s.translate(g,h),s.textBaseline="top",s.font=d.R,s.scale(d.Zu,d.Zu),s.fillText(d.Kt,0,d.Sc),s.restore(),h+=d.gc*d.Zu}}wc(e,s){const a=this.kc(e.font);let c=a.get(s);return c===void 0&&(c=e.measureText(s).width,a.set(s,c)),c}kc(e){let s=this.mc.get(e);return s===void 0&&(s=new Map,this.mc.set(e,s)),s}}class ZS{constructor(e){this.ft=!0,this.Ft={yt:!1,V:"",bc:[],Mc:"center",xc:"center"},this.Wt=new QS(this.Ft),this.jt=e}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){const e=this.jt.W(),s=this.Ft;s.yt=e.visible,s.yt&&(s.V=e.color,s.xc=e.horzAlign,s.Mc=e.vertAlign,s.bc=[{Kt:e.text,R:La(e.fontSize,e.fontFamily,e.fontStyle),gc:1.2*e.fontSize,Sc:0,Zu:0}])}}class e_ extends Td{constructor(e,s){super(),this.cn=s,this.wn=new ZS(this)}Rn(){return[]}Pn(){return[this.wn]}W(){return this.cn}Vn(){this.wn.bt()}}var _v,jv,Nv,od,Ev;(function(i){i[i.OnTouchEnd=0]="OnTouchEnd",i[i.OnNextTap=1]="OnNextTap"})(_v||(_v={}));class t_{constructor(e,s,a){this.yc=[],this.Cc=[],this.__=0,this.Tc=null,this.Pc=new kt,this.Rc=new kt,this.Dc=null,this.Vc=e,this.cn=s,this.q_=a,this.Oc=new Aw(this),this.yl=new XS(this,s.timeScale,this.cn.localization,a),this.vt=new qw(this,s.crosshair),this.Bc=new BS(s.crosshair),this.Ac=new e_(this,s.watermark),this.Ic(),this.yc[0].x_(2e3),this.zc=this.Lc(0),this.Ec=this.Lc(1)}Kl(){this.Nc(Wt.es())}Uh(){this.Nc(Wt.ss())}oa(){this.Nc(new Wt(1))}Gl(e){const s=this.Fc(e);this.Nc(s)}Wc(){return this.Tc}jc(e){const s=this.Tc;this.Tc=e,s!==null&&this.Gl(s.Hc),e!==null&&this.Gl(e.Hc)}W(){return this.cn}$h(e){Is(this.cn,e),this.yc.forEach((s=>s.b_(e))),e.timeScale!==void 0&&this.yl.$h(e.timeScale),e.localization!==void 0&&this.yl.yu(e.localization),(e.leftPriceScale||e.rightPriceScale)&&this.Pc.m(),this.zc=this.Lc(0),this.Ec=this.Lc(1),this.Kl()}$c(e,s){if(e==="left")return void this.$h({leftPriceScale:s});if(e==="right")return void this.$h({rightPriceScale:s});const a=this.Uc(e);a!==null&&(a.Dt.$h(s),this.Pc.m())}Uc(e){for(const s of this.yc){const a=s.w_(e);if(a!==null)return{Ht:s,Dt:a}}return null}St(){return this.yl}qc(){return this.yc}Yc(){return this.Ac}Zc(){return this.vt}Xc(){return this.Rc}Kc(e,s){e.Lo(s),this.Wu()}S_(e){this.__=e,this.yl.S_(this.__),this.yc.forEach((s=>s.S_(e))),this.Wu()}Ic(e){const s=new WS(this.yl,this);e!==void 0?this.yc.splice(e,0,s):this.yc.push(s);const a=e===void 0?this.yc.length-1:e,c=Wt.es();return c.Nn(a,{Fn:0,Wn:!0}),this.Nc(c),s}V_(e,s,a){e.V_(s,a)}O_(e,s,a){e.O_(s,a),this.Jl(),this.Nc(this.Gc(e,2))}B_(e,s){e.B_(s),this.Nc(this.Gc(e,2))}A_(e,s,a){s.Vo()||e.A_(s,a)}I_(e,s,a){s.Vo()||(e.I_(s,a),this.Jl(),this.Nc(this.Gc(e,2)))}z_(e,s){s.Vo()||(e.z_(s),this.Nc(this.Gc(e,2)))}E_(e,s){e.E_(s),this.Nc(this.Gc(e,2))}Jc(e){this.yl.Go(e)}Qc(e,s){const a=this.St();if(a.Ni()||s===0)return;const c=a.Hi();e=Math.max(1,Math.min(e,c)),a.Zu(e,s),this.Wu()}td(e){this.nd(0),this.sd(e),this.ed()}rd(e){this.yl.Jo(e),this.Wu()}hd(){this.yl.Qo(),this.Uh()}nd(e){this.yl.t_(e)}sd(e){this.yl.i_(e),this.Wu()}ed(){this.yl.n_(),this.Uh()}wt(){return this.Cc}ld(e,s,a,c,h){this.vt.gn(e,s);let d=NaN,g=this.yl.Nu(e);const p=this.yl.Xs();p!==null&&(g=Math.min(Math.max(p.Os(),g),p.ui()));const v=c.vn(),x=v.Ct();x!==null&&(d=v.pn(s,x)),d=this.Bc.Oa(d,g,c),this.vt.kn(g,d,c),this.oa(),h||this.Rc.m(this.vt.xt(),{x:e,y:s},a)}ad(e,s,a){const c=a.vn(),h=c.Ct(),d=c.Rt(e,be(h)),g=this.yl.Va(s,!0),p=this.yl.It(be(g));this.ld(p,d,null,a,!0)}od(e){this.Zc().Cn(),this.oa(),e||this.Rc.m(null,null,null)}Jl(){const e=this.vt.Ht();if(e!==null){const s=this.vt.xn(),a=this.vt.Sn();this.ld(s,a,null,e)}this.vt.Vn()}_d(e,s,a){const c=this.yl.mn(0);s!==void 0&&a!==void 0&&this.yl.bt(s,a);const h=this.yl.mn(0),d=this.yl.Eu(),g=this.yl.Xs();if(g!==null&&c!==null&&h!==null){const p=g.Kr(d),v=this.q_.key(c)>this.q_.key(h),x=e!==null&&e>d&&!v,y=this.yl.W().allowShiftVisibleRangeOnWhitespaceReplacement,b=p&&(a!==void 0||y)&&this.yl.W().shiftVisibleRangeOnNewBar;if(x&&!b){const S=e-d;this.yl.Jn(this.yl.Hu()-S)}}this.yl.Yu(e)}ia(e){e!==null&&e.F_()}dr(e){const s=this.yc.find((a=>a.Uo().includes(e)));return s===void 0?null:s}Wu(){this.Ac.Vn(),this.yc.forEach((e=>e.F_())),this.Jl()}S(){this.yc.forEach((e=>e.S())),this.yc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.percentageFormatter=void 0,this.cn.localization.timeFormatter=void 0}ud(){return this.Oc}br(){return this.Oc.W()}g_(){return this.Pc}dd(e,s,a){const c=this.yc[0],h=this.fd(s,e,c,a);return this.Cc.push(h),this.Cc.length===1?this.Kl():this.Uh(),h}vd(e){const s=this.dr(e),a=this.Cc.indexOf(e);ai(a!==-1,"Series not found"),this.Cc.splice(a,1),be(s).Zo(e),e.S&&e.S()}Xl(e,s){const a=be(this.dr(e));a.Zo(e);const c=this.Uc(s);if(c===null){const h=e.Xi();a.qo(e,s,h)}else{const h=c.Ht===a?e.Xi():void 0;c.Ht.qo(e,s,h)}}hc(){const e=Wt.ss();e.$n(),this.Nc(e)}pd(e){const s=Wt.ss();s.Yn(e),this.Nc(s)}Kn(){const e=Wt.ss();e.Kn(),this.Nc(e)}Gn(e){const s=Wt.ss();s.Gn(e),this.Nc(s)}Jn(e){const s=Wt.ss();s.Jn(e),this.Nc(s)}Zn(e){const s=Wt.ss();s.Zn(e),this.Nc(s)}Un(){const e=Wt.ss();e.Un(),this.Nc(e)}md(){return this.cn.rightPriceScale.visible?"right":"left"}bd(){return this.Ec}q(){return this.zc}Bt(e){const s=this.Ec,a=this.zc;if(s===a)return s;if(e=Math.max(0,Math.min(100,Math.round(100*e))),this.Dc===null||this.Dc.Ps!==a||this.Dc.Rs!==s)this.Dc={Ps:a,Rs:s,wd:new Map};else{const h=this.Dc.wd.get(e);if(h!==void 0)return h}const c=(function(h,d,g){const[p,v,x,y]=ql(h),[b,S,N,E]=ql(d),R=[Es(p+g*(b-p)),Es(v+g*(S-v)),Es(x+g*(N-x)),Uy(y+g*(E-y))];return`rgba(${R[0]}, ${R[1]}, ${R[2]}, ${R[3]})`})(a,s,e/100);return this.Dc.wd.set(e,c),c}Gc(e,s){const a=new Wt(s);if(e!==null){const c=this.yc.indexOf(e);a.Nn(c,{Fn:s})}return a}Fc(e,s){return s===void 0&&(s=2),this.Gc(this.dr(e),s)}Nc(e){this.Vc&&this.Vc(e),this.yc.forEach((s=>s.j_().qh().bt()))}fd(e,s,a,c){const h=new Dd(this,e,s,a,c),d=e.priceScaleId!==void 0?e.priceScaleId:this.md();return a.qo(h,d),ac(d)||h.$h(e),h}Lc(e){const s=this.cn.layout;return s.background.type==="gradient"?e===0?s.background.topColor:s.background.bottomColor:s.background.color}}function cd(i){return!Gs(i)&&!er(i)}function l0(i){return Gs(i)}(function(i){i[i.Disabled=0]="Disabled",i[i.Continuous=1]="Continuous",i[i.OnDataUpdate=2]="OnDataUpdate"})(jv||(jv={})),(function(i){i[i.LastBar=0]="LastBar",i[i.LastVisible=1]="LastVisible"})(Nv||(Nv={})),(function(i){i.Solid="solid",i.VerticalGradient="gradient"})(od||(od={})),(function(i){i[i.Year=0]="Year",i[i.Month=1]="Month",i[i.DayOfMonth=2]="DayOfMonth",i[i.Time=3]="Time",i[i.TimeWithSeconds=4]="TimeWithSeconds"})(Ev||(Ev={}));const Tv=i=>i.getUTCFullYear();function s_(i,e,s){return e.replace(/yyyy/g,(a=>wn(Tv(a),4))(i)).replace(/yy/g,(a=>wn(Tv(a)%100,2))(i)).replace(/MMMM/g,((a,c)=>new Date(a.getUTCFullYear(),a.getUTCMonth(),1).toLocaleString(c,{month:"long"}))(i,s)).replace(/MMM/g,((a,c)=>new Date(a.getUTCFullYear(),a.getUTCMonth(),1).toLocaleString(c,{month:"short"}))(i,s)).replace(/MM/g,(a=>wn((c=>c.getUTCMonth()+1)(a),2))(i)).replace(/dd/g,(a=>wn((c=>c.getUTCDate())(a),2))(i))}class r0{constructor(e="yyyy-MM-dd",s="default"){this.gd=e,this.Md=s}Y_(e){return s_(e,this.gd,this.Md)}}class n_{constructor(e){this.xd=e||"%h:%m:%s"}Y_(e){return this.xd.replace("%h",wn(e.getUTCHours(),2)).replace("%m",wn(e.getUTCMinutes(),2)).replace("%s",wn(e.getUTCSeconds(),2))}}const i_={Sd:"yyyy-MM-dd",kd:"%h:%m:%s",yd:" ",Cd:"default"};class a_{constructor(e={}){const s=Object.assign(Object.assign({},i_),e);this.Td=new r0(s.Sd,s.Cd),this.Pd=new n_(s.kd),this.Rd=s.yd}Y_(e){return`${this.Td.Y_(e)}${this.Rd}${this.Pd.Y_(e)}`}}function Co(i){return 60*i*60*1e3}function Lh(i){return 60*i*1e3}const Mo=[{Dd:(kv=1,1e3*kv),Vd:10},{Dd:Lh(1),Vd:20},{Dd:Lh(5),Vd:21},{Dd:Lh(30),Vd:22},{Dd:Co(1),Vd:30},{Dd:Co(3),Vd:31},{Dd:Co(6),Vd:32},{Dd:Co(12),Vd:33}];var kv;function Cv(i,e){if(i.getUTCFullYear()!==e.getUTCFullYear())return 70;if(i.getUTCMonth()!==e.getUTCMonth())return 60;if(i.getUTCDate()!==e.getUTCDate())return 50;for(let s=Mo.length-1;s>=0;--s)if(Math.floor(e.getTime()/Mo[s].Dd)!==Math.floor(i.getTime()/Mo[s].Dd))return Mo[s].Vd;return 0}function Oh(i){let e=i;if(er(i)&&(e=Rd(i)),!cd(e))throw new Error("time must be of type BusinessDay");const s=new Date(Date.UTC(e.year,e.month-1,e.day,0,0,0,0));return{Od:Math.round(s.getTime()/1e3),Bd:e}}function Mv(i){if(!l0(i))throw new Error("time must be of type isUTCTimestamp");return{Od:i}}function Rd(i){const e=new Date(i);if(isNaN(e.getTime()))throw new Error(`Invalid date string=${i}, expected format=yyyy-mm-dd`);return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}function Dv(i){er(i.time)&&(i.time=Rd(i.time))}class Rv{options(){return this.cn}setOptions(e){this.cn=e,this.updateFormatter(e.localization)}preprocessData(e){Array.isArray(e)?(function(s){s.forEach(Dv)})(e):Dv(e)}createConverterToInternalObj(e){return be((function(s){return s.length===0?null:cd(s[0].time)||er(s[0].time)?Oh:Mv})(e))}key(e){return typeof e=="object"&&"Od"in e?e.Od:this.key(this.convertHorzItemToInternal(e))}cacheKey(e){const s=e;return s.Bd===void 0?new Date(1e3*s.Od).getTime():new Date(Date.UTC(s.Bd.year,s.Bd.month-1,s.Bd.day)).getTime()}convertHorzItemToInternal(e){return l0(s=e)?Mv(s):cd(s)?Oh(s):Oh(Rd(s));var s}updateFormatter(e){if(!this.cn)return;const s=e.dateFormat;this.cn.timeScale.timeVisible?this.Ad=new a_({Sd:s,kd:this.cn.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",yd:"   ",Cd:e.locale}):this.Ad=new r0(s,e.locale)}formatHorzItem(e){const s=e;return this.Ad.Y_(new Date(1e3*s.Od))}formatTickmark(e,s){const a=(function(h,d,g){switch(h){case 0:case 10:return d?g?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return d?3:2;case 50:return 2;case 60:return 1;case 70:return 0}})(e.weight,this.cn.timeScale.timeVisible,this.cn.timeScale.secondsVisible),c=this.cn.timeScale;if(c.tickMarkFormatter!==void 0){const h=c.tickMarkFormatter(e.originalTime,a,s.locale);if(h!==null)return h}return(function(h,d,g){const p={};switch(d){case 0:p.year="numeric";break;case 1:p.month="short";break;case 2:p.day="numeric";break;case 3:p.hour12=!1,p.hour="2-digit",p.minute="2-digit";break;case 4:p.hour12=!1,p.hour="2-digit",p.minute="2-digit",p.second="2-digit"}const v=h.Bd===void 0?new Date(1e3*h.Od):new Date(Date.UTC(h.Bd.year,h.Bd.month-1,h.Bd.day));return new Date(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds(),v.getUTCMilliseconds()).toLocaleString(g,p)})(e.time,a,s.locale)}maxTickMarkWeight(e){let s=e.reduce(KS,e[0]).weight;return s>30&&s<50&&(s=30),s}fillWeightsForPoints(e,s){(function(a,c=0){if(a.length===0)return;let h=c===0?null:a[c-1].time.Od,d=h!==null?new Date(1e3*h):null,g=0;for(let p=c;p<a.length;++p){const v=a[p],x=new Date(1e3*v.time.Od);d!==null&&(v.timeWeight=Cv(x,d)),g+=v.time.Od-(h||v.time.Od),h=v.time.Od,d=x}if(c===0&&a.length>1){const p=Math.ceil(g/(a.length-1)),v=new Date(1e3*(a[0].time.Od-p));a[0].timeWeight=Cv(new Date(1e3*a[0].time.Od),v)}})(e,s)}static Id(e){return Is({localization:{dateFormat:"dd MMM 'yy"}},e??{})}}const Oa=typeof window<"u";function Av(){return!!Oa&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function zh(){return!!Oa&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function ud(i){return i+i%2}function Ih(i,e){return i.zd-e.zd}function Ph(i,e,s){const a=(i.zd-e.zd)/(i.ot-e.ot);return Math.sign(a)*Math.min(Math.abs(a),s)}class l_{constructor(e,s,a,c){this.Ld=null,this.Ed=null,this.Nd=null,this.Fd=null,this.Wd=null,this.jd=0,this.Hd=0,this.$d=e,this.Ud=s,this.qd=a,this.rs=c}Yd(e,s){if(this.Ld!==null){if(this.Ld.ot===s)return void(this.Ld.zd=e);if(Math.abs(this.Ld.zd-e)<this.rs)return}this.Fd=this.Nd,this.Nd=this.Ed,this.Ed=this.Ld,this.Ld={ot:s,zd:e}}Vr(e,s){if(this.Ld===null||this.Ed===null||s-this.Ld.ot>50)return;let a=0;const c=Ph(this.Ld,this.Ed,this.Ud),h=Ih(this.Ld,this.Ed),d=[c],g=[h];if(a+=h,this.Nd!==null){const v=Ph(this.Ed,this.Nd,this.Ud);if(Math.sign(v)===Math.sign(c)){const x=Ih(this.Ed,this.Nd);if(d.push(v),g.push(x),a+=x,this.Fd!==null){const y=Ph(this.Nd,this.Fd,this.Ud);if(Math.sign(y)===Math.sign(c)){const b=Ih(this.Nd,this.Fd);d.push(y),g.push(b),a+=b}}}}let p=0;for(let v=0;v<d.length;++v)p+=g[v]/a*d[v];Math.abs(p)<this.$d||(this.Wd={zd:e,ot:s},this.Hd=p,this.jd=(function(v,x){const y=Math.log(x);return Math.log(1*y/-v)/y})(Math.abs(p),this.qd))}tc(e){const s=be(this.Wd),a=e-s.ot;return s.zd+this.Hd*(Math.pow(this.qd,a)-1)/Math.log(this.qd)}Qu(e){return this.Wd===null||this.Zd(e)===this.jd}Zd(e){const s=e-be(this.Wd).ot;return Math.min(s,this.jd)}}class r_{constructor(e,s){this.Xd=void 0,this.Kd=void 0,this.Gd=void 0,this.en=!1,this.Jd=e,this.Qd=s,this.tf()}bt(){this.tf()}if(){this.Xd&&this.Jd.removeChild(this.Xd),this.Kd&&this.Jd.removeChild(this.Kd),this.Xd=void 0,this.Kd=void 0}nf(){return this.en!==this.sf()||this.Gd!==this.ef()}ef(){return Vy(ql(this.Qd.W().layout.textColor))>160?"dark":"light"}sf(){return this.Qd.W().layout.attributionLogo}rf(){const e=new URL(location.href);return e.hostname?"&utm_source="+e.hostname+e.pathname:""}tf(){this.nf()&&(this.if(),this.en=this.sf(),this.en&&(this.Gd=this.ef(),this.Kd=document.createElement("style"),this.Kd.innerText="a#tv-attr-logo{--fill:#131722;--stroke:#fff;position:absolute;left:10px;bottom:10px;height:19px;width:35px;margin:0;padding:0;border:0;z-index:3;}a#tv-attr-logo[data-dark]{--fill:#D1D4DC;--stroke:#131722;}",this.Xd=document.createElement("a"),this.Xd.href=`https://www.tradingview.com/?utm_medium=lwc-link&utm_campaign=lwc-chart${this.rf()}`,this.Xd.title="Charting by TradingView",this.Xd.id="tv-attr-logo",this.Xd.target="_blank",this.Xd.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 19" width="35" height="19" fill="none"><g fill-rule="evenodd" clip-path="url(#a)" clip-rule="evenodd"><path fill="var(--stroke)" d="M2 0H0v10h6v9h21.4l.5-1.3 6-15 1-2.7H23.7l-.5 1.3-.2.6a5 5 0 0 0-7-.9V0H2Zm20 17h4l5.2-13 .8-2h-7l-1 2.5-.2.5-1.5 3.8-.3.7V17Zm-.8-10a3 3 0 0 0 .7-2.7A3 3 0 1 0 16.8 7h4.4ZM14 7V2H2v6h6v9h4V7h2Z"/><path fill="var(--fill)" d="M14 2H2v6h6v9h6V2Zm12 15h-7l6-15h7l-6 15Zm-7-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></g><defs><clipPath id="a"><path fill="var(--stroke)" d="M0 0h35v19H0z"/></clipPath></defs></svg>',this.Xd.toggleAttribute("data-dark",this.Gd==="dark"),this.Jd.appendChild(this.Kd),this.Jd.appendChild(this.Xd)))}}function Li(i,e){const s=be(i.ownerDocument).createElement("canvas");i.appendChild(s);const a=yw(s,{options:{allowResizeObserver:!1},transform:(c,h)=>({width:Math.max(c.width,h.width),height:Math.max(c.height,h.height)})});return a.resizeCanvasElement(e),a}function Oi(i){var e;i.width=1,i.height=1,(e=i.getContext("2d"))===null||e===void 0||e.clearRect(0,0,1,1)}function hd(i,e,s,a){i.gl&&i.gl(e,s,a)}function Po(i,e,s,a){i.X(e,s,a)}function dd(i,e,s,a){const c=i(s,a);for(const h of c){const d=h.gt();d!==null&&e(d)}}function o_(i){Oa&&window.chrome!==void 0&&i.addEventListener("mousedown",(e=>{if(e.button===1)return e.preventDefault(),!1}))}class Ad{constructor(e,s,a){this.hf=0,this.lf=null,this.af={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this._f=0,this.uf=null,this.cf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.df=null,this.ff=!1,this.vf=null,this.pf=null,this.mf=!1,this.bf=!1,this.wf=!1,this.gf=null,this.Mf=null,this.xf=null,this.Sf=null,this.kf=null,this.yf=null,this.Cf=null,this.Tf=0,this.Pf=!1,this.Rf=!1,this.Df=!1,this.Vf=0,this.Of=null,this.Bf=!zh(),this.Af=c=>{this.If(c)},this.zf=c=>{if(this.Lf(c)){const h=this.Ef(c);if(++this._f,this.uf&&this._f>1){const{Nf:d}=this.Ff(Hs(c),this.cf);d<30&&!this.wf&&this.Wf(h,this.Hf.jf),this.$f()}}else{const h=this.Ef(c);if(++this.hf,this.lf&&this.hf>1){const{Nf:d}=this.Ff(Hs(c),this.af);d<5&&!this.bf&&this.Uf(h,this.Hf.qf),this.Yf()}}},this.Zf=e,this.Hf=s,this.cn=a,this.Xf()}S(){this.gf!==null&&(this.gf(),this.gf=null),this.Mf!==null&&(this.Mf(),this.Mf=null),this.Sf!==null&&(this.Sf(),this.Sf=null),this.kf!==null&&(this.kf(),this.kf=null),this.yf!==null&&(this.yf(),this.yf=null),this.xf!==null&&(this.xf(),this.xf=null),this.Kf(),this.Yf()}Gf(e){this.Sf&&this.Sf();const s=this.Jf.bind(this);if(this.Sf=()=>{this.Zf.removeEventListener("mousemove",s)},this.Zf.addEventListener("mousemove",s),this.Lf(e))return;const a=this.Ef(e);this.Uf(a,this.Hf.Qf),this.Bf=!0}Yf(){this.lf!==null&&clearTimeout(this.lf),this.hf=0,this.lf=null,this.af={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}$f(){this.uf!==null&&clearTimeout(this.uf),this._f=0,this.uf=null,this.cf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Jf(e){if(this.Df||this.pf!==null||this.Lf(e))return;const s=this.Ef(e);this.Uf(s,this.Hf.tv),this.Bf=!0}iv(e){const s=Bh(e.changedTouches,be(this.Of));if(s===null||(this.Vf=Do(e),this.Cf!==null)||this.Rf)return;this.Pf=!0;const a=this.Ff(Hs(s),be(this.pf)),{nv:c,sv:h,Nf:d}=a;if(this.mf||!(d<5)){if(!this.mf){const g=.5*c,p=h>=g&&!this.cn.ev(),v=g>h&&!this.cn.rv();p||v||(this.Rf=!0),this.mf=!0,this.wf=!0,this.Kf(),this.$f()}if(!this.Rf){const g=this.Ef(e,s);this.Wf(g,this.Hf.hv),_a(e)}}}lv(e){if(e.button!==0)return;const s=this.Ff(Hs(e),be(this.vf)),{Nf:a}=s;if(a>=5&&(this.bf=!0,this.Yf()),this.bf){const c=this.Ef(e);this.Uf(c,this.Hf.av)}}Ff(e,s){const a=Math.abs(s.nt-e.nt),c=Math.abs(s.st-e.st);return{nv:a,sv:c,Nf:a+c}}ov(e){let s=Bh(e.changedTouches,be(this.Of));if(s===null&&e.touches.length===0&&(s=e.changedTouches[0]),s===null)return;this.Of=null,this.Vf=Do(e),this.Kf(),this.pf=null,this.yf&&(this.yf(),this.yf=null);const a=this.Ef(e,s);if(this.Wf(a,this.Hf._v),++this._f,this.uf&&this._f>1){const{Nf:c}=this.Ff(Hs(s),this.cf);c<30&&!this.wf&&this.Wf(a,this.Hf.jf),this.$f()}else this.wf||(this.Wf(a,this.Hf.uv),this.Hf.uv&&_a(e));this._f===0&&_a(e),e.touches.length===0&&this.ff&&(this.ff=!1,_a(e))}If(e){if(e.button!==0)return;const s=this.Ef(e);if(this.vf=null,this.Df=!1,this.kf&&(this.kf(),this.kf=null),Av()&&this.Zf.ownerDocument.documentElement.removeEventListener("mouseleave",this.Af),!this.Lf(e))if(this.Uf(s,this.Hf.cv),++this.hf,this.lf&&this.hf>1){const{Nf:a}=this.Ff(Hs(e),this.af);a<5&&!this.bf&&this.Uf(s,this.Hf.qf),this.Yf()}else this.bf||this.Uf(s,this.Hf.dv)}Kf(){this.df!==null&&(clearTimeout(this.df),this.df=null)}fv(e){if(this.Of!==null)return;const s=e.changedTouches[0];this.Of=s.identifier,this.Vf=Do(e);const a=this.Zf.ownerDocument.documentElement;this.wf=!1,this.mf=!1,this.Rf=!1,this.pf=Hs(s),this.yf&&(this.yf(),this.yf=null);{const h=this.iv.bind(this),d=this.ov.bind(this);this.yf=()=>{a.removeEventListener("touchmove",h),a.removeEventListener("touchend",d)},a.addEventListener("touchmove",h,{passive:!1}),a.addEventListener("touchend",d,{passive:!1}),this.Kf(),this.df=setTimeout(this.vv.bind(this,e),240)}const c=this.Ef(e,s);this.Wf(c,this.Hf.pv),this.uf||(this._f=0,this.uf=setTimeout(this.$f.bind(this),500),this.cf=Hs(s))}mv(e){if(e.button!==0)return;const s=this.Zf.ownerDocument.documentElement;Av()&&s.addEventListener("mouseleave",this.Af),this.bf=!1,this.vf=Hs(e),this.kf&&(this.kf(),this.kf=null);{const c=this.lv.bind(this),h=this.If.bind(this);this.kf=()=>{s.removeEventListener("mousemove",c),s.removeEventListener("mouseup",h)},s.addEventListener("mousemove",c),s.addEventListener("mouseup",h)}if(this.Df=!0,this.Lf(e))return;const a=this.Ef(e);this.Uf(a,this.Hf.bv),this.lf||(this.hf=0,this.lf=setTimeout(this.Yf.bind(this),500),this.af=Hs(e))}Xf(){this.Zf.addEventListener("mouseenter",this.Gf.bind(this)),this.Zf.addEventListener("touchcancel",this.Kf.bind(this));{const e=this.Zf.ownerDocument,s=a=>{this.Hf.wv&&(a.composed&&this.Zf.contains(a.composedPath()[0])||a.target&&this.Zf.contains(a.target)||this.Hf.wv())};this.Mf=()=>{e.removeEventListener("touchstart",s)},this.gf=()=>{e.removeEventListener("mousedown",s)},e.addEventListener("mousedown",s),e.addEventListener("touchstart",s,{passive:!0})}zh()&&(this.xf=()=>{this.Zf.removeEventListener("dblclick",this.zf)},this.Zf.addEventListener("dblclick",this.zf)),this.Zf.addEventListener("mouseleave",this.gv.bind(this)),this.Zf.addEventListener("touchstart",this.fv.bind(this),{passive:!0}),o_(this.Zf),this.Zf.addEventListener("mousedown",this.mv.bind(this)),this.Mv(),this.Zf.addEventListener("touchmove",(()=>{}),{passive:!1})}Mv(){this.Hf.xv===void 0&&this.Hf.Sv===void 0&&this.Hf.kv===void 0||(this.Zf.addEventListener("touchstart",(e=>this.yv(e.touches)),{passive:!0}),this.Zf.addEventListener("touchmove",(e=>{if(e.touches.length===2&&this.Cf!==null&&this.Hf.Sv!==void 0){const s=Lv(e.touches[0],e.touches[1])/this.Tf;this.Hf.Sv(this.Cf,s),_a(e)}}),{passive:!1}),this.Zf.addEventListener("touchend",(e=>{this.yv(e.touches)})))}yv(e){e.length===1&&(this.Pf=!1),e.length!==2||this.Pf||this.ff?this.Cv():this.Tv(e)}Tv(e){const s=this.Zf.getBoundingClientRect()||{left:0,top:0};this.Cf={nt:(e[0].clientX-s.left+(e[1].clientX-s.left))/2,st:(e[0].clientY-s.top+(e[1].clientY-s.top))/2},this.Tf=Lv(e[0],e[1]),this.Hf.xv!==void 0&&this.Hf.xv(),this.Kf()}Cv(){this.Cf!==null&&(this.Cf=null,this.Hf.kv!==void 0&&this.Hf.kv())}gv(e){if(this.Sf&&this.Sf(),this.Lf(e)||!this.Bf)return;const s=this.Ef(e);this.Uf(s,this.Hf.Pv),this.Bf=!zh()}vv(e){const s=Bh(e.touches,be(this.Of));if(s===null)return;const a=this.Ef(e,s);this.Wf(a,this.Hf.Rv),this.wf=!0,this.ff=!0}Lf(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents!==void 0?e.sourceCapabilities.firesTouchEvents:Do(e)<this.Vf+500}Wf(e,s){s&&s.call(this.Hf,e)}Uf(e,s){s&&s.call(this.Hf,e)}Ef(e,s){const a=s||e,c=this.Zf.getBoundingClientRect()||{left:0,top:0};return{clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,screenX:a.screenX,screenY:a.screenY,localX:a.clientX-c.left,localY:a.clientY-c.top,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,Dv:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click",Vv:e.type,Ov:a.target,Bv:e.view,Av:()=>{e.type!=="touchstart"&&_a(e)}}}}function Lv(i,e){const s=i.clientX-e.clientX,a=i.clientY-e.clientY;return Math.sqrt(s*s+a*a)}function _a(i){i.cancelable&&i.preventDefault()}function Hs(i){return{nt:i.pageX,st:i.pageY}}function Do(i){return i.timeStamp||performance.now()}function Bh(i,e){for(let s=0;s<i.length;++s)if(i[s].identifier===e)return i[s];return null}function Ro(i){return{Hc:i.Hc,Iv:{gr:i.zv.externalId},Lv:i.zv.cursorStyle}}function c_(i,e,s){for(const a of i){const c=a.gt();if(c!==null&&c.wr){const h=c.wr(e,s);if(h!==null)return{Bv:a,Iv:h}}}return null}function $h(i,e){return s=>{var a,c,h,d;return((c=(a=s.Dt())===null||a===void 0?void 0:a.Pa())!==null&&c!==void 0?c:"")!==e?[]:(d=(h=s.da)===null||h===void 0?void 0:h.call(s,i))!==null&&d!==void 0?d:[]}}function Ov(i,e,s,a){if(!i.length)return;let c=0;const h=s/2,d=i[0].At(a,!0);let g=e===1?h-(i[0].Vi()-d/2):i[0].Vi()-d/2-h;g=Math.max(0,g);for(let p=1;p<i.length;p++){const v=i[p],x=i[p-1],y=x.At(a,!1),b=v.Vi(),S=x.Vi();if(e===1?b>S-y:b<S+y){const N=S-y*e;v.Oi(N);const E=N-e*y/2;if((e===1?E<0:E>s)&&g>0){const R=e===1?-1-E:E-s,_=Math.min(R,g);for(let F=c;F<i.length;F++)i[F].Oi(i[F].Vi()+e*_);g-=_}}else c=p,g=e===1?S-y-b:b-(S+y)}}class zv{constructor(e,s,a,c){this.Li=null,this.Ev=null,this.Nv=!1,this.Fv=new Gl(200),this.Qr=null,this.Wv=0,this.jv=!1,this.Hv=()=>{this.jv||this.tn.$v().$t().Uh()},this.Uv=()=>{this.jv||this.tn.$v().$t().Uh()},this.tn=e,this.cn=s,this.ko=s.layout,this.Oc=a,this.qv=c==="left",this.Yv=$h("normal",c),this.Zv=$h("top",c),this.Xv=$h("bottom",c),this.Kv=document.createElement("div"),this.Kv.style.height="100%",this.Kv.style.overflow="hidden",this.Kv.style.width="25px",this.Kv.style.left="0",this.Kv.style.position="relative",this.Gv=Li(this.Kv,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const h=this.Gv.canvasElement;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Jv=Li(this.Kv,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const d=this.Jv.canvasElement;d.style.position="absolute",d.style.zIndex="2",d.style.left="0",d.style.top="0";const g={bv:this.Qv.bind(this),pv:this.Qv.bind(this),av:this.tp.bind(this),hv:this.tp.bind(this),wv:this.ip.bind(this),cv:this.np.bind(this),_v:this.np.bind(this),qf:this.sp.bind(this),jf:this.sp.bind(this),Qf:this.ep.bind(this),Pv:this.rp.bind(this)};this.hp=new Ad(this.Jv.canvasElement,g,{ev:()=>!this.cn.handleScroll.vertTouchDrag,rv:()=>!0})}S(){this.hp.S(),this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),Oi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),Oi(this.Gv.canvasElement),this.Gv.dispose(),this.Li!==null&&this.Li.Ko().p(this),this.Li=null}lp(){return this.Kv}P(){return this.ko.fontSize}ap(){const e=this.Oc.W();return this.Qr!==e.R&&(this.Fv.nr(),this.Qr=e.R),e}op(){if(this.Li===null)return 0;let e=0;const s=this.ap(),a=be(this.Gv.canvasElement.getContext("2d"));a.save();const c=this.Li.Ha();a.font=this._p(),c.length>0&&(e=Math.max(this.Fv.xi(a,c[0].so),this.Fv.xi(a,c[c.length-1].so)));const h=this.up();for(let v=h.length;v--;){const x=this.Fv.xi(a,h[v].Kt());x>e&&(e=x)}const d=this.Li.Ct();if(d!==null&&this.Ev!==null&&(g=this.cn.crosshair).mode!==2&&g.horzLine.visible&&g.horzLine.labelVisible){const v=this.Li.pn(1,d),x=this.Li.pn(this.Ev.height-2,d);e=Math.max(e,this.Fv.xi(a,this.Li.Fi(Math.floor(Math.min(v,x))+.11111111111111,d)),this.Fv.xi(a,this.Li.Fi(Math.ceil(Math.max(v,x))-.11111111111111,d)))}var g;a.restore();const p=e||34;return ud(Math.ceil(s.C+s.T+s.A+s.I+5+p))}cp(e){this.Ev!==null&&Mi(this.Ev,e)||(this.Ev=e,this.jv=!0,this.Gv.resizeCanvasElement(e),this.Jv.resizeCanvasElement(e),this.jv=!1,this.Kv.style.width=`${e.width}px`,this.Kv.style.height=`${e.height}px`)}dp(){return be(this.Ev).width}Gi(e){this.Li!==e&&(this.Li!==null&&this.Li.Ko().p(this),this.Li=e,e.Ko().l(this.fo.bind(this),this))}Dt(){return this.Li}nr(){const e=this.tn.fp();this.tn.$v().$t().E_(e,be(this.Dt()))}vp(e){if(this.Ev===null)return;if(e!==1){this.pp(),this.Gv.applySuggestedBitmapSize();const a=Ri(this.Gv);a!==null&&(a.useBitmapCoordinateSpace((c=>{this.mp(c),this.Ie(c)})),this.tn.bp(a,this.Xv),this.wp(a),this.tn.bp(a,this.Yv),this.gp(a))}this.Jv.applySuggestedBitmapSize();const s=Ri(this.Jv);s!==null&&(s.useBitmapCoordinateSpace((({context:a,bitmapSize:c})=>{a.clearRect(0,0,c.width,c.height)})),this.Mp(s),this.tn.bp(s,this.Zv))}xp(){return this.Gv.bitmapSize}Sp(e,s,a){const c=this.xp();c.width>0&&c.height>0&&e.drawImage(this.Gv.canvasElement,s,a)}bt(){var e;(e=this.Li)===null||e===void 0||e.Ha()}Qv(e){if(this.Li===null||this.Li.Ni()||!this.cn.handleScale.axisPressedMouseMove.price)return;const s=this.tn.$v().$t(),a=this.tn.fp();this.Nv=!0,s.V_(a,this.Li,e.localY)}tp(e){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const s=this.tn.$v().$t(),a=this.tn.fp(),c=this.Li;s.O_(a,c,e.localY)}ip(){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const e=this.tn.$v().$t(),s=this.tn.fp(),a=this.Li;this.Nv&&(this.Nv=!1,e.B_(s,a))}np(e){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const s=this.tn.$v().$t(),a=this.tn.fp();this.Nv=!1,s.B_(a,this.Li)}sp(e){this.cn.handleScale.axisDoubleClickReset.price&&this.nr()}ep(e){this.Li!==null&&(!this.tn.$v().$t().W().handleScale.axisPressedMouseMove.price||this.Li.Mh()||this.Li.Oo()||this.kp(1))}rp(e){this.kp(0)}up(){const e=[],s=this.Li===null?void 0:this.Li;return(a=>{for(let c=0;c<a.length;++c){const h=a[c].Rn(this.tn.fp(),s);for(let d=0;d<h.length;d++)e.push(h[d])}})(this.tn.fp().Uo()),e}mp({context:e,bitmapSize:s}){const{width:a,height:c}=s,h=this.tn.fp().$t(),d=h.q(),g=h.bd();d===g?nc(e,0,0,a,c,d):Hy(e,0,0,a,c,d,g)}Ie({context:e,bitmapSize:s,horizontalPixelRatio:a}){if(this.Ev===null||this.Li===null||!this.Li.W().borderVisible)return;e.fillStyle=this.Li.W().borderColor;const c=Math.max(1,Math.floor(this.ap().C*a));let h;h=this.qv?s.width-c:0,e.fillRect(h,0,c,s.height)}wp(e){if(this.Ev===null||this.Li===null)return;const s=this.Li.Ha(),a=this.Li.W(),c=this.ap(),h=this.qv?this.Ev.width-c.T:0;a.borderVisible&&a.ticksVisible&&e.useBitmapCoordinateSpace((({context:d,horizontalPixelRatio:g,verticalPixelRatio:p})=>{d.fillStyle=a.borderColor;const v=Math.max(1,Math.floor(p)),x=Math.floor(.5*p),y=Math.round(c.T*g);d.beginPath();for(const b of s)d.rect(Math.floor(h*g),Math.round(b.Ea*p)-x,y,v);d.fill()})),e.useMediaCoordinateSpace((({context:d})=>{var g;d.font=this._p(),d.fillStyle=(g=a.textColor)!==null&&g!==void 0?g:this.ko.textColor,d.textAlign=this.qv?"right":"left",d.textBaseline="middle";const p=this.qv?Math.round(h-c.A):Math.round(h+c.T+c.A),v=s.map((x=>this.Fv.Mi(d,x.so)));for(let x=s.length;x--;){const y=s[x];d.fillText(y.so,p,y.Ea+v[x])}}))}pp(){if(this.Ev===null||this.Li===null)return;const e=[],s=this.Li.Uo().slice(),a=this.tn.fp(),c=this.ap();this.Li===a.pr()&&this.tn.fp().Uo().forEach((d=>{a.vr(d)&&s.push(d)}));const h=this.Li;s.forEach((d=>{d.Rn(a,h).forEach((g=>{g.Oi(null),g.Bi()&&e.push(g)}))})),e.forEach((d=>d.Oi(d.ki()))),this.Li.W().alignLabels&&this.yp(e,c)}yp(e,s){if(this.Ev===null)return;const a=this.Ev.height/2,c=e.filter((d=>d.ki()<=a)),h=e.filter((d=>d.ki()>a));c.sort(((d,g)=>g.ki()-d.ki())),h.sort(((d,g)=>d.ki()-g.ki()));for(const d of e){const g=Math.floor(d.At(s)/2),p=d.ki();p>-g&&p<g&&d.Oi(g),p>this.Ev.height-g&&p<this.Ev.height+g&&d.Oi(this.Ev.height-g)}Ov(c,1,this.Ev.height,s),Ov(h,-1,this.Ev.height,s)}gp(e){if(this.Ev===null)return;const s=this.up(),a=this.ap(),c=this.qv?"right":"left";s.forEach((h=>{h.Ai()&&h.gt(be(this.Li)).X(e,a,this.Fv,c)}))}Mp(e){if(this.Ev===null||this.Li===null)return;const s=this.tn.$v().$t(),a=[],c=this.tn.fp(),h=s.Zc().Rn(c,this.Li);h.length&&a.push(h);const d=this.ap(),g=this.qv?"right":"left";a.forEach((p=>{p.forEach((v=>{v.gt(be(this.Li)).X(e,d,this.Fv,g)}))}))}kp(e){this.Kv.style.cursor=e===1?"ns-resize":"default"}fo(){const e=this.op();this.Wv<e&&this.tn.$v().$t().Kl(),this.Wv=e}_p(){return La(this.ko.fontSize,this.ko.fontFamily)}}function u_(i,e){var s,a;return(a=(s=i.ua)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:[]}function Ao(i,e){var s,a;return(a=(s=i.Pn)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:[]}function h_(i,e){var s,a;return(a=(s=i.Ji)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:[]}function d_(i,e){var s,a;return(a=(s=i.aa)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:[]}class Ld{constructor(e,s){this.Ev=vt({width:0,height:0}),this.Cp=null,this.Tp=null,this.Pp=null,this.Rp=null,this.Dp=!1,this.Vp=new kt,this.Op=new kt,this.Bp=0,this.Ap=!1,this.Ip=null,this.zp=!1,this.Lp=null,this.Ep=null,this.jv=!1,this.Hv=()=>{this.jv||this.Np===null||this.$i().Uh()},this.Uv=()=>{this.jv||this.Np===null||this.$i().Uh()},this.Qd=e,this.Np=s,this.Np.W_().l(this.Fp.bind(this),this,!0),this.Wp=document.createElement("td"),this.Wp.style.padding="0",this.Wp.style.position="relative";const a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="relative",a.style.overflow="hidden",this.jp=document.createElement("td"),this.jp.style.padding="0",this.Hp=document.createElement("td"),this.Hp.style.padding="0",this.Wp.appendChild(a),this.Gv=Li(a,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const c=this.Gv.canvasElement;c.style.position="absolute",c.style.zIndex="1",c.style.left="0",c.style.top="0",this.Jv=Li(a,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const h=this.Jv.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this.$p=document.createElement("tr"),this.$p.appendChild(this.jp),this.$p.appendChild(this.Wp),this.$p.appendChild(this.Hp),this.Up(),this.hp=new Ad(this.Jv.canvasElement,this,{ev:()=>this.Ip===null&&!this.Qd.W().handleScroll.vertTouchDrag,rv:()=>this.Ip===null&&!this.Qd.W().handleScroll.horzTouchDrag})}S(){this.Cp!==null&&this.Cp.S(),this.Tp!==null&&this.Tp.S(),this.Pp=null,this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),Oi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),Oi(this.Gv.canvasElement),this.Gv.dispose(),this.Np!==null&&this.Np.W_().p(this),this.hp.S()}fp(){return be(this.Np)}qp(e){var s,a;this.Np!==null&&this.Np.W_().p(this),this.Np=e,this.Np!==null&&this.Np.W_().l(Ld.prototype.Fp.bind(this),this,!0),this.Up(),this.Qd.Yp().indexOf(this)===this.Qd.Yp().length-1?(this.Pp=(s=this.Pp)!==null&&s!==void 0?s:new r_(this.Wp,this.Qd),this.Pp.bt()):((a=this.Pp)===null||a===void 0||a.if(),this.Pp=null)}$v(){return this.Qd}lp(){return this.$p}Up(){if(this.Np!==null&&(this.Zp(),this.$i().wt().length!==0)){if(this.Cp!==null){const e=this.Np.R_();this.Cp.Gi(be(e))}if(this.Tp!==null){const e=this.Np.D_();this.Tp.Gi(be(e))}}}Xp(){this.Cp!==null&&this.Cp.bt(),this.Tp!==null&&this.Tp.bt()}M_(){return this.Np!==null?this.Np.M_():0}x_(e){this.Np&&this.Np.x_(e)}Qf(e){if(!this.Np)return;this.Kp();const s=e.localX,a=e.localY;this.Gp(s,a,e)}bv(e){this.Kp(),this.Jp(),this.Gp(e.localX,e.localY,e)}tv(e){var s;if(!this.Np)return;this.Kp();const a=e.localX,c=e.localY;this.Gp(a,c,e);const h=this.wr(a,c);this.Qd.Qp((s=h?.Lv)!==null&&s!==void 0?s:null),this.$i().jc(h&&{Hc:h.Hc,Iv:h.Iv})}dv(e){this.Np!==null&&(this.Kp(),this.tm(e))}qf(e){this.Np!==null&&this.im(this.Op,e)}jf(e){this.qf(e)}av(e){this.Kp(),this.nm(e),this.Gp(e.localX,e.localY,e)}cv(e){this.Np!==null&&(this.Kp(),this.Ap=!1,this.sm(e))}uv(e){this.Np!==null&&this.tm(e)}Rv(e){if(this.Ap=!0,this.Ip===null){const s={x:e.localX,y:e.localY};this.rm(s,s,e)}}Pv(e){this.Np!==null&&(this.Kp(),this.Np.$t().jc(null),this.hm())}lm(){return this.Vp}am(){return this.Op}xv(){this.Bp=1,this.$i().Un()}Sv(e,s){if(!this.Qd.W().handleScale.pinch)return;const a=5*(s-this.Bp);this.Bp=s,this.$i().Qc(e.nt,a)}pv(e){this.Ap=!1,this.zp=this.Ip!==null,this.Jp();const s=this.$i().Zc();this.Ip!==null&&s.yt()&&(this.Lp={x:s.Yt(),y:s.Zt()},this.Ip={x:e.localX,y:e.localY})}hv(e){if(this.Np===null)return;const s=e.localX,a=e.localY;if(this.Ip===null)this.nm(e);else{this.zp=!1;const c=be(this.Lp),h=c.x+(s-this.Ip.x),d=c.y+(a-this.Ip.y);this.Gp(h,d,e)}}_v(e){this.$v().W().trackingMode.exitMode===0&&(this.zp=!0),this.om(),this.sm(e)}wr(e,s){const a=this.Np;return a===null?null:(function(c,h,d){const g=c.Uo(),p=(function(v,x,y){var b,S;let N,E;for(const F of v){const H=(S=(b=F.va)===null||b===void 0?void 0:b.call(F,x,y))!==null&&S!==void 0?S:[];for(const z of H)R=z.zOrder,(!(_=N?.zOrder)||R==="top"&&_!=="top"||R==="normal"&&_==="bottom")&&(N=z,E=F)}var R,_;return N&&E?{zv:N,Hc:E}:null})(g,h,d);if(p?.zv.zOrder==="top")return Ro(p);for(const v of g){if(p&&p.Hc===v&&p.zv.zOrder!=="bottom"&&!p.zv.isBackground)return Ro(p);const x=c_(v.Pn(c),h,d);if(x!==null)return{Hc:v,Bv:x.Bv,Iv:x.Iv};if(p&&p.Hc===v&&p.zv.zOrder!=="bottom"&&p.zv.isBackground)return Ro(p)}return p?.zv?Ro(p):null})(a,e,s)}_m(e,s){be(s==="left"?this.Cp:this.Tp).cp(vt({width:e,height:this.Ev.height}))}um(){return this.Ev}cp(e){Mi(this.Ev,e)||(this.Ev=e,this.jv=!0,this.Gv.resizeCanvasElement(e),this.Jv.resizeCanvasElement(e),this.jv=!1,this.Wp.style.width=e.width+"px",this.Wp.style.height=e.height+"px")}dm(){const e=be(this.Np);e.P_(e.R_()),e.P_(e.D_());for(const s of e.Ba())if(e.vr(s)){const a=s.Dt();a!==null&&e.P_(a),s.Vn()}}xp(){return this.Gv.bitmapSize}Sp(e,s,a){const c=this.xp();c.width>0&&c.height>0&&e.drawImage(this.Gv.canvasElement,s,a)}vp(e){if(e===0||this.Np===null)return;if(e>1&&this.dm(),this.Cp!==null&&this.Cp.vp(e),this.Tp!==null&&this.Tp.vp(e),e!==1){this.Gv.applySuggestedBitmapSize();const a=Ri(this.Gv);a!==null&&(a.useBitmapCoordinateSpace((c=>{this.mp(c)})),this.Np&&(this.fm(a,u_),this.vm(a),this.pm(a),this.fm(a,Ao),this.fm(a,h_)))}this.Jv.applySuggestedBitmapSize();const s=Ri(this.Jv);s!==null&&(s.useBitmapCoordinateSpace((({context:a,bitmapSize:c})=>{a.clearRect(0,0,c.width,c.height)})),this.bm(s),this.fm(s,d_))}wm(){return this.Cp}gm(){return this.Tp}bp(e,s){this.fm(e,s)}Fp(){this.Np!==null&&this.Np.W_().p(this),this.Np=null}tm(e){this.im(this.Vp,e)}im(e,s){const a=s.localX,c=s.localY;e.M()&&e.m(this.$i().St().Nu(a),{x:a,y:c},s)}mp({context:e,bitmapSize:s}){const{width:a,height:c}=s,h=this.$i(),d=h.q(),g=h.bd();d===g?nc(e,0,0,a,c,g):Hy(e,0,0,a,c,d,g)}vm(e){const s=be(this.Np).j_().qh().gt();s!==null&&s.X(e,!1)}pm(e){const s=this.$i().Yc();this.Mm(e,Ao,hd,s),this.Mm(e,Ao,Po,s)}bm(e){this.Mm(e,Ao,Po,this.$i().Zc())}fm(e,s){const a=be(this.Np).Uo();for(const c of a)this.Mm(e,s,hd,c);for(const c of a)this.Mm(e,s,Po,c)}Mm(e,s,a,c){const h=be(this.Np),d=h.$t().Wc(),g=d!==null&&d.Hc===c,p=d!==null&&g&&d.Iv!==void 0?d.Iv.Mr:void 0;dd(s,(v=>a(v,e,g,p)),c,h)}Zp(){if(this.Np===null)return;const e=this.Qd,s=this.Np.R_().W().visible,a=this.Np.D_().W().visible;s||this.Cp===null||(this.jp.removeChild(this.Cp.lp()),this.Cp.S(),this.Cp=null),a||this.Tp===null||(this.Hp.removeChild(this.Tp.lp()),this.Tp.S(),this.Tp=null);const c=e.$t().ud();s&&this.Cp===null&&(this.Cp=new zv(this,e.W(),c,"left"),this.jp.appendChild(this.Cp.lp())),a&&this.Tp===null&&(this.Tp=new zv(this,e.W(),c,"right"),this.Hp.appendChild(this.Tp.lp()))}xm(e){return e.Dv&&this.Ap||this.Ip!==null}Sm(e){return Math.max(0,Math.min(e,this.Ev.width-1))}km(e){return Math.max(0,Math.min(e,this.Ev.height-1))}Gp(e,s,a){this.$i().ld(this.Sm(e),this.km(s),a,be(this.Np))}hm(){this.$i().od()}om(){this.zp&&(this.Ip=null,this.hm())}rm(e,s,a){this.Ip=e,this.zp=!1,this.Gp(s.x,s.y,a);const c=this.$i().Zc();this.Lp={x:c.Yt(),y:c.Zt()}}$i(){return this.Qd.$t()}sm(e){if(!this.Dp)return;const s=this.$i(),a=this.fp();if(s.z_(a,a.vn()),this.Rp=null,this.Dp=!1,s.ed(),this.Ep!==null){const c=performance.now(),h=s.St();this.Ep.Vr(h.Hu(),c),this.Ep.Qu(c)||s.Zn(this.Ep)}}Kp(){this.Ip=null}Jp(){if(this.Np){if(this.$i().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)be(document.activeElement).blur();else{const e=document.getSelection();e!==null&&e.removeAllRanges()}!this.Np.vn().Ni()&&this.$i().St().Ni()}}nm(e){if(this.Np===null)return;const s=this.$i(),a=s.St();if(a.Ni())return;const c=this.Qd.W(),h=c.handleScroll,d=c.kineticScroll;if((!h.pressedMouseMove||e.Dv)&&(!h.horzTouchDrag&&!h.vertTouchDrag||!e.Dv))return;const g=this.Np.vn(),p=performance.now();if(this.Rp!==null||this.xm(e)||(this.Rp={x:e.clientX,y:e.clientY,Od:p,ym:e.localX,Cm:e.localY}),this.Rp!==null&&!this.Dp&&(this.Rp.x!==e.clientX||this.Rp.y!==e.clientY)){if(e.Dv&&d.touch||!e.Dv&&d.mouse){const v=a.le();this.Ep=new l_(.2/v,7/v,.997,15/v),this.Ep.Yd(a.Hu(),this.Rp.Od)}else this.Ep=null;g.Ni()||s.A_(this.Np,g,e.localY),s.nd(e.localX),this.Dp=!0}this.Dp&&(g.Ni()||s.I_(this.Np,g,e.localY),s.sd(e.localX),this.Ep!==null&&this.Ep.Yd(a.Hu(),p))}}class Iv{constructor(e,s,a,c,h){this.ft=!0,this.Ev=vt({width:0,height:0}),this.Hv=()=>this.vp(3),this.qv=e==="left",this.Oc=a.ud,this.cn=s,this.Tm=c,this.Pm=h,this.Kv=document.createElement("div"),this.Kv.style.width="25px",this.Kv.style.height="100%",this.Kv.style.overflow="hidden",this.Gv=Li(this.Kv,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv)}S(){this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),Oi(this.Gv.canvasElement),this.Gv.dispose()}lp(){return this.Kv}um(){return this.Ev}cp(e){Mi(this.Ev,e)||(this.Ev=e,this.Gv.resizeCanvasElement(e),this.Kv.style.width=`${e.width}px`,this.Kv.style.height=`${e.height}px`,this.ft=!0)}vp(e){if(e<3&&!this.ft||this.Ev.width===0||this.Ev.height===0)return;this.ft=!1,this.Gv.applySuggestedBitmapSize();const s=Ri(this.Gv);s!==null&&s.useBitmapCoordinateSpace((a=>{this.mp(a),this.Ie(a)}))}xp(){return this.Gv.bitmapSize}Sp(e,s,a){const c=this.xp();c.width>0&&c.height>0&&e.drawImage(this.Gv.canvasElement,s,a)}Ie({context:e,bitmapSize:s,horizontalPixelRatio:a,verticalPixelRatio:c}){if(!this.Tm())return;e.fillStyle=this.cn.timeScale.borderColor;const h=Math.floor(this.Oc.W().C*a),d=Math.floor(this.Oc.W().C*c),g=this.qv?s.width-h:0;e.fillRect(g,0,h,d)}mp({context:e,bitmapSize:s}){nc(e,0,0,s.width,s.height,this.Pm())}}function Od(i){return e=>{var s,a;return(a=(s=e.fa)===null||s===void 0?void 0:s.call(e,i))!==null&&a!==void 0?a:[]}}const f_=Od("normal"),m_=Od("top"),p_=Od("bottom");class g_{constructor(e,s){this.Rm=null,this.Dm=null,this.k=null,this.Vm=!1,this.Ev=vt({width:0,height:0}),this.Om=new kt,this.Fv=new Gl(5),this.jv=!1,this.Hv=()=>{this.jv||this.Qd.$t().Uh()},this.Uv=()=>{this.jv||this.Qd.$t().Uh()},this.Qd=e,this.q_=s,this.cn=e.W().layout,this.Xd=document.createElement("tr"),this.Bm=document.createElement("td"),this.Bm.style.padding="0",this.Am=document.createElement("td"),this.Am.style.padding="0",this.Kv=document.createElement("td"),this.Kv.style.height="25px",this.Kv.style.padding="0",this.Im=document.createElement("div"),this.Im.style.width="100%",this.Im.style.height="100%",this.Im.style.position="relative",this.Im.style.overflow="hidden",this.Kv.appendChild(this.Im),this.Gv=Li(this.Im,vt({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.Hv);const a=this.Gv.canvasElement;a.style.position="absolute",a.style.zIndex="1",a.style.left="0",a.style.top="0",this.Jv=Li(this.Im,vt({width:16,height:16})),this.Jv.subscribeSuggestedBitmapSizeChanged(this.Uv);const c=this.Jv.canvasElement;c.style.position="absolute",c.style.zIndex="2",c.style.left="0",c.style.top="0",this.Xd.appendChild(this.Bm),this.Xd.appendChild(this.Kv),this.Xd.appendChild(this.Am),this.zm(),this.Qd.$t().g_().l(this.zm.bind(this),this),this.hp=new Ad(this.Jv.canvasElement,this,{ev:()=>!0,rv:()=>!this.Qd.W().handleScroll.horzTouchDrag})}S(){this.hp.S(),this.Rm!==null&&this.Rm.S(),this.Dm!==null&&this.Dm.S(),this.Jv.unsubscribeSuggestedBitmapSizeChanged(this.Uv),Oi(this.Jv.canvasElement),this.Jv.dispose(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.Hv),Oi(this.Gv.canvasElement),this.Gv.dispose()}lp(){return this.Xd}Lm(){return this.Rm}Em(){return this.Dm}bv(e){if(this.Vm)return;this.Vm=!0;const s=this.Qd.$t();!s.St().Ni()&&this.Qd.W().handleScale.axisPressedMouseMove.time&&s.Jc(e.localX)}pv(e){this.bv(e)}wv(){const e=this.Qd.$t();!e.St().Ni()&&this.Vm&&(this.Vm=!1,this.Qd.W().handleScale.axisPressedMouseMove.time&&e.hd())}av(e){const s=this.Qd.$t();!s.St().Ni()&&this.Qd.W().handleScale.axisPressedMouseMove.time&&s.rd(e.localX)}hv(e){this.av(e)}cv(){this.Vm=!1;const e=this.Qd.$t();e.St().Ni()&&!this.Qd.W().handleScale.axisPressedMouseMove.time||e.hd()}_v(){this.cv()}qf(){this.Qd.W().handleScale.axisDoubleClickReset.time&&this.Qd.$t().Kn()}jf(){this.qf()}Qf(){this.Qd.$t().W().handleScale.axisPressedMouseMove.time&&this.kp(1)}Pv(){this.kp(0)}um(){return this.Ev}Nm(){return this.Om}Fm(e,s,a){Mi(this.Ev,e)||(this.Ev=e,this.jv=!0,this.Gv.resizeCanvasElement(e),this.Jv.resizeCanvasElement(e),this.jv=!1,this.Kv.style.width=`${e.width}px`,this.Kv.style.height=`${e.height}px`,this.Om.m(e)),this.Rm!==null&&this.Rm.cp(vt({width:s,height:e.height})),this.Dm!==null&&this.Dm.cp(vt({width:a,height:e.height}))}Wm(){const e=this.jm();return Math.ceil(e.C+e.T+e.P+e.L+e.B+e.Hm)}bt(){this.Qd.$t().St().Ha()}xp(){return this.Gv.bitmapSize}Sp(e,s,a){const c=this.xp();c.width>0&&c.height>0&&e.drawImage(this.Gv.canvasElement,s,a)}vp(e){if(e===0)return;if(e!==1){this.Gv.applySuggestedBitmapSize();const a=Ri(this.Gv);a!==null&&(a.useBitmapCoordinateSpace((c=>{this.mp(c),this.Ie(c),this.$m(a,p_)})),this.wp(a),this.$m(a,f_)),this.Rm!==null&&this.Rm.vp(e),this.Dm!==null&&this.Dm.vp(e)}this.Jv.applySuggestedBitmapSize();const s=Ri(this.Jv);s!==null&&(s.useBitmapCoordinateSpace((({context:a,bitmapSize:c})=>{a.clearRect(0,0,c.width,c.height)})),this.Um([...this.Qd.$t().wt(),this.Qd.$t().Zc()],s),this.$m(s,m_))}$m(e,s){const a=this.Qd.$t().wt();for(const c of a)dd(s,(h=>hd(h,e,!1,void 0)),c,void 0);for(const c of a)dd(s,(h=>Po(h,e,!1,void 0)),c,void 0)}mp({context:e,bitmapSize:s}){nc(e,0,0,s.width,s.height,this.Qd.$t().bd())}Ie({context:e,bitmapSize:s,verticalPixelRatio:a}){if(this.Qd.W().timeScale.borderVisible){e.fillStyle=this.qm();const c=Math.max(1,Math.floor(this.jm().C*a));e.fillRect(0,0,s.width,c)}}wp(e){const s=this.Qd.$t().St(),a=s.Ha();if(!a||a.length===0)return;const c=this.q_.maxTickMarkWeight(a),h=this.jm(),d=s.W();d.borderVisible&&d.ticksVisible&&e.useBitmapCoordinateSpace((({context:g,horizontalPixelRatio:p,verticalPixelRatio:v})=>{g.strokeStyle=this.qm(),g.fillStyle=this.qm();const x=Math.max(1,Math.floor(p)),y=Math.floor(.5*p);g.beginPath();const b=Math.round(h.T*v);for(let S=a.length;S--;){const N=Math.round(a[S].coord*p);g.rect(N-y,0,x,b)}g.fill()})),e.useMediaCoordinateSpace((({context:g})=>{const p=h.C+h.T+h.L+h.P/2;g.textAlign="center",g.textBaseline="middle",g.fillStyle=this.$(),g.font=this._p();for(const v of a)if(v.weight<c){const x=v.needAlignCoordinate?this.Ym(g,v.coord,v.label):v.coord;g.fillText(v.label,x,p)}this.Qd.W().timeScale.allowBoldLabels&&(g.font=this.Zm());for(const v of a)if(v.weight>=c){const x=v.needAlignCoordinate?this.Ym(g,v.coord,v.label):v.coord;g.fillText(v.label,x,p)}}))}Ym(e,s,a){const c=this.Fv.xi(e,a),h=c/2,d=Math.floor(s-h)+.5;return d<0?s+=Math.abs(0-d):d+c>this.Ev.width&&(s-=Math.abs(this.Ev.width-(d+c))),s}Um(e,s){const a=this.jm();for(const c of e)for(const h of c.Qi())h.gt().X(s,a)}qm(){return this.Qd.W().timeScale.borderColor}$(){return this.cn.textColor}j(){return this.cn.fontSize}_p(){return La(this.j(),this.cn.fontFamily)}Zm(){return La(this.j(),this.cn.fontFamily,"bold")}jm(){this.k===null&&(this.k={C:1,N:NaN,L:NaN,B:NaN,ji:NaN,T:5,P:NaN,R:"",Wi:new Gl,Hm:0});const e=this.k,s=this._p();if(e.R!==s){const a=this.j();e.P=a,e.R=s,e.L=3*a/12,e.B=3*a/12,e.ji=9*a/12,e.N=0,e.Hm=4*a/12,e.Wi.nr()}return this.k}kp(e){this.Kv.style.cursor=e===1?"ew-resize":"default"}zm(){const e=this.Qd.$t(),s=e.W();s.leftPriceScale.visible||this.Rm===null||(this.Bm.removeChild(this.Rm.lp()),this.Rm.S(),this.Rm=null),s.rightPriceScale.visible||this.Dm===null||(this.Am.removeChild(this.Dm.lp()),this.Dm.S(),this.Dm=null);const a={ud:this.Qd.$t().ud()},c=()=>s.leftPriceScale.borderVisible&&e.St().W().borderVisible,h=()=>e.bd();s.leftPriceScale.visible&&this.Rm===null&&(this.Rm=new Iv("left",s,a,c,h),this.Bm.appendChild(this.Rm.lp())),s.rightPriceScale.visible&&this.Dm===null&&(this.Dm=new Iv("right",s,a,c,h),this.Am.appendChild(this.Dm.lp()))}}const v_=!!Oa&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((i=>i.brand.includes("Chromium")))&&!!Oa&&(!((Uh=navigator?.userAgentData)===null||Uh===void 0)&&Uh.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0);var Uh;class y_{constructor(e,s,a){var c;this.Xm=[],this.Km=0,this.ho=0,this.__=0,this.Gm=0,this.Jm=0,this.Qm=null,this.tb=!1,this.Vp=new kt,this.Op=new kt,this.Rc=new kt,this.ib=null,this.nb=null,this.Jd=e,this.cn=s,this.q_=a,this.Xd=document.createElement("div"),this.Xd.classList.add("tv-lightweight-charts"),this.Xd.style.overflow="hidden",this.Xd.style.direction="ltr",this.Xd.style.width="100%",this.Xd.style.height="100%",(c=this.Xd).style.userSelect="none",c.style.webkitUserSelect="none",c.style.msUserSelect="none",c.style.MozUserSelect="none",c.style.webkitTapHighlightColor="transparent",this.sb=document.createElement("table"),this.sb.setAttribute("cellspacing","0"),this.Xd.appendChild(this.sb),this.eb=this.rb.bind(this),Vh(this.cn)&&this.hb(!0),this.$i=new t_(this.Vc.bind(this),this.cn,a),this.$t().Xc().l(this.lb.bind(this),this),this.ab=new g_(this,this.q_),this.sb.appendChild(this.ab.lp());const h=s.autoSize&&this.ob();let d=this.cn.width,g=this.cn.height;if(h||d===0||g===0){const p=e.getBoundingClientRect();d=d||p.width,g=g||p.height}this._b(d,g),this.ub(),e.appendChild(this.Xd),this.cb(),this.$i.St().ec().l(this.$i.Kl.bind(this.$i),this),this.$i.g_().l(this.$i.Kl.bind(this.$i),this)}$t(){return this.$i}W(){return this.cn}Yp(){return this.Xm}fb(){return this.ab}S(){this.hb(!1),this.Km!==0&&window.cancelAnimationFrame(this.Km),this.$i.Xc().p(this),this.$i.St().ec().p(this),this.$i.g_().p(this),this.$i.S();for(const e of this.Xm)this.sb.removeChild(e.lp()),e.lm().p(this),e.am().p(this),e.S();this.Xm=[],be(this.ab).S(),this.Xd.parentElement!==null&&this.Xd.parentElement.removeChild(this.Xd),this.Rc.S(),this.Vp.S(),this.Op.S(),this.pb()}_b(e,s,a=!1){if(this.ho===s&&this.__===e)return;const c=(function(g){const p=Math.floor(g.width),v=Math.floor(g.height);return vt({width:p-p%2,height:v-v%2})})(vt({width:e,height:s}));this.ho=c.height,this.__=c.width;const h=this.ho+"px",d=this.__+"px";be(this.Xd).style.height=h,be(this.Xd).style.width=d,this.sb.style.height=h,this.sb.style.width=d,a?this.mb(Wt.es(),performance.now()):this.$i.Kl()}vp(e){e===void 0&&(e=Wt.es());for(let s=0;s<this.Xm.length;s++)this.Xm[s].vp(e.Hn(s).Fn);this.cn.timeScale.visible&&this.ab.vp(e.jn())}$h(e){const s=Vh(this.cn);this.$i.$h(e);const a=Vh(this.cn);a!==s&&this.hb(a),this.cb(),this.bb(e)}lm(){return this.Vp}am(){return this.Op}Xc(){return this.Rc}wb(){this.Qm!==null&&(this.mb(this.Qm,performance.now()),this.Qm=null);const e=this.gb(null),s=document.createElement("canvas");s.width=e.width,s.height=e.height;const a=be(s.getContext("2d"));return this.gb(a),s}Mb(e){return e==="left"&&!this.xb()||e==="right"&&!this.Sb()||this.Xm.length===0?0:be(e==="left"?this.Xm[0].wm():this.Xm[0].gm()).dp()}kb(){return this.cn.autoSize&&this.ib!==null}yb(){return this.Xd}Qp(e){this.nb=e,this.nb?this.yb().style.setProperty("cursor",e):this.yb().style.removeProperty("cursor")}Cb(){return this.nb}Tb(){return Jt(this.Xm[0]).um()}bb(e){(e.autoSize!==void 0||!this.ib||e.width===void 0&&e.height===void 0)&&(e.autoSize&&!this.ib&&this.ob(),e.autoSize===!1&&this.ib!==null&&this.pb(),e.autoSize||e.width===void 0&&e.height===void 0||this._b(e.width||this.__,e.height||this.ho))}gb(e){let s=0,a=0;const c=this.Xm[0],h=(g,p)=>{let v=0;for(let x=0;x<this.Xm.length;x++){const y=this.Xm[x],b=be(g==="left"?y.wm():y.gm()),S=b.xp();e!==null&&b.Sp(e,p,v),v+=S.height}};this.xb()&&(h("left",0),s+=be(c.wm()).xp().width);for(let g=0;g<this.Xm.length;g++){const p=this.Xm[g],v=p.xp();e!==null&&p.Sp(e,s,a),a+=v.height}s+=c.xp().width,this.Sb()&&(h("right",s),s+=be(c.gm()).xp().width);const d=(g,p,v)=>{be(g==="left"?this.ab.Lm():this.ab.Em()).Sp(be(e),p,v)};if(this.cn.timeScale.visible){const g=this.ab.xp();if(e!==null){let p=0;this.xb()&&(d("left",p,a),p=be(c.wm()).xp().width),this.ab.Sp(e,p,a),p+=g.width,this.Sb()&&d("right",p,a)}a+=g.height}return vt({width:s,height:a})}Pb(){let e=0,s=0,a=0;for(const N of this.Xm)this.xb()&&(s=Math.max(s,be(N.wm()).op(),this.cn.leftPriceScale.minimumWidth)),this.Sb()&&(a=Math.max(a,be(N.gm()).op(),this.cn.rightPriceScale.minimumWidth)),e+=N.M_();s=ud(s),a=ud(a);const c=this.__,h=this.ho,d=Math.max(c-s-a,0),g=this.cn.timeScale.visible;let p=g?Math.max(this.ab.Wm(),this.cn.timeScale.minimumHeight):0;var v;p=(v=p)+v%2;const x=0+p,y=h<x?0:h-x,b=y/e;let S=0;for(let N=0;N<this.Xm.length;++N){const E=this.Xm[N];E.qp(this.$i.qc()[N]);let R=0,_=0;_=N===this.Xm.length-1?y-S:Math.round(E.M_()*b),R=Math.max(_,2),S+=R,E.cp(vt({width:d,height:R})),this.xb()&&E._m(s,"left"),this.Sb()&&E._m(a,"right"),E.fp()&&this.$i.Kc(E.fp(),R)}this.ab.Fm(vt({width:g?d:0,height:p}),g?s:0,g?a:0),this.$i.S_(d),this.Gm!==s&&(this.Gm=s),this.Jm!==a&&(this.Jm=a)}hb(e){e?this.Xd.addEventListener("wheel",this.eb,{passive:!1}):this.Xd.removeEventListener("wheel",this.eb)}Rb(e){switch(e.deltaMode){case e.DOM_DELTA_PAGE:return 120;case e.DOM_DELTA_LINE:return 32}return v_?1/window.devicePixelRatio:1}rb(e){if(!(e.deltaX!==0&&this.cn.handleScroll.mouseWheel||e.deltaY!==0&&this.cn.handleScale.mouseWheel))return;const s=this.Rb(e),a=s*e.deltaX/100,c=-s*e.deltaY/100;if(e.cancelable&&e.preventDefault(),c!==0&&this.cn.handleScale.mouseWheel){const h=Math.sign(c)*Math.min(1,Math.abs(c)),d=e.clientX-this.Xd.getBoundingClientRect().left;this.$t().Qc(d,h)}a!==0&&this.cn.handleScroll.mouseWheel&&this.$t().td(-80*a)}mb(e,s){var a;const c=e.jn();c===3&&this.Db(),c!==3&&c!==2||(this.Vb(e),this.Ob(e,s),this.ab.bt(),this.Xm.forEach((h=>{h.Xp()})),((a=this.Qm)===null||a===void 0?void 0:a.jn())===3&&(this.Qm.ts(e),this.Db(),this.Vb(this.Qm),this.Ob(this.Qm,s),e=this.Qm,this.Qm=null)),this.vp(e)}Ob(e,s){for(const a of e.Qn())this.ns(a,s)}Vb(e){const s=this.$i.qc();for(let a=0;a<s.length;a++)e.Hn(a).Wn&&s[a].N_()}ns(e,s){const a=this.$i.St();switch(e.qn){case 0:a.hc();break;case 1:a.lc(e.Vt);break;case 2:a.Gn(e.Vt);break;case 3:a.Jn(e.Vt);break;case 4:a.qu();break;case 5:e.Vt.Qu(s)||a.Jn(e.Vt.tc(s))}}Vc(e){this.Qm!==null?this.Qm.ts(e):this.Qm=e,this.tb||(this.tb=!0,this.Km=window.requestAnimationFrame((s=>{if(this.tb=!1,this.Km=0,this.Qm!==null){const a=this.Qm;this.Qm=null,this.mb(a,s);for(const c of a.Qn())if(c.qn===5&&!c.Vt.Qu(s)){this.$t().Zn(c.Vt);break}}})))}Db(){this.ub()}ub(){const e=this.$i.qc(),s=e.length,a=this.Xm.length;for(let c=s;c<a;c++){const h=Jt(this.Xm.pop());this.sb.removeChild(h.lp()),h.lm().p(this),h.am().p(this),h.S()}for(let c=a;c<s;c++){const h=new Ld(this,e[c]);h.lm().l(this.Bb.bind(this),this),h.am().l(this.Ab.bind(this),this),this.Xm.push(h),this.sb.insertBefore(h.lp(),this.ab.lp())}for(let c=0;c<s;c++){const h=e[c],d=this.Xm[c];d.fp()!==h?d.qp(h):d.Up()}this.cb(),this.Pb()}Ib(e,s,a){var c;const h=new Map;e!==null&&this.$i.wt().forEach((x=>{const y=x.In().ll(e);y!==null&&h.set(x,y)}));let d;if(e!==null){const x=(c=this.$i.St().Ui(e))===null||c===void 0?void 0:c.originalTime;x!==void 0&&(d=x)}const g=this.$t().Wc(),p=g!==null&&g.Hc instanceof Dd?g.Hc:void 0,v=g!==null&&g.Iv!==void 0?g.Iv.gr:void 0;return{zb:d,ee:e??void 0,Lb:s??void 0,Eb:p,Nb:h,Fb:v,Wb:a??void 0}}Bb(e,s,a){this.Vp.m((()=>this.Ib(e,s,a)))}Ab(e,s,a){this.Op.m((()=>this.Ib(e,s,a)))}lb(e,s,a){this.Rc.m((()=>this.Ib(e,s,a)))}cb(){const e=this.cn.timeScale.visible?"":"none";this.ab.lp().style.display=e}xb(){return this.Xm[0].fp().R_().W().visible}Sb(){return this.Xm[0].fp().D_().W().visible}ob(){return"ResizeObserver"in window&&(this.ib=new ResizeObserver((e=>{const s=e.find((a=>a.target===this.Jd));s&&this._b(s.contentRect.width,s.contentRect.height)})),this.ib.observe(this.Jd,{box:"border-box"}),!0)}pb(){this.ib!==null&&this.ib.disconnect(),this.ib=null}}function Vh(i){return!!(i.handleScroll.mouseWheel||i.handleScale.mouseWheel)}function b_(i){return(function(e){return e.open!==void 0})(i)||(function(e){return e.value!==void 0})(i)}function o0(i,e){var s={};for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&e.indexOf(a)<0&&(s[a]=i[a]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function"){var c=0;for(a=Object.getOwnPropertySymbols(i);c<a.length;c++)e.indexOf(a[c])<0&&Object.prototype.propertyIsEnumerable.call(i,a[c])&&(s[a[c]]=i[a[c]])}return s}function Pv(i,e,s,a){const c=s.value,h={ee:e,ot:i,Vt:[c,c,c,c],zb:a};return s.color!==void 0&&(h.V=s.color),h}function x_(i,e,s,a){const c=s.value,h={ee:e,ot:i,Vt:[c,c,c,c],zb:a};return s.lineColor!==void 0&&(h.lt=s.lineColor),s.topColor!==void 0&&(h.Ps=s.topColor),s.bottomColor!==void 0&&(h.Rs=s.bottomColor),h}function w_(i,e,s,a){const c=s.value,h={ee:e,ot:i,Vt:[c,c,c,c],zb:a};return s.topLineColor!==void 0&&(h.Re=s.topLineColor),s.bottomLineColor!==void 0&&(h.De=s.bottomLineColor),s.topFillColor1!==void 0&&(h.ke=s.topFillColor1),s.topFillColor2!==void 0&&(h.ye=s.topFillColor2),s.bottomFillColor1!==void 0&&(h.Ce=s.bottomFillColor1),s.bottomFillColor2!==void 0&&(h.Te=s.bottomFillColor2),h}function S_(i,e,s,a){const c={ee:e,ot:i,Vt:[s.open,s.high,s.low,s.close],zb:a};return s.color!==void 0&&(c.V=s.color),c}function __(i,e,s,a){const c={ee:e,ot:i,Vt:[s.open,s.high,s.low,s.close],zb:a};return s.color!==void 0&&(c.V=s.color),s.borderColor!==void 0&&(c.Ot=s.borderColor),s.wickColor!==void 0&&(c.Xh=s.wickColor),c}function j_(i,e,s,a,c){const h=Jt(c)(s),d=Math.max(...h),g=Math.min(...h),p=h[h.length-1],v=[p,d,g,p],x=s,{time:y,color:b}=x;return{ee:e,ot:i,Vt:v,zb:a,$e:o0(x,["time","color"]),V:b}}function Lo(i){return i.Vt!==void 0}function Bv(i,e){return e.customValues!==void 0&&(i.jb=e.customValues),i}function Ei(i){return(e,s,a,c,h,d)=>(function(g,p){return p?p(g):(v=g).open===void 0&&v.value===void 0;var v})(a,d)?Bv({ot:e,ee:s,zb:c},a):Bv(i(e,s,a,c,h),a)}function $v(i){return{Candlestick:Ei(__),Bar:Ei(S_),Area:Ei(x_),Baseline:Ei(w_),Histogram:Ei(Pv),Line:Ei(Pv),Custom:Ei(j_)}[i]}function Uv(i){return{ee:0,Hb:new Map,la:i}}function Vv(i,e){if(i!==void 0&&i.length!==0)return{$b:e.key(i[0].ot),Ub:e.key(i[i.length-1].ot)}}function Hv(i){let e;return i.forEach((s=>{e===void 0&&(e=s.zb)})),Jt(e)}class N_{constructor(e){this.qb=new Map,this.Yb=new Map,this.Zb=new Map,this.Xb=[],this.q_=e}S(){this.qb.clear(),this.Yb.clear(),this.Zb.clear(),this.Xb=[]}Kb(e,s){let a=this.qb.size!==0,c=!1;const h=this.Yb.get(e);if(h!==void 0)if(this.Yb.size===1)a=!1,c=!0,this.qb.clear();else for(const p of this.Xb)p.pointData.Hb.delete(e)&&(c=!0);let d=[];if(s.length!==0){const p=s.map((S=>S.time)),v=this.q_.createConverterToInternalObj(s),x=$v(e.Qh()),y=e.Ca(),b=e.Ta();d=s.map(((S,N)=>{const E=v(S.time),R=this.q_.key(E);let _=this.qb.get(R);_===void 0&&(_=Uv(E),this.qb.set(R,_),c=!0);const F=x(E,_.ee,S,p[N],y,b);return _.Hb.set(e,F),F}))}a&&this.Gb(),this.Jb(e,d);let g=-1;if(c){const p=[];this.qb.forEach((v=>{p.push({timeWeight:0,time:v.la,pointData:v,originalTime:Hv(v.Hb)})})),p.sort(((v,x)=>this.q_.key(v.time)-this.q_.key(x.time))),g=this.Qb(p)}return this.tw(e,g,(function(p,v,x){const y=Vv(p,x),b=Vv(v,x);if(y!==void 0&&b!==void 0)return{ta:y.Ub>=b.Ub&&y.$b>=b.$b}})(this.Yb.get(e),h,this.q_))}vd(e){return this.Kb(e,[])}iw(e,s){const a=s;(function(E){E.zb===void 0&&(E.zb=E.time)})(a),this.q_.preprocessData(s);const c=this.q_.createConverterToInternalObj([s])(s.time),h=this.Zb.get(e);if(h!==void 0&&this.q_.key(c)<this.q_.key(h))throw new Error(`Cannot update oldest data, last time=${h}, new time=${c}`);let d=this.qb.get(this.q_.key(c));const g=d===void 0;d===void 0&&(d=Uv(c),this.qb.set(this.q_.key(c),d));const p=$v(e.Qh()),v=e.Ca(),x=e.Ta(),y=p(c,d.ee,s,a.zb,v,x);d.Hb.set(e,y),this.nw(e,y);const b={ta:Lo(y)};if(!g)return this.tw(e,-1,b);const S={timeWeight:0,time:d.la,pointData:d,originalTime:Hv(d.Hb)},N=tr(this.Xb,this.q_.key(S.time),((E,R)=>this.q_.key(E.time)<R));this.Xb.splice(N,0,S);for(let E=N;E<this.Xb.length;++E)Hh(this.Xb[E].pointData,E);return this.q_.fillWeightsForPoints(this.Xb,N),this.tw(e,N,b)}nw(e,s){let a=this.Yb.get(e);a===void 0&&(a=[],this.Yb.set(e,a));const c=a.length!==0?a[a.length-1]:null;c===null||this.q_.key(s.ot)>this.q_.key(c.ot)?Lo(s)&&a.push(s):Lo(s)?a[a.length-1]=s:a.splice(-1,1),this.Zb.set(e,s.ot)}Jb(e,s){s.length!==0?(this.Yb.set(e,s.filter(Lo)),this.Zb.set(e,s[s.length-1].ot)):(this.Yb.delete(e),this.Zb.delete(e))}Gb(){for(const e of this.Xb)e.pointData.Hb.size===0&&this.qb.delete(this.q_.key(e.time))}Qb(e){let s=-1;for(let a=0;a<this.Xb.length&&a<e.length;++a){const c=this.Xb[a],h=e[a];if(this.q_.key(c.time)!==this.q_.key(h.time)){s=a;break}h.timeWeight=c.timeWeight,Hh(h.pointData,a)}if(s===-1&&this.Xb.length!==e.length&&(s=Math.min(this.Xb.length,e.length)),s===-1)return-1;for(let a=s;a<e.length;++a)Hh(e[a].pointData,a);return this.q_.fillWeightsForPoints(e,s),this.Xb=e,s}sw(){if(this.Yb.size===0)return null;let e=0;return this.Yb.forEach((s=>{s.length!==0&&(e=Math.max(e,s[s.length-1].ee))})),e}tw(e,s,a){const c={ew:new Map,St:{Eu:this.sw()}};if(s!==-1)this.Yb.forEach(((h,d)=>{c.ew.set(d,{$e:h,rw:d===e?a:void 0})})),this.Yb.has(e)||c.ew.set(e,{$e:[],rw:a}),c.St.hw=this.Xb,c.St.lw=s;else{const h=this.Yb.get(e);c.ew.set(e,{$e:h||[],rw:a})}return c}}function Hh(i,e){i.ee=e,i.Hb.forEach((s=>{s.ee=e}))}function zd(i){const e={value:i.Vt[3],time:i.zb};return i.jb!==void 0&&(e.customValues=i.jb),e}function qv(i){const e=zd(i);return i.V!==void 0&&(e.color=i.V),e}function E_(i){const e=zd(i);return i.lt!==void 0&&(e.lineColor=i.lt),i.Ps!==void 0&&(e.topColor=i.Ps),i.Rs!==void 0&&(e.bottomColor=i.Rs),e}function T_(i){const e=zd(i);return i.Re!==void 0&&(e.topLineColor=i.Re),i.De!==void 0&&(e.bottomLineColor=i.De),i.ke!==void 0&&(e.topFillColor1=i.ke),i.ye!==void 0&&(e.topFillColor2=i.ye),i.Ce!==void 0&&(e.bottomFillColor1=i.Ce),i.Te!==void 0&&(e.bottomFillColor2=i.Te),e}function c0(i){const e={open:i.Vt[0],high:i.Vt[1],low:i.Vt[2],close:i.Vt[3],time:i.zb};return i.jb!==void 0&&(e.customValues=i.jb),e}function k_(i){const e=c0(i);return i.V!==void 0&&(e.color=i.V),e}function C_(i){const e=c0(i),{V:s,Ot:a,Xh:c}=i;return s!==void 0&&(e.color=s),a!==void 0&&(e.borderColor=a),c!==void 0&&(e.wickColor=c),e}function fd(i){return{Area:E_,Line:qv,Baseline:T_,Histogram:qv,Bar:k_,Candlestick:C_,Custom:M_}[i]}function M_(i){const e=i.zb;return Object.assign(Object.assign({},i.$e),{time:e})}const D_={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},R_={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},A_={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:Nd,attributionLogo:!0},qh={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},L_={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},O_={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Nd,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function Fv(){return{width:0,height:0,autoSize:!1,layout:A_,crosshair:D_,grid:R_,overlayPriceScales:Object.assign({},qh),leftPriceScale:Object.assign(Object.assign({},qh),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},qh),{visible:!0}),timeScale:L_,watermark:O_,localization:{locale:Oa?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class z_{constructor(e,s){this.aw=e,this.ow=s}applyOptions(e){this.aw.$t().$c(this.ow,e)}options(){return this.Li().W()}width(){return ac(this.ow)?this.aw.Mb(this.ow):0}Li(){return be(this.aw.$t().Uc(this.ow)).Dt}}function Wv(i,e,s){const a=o0(i,["time","originalTime"]),c=Object.assign({time:e},a);return s!==void 0&&(c.originalTime=s),c}const I_={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class P_{constructor(e){this.Nh=e}applyOptions(e){this.Nh.$h(e)}options(){return this.Nh.W()}_w(){return this.Nh}}class B_{constructor(e,s,a,c,h){this.uw=new kt,this.Es=e,this.cw=s,this.dw=a,this.q_=h,this.fw=c}S(){this.uw.S()}priceFormatter(){return this.Es.ba()}priceToCoordinate(e){const s=this.Es.Ct();return s===null?null:this.Es.Dt().Rt(e,s.Vt)}coordinateToPrice(e){const s=this.Es.Ct();return s===null?null:this.Es.Dt().pn(e,s.Vt)}barsInLogicalRange(e){if(e===null)return null;const s=new ka(new Ul(e.from,e.to)).lu(),a=this.Es.In();if(a.Ni())return null;const c=a.ll(s.Os(),1),h=a.ll(s.ui(),-1),d=be(a.el()),g=be(a.An());if(c!==null&&h!==null&&c.ee>h.ee)return{barsBefore:e.from-d,barsAfter:g-e.to};const p={barsBefore:c===null||c.ee===d?e.from-d:c.ee-d,barsAfter:h===null||h.ee===g?g-e.to:g-h.ee};return c!==null&&h!==null&&(p.from=c.zb,p.to=h.zb),p}setData(e){this.q_,this.Es.Qh(),this.cw.pw(this.Es,e),this.mw("full")}update(e){this.Es.Qh(),this.cw.bw(this.Es,e),this.mw("update")}dataByIndex(e,s){const a=this.Es.In().ll(e,s);return a===null?null:fd(this.seriesType())(a)}data(){const e=fd(this.seriesType());return this.Es.In().ne().map((s=>e(s)))}subscribeDataChanged(e){this.uw.l(e)}unsubscribeDataChanged(e){this.uw.v(e)}setMarkers(e){this.q_;const s=e.map((a=>Wv(a,this.q_.convertHorzItemToInternal(a.time),a.time)));this.Es.na(s)}markers(){return this.Es.sa().map((e=>Wv(e,e.originalTime,void 0)))}applyOptions(e){this.Es.$h(e)}options(){return xn(this.Es.W())}priceScale(){return this.dw.priceScale(this.Es.Dt().Pa())}createPriceLine(e){const s=Is(xn(I_),e),a=this.Es.ea(s);return new P_(a)}removePriceLine(e){this.Es.ra(e._w())}seriesType(){return this.Es.Qh()}attachPrimitive(e){this.Es.ka(e),e.attached&&e.attached({chart:this.fw,series:this,requestUpdate:()=>this.Es.$t().Kl()})}detachPrimitive(e){this.Es.ya(e),e.detached&&e.detached()}mw(e){this.uw.M()&&this.uw.m(e)}}class $_{constructor(e,s,a){this.ww=new kt,this.mu=new kt,this.Om=new kt,this.$i=e,this.yl=e.St(),this.ab=s,this.yl.nc().l(this.gw.bind(this)),this.yl.sc().l(this.Mw.bind(this)),this.ab.Nm().l(this.xw.bind(this)),this.q_=a}S(){this.yl.nc().p(this),this.yl.sc().p(this),this.ab.Nm().p(this),this.ww.S(),this.mu.S(),this.Om.S()}scrollPosition(){return this.yl.Hu()}scrollToPosition(e,s){s?this.yl.Ju(e,1e3):this.$i.Jn(e)}scrollToRealTime(){this.yl.Gu()}getVisibleRange(){const e=this.yl.Vu();return e===null?null:{from:e.from.originalTime,to:e.to.originalTime}}setVisibleRange(e){const s={from:this.q_.convertHorzItemToInternal(e.from),to:this.q_.convertHorzItemToInternal(e.to)},a=this.yl.Iu(s);this.$i.pd(a)}getVisibleLogicalRange(){const e=this.yl.Du();return e===null?null:{from:e.Os(),to:e.ui()}}setVisibleLogicalRange(e){ai(e.from<=e.to,"The from index cannot be after the to index."),this.$i.pd(e)}resetTimeScale(){this.$i.Kn()}fitContent(){this.$i.hc()}logicalToCoordinate(e){const s=this.$i.St();return s.Ni()?null:s.It(e)}coordinateToLogical(e){return this.yl.Ni()?null:this.yl.Nu(e)}timeToCoordinate(e){const s=this.q_.convertHorzItemToInternal(e),a=this.yl.Va(s,!1);return a===null?null:this.yl.It(a)}coordinateToTime(e){const s=this.$i.St(),a=s.Nu(e),c=s.Ui(a);return c===null?null:c.originalTime}width(){return this.ab.um().width}height(){return this.ab.um().height}subscribeVisibleTimeRangeChange(e){this.ww.l(e)}unsubscribeVisibleTimeRangeChange(e){this.ww.v(e)}subscribeVisibleLogicalRangeChange(e){this.mu.l(e)}unsubscribeVisibleLogicalRangeChange(e){this.mu.v(e)}subscribeSizeChange(e){this.Om.l(e)}unsubscribeSizeChange(e){this.Om.v(e)}applyOptions(e){this.yl.$h(e)}options(){return Object.assign(Object.assign({},xn(this.yl.W())),{barSpacing:this.yl.le()})}gw(){this.ww.M()&&this.ww.m(this.getVisibleRange())}Mw(){this.mu.M()&&this.mu.m(this.getVisibleLogicalRange())}xw(e){this.Om.m(e.width,e.height)}}function U_(i){if(i===void 0||i.type==="custom")return;const e=i;e.minMove!==void 0&&e.precision===void 0&&(e.precision=(function(s){if(s>=1)return 0;let a=0;for(;a<8;a++){const c=Math.round(s);if(Math.abs(c-s)<1e-8)return a;s*=10}return a})(e.minMove))}function Gv(i){return(function(e){if(No(e.handleScale)){const a=e.handleScale;e.handleScale={axisDoubleClickReset:{time:a,price:a},axisPressedMouseMove:{time:a,price:a},mouseWheel:a,pinch:a}}else if(e.handleScale!==void 0){const{axisPressedMouseMove:a,axisDoubleClickReset:c}=e.handleScale;No(a)&&(e.handleScale.axisPressedMouseMove={time:a,price:a}),No(c)&&(e.handleScale.axisDoubleClickReset={time:c,price:c})}const s=e.handleScroll;No(s)&&(e.handleScroll={horzTouchDrag:s,vertTouchDrag:s,mouseWheel:s,pressedMouseMove:s})})(i),i}class V_{constructor(e,s,a){this.Sw=new Map,this.kw=new Map,this.yw=new kt,this.Cw=new kt,this.Tw=new kt,this.Pw=new N_(s);const c=a===void 0?xn(Fv()):Is(xn(Fv()),Gv(a));this.q_=s,this.aw=new y_(e,c,s),this.aw.lm().l((d=>{this.yw.M()&&this.yw.m(this.Rw(d()))}),this),this.aw.am().l((d=>{this.Cw.M()&&this.Cw.m(this.Rw(d()))}),this),this.aw.Xc().l((d=>{this.Tw.M()&&this.Tw.m(this.Rw(d()))}),this);const h=this.aw.$t();this.Dw=new $_(h,this.aw.fb(),this.q_)}remove(){this.aw.lm().p(this),this.aw.am().p(this),this.aw.Xc().p(this),this.Dw.S(),this.aw.S(),this.Sw.clear(),this.kw.clear(),this.yw.S(),this.Cw.S(),this.Tw.S(),this.Pw.S()}resize(e,s,a){this.autoSizeActive()||this.aw._b(e,s,a)}addCustomSeries(e,s){const a=Ea(e),c=Object.assign(Object.assign({},Py),a.defaultOptions());return this.Vw("Custom",c,s,a)}addAreaSeries(e){return this.Vw("Area",Nw,e)}addBaselineSeries(e){return this.Vw("Baseline",Ew,e)}addBarSeries(e){return this.Vw("Bar",_w,e)}addCandlestickSeries(e={}){return(function(s){s.borderColor!==void 0&&(s.borderUpColor=s.borderColor,s.borderDownColor=s.borderColor),s.wickColor!==void 0&&(s.wickUpColor=s.wickColor,s.wickDownColor=s.wickColor)})(e),this.Vw("Candlestick",Sw,e)}addHistogramSeries(e){return this.Vw("Histogram",Tw,e)}addLineSeries(e){return this.Vw("Line",jw,e)}removeSeries(e){const s=Jt(this.Sw.get(e)),a=this.Pw.vd(s);this.aw.$t().vd(s),this.Ow(a),this.Sw.delete(e),this.kw.delete(s)}pw(e,s){this.Ow(this.Pw.Kb(e,s))}bw(e,s){this.Ow(this.Pw.iw(e,s))}subscribeClick(e){this.yw.l(e)}unsubscribeClick(e){this.yw.v(e)}subscribeCrosshairMove(e){this.Tw.l(e)}unsubscribeCrosshairMove(e){this.Tw.v(e)}subscribeDblClick(e){this.Cw.l(e)}unsubscribeDblClick(e){this.Cw.v(e)}priceScale(e){return new z_(this.aw,e)}timeScale(){return this.Dw}applyOptions(e){this.aw.$h(Gv(e))}options(){return this.aw.W()}takeScreenshot(){return this.aw.wb()}autoSizeActive(){return this.aw.kb()}chartElement(){return this.aw.yb()}paneSize(){const e=this.aw.Tb();return{height:e.height,width:e.width}}setCrosshairPosition(e,s,a){const c=this.Sw.get(a);if(c===void 0)return;const h=this.aw.$t().dr(c);h!==null&&this.aw.$t().ad(e,s,h)}clearCrosshairPosition(){this.aw.$t().od(!0)}Vw(e,s,a={},c){U_(a.priceFormat);const h=Is(xn(By),xn(s),a),d=this.aw.$t().dd(e,h,c),g=new B_(d,this,this,this,this.q_);return this.Sw.set(g,d),this.kw.set(d,g),g}Ow(e){const s=this.aw.$t();s._d(e.St.Eu,e.St.hw,e.St.lw),e.ew.forEach(((a,c)=>c.J(a.$e,a.rw))),s.Wu()}Bw(e){return Jt(this.kw.get(e))}Rw(e){const s=new Map;e.Nb.forEach(((c,h)=>{const d=h.Qh(),g=fd(d)(c);if(d!=="Custom")ai(b_(g));else{const p=h.Ta();ai(!p||p(g)===!1)}s.set(this.Bw(h),g)}));const a=e.Eb!==void 0&&this.kw.has(e.Eb)?this.Bw(e.Eb):void 0;return{time:e.zb,logical:e.ee,point:e.Lb,hoveredSeries:a,hoveredObjectId:e.Fb,seriesData:s,sourceEvent:e.Wb}}}function H_(i,e,s){let a;if(er(i)){const h=document.getElementById(i);ai(h!==null,`Cannot find element in DOM with id=${i}`),a=h}else a=i;const c=new V_(a,e,s);return e.setOptions(c.options()),c}function q_(i,e){return H_(i,new Rv,Rv.Id(e))}Object.assign(Object.assign({},By),Py);const F_=({symbol:i="SPY",timeframe:e="15Min",signals:s=[],trades:a=[],historicalData:c=[],theme:h="dark"})=>{const d=D.useRef(null),g=D.useRef(null),p=D.useRef(null),v=D.useRef(null),[x,y]=D.useState(!0),[b,S]=D.useState(null),[N,E]=D.useState(null),R=h==="dark"?{background:"#0a0a0f",text:"#d1d4dc",grid:"rgba(66, 66, 66, 0.3)",upColor:"#26a69a",downColor:"#ef5350",wickUp:"#26a69a",wickDown:"#ef5350",volumeUp:"rgba(38, 166, 154, 0.5)",volumeDown:"rgba(239, 83, 80, 0.5)",crosshair:"#758696"}:{background:"#ffffff",text:"#191919",grid:"rgba(200, 200, 200, 0.3)",upColor:"#26a69a",downColor:"#ef5350",wickUp:"#26a69a",wickDown:"#ef5350",volumeUp:"rgba(38, 166, 154, 0.5)",volumeDown:"rgba(239, 83, 80, 0.5)",crosshair:"#9B9B9B"},_=L=>!L||!Array.isArray(L)||L.length===0?[]:L.map((C,j)=>{let K;return C.timestamp?K=Math.floor(new Date(C.timestamp).getTime()/1e3):C.time?K=typeof C.time=="number"?C.time:Math.floor(new Date(C.time).getTime()/1e3):C.t?K=typeof C.t=="number"?C.t:Math.floor(new Date(C.t).getTime()/1e3):K=Math.floor(Date.now()/1e3)-(L.length-j)*60,{time:K,open:parseFloat(C.open||C.o||0),high:parseFloat(C.high||C.h||0),low:parseFloat(C.low||C.l||0),close:parseFloat(C.close||C.c||0),volume:parseFloat(C.volume||C.v||0)}}).filter(C=>C.open>0&&C.high>0&&C.low>0&&C.close>0).sort((C,j)=>C.time-j.time),F=L=>{const C=[],j=U=>{if(!L||L.length===0)return null;const Y=typeof U=="number"?U:Math.floor(new Date(U).getTime()/1e3);let $=L[0],Q=Math.abs(L[0].time-Y);for(const q of L){const ge=Math.abs(q.time-Y);ge<Q&&(Q=ge,$=q)}return $.time};a&&a.length>0&&a.forEach((U,Y)=>{if(U.entry_time||U.open_ts||U.entryTime){const $=U.entry_time||U.open_ts||U.entryTime,Q=j($);if(Q){const q=U.side==="BUY"||U.open_side==="LONG"||U.direction==="long";C.push({time:Q,position:q?"belowBar":"aboveBar",color:q?"#00c853":"#ff1744",shape:q?"arrowUp":"arrowDown",text:q?"BUY":"SELL",size:2})}}if(U.exit_time||U.close_ts||U.exitTime){const $=U.exit_time||U.close_ts||U.exitTime,Q=j($);if(Q){const q=U.exit_side==="BUY"||U.close_side==="SHORT";C.push({time:Q,position:q?"belowBar":"aboveBar",color:q?"#00c853":"#ff1744",shape:q?"arrowUp":"arrowDown",text:`EXIT ${U.net_pct?(U.net_pct>0?"+":"")+U.net_pct.toFixed(2)+"%":""}`,size:1})}}}),s&&s.length>0&&C.length===0&&s.forEach((U,Y)=>{const $=U.timestamp||U.time||U.ts;if($){const Q=j($);if(Q){const q=U.type==="BUY"||U.signal==="BUY"||U.direction==="BUY";C.push({time:Q,position:q?"belowBar":"aboveBar",color:q?"#00c853":"#ff1744",shape:q?"arrowUp":"arrowDown",text:q?"BUY":"SELL",size:2})}}});const K=[],I=new Set;return C.sort((U,Y)=>U.time-Y.time).forEach(U=>{const Y=`${U.time}-${U.text}`;I.has(Y)||(I.add(Y),K.push(U))}),K};D.useEffect(()=>{if(!d.current)return;const L=d.current,C=L.clientWidth||L.offsetWidth||800,j=L.clientHeight||L.offsetHeight||500;if(C<100||j<100){const K=setTimeout(()=>{y(I=>I)},100);return()=>clearTimeout(K)}y(!0),S(null);try{g.current&&(g.current.remove(),g.current=null);const K=q_(L,{width:C,height:Math.max(j,400),layout:{background:{type:od.Solid,color:R.background},textColor:R.text},grid:{vertLines:{color:R.grid},horzLines:{color:R.grid}},crosshair:{mode:ld.Normal,vertLine:{color:R.crosshair,width:1,style:2,labelBackgroundColor:"#2962ff"},horzLine:{color:R.crosshair,width:1,style:2,labelBackgroundColor:"#2962ff"}},rightPriceScale:{borderColor:R.grid,scaleMargins:{top:.1,bottom:.2}},timeScale:{borderColor:R.grid,timeVisible:!0,secondsVisible:!1,tickMarkFormatter:q=>new Date(q*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})},handleScroll:{vertTouchDrag:!1}});console.log("Chart created:",K),console.log("Chart methods:",Object.keys(K)),console.log("addCandlestickSeries type:",typeof K.addCandlestickSeries),g.current=K;let I;try{I=K.addCandlestickSeries({upColor:R.upColor,downColor:R.downColor,wickUpColor:R.wickUp,wickDownColor:R.wickDown,borderVisible:!1}),console.log("Candlestick series created:",I),console.log("setMarkers available:",typeof I.setMarkers)}catch(q){throw console.error("Failed to create candlestick series:",q),q}p.current=I;const U=K.addHistogramSeries({color:R.volumeUp,priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.85,bottom:0}});v.current=U;const Y=_(c);if(Y.length>0){I.setData(Y);const q=Y.map(O=>({time:O.time,value:O.volume,color:O.close>=O.open?R.volumeUp:R.volumeDown}));U.setData(q);const ge=F(Y);ge.length>0&&I.setMarkers(ge),K.timeScale().fitContent()}else S("No chart data available");const $=()=>{if(d.current&&g.current){const q=d.current.clientWidth||d.current.offsetWidth,ge=d.current.clientHeight||d.current.offsetHeight;q>100&&ge>100&&g.current.applyOptions({width:q,height:Math.max(ge,400)})}};window.addEventListener("resize",$);const Q=new ResizeObserver(()=>{$()});return Q.observe(L),setTimeout(()=>{$(),K.timeScale().fitContent()},50),K.subscribeCrosshairMove(q=>{if(q.time&&q.seriesData&&q.seriesData.size>0){const ge=q.seriesData.get(I)}}),y(!1),()=>{window.removeEventListener("resize",$),Q.disconnect(),g.current&&(g.current.remove(),g.current=null)}}catch(K){console.error("Chart error:",K),S(K.message||"Failed to create chart"),y(!1)}},[c,s,a,h]);const H=(s?.filter(L=>L.type==="BUY"||L.signal==="BUY").length||0)+(a?.filter(L=>L.open_side==="LONG"||L.side==="BUY").length||0),z=(s?.filter(L=>L.type==="SELL"||L.signal==="SELL").length||0)+(a?.filter(L=>L.open_side==="SHORT"||L.side==="SELL").length||0);return l.jsxs("div",{className:"tradingview-chart-wrapper",children:[l.jsxs("div",{className:"tv-chart-header",children:[l.jsxs("div",{className:"tv-chart-info",children:[l.jsx("span",{className:"tv-symbol",children:i}),l.jsx("span",{className:"tv-timeframe",children:e}),l.jsx("span",{className:"tv-chart-type",children:"Candlestick"})]}),l.jsxs("div",{className:"tv-signals-count",children:[l.jsxs("span",{className:"signal-badge buy",children:[l.jsx("span",{className:"marker-icon",children:""})," ",H," Buys"]}),l.jsxs("span",{className:"signal-badge sell",children:[l.jsx("span",{className:"marker-icon",children:""})," ",z," Sells"]})]})]}),x&&l.jsxs("div",{className:"tv-loading",children:[l.jsx("div",{className:"tv-spinner"}),l.jsx("span",{children:"Loading Chart..."})]}),b&&l.jsxs("div",{className:"tv-error",children:[l.jsxs("span",{children:[" ",b]}),l.jsx("p",{className:"tv-error-hint",children:"Make sure historical data is available in the backtest results."})]}),l.jsx("div",{className:"chart-container",ref:d,style:{flex:1,width:"100%",minHeight:"400px",visibility:x||b?"hidden":"visible",position:"relative"}}),l.jsxs("div",{className:"tv-signals-legend",children:[l.jsxs("div",{className:"legend-row",children:[l.jsxs("div",{className:"legend-item",children:[l.jsx("span",{className:"legend-marker buy",children:""}),l.jsx("span",{children:"Buy Entry"})]}),l.jsxs("div",{className:"legend-item",children:[l.jsx("span",{className:"legend-marker sell",children:""}),l.jsx("span",{children:"Sell Entry"})]}),l.jsxs("div",{className:"legend-item",children:[l.jsx("span",{className:"legend-color up"}),l.jsx("span",{children:"Bullish Candle"})]}),l.jsxs("div",{className:"legend-item",children:[l.jsx("span",{className:"legend-color down"}),l.jsx("span",{children:"Bearish Candle"})]})]}),l.jsx("div",{className:"legend-note",children:"Scroll to zoom  Drag to pan  Click markers for details"})]})]})},W_=D.memo(F_),G_=({data:i,trades:e})=>{const s=D.useRef(null),[a,c]=D.useState(null),[h,d]=D.useState(null),[g,p]=D.useState(null),v=D.useRef({});D.useEffect(()=>{!i||i.length===0||(x(),y())},[i,h]);const x=()=>{if(!i||i.length<2)return;const E=i.map($=>$.drawdown||0),R=Math.max(...E);let _=[],F=!1,H=null,z=0;for(let $=0;$<i.length;$++){const Q=i[$].drawdown||0;Q>0&&!F?(F=!0,H=$,z=Q):Q>z&&F?z=Q:Q===0&&F&&(_.push({start:H,end:$,duration:$-H,peak:z,startTime:i[H].time,endTime:i[$].time}),F=!1,z=0)}F&&_.push({start:H,end:i.length-1,duration:i.length-1-H,peak:z,startTime:i[H].time,endTime:i[i.length-1].time,ongoing:!0}),_.sort(($,Q)=>Q.peak-$.peak);const L=E.reduce(($,Q)=>$+Q,0)/E.length,j=E.filter($=>$>0).length/E.length*100,K=_.length>0?_.reduce(($,Q)=>$+Q.duration,0)/_.length:0,I=_.length>0?_.reduce(($,Q)=>Q.duration>$.duration?Q:$,_[0]):null,U=E.indexOf(R);let Y=null;for(let $=U;$<E.length;$++)if(E[$]===0){Y=$-U;break}c({maxDrawdown:R,avgDrawdown:L,currentDrawdown:E[E.length-1],drawdownPeriods:_.length,timeInDrawdown:j,avgDuration:K,longestDuration:I?.duration||0,recoveryTime:Y,top3Drawdowns:_.slice(0,3)})},y=()=>{const E=s.current;if(!E)return;const R=E.getContext("2d"),_=window.devicePixelRatio||1,F=E.getBoundingClientRect();E.width=F.width*_,E.height=F.height*_,R.scale(_,_);const H=F.width,z=F.height;R.clearRect(0,0,H,z);const L={top:30,right:80,bottom:50,left:70},C=H-L.left-L.right,j=z-L.top-L.bottom,K=i.map(T=>T.drawdown||0),I=Math.max(...K,1),U=i[0].time,Y=i[i.length-1].time;let $,Q;I<5?($="#3b82f6",Q="rgba(59, 130, 246, 0.4)"):I<15?($="#f59e0b",Q="rgba(245, 158, 11, 0.4)"):($="#ef4444",Q="rgba(239, 68, 68, 0.4)");const q=T=>L.left+(T-U)/(Y-U)*C,ge=T=>L.top+T/I*j;R.strokeStyle="rgba(42, 46, 57, 0.5)",R.lineWidth=1,R.setLineDash([5,5]);for(let T=0;T<=5;T++){const P=L.top+j/5*T;R.beginPath(),R.moveTo(L.left,P),R.lineTo(H-L.right,P),R.stroke()}R.setLineDash([]);const O=[{threshold:5,color:"rgba(59, 130, 246, 0.05)",label:"Low Risk"},{threshold:15,color:"rgba(245, 158, 11, 0.05)",label:"Medium Risk"},{threshold:100,color:"rgba(239, 68, 68, 0.05)",label:"High Risk"}];let A=L.top;O.forEach(T=>{if(I>0){const P=ge(Math.min(T.threshold,I))-A;P>0&&(R.fillStyle=T.color,R.fillRect(L.left,A,C,P),A+=P)}});const W=R.createLinearGradient(0,L.top,0,L.top+j);if(W.addColorStop(0,Q),W.addColorStop(1,"rgba(0, 0, 0, 0)"),R.fillStyle=W,R.beginPath(),R.moveTo(L.left,L.top),i.forEach(T=>{R.lineTo(q(T.time),ge(T.drawdown||0))}),R.lineTo(q(i[i.length-1].time),L.top),R.closePath(),R.fill(),v.current={xScale:q,yScale:ge,margin:L,data:i,minTime:U,maxTime:Y,maxDD:I,chartWidth:C,chartHeight:j},R.strokeStyle=$,R.lineWidth=2,R.lineJoin="round",R.lineCap="round",R.beginPath(),i.forEach((T,P)=>{const B=q(T.time),te=ge(T.drawdown||0);P===0?R.moveTo(B,te):R.lineTo(B,te)}),R.stroke(),h!==null&&h>=0&&h<i.length){const T=i[h],P=q(T.time),B=ge(T.drawdown||0);R.strokeStyle="rgba(156, 163, 175, 0.5)",R.lineWidth=1,R.setLineDash([4,4]),R.beginPath(),R.moveTo(P,L.top),R.lineTo(P,z-L.bottom),R.stroke(),R.beginPath(),R.moveTo(L.left,B),R.lineTo(H-L.right,B),R.stroke(),R.setLineDash([]),R.fillStyle=$,R.beginPath(),R.arc(P,B,6,0,Math.PI*2),R.fill(),R.fillStyle="#0d1117",R.beginPath(),R.arc(P,B,3,0,Math.PI*2),R.fill()}const ce=K.indexOf(I);if(ce>=0){const T=i[ce],P=q(T.time),B=ge(I);R.fillStyle="#ef4444",R.beginPath(),R.arc(P,B,6,0,Math.PI*2),R.fill(),R.fillStyle="#0d1117",R.beginPath(),R.arc(P,B,3,0,Math.PI*2),R.fill(),R.fillStyle="#ef4444",R.font="bold 11px sans-serif",R.textAlign="center",R.fillText(`Max: -${I.toFixed(1)}%`,P,B+18)}R.fillStyle="#9aa6c6",R.font="11px sans-serif",R.textAlign="right";for(let T=0;T<=5;T++){const P=I/5*T,B=L.top+j/5*T;R.fillText(`-${P.toFixed(1)}%`,L.left-10,B+4)}R.textAlign="center";for(let T=0;T<=6;T++){const P=U+(Y-U)/6*T,B=L.left+C/6*T,te=new Date(P);R.fillText(te.toLocaleDateString("en-US",{month:"short",day:"numeric"}),B,z-L.bottom+20)}const se=K[K.length-1],M=ge(se);R.textAlign="left",R.fillStyle=se>0?$:"#3b82f6",R.font="bold 12px sans-serif",R.fillText(`-${se.toFixed(1)}%`,H-L.right+8,M+4)},b=E=>E<24?`${E} bars`:`${Math.floor(E/24)}d`,S=D.useCallback(E=>{const R=s.current;if(!R||!v.current.data)return;const _=R.getBoundingClientRect(),F=E.clientX-_.left,{margin:H,data:z,minTime:L,maxTime:C,chartWidth:j}=v.current;if(F>=H.left&&F<=_.width-H.right){const K=L+(F-H.left)/j*(C-L);let I=0,U=1/0;z.forEach((Y,$)=>{const Q=Math.abs(Y.time-K);Q<U&&(U=Q,I=$)}),d(I),p({x:E.clientX-_.left,y:E.clientY-_.top})}else d(null),p(null)},[]),N=D.useCallback(()=>{d(null),p(null)},[]);return l.jsxs("div",{className:"drawdown-chart-enhanced",children:[a&&l.jsxs("div",{className:"dd-stats-bar",children:[l.jsxs("div",{className:"dd-stat main",children:[l.jsx("span",{className:"dd-label",children:"Max Drawdown"}),l.jsxs("span",{className:"dd-value negative",children:["-",a.maxDrawdown?.toFixed(2),"%"]})]}),l.jsxs("div",{className:"dd-stat",children:[l.jsx("span",{className:"dd-label",children:"Current DD"}),l.jsx("span",{className:`dd-value ${a.currentDrawdown>0?"negative":"positive"}`,children:a.currentDrawdown>0?`-${a.currentDrawdown.toFixed(2)}%`:"0.00%"})]}),l.jsxs("div",{className:"dd-stat",children:[l.jsx("span",{className:"dd-label",children:"Avg Drawdown"}),l.jsxs("span",{className:"dd-value neutral",children:["-",a.avgDrawdown?.toFixed(2),"%"]})]}),l.jsxs("div",{className:"dd-stat",children:[l.jsx("span",{className:"dd-label",children:"Time in DD"}),l.jsxs("span",{className:"dd-value neutral",children:[a.timeInDrawdown?.toFixed(1),"%"]})]}),l.jsxs("div",{className:"dd-stat",children:[l.jsx("span",{className:"dd-label",children:"DD Periods"}),l.jsx("span",{className:"dd-value",children:a.drawdownPeriods})]}),l.jsxs("div",{className:"dd-stat",children:[l.jsx("span",{className:"dd-label",children:"Avg Duration"}),l.jsx("span",{className:"dd-value",children:b(Math.round(a.avgDuration||0))})]})]}),l.jsxs("div",{className:"dd-chart-container",onMouseMove:S,onMouseLeave:N,children:[l.jsx("canvas",{ref:s}),h!==null&&i&&i[h]&&g&&l.jsxs("div",{className:"dd-tooltip",style:{left:g.x>200?g.x-140:g.x+10,top:g.y>100?g.y-70:g.y+10},children:[l.jsx("div",{className:"tooltip-date",children:new Date(i[h].time).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),l.jsxs("div",{className:"tooltip-dd negative",children:["-",(i[h].drawdown||0).toFixed(2),"%"]}),l.jsxs("div",{className:"tooltip-equity",children:["Equity: $",i[h].equity?.toLocaleString(void 0,{maximumFractionDigits:2})||"N/A"]})]})]}),a&&a.top3Drawdowns&&a.top3Drawdowns.length>0&&l.jsxs("div",{className:"dd-periods-section",children:[l.jsx("h5",{children:"Worst Drawdown Periods"}),l.jsx("div",{className:"dd-periods-list",children:a.top3Drawdowns.map((E,R)=>l.jsxs("div",{className:`dd-period-item ${E.ongoing?"ongoing":""}`,children:[l.jsxs("div",{className:"period-rank",children:["#",R+1]}),l.jsxs("div",{className:"period-details",children:[l.jsxs("div",{className:"period-main",children:[l.jsxs("span",{className:"period-dd",children:["-",E.peak.toFixed(2),"%"]}),l.jsx("span",{className:"period-duration",children:b(E.duration)})]}),l.jsxs("div",{className:"period-dates",children:[new Date(E.startTime).toLocaleDateString(),E.ongoing?"  ongoing":`  ${new Date(E.endTime).toLocaleDateString()}`]})]}),E.ongoing&&l.jsx("span",{className:"ongoing-badge",children:"Active"})]},R))})]})]})},Y_=({trades:i})=>{const e=D.useRef(null),s=D.useRef(null),a=D.useRef(null),c=D.useRef(null),[h,d]=D.useState(null),[g,p]=D.useState(null),[v,x]=D.useState(null),[y,b]=D.useState(null),S=i.filter(O=>O.netProfit>0),N=i.filter(O=>O.netProfit<=0),E=()=>{if(i.length===0)return[];const O=i.map(T=>T.netProfit),A=Math.min(...O),W=Math.max(...O),ce=12,se=(W-A)/ce,M=Array.from({length:ce},(T,P)=>({min:A+P*se,max:A+(P+1)*se,count:0,trades:[]}));return i.forEach(T=>{const P=Math.min(Math.floor((T.netProfit-A)/se),ce-1);M[P].count++,M[P].trades.push(T)}),M},R=()=>{if(i.length===0)return[];const O=i.map(T=>T.holdingDuration||0),A=Math.min(...O),W=Math.max(...O),ce=10,se=(W-A)/ce||1,M=Array.from({length:ce},(T,P)=>({min:A+P*se,max:A+(P+1)*se,count:0,label:_(A+P*se),trades:[]}));return i.forEach(T=>{const P=T.holdingDuration||0,B=Math.min(Math.floor((P-A)/se),ce-1);M[B].count++,M[B].trades.push(T)}),M},_=O=>{const A=O/36e5;return A<1?`${Math.round(O/(1e3*60))}m`:A<24?`${Math.round(A)}h`:`${Math.round(A/24)}d`},F=O=>Math.abs(O)>=1e3?`$${(O/1e3).toFixed(1)}k`:`$${O.toFixed(0)}`,H=E(),z=R(),L=D.useCallback(()=>{const O=e.current;if(!O||H.length===0)return;const A=O.getContext("2d"),W=window.devicePixelRatio||1,ce=O.getBoundingClientRect();O.width=ce.width*W,O.height=ce.height*W,A.scale(W,W);const se=ce.width,M=ce.height,T={top:20,right:20,bottom:40,left:50},P=se-T.left-T.right,B=M-T.top-T.bottom;A.clearRect(0,0,se,M);const te=Math.max(...H.map(ue=>ue.count),1),de=P/H.length-6;A.strokeStyle="rgba(42, 46, 57, 0.3)",A.lineWidth=1;for(let ue=0;ue<=4;ue++){const ee=T.top+B/4*ue;A.beginPath(),A.moveTo(T.left,ee),A.lineTo(se-T.right,ee),A.stroke()}const oe=T.left+-H[0].min/(H[H.length-1].max-H[0].min)*P;oe>T.left&&oe<se-T.right&&(A.strokeStyle="rgba(156, 163, 175, 0.5)",A.setLineDash([4,4]),A.beginPath(),A.moveTo(oe,T.top),A.lineTo(oe,M-T.bottom),A.stroke(),A.setLineDash([])),H.forEach((ue,ee)=>{const Z=T.left+ee*(P/H.length)+3,ye=ue.count/te*B,we=T.top+B-ye,Re=ue.min>=0,Be=h===ee;A.fillStyle=Re?Be?"#60a5fa":"rgba(59, 130, 246, 0.8)":Be?"#f87171":"rgba(239, 68, 68, 0.8)";const Le=4;A.beginPath(),A.moveTo(Z+Le,we),A.lineTo(Z+de-Le,we),A.quadraticCurveTo(Z+de,we,Z+de,we+Le),A.lineTo(Z+de,we+ye),A.lineTo(Z,we+ye),A.lineTo(Z,we+Le),A.quadraticCurveTo(Z,we,Z+Le,we),A.fill(),ue.count>0&&ye>15&&(A.fillStyle="#fff",A.font="bold 10px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",A.fillText(ue.count,Z+de/2,we+14))}),A.fillStyle="#787b86",A.font="10px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",[0,Math.floor(H.length/2),H.length-1].forEach(ue=>{const ee=H[ue],Z=T.left+ue*(P/H.length)+de/2;A.fillText(F(ee.min),Z,M-10)}),A.save(),A.translate(15,M/2),A.rotate(-Math.PI/2),A.textAlign="center",A.fillText("# Trades",0,0),A.restore()},[H,h]),C=D.useCallback(()=>{const O=s.current;if(!O||z.length===0)return;const A=O.getContext("2d"),W=window.devicePixelRatio||1,ce=O.getBoundingClientRect();O.width=ce.width*W,O.height=ce.height*W,A.scale(W,W);const se=ce.width,M=ce.height,T={top:20,right:20,bottom:40,left:50},P=se-T.left-T.right,B=M-T.top-T.bottom;A.clearRect(0,0,se,M);const te=Math.max(...z.map(oe=>oe.count),1),de=P/z.length-6;A.strokeStyle="rgba(42, 46, 57, 0.3)",A.lineWidth=1;for(let oe=0;oe<=4;oe++){const ue=T.top+B/4*oe;A.beginPath(),A.moveTo(T.left,ue),A.lineTo(se-T.right,ue),A.stroke()}z.forEach((oe,ue)=>{const ee=T.left+ue*(P/z.length)+3,Z=oe.count/te*B,ye=T.top+B-Z,we=g===ue;A.fillStyle=we?"#a78bfa":"rgba(139, 92, 246, 0.8)";const Re=4;A.beginPath(),A.moveTo(ee+Re,ye),A.lineTo(ee+de-Re,ye),A.quadraticCurveTo(ee+de,ye,ee+de,ye+Re),A.lineTo(ee+de,ye+Z),A.lineTo(ee,ye+Z),A.lineTo(ee,ye+Re),A.quadraticCurveTo(ee,ye,ee+Re,ye),A.fill(),oe.count>0&&Z>15&&(A.fillStyle="#fff",A.font="bold 10px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",A.fillText(oe.count,ee+de/2,ye+14))}),A.fillStyle="#787b86",A.font="10px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",z.forEach((oe,ue)=>{if(ue%2===0){const ee=T.left+ue*(P/z.length)+de/2;A.fillText(oe.label,ee,M-10)}})},[z,g]),j=D.useCallback(()=>{const O=a.current;if(!O||i.length===0)return;const A=O.getContext("2d"),W=window.devicePixelRatio||1,ce=O.getBoundingClientRect();O.width=ce.width*W,O.height=ce.height*W,A.scale(W,W);const se=ce.width,M=ce.height,T={top:30,right:30,bottom:50,left:60},P=se-T.left-T.right,B=M-T.top-T.bottom;A.clearRect(0,0,se,M);const te=i.map(ee=>ee.mae||0),de=i.map(ee=>ee.mfe||0),oe=Math.max(...te,1),ue=Math.max(...de,1);A.strokeStyle="rgba(42, 46, 57, 0.3)",A.lineWidth=1;for(let ee=0;ee<=4;ee++){const Z=T.top+B/4*ee,ye=T.left+P/4*ee;A.beginPath(),A.moveTo(T.left,Z),A.lineTo(se-T.right,Z),A.stroke(),A.beginPath(),A.moveTo(ye,T.top),A.lineTo(ye,M-T.bottom),A.stroke()}A.strokeStyle="rgba(156, 163, 175, 0.4)",A.setLineDash([4,4]),A.beginPath(),A.moveTo(T.left,M-T.bottom),A.lineTo(se-T.right,T.top),A.stroke(),A.setLineDash([]),i.slice(0,100).forEach((ee,Z)=>{const ye=ee.mae||0,we=ee.mfe||0,Re=T.left+ye/oe*P,Be=M-T.bottom-we/ue*B,Le=ee.netProfit>0,Ie=v===Z;A.beginPath(),A.arc(Re,Be,Ie?7:5,0,Math.PI*2),A.fillStyle=Le?Ie?"#60a5fa":"rgba(59, 130, 246, 0.8)":Ie?"#f87171":"rgba(239, 83, 80, 0.8)",A.fill()}),A.fillStyle="#787b86",A.font="11px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",A.fillText("MAE (Max Adverse Excursion)",se/2,M-10),A.save(),A.translate(15,M/2),A.rotate(-Math.PI/2),A.fillText("MFE (Max Favorable Excursion)",0,0),A.restore()},[i,v]),K=D.useCallback(()=>{const O=c.current;if(!O||i.length===0)return;const A=O.getContext("2d"),W=window.devicePixelRatio||1,ce=O.getBoundingClientRect();O.width=ce.width*W,O.height=ce.height*W,A.scale(W,W);const se=ce.width,M=ce.height,T={top:20,right:20,bottom:35,left:50},P=se-T.left-T.right,B=M-T.top-T.bottom;A.clearRect(0,0,se,M);const te={};for(let Z=0;Z<24;Z++)te[Z]={trades:0,profit:0,wins:0};i.forEach(Z=>{const we=new Date(Z.entryTime||Z.time||Date.now()).getHours();te[we].trades++,te[we].profit+=Z.netProfit||0,(Z.netProfit||0)>0&&te[we].wins++});const de=Object.keys(te).map(Number),oe=Math.max(...de.map(Z=>Math.abs(te[Z].profit)),1),ue=P/24-3;A.strokeStyle="rgba(42, 46, 57, 0.3)",A.lineWidth=1;for(let Z=0;Z<=4;Z++){const ye=T.top+B/4*Z;A.beginPath(),A.moveTo(T.left,ye),A.lineTo(se-T.right,ye),A.stroke()}const ee=T.top+B/2;A.strokeStyle="rgba(156, 163, 175, 0.4)",A.beginPath(),A.moveTo(T.left,ee),A.lineTo(se-T.right,ee),A.stroke(),de.forEach(Z=>{const ye=te[Z];if(ye.trades===0)return;const we=T.left+Z*(P/24)+1.5,Re=ye.profit/oe,Be=Math.abs(Re)*(B/2),Le=ye.profit>=0,Ie=Le?ee-Be:ee;A.fillStyle=Le?"rgba(59, 130, 246, 0.8)":"rgba(239, 83, 80, 0.8)";const ut=3;A.beginPath(),Le?(A.moveTo(we+ut,Ie),A.lineTo(we+ue-ut,Ie),A.quadraticCurveTo(we+ue,Ie,we+ue,Ie+ut),A.lineTo(we+ue,Ie+Be),A.lineTo(we,Ie+Be),A.lineTo(we,Ie+ut),A.quadraticCurveTo(we,Ie,we+ut,Ie)):(A.moveTo(we,Ie),A.lineTo(we+ue,Ie),A.lineTo(we+ue,Ie+Be-ut),A.quadraticCurveTo(we+ue,Ie+Be,we+ue-ut,Ie+Be),A.lineTo(we+ut,Ie+Be),A.quadraticCurveTo(we,Ie+Be,we,Ie+Be-ut)),A.fill()}),A.fillStyle="#787b86",A.font="9px -apple-system, BlinkMacSystemFont, sans-serif",A.textAlign="center",[0,6,12,18,23].forEach(Z=>{const ye=T.left+Z*(P/24)+ue/2;A.fillText(`${Z}:00`,ye,M-8)})},[i]);D.useEffect(()=>{L(),C(),j(),K();const O=()=>{L(),C(),j(),K()};return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[L,C,j,K]);const I=(S.length/i.length*100).toFixed(1),U=S.length>0?S.reduce((O,A)=>O+A.netProfit,0)/S.length:0,Y=N.length>0?Math.abs(N.reduce((O,A)=>O+A.netProfit,0)/N.length):0,$=S.length/i.length*U-N.length/i.length*Y,Q=Y>0?S.reduce((O,A)=>O+A.netProfit,0)/Math.abs(N.reduce((O,A)=>O+A.netProfit,0)||1):0,q=S.length>0?Math.max(...S.map(O=>O.netProfit)):0,ge=N.length>0?Math.min(...N.map(O=>O.netProfit)):0;return l.jsxs("div",{className:"stats-distribution-enhanced",children:[l.jsxs("div",{className:"dist-summary-grid",children:[l.jsxs("div",{className:"summary-stat-card",children:[l.jsx("div",{className:"stat-icon win",children:l.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})})}),l.jsxs("div",{className:"stat-info",children:[l.jsx("span",{className:"stat-value positive",children:S.length}),l.jsx("span",{className:"stat-label",children:"Winners"})]}),l.jsxs("div",{className:"stat-detail",children:[l.jsxs("span",{children:["Avg: $",U.toFixed(2)]}),l.jsxs("span",{children:["Best: $",q.toFixed(2)]})]})]}),l.jsxs("div",{className:"summary-stat-card",children:[l.jsx("div",{className:"stat-icon loss",children:l.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:l.jsx("path",{d:"M12 5v14M5 12l7 7 7-7"})})}),l.jsxs("div",{className:"stat-info",children:[l.jsx("span",{className:"stat-value negative",children:N.length}),l.jsx("span",{className:"stat-label",children:"Losers"})]}),l.jsxs("div",{className:"stat-detail",children:[l.jsxs("span",{children:["Avg: -$",Y.toFixed(2)]}),l.jsxs("span",{children:["Worst: $",ge.toFixed(2)]})]})]}),l.jsxs("div",{className:"summary-stat-card",children:[l.jsx("div",{className:"stat-icon rate",children:l.jsx("span",{children:"%"})}),l.jsxs("div",{className:"stat-info",children:[l.jsxs("span",{className:`stat-value ${parseFloat(I)>=50?"positive":"neutral"}`,children:[I,"%"]}),l.jsx("span",{className:"stat-label",children:"Win Rate"})]}),l.jsx("div",{className:"win-rate-bar",children:l.jsx("div",{className:"bar-fill",style:{width:`${I}%`}})})]}),l.jsxs("div",{className:"summary-stat-card",children:[l.jsx("div",{className:"stat-icon expect",children:l.jsx("span",{children:"E"})}),l.jsxs("div",{className:"stat-info",children:[l.jsxs("span",{className:`stat-value ${$>=0?"positive":"negative"}`,children:["$",$.toFixed(2)]}),l.jsx("span",{className:"stat-label",children:"Expectancy"})]}),l.jsx("div",{className:"stat-detail",children:l.jsxs("span",{children:["PF: ",Q.toFixed(2)]})})]})]}),l.jsxs("div",{className:"dist-charts-grid",children:[l.jsxs("div",{className:"dist-chart-card",children:[l.jsxs("div",{className:"chart-header",children:[l.jsx("h4",{children:"P&L Distribution"}),l.jsxs("span",{className:"chart-badge",children:[i.length," trades"]})]}),l.jsx("div",{className:"chart-canvas-wrapper",children:l.jsx("canvas",{ref:e})})]}),l.jsxs("div",{className:"dist-chart-card",children:[l.jsxs("div",{className:"chart-header",children:[l.jsx("h4",{children:"Hold Time Distribution"}),l.jsx("span",{className:"chart-badge",children:"Duration"})]}),l.jsx("div",{className:"chart-canvas-wrapper",children:l.jsx("canvas",{ref:s})})]}),l.jsxs("div",{className:"dist-chart-card",children:[l.jsxs("div",{className:"chart-header",children:[l.jsx("h4",{children:"Hourly Performance"}),l.jsx("span",{className:"chart-badge",children:"By Hour"})]}),l.jsx("div",{className:"chart-canvas-wrapper",children:l.jsx("canvas",{ref:c})})]}),l.jsxs("div",{className:"dist-chart-card",children:[l.jsxs("div",{className:"chart-header",children:[l.jsx("h4",{children:"MAE vs MFE"}),l.jsxs("div",{className:"scatter-legend-inline",children:[l.jsx("span",{className:"legend-dot win"}),l.jsx("span",{children:"Win"}),l.jsx("span",{className:"legend-dot loss"}),l.jsx("span",{children:"Loss"})]})]}),l.jsx("div",{className:"chart-canvas-wrapper",children:l.jsx("canvas",{ref:a})})]})]})]})},K_=({results:i})=>{const{trades:e,metrics:s,config:a}=i;if(!e||e.length===0)return l.jsx("div",{className:"advanced-metrics-empty",children:"No trades to analyze"});const c=X_(e,a.startingCapital),h=y=>`$${y?.toFixed(2)||"0.00"}`,d=y=>`${y?.toFixed(2)||"0.00"}%`,g=y=>y?.toFixed(2)||"0.00",p=y=>y===1/0?"":y===-1/0?"-":y?.toFixed(3)||"0.000",x=(()=>{let y=0;const b=[{name:"Sharpe > 1",pass:c.sharpeRatio>1},{name:"Sortino > 1",pass:c.sortinoRatio>1},{name:"Win Rate > 50%",pass:(s?.winRate||0)>50},{name:"Profit Factor > 1.5",pass:c.payoffRatio>1.5},{name:"Positive R-Multiple",pass:c.avgRMultiple>0},{name:"Good Exit Efficiency",pass:c.exitEfficiency>50},{name:"Low MAE/MFE",pass:c.maeMfeRatio<1},{name:"Recovery Factor > 2",pass:c.recoveryFactor>2}];return b.forEach(S=>{S.pass&&y++}),{score:y,total:b.length,checks:b}})();return l.jsxs("div",{className:"advanced-metrics-enhanced",children:[l.jsx("div",{className:"score-card-section",children:l.jsxs("div",{className:"score-card",children:[l.jsxs("div",{className:"score-visual",children:[l.jsxs("svg",{viewBox:"0 0 100 100",children:[l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(42, 46, 57, 0.5)",strokeWidth:"8"}),l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:x.score>=6?"#3b82f6":x.score>=4?"#f59e0b":"#ef4444",strokeWidth:"8",strokeDasharray:`${x.score/x.total*283} 283`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),l.jsxs("div",{className:"score-text",children:[l.jsx("span",{className:"score-num",children:x.score}),l.jsxs("span",{className:"score-denom",children:["/",x.total]})]})]}),l.jsxs("div",{className:"score-details",children:[l.jsx("h4",{children:"Strategy Health Score"}),l.jsx("div",{className:"score-checks",children:x.checks.map((y,b)=>l.jsxs("div",{className:`check-item ${y.pass?"pass":"fail"}`,children:[l.jsx("span",{className:"check-icon",children:y.pass?"":""}),l.jsx("span",{className:"check-name",children:y.name})]},b))})]})]})}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsxs("div",{className:"section-header",children:[l.jsx("h3",{children:"Risk-Adjusted Performance"}),l.jsx("span",{className:"section-badge",children:"Professional Ratios"})]}),l.jsxs("div",{className:"metrics-grid-3",children:[l.jsxs("div",{className:"metric-card-enhanced",children:[l.jsx("div",{className:"metric-icon sharpe",children:"SR"}),l.jsxs("div",{className:"metric-content",children:[l.jsx("div",{className:"metric-label",children:"Sharpe Ratio"}),l.jsx("div",{className:"metric-value",style:{color:c.sharpeRatio>1?"#3b82f6":c.sharpeRatio>0?"#f59e0b":"#ef4444"},children:p(c.sharpeRatio)}),l.jsx("div",{className:"metric-bar",children:l.jsx("div",{className:"metric-bar-fill",style:{width:`${Math.min(100,Math.max(0,c.sharpeRatio*33))}%`,background:c.sharpeRatio>1?"#3b82f6":"#f59e0b"}})}),l.jsx("div",{className:"metric-hint",children:c.sharpeRatio>2?"Excellent":c.sharpeRatio>1?"Good":"Needs Improvement"})]})]}),l.jsxs("div",{className:"metric-card-enhanced",children:[l.jsx("div",{className:"metric-icon sortino",children:"SO"}),l.jsxs("div",{className:"metric-content",children:[l.jsx("div",{className:"metric-label",children:"Sortino Ratio"}),l.jsx("div",{className:"metric-value",style:{color:c.sortinoRatio>1?"#3b82f6":c.sortinoRatio>0?"#f59e0b":"#ef4444"},children:p(c.sortinoRatio)}),l.jsx("div",{className:"metric-bar",children:l.jsx("div",{className:"metric-bar-fill",style:{width:`${Math.min(100,Math.max(0,c.sortinoRatio*33))}%`,background:c.sortinoRatio>1?"#3b82f6":"#f59e0b"}})}),l.jsx("div",{className:"metric-hint",children:"Downside risk adjusted"})]})]}),l.jsxs("div",{className:"metric-card-enhanced",children:[l.jsx("div",{className:"metric-icon calmar",children:"CR"}),l.jsxs("div",{className:"metric-content",children:[l.jsx("div",{className:"metric-label",children:"Calmar Ratio"}),l.jsx("div",{className:"metric-value",style:{color:c.calmarRatio>1?"#3b82f6":c.calmarRatio>0?"#f59e0b":"#ef4444"},children:p(c.calmarRatio)}),l.jsx("div",{className:"metric-bar",children:l.jsx("div",{className:"metric-bar-fill",style:{width:`${Math.min(100,Math.max(0,c.calmarRatio*33))}%`,background:c.calmarRatio>1?"#3b82f6":"#f59e0b"}})}),l.jsx("div",{className:"metric-hint",children:"Return / Max Drawdown"})]})]})]})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsx("div",{className:"section-header",children:l.jsx("h3",{children:"Trade Quality Metrics"})}),l.jsxs("div",{className:"metrics-grid-4",children:[l.jsxs("div",{className:"metric-card-compact",children:[l.jsx("div",{className:"metric-label",children:"Average R-Multiple"}),l.jsxs("div",{className:"metric-value",style:{color:c.avgRMultiple>1?"#3b82f6":c.avgRMultiple>0?"#f59e0b":"#ef4444"},children:[p(c.avgRMultiple),"R"]}),l.jsx("div",{className:"metric-sub",children:"Risk-reward efficiency"})]}),l.jsxs("div",{className:"metric-card-compact",children:[l.jsx("div",{className:"metric-label",children:"Win/Loss Ratio"}),l.jsx("div",{className:"metric-value",style:{color:c.winLossRatio>1?"#3b82f6":"#ef4444"},children:p(c.winLossRatio)}),l.jsx("div",{className:"metric-sub",children:"Avg win / avg loss"})]}),l.jsxs("div",{className:"metric-card-compact",children:[l.jsx("div",{className:"metric-label",children:"Recovery Factor"}),l.jsx("div",{className:"metric-value",style:{color:c.recoveryFactor>2?"#3b82f6":c.recoveryFactor>1?"#f59e0b":"#ef4444"},children:p(c.recoveryFactor)}),l.jsx("div",{className:"metric-sub",children:"Net profit / max DD"})]}),l.jsxs("div",{className:"metric-card-compact",children:[l.jsx("div",{className:"metric-label",children:"Payoff Ratio"}),l.jsx("div",{className:"metric-value",style:{color:c.payoffRatio>1.5?"#3b82f6":c.payoffRatio>1?"#f59e0b":"#ef4444"},children:p(c.payoffRatio)}),l.jsx("div",{className:"metric-sub",children:"Target > 1.5"})]})]})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsxs("div",{className:"section-header",children:[l.jsx("h3",{children:"Streak Analysis"}),l.jsx("span",{className:"section-badge",children:"Consistency"})]}),l.jsxs("div",{className:"streak-grid",children:[l.jsxs("div",{className:"streak-card win",children:[l.jsxs("div",{className:"streak-header",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("span",{children:"Win Streaks"})]}),l.jsxs("div",{className:"streak-stats",children:[l.jsxs("div",{className:"streak-main",children:[l.jsx("span",{className:"streak-label",children:"Max"}),l.jsx("span",{className:"streak-value",children:c.maxConsecutiveWins})]}),l.jsxs("div",{className:"streak-secondary",children:[l.jsx("span",{className:"streak-label",children:"Avg"}),l.jsx("span",{className:"streak-value",children:g(c.avgWinStreak)})]})]})]}),l.jsxs("div",{className:"streak-card loss",children:[l.jsxs("div",{className:"streak-header",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("span",{children:"Loss Streaks"})]}),l.jsxs("div",{className:"streak-stats",children:[l.jsxs("div",{className:"streak-main",children:[l.jsx("span",{className:"streak-label",children:"Max"}),l.jsx("span",{className:"streak-value",children:c.maxConsecutiveLosses})]}),l.jsxs("div",{className:"streak-secondary",children:[l.jsx("span",{className:"streak-label",children:"Avg"}),l.jsx("span",{className:"streak-value",children:g(c.avgLossStreak)})]})]})]})]})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsx("div",{className:"section-header",children:l.jsx("h3",{children:"Duration Analysis"})}),l.jsxs("div",{className:"duration-comparison",children:[l.jsxs("div",{className:"duration-item win",children:[l.jsx("span",{className:"duration-label",children:"Avg Win Duration"}),l.jsx("span",{className:"duration-value",children:Yv(c.avgWinDuration)})]}),l.jsxs("div",{className:"duration-vs",children:[l.jsxs("div",{className:"duration-efficiency",style:{color:c.durationEfficiency>1?"#3b82f6":"#ef4444"},children:[g(c.durationEfficiency),"x"]}),l.jsx("span",{className:"duration-efficiency-label",children:"Efficiency"})]}),l.jsxs("div",{className:"duration-item loss",children:[l.jsx("span",{className:"duration-label",children:"Avg Loss Duration"}),l.jsx("span",{className:"duration-value",children:Yv(c.avgLossDuration)})]})]})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsx("div",{className:"section-header",children:l.jsx("h3",{children:"Profit Distribution"})}),l.jsx("div",{className:"profit-distribution-enhanced",children:c.profitBuckets.map((y,b)=>l.jsxs("div",{className:"profit-bucket-enhanced",children:[l.jsxs("div",{className:"bucket-info",children:[l.jsx("span",{className:"bucket-label",children:y.label}),l.jsxs("span",{className:"bucket-count",children:[y.count," trades"]})]}),l.jsx("div",{className:"bucket-bar-container",children:l.jsx("div",{className:"bucket-bar-fill",style:{width:`${Math.max(y.percentage,2)}%`,backgroundColor:y.color}})}),l.jsx("span",{className:"bucket-percentage",children:d(y.percentage)})]},b))})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsx("div",{className:"section-header",children:l.jsx("h3",{children:"Direction Performance"})}),l.jsxs("div",{className:"direction-grid-enhanced",children:[l.jsxs("div",{className:"direction-card-enhanced long",children:[l.jsx("div",{className:"direction-icon",children:""}),l.jsxs("div",{className:"direction-content",children:[l.jsxs("div",{className:"direction-title",children:[l.jsx("h4",{children:"Long Trades"}),l.jsx("span",{className:"direction-count",children:c.longTrades.count})]}),l.jsxs("div",{className:"direction-metrics",children:[l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Win Rate"}),l.jsx("span",{className:"dir-value",children:d(c.longTrades.winRate)})]}),l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Net P&L"}),l.jsx("span",{className:"dir-value",style:{color:c.longTrades.netProfit>=0?"#3b82f6":"#ef4444"},children:h(c.longTrades.netProfit)})]}),l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Profit Factor"}),l.jsx("span",{className:"dir-value",children:p(c.longTrades.profitFactor)})]})]})]})]}),l.jsxs("div",{className:"direction-card-enhanced short",children:[l.jsx("div",{className:"direction-icon",children:""}),l.jsxs("div",{className:"direction-content",children:[l.jsxs("div",{className:"direction-title",children:[l.jsx("h4",{children:"Short Trades"}),l.jsx("span",{className:"direction-count",children:c.shortTrades.count})]}),l.jsxs("div",{className:"direction-metrics",children:[l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Win Rate"}),l.jsx("span",{className:"dir-value",children:d(c.shortTrades.winRate)})]}),l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Net P&L"}),l.jsx("span",{className:"dir-value",style:{color:c.shortTrades.netProfit>=0?"#3b82f6":"#ef4444"},children:h(c.shortTrades.netProfit)})]}),l.jsxs("div",{className:"dir-metric",children:[l.jsx("span",{className:"dir-label",children:"Profit Factor"}),l.jsx("span",{className:"dir-value",children:p(c.shortTrades.profitFactor)})]})]})]})]})]})]}),l.jsxs("div",{className:"metrics-section-enhanced",children:[l.jsxs("div",{className:"section-header",children:[l.jsx("h3",{children:"MAE/MFE Analysis"}),l.jsx("span",{className:"section-badge",children:"Trade Management"})]}),l.jsxs("div",{className:"mae-mfe-grid",children:[l.jsxs("div",{className:"mae-mfe-card mae",children:[l.jsxs("div",{className:"mae-mfe-header",children:[l.jsx("span",{className:"mae-mfe-icon",children:""}),l.jsx("span",{children:"MAE"})]}),l.jsx("div",{className:"mae-mfe-value",children:h(c.avgMAE)}),l.jsx("div",{className:"mae-mfe-label",children:"Max Adverse Excursion"})]}),l.jsxs("div",{className:"mae-mfe-card mfe",children:[l.jsxs("div",{className:"mae-mfe-header",children:[l.jsx("span",{className:"mae-mfe-icon",children:""}),l.jsx("span",{children:"MFE"})]}),l.jsx("div",{className:"mae-mfe-value",children:h(c.avgMFE)}),l.jsx("div",{className:"mae-mfe-label",children:"Max Favorable Excursion"})]}),l.jsxs("div",{className:"mae-mfe-card ratio",children:[l.jsxs("div",{className:"mae-mfe-header",children:[l.jsx("span",{className:"mae-mfe-icon",children:""}),l.jsx("span",{children:"Ratio"})]}),l.jsx("div",{className:"mae-mfe-value",style:{color:c.maeMfeRatio<1?"#3b82f6":"#ef4444"},children:p(c.maeMfeRatio)}),l.jsx("div",{className:"mae-mfe-label",children:c.maeMfeRatio<1?"Good (Lower is better)":"Needs work"})]}),l.jsxs("div",{className:"mae-mfe-card efficiency",children:[l.jsxs("div",{className:"mae-mfe-header",children:[l.jsx("span",{className:"mae-mfe-icon",children:""}),l.jsx("span",{children:"Exit Efficiency"})]}),l.jsx("div",{className:"mae-mfe-value",style:{color:c.exitEfficiency>50?"#3b82f6":"#f59e0b"},children:d(c.exitEfficiency)}),l.jsx("div",{className:"mae-mfe-label",children:"Profit capture rate"})]})]})]})]})};function Yv(i){if(!i)return"0m";const e=i/(1e3*60*60);return e<1?`${(i/(1e3*60)).toFixed(0)}m`:e<24?`${e.toFixed(1)}h`:`${(e/24).toFixed(1)}d`}function X_(i,e){const s=i.filter(Z=>Z.netProfit>0),a=i.filter(Z=>Z.netProfit<=0),c=i.map(Z=>Z.profitPercent),h=c.reduce((Z,ye)=>Z+ye,0)/c.length,d=c.filter(Z=>Z<0),g=d.length>0?Math.sqrt(d.reduce((Z,ye)=>Z+Math.pow(ye,2),0)/d.length):0,p=g>0?h/g:0,v=c.reduce((Z,ye)=>Z+Math.pow(ye-h,2),0)/c.length,x=Math.sqrt(v),y=x>0?h/x:0,S=i.reduce((Z,ye)=>Z+ye.netProfit,0)/e*100,N=J_(i,e),E=N>0?S/N:0,R=i.map(Z=>{const ye=Math.abs(Z.mae||Z.entryPrice*.02);return ye>0?Z.netProfit/ye:0}),_=R.reduce((Z,ye)=>Z+ye,0)/R.length,F=s.reduce((Z,ye)=>Z+ye.netProfit,0),H=Math.abs(a.reduce((Z,ye)=>Z+ye.netProfit,0)),z=s.length>0?F/s.length:0,L=a.length>0?H/a.length:0,C=L>0?z/L:z>0?1/0:0,j=C,K=N>0?S/N:0;let I=0,U=null,Y=0,$=0,Q=[],q=[];i.forEach(Z=>{const ye=Z.netProfit>0;U===null||ye&&U==="win"||!ye&&U==="loss"?(I++,U=ye?"win":"loss"):(U==="win"?(Q.push(I),Y=Math.max(Y,I)):(q.push(I),$=Math.max($,I)),I=1,U=ye?"win":"loss")}),U==="win"?(Q.push(I),Y=Math.max(Y,I)):U==="loss"&&(q.push(I),$=Math.max($,I));const ge=Q.length>0?Q.reduce((Z,ye)=>Z+ye,0)/Q.length:0,O=q.length>0?q.reduce((Z,ye)=>Z+ye,0)/q.length:0,A=s.length>0?s.reduce((Z,ye)=>Z+ye.holdingDuration,0)/s.length:0,W=a.length>0?a.reduce((Z,ye)=>Z+ye.holdingDuration,0)/a.length:0,ce=W>0?A/W:0,se=[{label:"Big Loss (< -5%)",count:0,color:"#dc2626"},{label:"Loss (-5% to -2%)",count:0,color:"#ef4444"},{label:"Small Loss (-2% to 0%)",count:0,color:"#f87171"},{label:"Small Win (0% to 2%)",count:0,color:"#86efac"},{label:"Win (2% to 5%)",count:0,color:"#3b82f6"},{label:"Big Win (> 5%)",count:0,color:"#2563eb"}];i.forEach(Z=>{const ye=Z.profitPercent;ye<-5?se[0].count++:ye<-2?se[1].count++:ye<0?se[2].count++:ye<2?se[3].count++:ye<5?se[4].count++:se[5].count++}),se.forEach(Z=>{Z.percentage=Z.count/i.length*100});const M=i.filter(Z=>Z.direction==="long"),T=i.filter(Z=>Z.direction==="short"),P=Z=>{if(Z.length===0)return{count:0,winRate:0,netProfit:0,profitFactor:0};const ye=Z.filter(Le=>Le.netProfit>0),we=Z.filter(Le=>Le.netProfit<=0),Re=ye.reduce((Le,Ie)=>Le+Ie.netProfit,0),Be=Math.abs(we.reduce((Le,Ie)=>Le+Ie.netProfit,0));return{count:Z.length,winRate:ye.length/Z.length*100,netProfit:Z.reduce((Le,Ie)=>Le+Ie.netProfit,0),profitFactor:Be>0?Re/Be:Re>0?1/0:0}},B=P(M),te=P(T),de=i.reduce((Z,ye)=>Z+Math.abs(ye.mae||0),0)/i.length,oe=i.reduce((Z,ye)=>Z+Math.abs(ye.mfe||0),0)/i.length,ue=oe>0?de/oe:0,ee=s.length>0?s.reduce((Z,ye)=>Z+(ye.mfe>0?ye.netProfit/ye.mfe*100:0),0)/s.length:0;return{sharpeRatio:y,sortinoRatio:p,calmarRatio:E,avgRMultiple:_,winLossRatio:C,payoffRatio:j,recoveryFactor:K,maxConsecutiveWins:Y,maxConsecutiveLosses:$,avgWinStreak:ge,avgLossStreak:O,avgWinDuration:A,avgLossDuration:W,durationEfficiency:ce,profitBuckets:se,longTrades:B,shortTrades:te,avgMAE:de,avgMFE:oe,maeMfeRatio:ue,exitEfficiency:ee}}function J_(i,e){let s=e,a=e,c=0;return i.forEach(h=>{s+=h.netProfit,s>a&&(a=s);const d=(a-s)/a*100;d>c&&(c=d)}),c}const Q_=({results:i})=>{const{trades:e}=i,[s,a]=D.useState(null);if(!e||e.length===0)return l.jsx("div",{className:"monthly-returns-empty",children:"No trades to analyze"});const c=Z_(e),h=y=>y>=0?`+${y.toFixed(1)}%`:`${y.toFixed(1)}%`,d=y=>y>=0?`+$${y.toFixed(2)}`:`-$${Math.abs(y).toFixed(2)}`,g=y=>y>5?"#2563eb":y>2?"#3b82f6":y>0?"#93c5fd":y>-2?"#fca5a5":y>-5?"#ef4444":"#dc2626",p=y=>{const b=Math.abs(y);return b>10?1:b>5?.8:b>2?.6:b>0?.4:.2},v=(y,b)=>{const S=`${y}-${b}`;c.dailyData[S]&&a({year:y,month:b,key:S})},x=()=>{a(null)};return l.jsxs("div",{className:"monthly-returns",children:[s&&l.jsxs("div",{className:"month-breakdown",children:[l.jsxs("div",{className:"breakdown-header",children:[l.jsxs("h3",{children:["Month Breakdown - ",["January","February","March","April","May","June","July","August","September","October","November","December"][s.month]," ",s.year]}),l.jsx("button",{className:"close-breakdown-btn",onClick:x,children:""})]}),l.jsx("div",{className:"breakdown-body",children:c.dailyData[s.key]&&c.dailyData[s.key].length>0?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"daily-summary",children:[l.jsxs("div",{className:"daily-summary-card",children:[l.jsx("span",{className:"summary-label",children:"Total Return:"}),l.jsx("span",{className:"summary-value",style:{color:c.dailyData[s.key].reduce((y,b)=>y+b.returnPct,0)>0?"#3b82f6":"#ef4444"},children:h(c.dailyData[s.key].reduce((y,b)=>y+b.returnPct,0))})]}),l.jsxs("div",{className:"daily-summary-card",children:[l.jsx("span",{className:"summary-label",children:"Trading Days:"}),l.jsx("span",{className:"summary-value",children:c.dailyData[s.key].length})]}),l.jsxs("div",{className:"daily-summary-card",children:[l.jsx("span",{className:"summary-label",children:"Win Days:"}),l.jsx("span",{className:"summary-value",style:{color:"#3b82f6"},children:c.dailyData[s.key].filter(y=>y.returnPct>0).length})]}),l.jsxs("div",{className:"daily-summary-card",children:[l.jsx("span",{className:"summary-label",children:"Loss Days:"}),l.jsx("span",{className:"summary-value",style:{color:"#ef4444"},children:c.dailyData[s.key].filter(y=>y.returnPct<0).length})]})]}),l.jsxs("div",{className:"daily-returns-table",children:[l.jsxs("div",{className:"daily-table-header",children:[l.jsx("div",{className:"daily-col-date",children:"Date"}),l.jsx("div",{className:"daily-col-trades",children:"Trades"}),l.jsx("div",{className:"daily-col-pnl",children:"P&L"}),l.jsx("div",{className:"daily-col-return",children:"Return %"}),l.jsx("div",{className:"daily-col-winrate",children:"Win Rate"})]}),l.jsx("div",{className:"daily-table-body",children:c.dailyData[s.key].map((y,b)=>l.jsxs("div",{className:"daily-table-row",children:[l.jsxs("div",{className:"daily-col-date",children:[l.jsx("span",{className:"day-name",children:y.dayName}),l.jsx("span",{className:"date-num",children:y.date})]}),l.jsx("div",{className:"daily-col-trades",children:y.trades}),l.jsx("div",{className:"daily-col-pnl",style:{color:y.profit>0?"#3b82f6":"#ef4444"},children:d(y.profit)}),l.jsx("div",{className:"daily-col-return",children:l.jsxs("div",{className:"return-bar-container",children:[l.jsx("div",{className:"return-bar",style:{width:`${Math.min(Math.abs(y.returnPct)*10,100)}%`,backgroundColor:y.returnPct>0?"#3b82f6":"#ef4444"}}),l.jsx("span",{className:"return-value",style:{color:y.returnPct>0?"#3b82f6":"#ef4444"},children:h(y.returnPct)})]})}),l.jsx("div",{className:"daily-col-winrate",children:y.wins>0||y.losses>0?`${(y.wins/(y.wins+y.losses)*100).toFixed(0)}%`:"-"})]},b))})]})]}):l.jsx("div",{className:"no-daily-data",children:"No trading data for this month"})})]}),l.jsxs("div",{className:"returns-header",children:[l.jsx("h3",{children:"Monthly Returns"}),l.jsxs("div",{className:"returns-legend",children:[l.jsx("span",{className:"legend-label",children:"Returns:"}),l.jsxs("div",{className:"legend-gradient",children:[l.jsx("span",{children:"-10%"}),l.jsx("div",{className:"gradient-bar"}),l.jsx("span",{children:"+10%"})]})]})]}),l.jsx("div",{className:"returns-table",children:l.jsxs("div",{className:"returns-grid",children:[l.jsx("div",{className:"returns-header-cell corner"}),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(y=>l.jsx("div",{className:"returns-header-cell",children:y},y)),l.jsx("div",{className:"returns-header-cell",children:"Year"}),c.years.map(y=>l.jsxs(Ql.Fragment,{children:[l.jsx("div",{className:"returns-year-cell",children:y.year}),y.months.map((b,S)=>l.jsx("div",{className:`returns-cell ${b!==null?"clickable":""}`,style:{backgroundColor:b!==null?g(b):"transparent",opacity:b!==null?p(b):.1},title:b!==null?h(b):"No data",onClick:()=>b!==null&&v(y.year,S),children:b!==null&&l.jsx("span",{className:"cell-value",children:h(b)})},S)),l.jsx("div",{className:"returns-year-total",style:{backgroundColor:g(y.yearTotal),opacity:p(y.yearTotal)},children:l.jsx("span",{className:"cell-value",children:h(y.yearTotal)})})]},y.year))]})}),l.jsxs("div",{className:"returns-summary",children:[l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Best Month:"}),l.jsxs("span",{className:"stat-value",style:{color:"#3b82f6"},children:[h(c.bestMonth.value)," (",c.bestMonth.label,")"]})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Worst Month:"}),l.jsxs("span",{className:"stat-value",style:{color:"#ef4444"},children:[h(c.worstMonth.value)," (",c.worstMonth.label,")"]})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Avg Monthly Return:"}),l.jsx("span",{className:"stat-value",style:{color:c.avgMonthly>0?"#3b82f6":"#ef4444"},children:h(c.avgMonthly)})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Positive Months:"}),l.jsxs("span",{className:"stat-value",children:[c.positiveMonths," / ",c.totalMonths]})]})]})]})};function Z_(i){const e={},s={};i.forEach(_=>{const F=new Date(_.exitTime),H=F.getFullYear(),z=F.getMonth(),L=F.getDate(),C=`${H}-${z}`;e[C]||(e[C]={year:H,month:z,profit:0,returnPct:0}),e[C].profit+=_.netProfit,e[C].returnPct+=_.profitPercent;const j=`${H}-${z}-${L}`;s[j]||(s[j]={year:H,month:z,day:L,profit:0,returnPct:0,trades:0,wins:0,losses:0,date:F}),s[j].profit+=_.netProfit,s[j].returnPct+=_.profitPercent,s[j].trades++,_.netProfit>0?s[j].wins++:s[j].losses++});const c=[...new Set(Object.values(e).map(_=>_.year))].sort().map(_=>{const F=Array(12).fill(null);let H=0;for(let z=0;z<12;z++){const L=`${_}-${z}`;e[L]&&(F[z]=e[L].returnPct,H+=e[L].returnPct)}return{year:_,months:F,yearTotal:H}}),h=Object.values(e).map(_=>_.returnPct),d=h.filter(_=>_>0).length,g=h.length>0?Math.max(...h):0,p=h.length>0?Math.min(...h):0,v=h.length>0?h.reduce((_,F)=>_+F,0)/h.length:0,x=Object.entries(e).find(([,_])=>_.returnPct===g),y=Object.entries(e).find(([,_])=>_.returnPct===p),b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],N=x?`${b[x[1].month]} ${x[1].year}`:"N/A",E=y?`${b[y[1].month]} ${y[1].year}`:"N/A",R={};return Object.entries(s).forEach(([_,F])=>{const H=`${F.year}-${F.month}`;R[H]||(R[H]=[]),R[H].push({...F,dayName:S[F.date.getDay()],date:`${b[F.month]} ${F.day}`})}),Object.keys(R).forEach(_=>{R[_].sort((F,H)=>F.day-H.day)}),{years:c,bestMonth:{value:g,label:N},worstMonth:{value:p,label:E},avgMonthly:v,positiveMonths:d,totalMonths:h.length,dailyData:R}}const ej=({results:i})=>{const[e,s]=D.useState("summary"),a=[{key:"summary",label:"Summary",icon:"ai"},{key:"trades",label:"Trades",icon:"list"},{key:"advanced",label:"Advanced",icon:"target"},{key:"monthly",label:"Monthly",icon:"chart"},{key:"equity",label:"Equity Curve",icon:"chart"},{key:"tradingview",label:"TradingView",icon:"bolt"},{key:"price",label:"Price Action",icon:"bolt"},{key:"drawdown",label:"Drawdown",icon:"drop"},{key:"stats",label:"Distribution",icon:"search"}],c=()=>{const{trades:d}=i,g=["Entry Time","Exit Time","Direction","Entry Price","Exit Price","Net Profit","Profit %","Holding Duration (ms)","MAE","MFE"],p=d.map(S=>[new Date(S.entryTime).toISOString(),new Date(S.exitTime).toISOString(),S.direction,S.entryPrice.toFixed(2),S.exitPrice.toFixed(2),S.netProfit.toFixed(2),S.profitPercent.toFixed(2),S.holdingDuration,S.mae.toFixed(2),S.mfe.toFixed(2)]),v=[g,...p].map(S=>S.join(",")).join(`
`),x=new Blob([v],{type:"text/csv"}),y=URL.createObjectURL(x),b=document.createElement("a");b.href=y,b.download=`backtest-trades-${Date.now()}.csv`,b.click(),URL.revokeObjectURL(y)},h=()=>{const d=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),g=URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download=`backtest-results-${Date.now()}.json`,p.click(),URL.revokeObjectURL(g)};return l.jsxs("div",{className:"backtest-results",children:[l.jsxs("div",{className:"results-header",children:[l.jsx("h2",{children:"Backtest Results"}),l.jsxs("div",{className:"export-buttons",children:[l.jsx("button",{onClick:c,className:"export-btn",children:"Export CSV"}),l.jsx("button",{onClick:h,className:"export-btn",children:"Export JSON"})]})]}),l.jsx("div",{className:"results-tabs",children:a.map(d=>l.jsxs("button",{className:`tab-btn ${e===d.key?"active":""}`,onClick:()=>s(d.key),children:[l.jsx(Ts,{name:d.icon}),l.jsx("span",{className:"tab-label",children:d.label})]},d.key))}),l.jsxs("div",{className:"results-content",children:[e==="summary"&&l.jsx(hw,{results:i}),e==="trades"&&l.jsx(dw,{trades:i.trades}),e==="advanced"&&l.jsx(K_,{results:i}),e==="monthly"&&l.jsx(Q_,{results:i}),e==="equity"&&l.jsx(fw,{data:i.equityCurve}),e==="tradingview"&&l.jsx(W_,{symbol:i.symbol||"SPY",timeframe:i.timeframe||"15Min",signals:i.signals,trades:i.trades,historicalData:i.historicalData,theme:"dark"}),e==="price"&&l.jsx(mw,{historicalData:i.historicalData,signals:i.signals}),e==="drawdown"&&l.jsx(G_,{data:i.drawdownData.data}),e==="stats"&&l.jsx(Y_,{trades:i.trades})]})]})},tj="flowgrid_workflow_v1::saves";async function sj(i){const{strategyName:e,symbol:s,timeframe:a,startDate:c,endDate:h,startingCapital:d,fees:g=.001,slippage:p=5e-4,orderType:v="market",takeProfitPct:x=0,stopLossPct:y=0,sharesPerTrade:b=100,commissionPerTrade:S=0,usePercentOfEquity:N=!1,percentOfEquity:E=10,pyramiding:R=1,fillOnNextBar:_=!0}=i;console.log("[BacktestEngine] Starting TradingView-style backtest...",i);const F=nj(e);if(!F)throw new Error(`Strategy "${e}" not found. Create a strategy in the Workflow Builder first.`);const H=await ij(s,a,c,h);if(!H||H.length===0)throw new Error(`No historical data available for ${s} (${a}) from ${c} to ${h}. Try a different date range or timeframe.`);console.log(`[BacktestEngine] Loaded ${H.length} candles`);const z=await aj(F,H,s,a,{takeProfitPct:x,stopLossPct:y,sharesPerTrade:b,startingCapital:d,commissionPerTrade:S});console.log(`[BacktestEngine] Generated ${z.length} signals`);const{trades:L,openPosition:C}=lj(z,H,{fees:g,slippage:p,takeProfitPct:x,stopLossPct:y,sharesPerTrade:b,commissionPerTrade:S,usePercentOfEquity:!0,percentOfEquity:E,pyramiding:R,fillOnNextBar:_,startingCapital:d});console.log(`[BacktestEngine] Executed ${L.length} trades${C?" (1 open position)":""}`);const j=oj(L,d),K=cj(L,d,H),I=uj(K);let U=0;if(C){const Q=H[H.length-1],q=parseFloat(Q.c||Q.close||0),ge=C.entryPrice,O=C.shares;C.type==="long"?U=(q-ge)*O:U=(ge-q)*O}const $=(K.length>0?K[K.length-1].equity:d)+U;return j.currentCapital=$,j.openPnL=U,j.openPosition=C,{config:i,trades:L,metrics:j,equityCurve:K,drawdownData:I,historicalData:H,signals:z}}function nj(i){try{const e=localStorage.getItem(tj);return e?JSON.parse(e)[i]:null}catch(e){return console.error("[BacktestEngine] Failed to load strategy",e),null}}async function ij(i,e,s,a){try{const c=localStorage.getItem("alpaca_key_id"),h=localStorage.getItem("alpaca_secret_key");if(!c||!h)throw new Error("Alpaca API credentials not found. Please configure them in Dashboard Settings.");const d={symbol:i,timeframe:e,start:s,end:a,alpacaKeyId:c,alpacaSecretKey:h};console.log(`[BacktestEngine] Fetching data for ${i} (${e}) from ${s} to ${a}`);const p=["http://localhost:5000/backtest_data","http://localhost:5000/backtest_data",`${typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000"}/backtest_data`,"/backtest_data"];let v=null;for(const x of p)try{console.log(`[BacktestEngine] Trying endpoint: ${x}`);const y=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!y.ok){const N=await y.text();throw new Error(`HTTP ${y.status}: ${N}`)}const b=await y.json();if(b.error)throw new Error(b.error);const S=b.bars||b.data||b;return console.log(`[BacktestEngine] Successfully fetched ${S.length||0} bars from ${x}`),S}catch(y){v=y;continue}throw v||new Error("Failed to fetch historical data")}catch(c){throw console.error("[BacktestEngine] Historical data fetch error",c),c}}async function aj(i,e,s,a,c={}){try{const h=localStorage.getItem("alpaca_key_id"),d=localStorage.getItem("alpaca_secret_key");let g,p=[];if(Array.isArray(i))g=i.map(S=>({id:S.id,type:S.type,params:S.configValues||S.params||{}}));else if(i.nodes&&Array.isArray(i.nodes))g=i.nodes.map(S=>({id:S.id,type:S.type,params:S.configValues||S.params||{}})),i.connections&&Array.isArray(i.connections)&&(p=i.connections);else throw new Error("Invalid workflow format - expected array or object with nodes");console.log(`[BacktestEngine] Prepared ${g.length} workflow blocks, ${p.length} connections`);const v={symbol:s,timeframe:a,workflow:g,connections:p,historicalData:e,backtestMode:!0,alpacaKeyId:h,alpacaSecretKey:d,config:{takeProfitPct:c.takeProfitPct||0,stopLossPct:c.stopLossPct||0,sharesPerTrade:c.sharesPerTrade||100,initialCapital:c.startingCapital||1e4,commissionPerTrade:c.commissionPerTrade||0}},y=["http://localhost:5000/execute_backtest","/execute_backtest",`${typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000"}/execute_backtest`,"http://localhost:5000/execute_backtest"];let b=null;for(const S of y)try{const N=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!N.ok){const R=await N.text();throw new Error(`HTTP ${N.status}: ${R}`)}const E=await N.json();if(E.error)throw new Error(E.error);return E.signals||[]}catch(N){b=N;continue}throw b||new Error("Failed to generate signals")}catch(h){throw console.error("[BacktestEngine] Signal generation error",h),h}}function lj(i,e,s){const{fees:a=.001,slippage:c=5e-4,takeProfitPct:h=0,stopLossPct:d=0,sharesPerTrade:g=100,commissionPerTrade:p=0,usePercentOfEquity:v=!1,percentOfEquity:x=10,pyramiding:y=1,fillOnNextBar:b=!0,startingCapital:S=1e4}=s,N=[];let E=S,R=[];const _=new Map;i.forEach(H=>{const z=new Date(H.time||H.timestamp||H.t).getTime(),L=e.findIndex(C=>{const j=new Date(C.t||C.timestamp||C.time).getTime();return Math.abs(j-z)<6e4});L>=0&&_.set(L,H)}),console.log(`[TradingView Engine] Starting with $${E}, ${y} max positions, ${v?x+"% equity":g+" shares"} per trade`);for(let H=0;H<e.length;H++){const z=e[H],L=new Date(z.t||z.timestamp||z.time);parseFloat(z.o||z.open);const C=parseFloat(z.h||z.high),j=parseFloat(z.l||z.low),K=parseFloat(z.c||z.close),I=[];R.forEach((O,A)=>{let W=null,ce=null;if(O.type==="long"?O.slPrice&&j<=O.slPrice?(W=O.slPrice,ce="stop-loss"):O.tpPrice&&C>=O.tpPrice&&(W=O.tpPrice,ce="take-profit"):O.type==="short"&&(O.slPrice&&C>=O.slPrice?(W=O.slPrice,ce="stop-loss"):O.tpPrice&&j<=O.tpPrice&&(W=O.tpPrice,ce="take-profit")),W){const se=Fh(O,W,L,H,e,a,p,ce);N.push(se),E+=se.netProfit,I.push(A),console.log(`[Trade ${N.length}] ${O.type.toUpperCase()} closed via ${ce} at $${W.toFixed(2)}, P&L: $${se.netProfit.toFixed(2)}, Equity: $${E.toFixed(2)}`)}});for(let O=I.length-1;O>=0;O--)R.splice(I[O],1);const U=_.get(H);if(!U)continue;const Y=(U.signal||U.action||"").toUpperCase();if(Y==="HOLD"||Y==="WAIT")continue;let $,Q=H;if(b&&H+1<e.length){const O=e[H+1];$=parseFloat(O.o||O.open),Q=H+1}else $=K;Y==="BUY"?$*=1+c:Y==="SELL"&&($*=1-c);const q=R.filter(O=>O.type==="long").length,ge=R.filter(O=>O.type==="short").length;if(Y==="BUY"){if(ge>0&&(R.filter(O=>O.type==="short").forEach(O=>{const A=Fh(O,$,L,Q,e,a,p,"signal");N.push(A),E+=A.netProfit,console.log(`[Trade ${N.length}] SHORT reversed at $${$.toFixed(2)}, P&L: $${A.netProfit.toFixed(2)}, Equity: $${E.toFixed(2)}`)}),R=R.filter(O=>O.type!=="short")),q<y){const O=Kv(E,$,v,x,g),A=h>0?$*(1+h/100):null,W=d>0?$*(1-d/100):null;R.push({type:"long",entryPrice:$,entryTime:L,entryBar:Q,shares:O,tpPrice:A,slPrice:W}),console.log(`[Position] LONG opened at $${$.toFixed(2)}, ${O} shares (TP: ${A?.toFixed(2)||"none"}, SL: ${W?.toFixed(2)||"none"}), Equity: $${E.toFixed(2)}`)}}else if(Y==="SELL"&&(q>0&&(R.filter(O=>O.type==="long").forEach(O=>{const A=Fh(O,$,L,Q,e,a,p,"signal");N.push(A),E+=A.netProfit,console.log(`[Trade ${N.length}] LONG reversed at $${$.toFixed(2)}, P&L: $${A.netProfit.toFixed(2)}, Equity: $${E.toFixed(2)}`)}),R=R.filter(O=>O.type!=="long")),ge<y)){const O=Kv(E,$,v,x,g),A=h>0?$*(1-h/100):null,W=d>0?$*(1+d/100):null;R.push({type:"short",entryPrice:$,entryTime:L,entryBar:Q,shares:O,tpPrice:A,slPrice:W}),console.log(`[Position] SHORT opened at $${$.toFixed(2)}, ${O} shares (TP: ${A?.toFixed(2)||"none"}, SL: ${W?.toFixed(2)||"none"}), Equity: $${E.toFixed(2)}`)}}const F=R.length>0?R[0]:null;return console.log(F?`[TradingView Engine] Completed: ${N.length} trades, 1 open position, Equity: $${E.toFixed(2)}`:`[TradingView Engine] Completed: ${N.length} trades, Final Equity: $${E.toFixed(2)} (${((E-S)/S*100).toFixed(2)}%)`),{trades:N,openPosition:F}}function Kv(i,e,s,a,c){if(s){const h=i*(a/100),d=Math.floor(h/e);return Math.max(1,d)}return c}function Fh(i,e,s,a,c,h,d,g){const p=i.shares,x=(i.type==="long"?e-i.entryPrice:i.entryPrice-e)*p,y=i.entryPrice*p,b=e*p,S=(y+b)*h,N=S+d*2,E=x-N,R=E/y*100,_=s.getTime()-i.entryTime.getTime(),{mae:F,mfe:H}=rj(i.entryBar,a,c,i.entryPrice,i.type);return{direction:i.type,entryTime:i.entryTime,exitTime:s,entryPrice:i.entryPrice,exitPrice:e,shares:p,grossProfit:x,netProfit:E,profitPercent:R,holdingDuration:_,fees:S,commission:d*2,mae:F*p,mfe:H*p,exitReason:g,isAutoExit:g==="auto-exit"}}function rj(i,e,s,a,c){let h=0,d=0;for(let g=i;g<=e&&g<s.length;g++){const p=s[g],v=parseFloat(p.l||p.low||0),x=parseFloat(p.h||p.high||0);if(c==="long"){const y=a-v,b=x-a;y>h&&(h=y),b>d&&(d=b)}else{const y=x-a,b=a-v;y>h&&(h=y),b>d&&(d=b)}}return{mae:h,mfe:d}}function oj(i,e,s){if(i.length===0)return{totalTrades:0,winRate:0,lossRate:0,netProfit:0,netProfitPercent:0,avgWin:0,avgLoss:0,bestTrade:0,worstTrade:0,profitFactor:0,maxDrawdown:0,maxRunUp:0,expectancy:0,sharpeRatio:0,avgHoldingTime:0,tradesPerDay:0,currentCapital:e,openPnL:0};const a=i.filter(Y=>Y.netProfit>0),c=i.filter(Y=>Y.netProfit<=0),h=a.reduce((Y,$)=>Y+$.netProfit,0),d=Math.abs(c.reduce((Y,$)=>Y+$.netProfit,0)),g=i.reduce((Y,$)=>Y+$.netProfit,0),p=g/e*100,v=a.length>0?h/a.length:0,x=c.length>0?d/c.length:0,y=Math.max(...i.map(Y=>Y.netProfit)),b=Math.min(...i.map(Y=>Y.netProfit)),S=d>0?h/d:h>0?1/0:0,N=a.length/i.length*100,E=100-N,R=N/100*v-E/100*x,_=i.map(Y=>Y.profitPercent),F=_.reduce((Y,$)=>Y+$,0)/_.length,H=_.reduce((Y,$)=>Y+Math.pow($-F,2),0)/_.length,z=Math.sqrt(H),L=z>0?F/z:0,C=i.reduce((Y,$)=>Y+$.holdingDuration,0)/i.length,j=new Date(i[0].entryTime).getTime(),I=(new Date(i[i.length-1].exitTime).getTime()-j)/(1e3*60*60*24),U=I>0?i.length/I:0;return{totalTrades:i.length,winningTrades:a.length,losingTrades:c.length,winRate:N,lossRate:E,netProfit:g,netProfitPercent:p,avgWin:v,avgLoss:x,bestTrade:y,worstTrade:b,profitFactor:S,expectancy:R,sharpeRatio:L,avgHoldingTime:C,tradesPerDay:U,maxDrawdown:0,maxRunUp:0}}function cj(i,e,s){const a=[{time:new Date(s[0].t).getTime(),equity:e}];let c=e;return i.forEach(h=>{c+=h.netProfit,a.push({time:new Date(h.exitTime).getTime(),equity:c})}),a}function uj(i){const e=[];let s=i[0].equity,a=0;return i.forEach(c=>{c.equity>s&&(s=c.equity);const h=s-c.equity,d=s>0?h/s*100:0;e.push({time:c.time,drawdown:h,drawdownPercent:d}),h>a&&(a=h)}),{data:e,maxDrawdown:a,maxDrawdownPercent:a/i[0].equity*100}}const hj=({onNavigate:i})=>{const[e,s]=D.useState(!1),[a,c]=D.useState(null),[h,d]=D.useState(null),[g,p]=D.useState(!1),v=async x=>{s(!0),d(null),c(null);try{console.log("[Backtest] Running with config:",x);const y=await sj(x);console.log("[Backtest] Results:",y),c(y)}catch(y){console.error("[Backtest] Error:",y),d(y.message||"Backtest failed. Please try again.")}finally{s(!1)}};return l.jsxs("div",{className:"dashboard-page backtest-page-layout",children:[l.jsx(Zl,{onNavigate:i,activeRoute:"backtest"}),l.jsxs("main",{className:"dashboard-main backtest-main",children:[l.jsxs("div",{className:"backtest-page-header",children:[l.jsxs("div",{className:"header-left",children:[l.jsx("h1",{children:"Backtest"}),l.jsx("span",{className:"page-subtitle",children:"Test your strategies against historical data"})]}),l.jsx("div",{className:"header-right",children:l.jsxs("button",{className:"toggle-config-btn",onClick:()=>p(!g),title:g?"Show Configuration":"Hide Configuration",children:[l.jsx("span",{className:"toggle-icon",children:g?"":""}),l.jsx("span",{children:g?"Show Config":"Hide Config"})]})})]}),l.jsxs("div",{className:`backtest-layout ${g?"config-collapsed":""}`,children:[l.jsx("aside",{className:`backtest-config-panel ${g?"collapsed":""}`,children:l.jsx("div",{className:"config-panel-inner",children:l.jsx(uw,{onRun:v,loading:e})})}),l.jsxs("section",{className:"backtest-results-area",children:[e&&l.jsxs("div",{className:"backtest-loading",children:[l.jsx("div",{className:"loading-spinner"}),l.jsx("h3",{children:"Running Backtest"}),l.jsx("p",{children:"Processing historical data and computing trades..."}),l.jsx("div",{className:"loading-progress",children:l.jsx("div",{className:"progress-bar"})})]}),h&&l.jsxs("div",{className:"backtest-error-state",children:[l.jsx("div",{className:"error-icon-wrapper",children:l.jsx("span",{className:"error-icon-svg"})}),l.jsx("h3",{children:"Backtest Failed"}),l.jsx("p",{children:h}),l.jsx("button",{className:"retry-btn",onClick:()=>d(null),children:"Try Again"})]}),!e&&!h&&!a&&l.jsxs("div",{className:"backtest-empty-state",children:[l.jsx("div",{className:"empty-icon-wrapper",children:l.jsx("span",{className:"chart-icon-svg"})}),l.jsx("h3",{children:"Ready to Backtest"}),l.jsx("p",{children:`Configure your backtest parameters and click "Run Backtest" to begin analyzing your strategy's historical performance.`}),l.jsxs("div",{className:"empty-hints",children:[l.jsxs("div",{className:"hint-item",children:[l.jsx("span",{className:"hint-icon strategy"}),l.jsx("span",{children:"Select a saved strategy"})]}),l.jsxs("div",{className:"hint-item",children:[l.jsx("span",{className:"hint-icon calendar"}),l.jsx("span",{children:"Choose date range"})]}),l.jsxs("div",{className:"hint-item",children:[l.jsx("span",{className:"hint-icon play"}),l.jsx("span",{children:"Run backtest"})]})]})]}),!e&&!h&&a&&l.jsx(ej,{results:a})]})]})]})]})},sr=typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000",dj="flowgrid_live_trades_v1";let Xv=null,fj=0;async function nr(i={}){try{const e=new URLSearchParams;i.strategyId&&e.append("strategy_id",i.strategyId),i.limit&&e.append("limit",i.limit),i.offset&&e.append("offset",i.offset);const s=`${sr}/api/trades${e.toString()?"?"+e.toString():""}`,a=await fetch(s);if(!a.ok)throw new Error(`Backend returned ${a.status}`);return Xv=(await a.json()).trades||[],fj=Date.now(),Xv}catch(e){return console.warn("[TradeService] Backend fetch failed, using localStorage:",e.message),null}}async function u0(){try{const i=await fetch(`${sr}/api/analytics/overview`);if(!i.ok)throw new Error(`Backend returned ${i.status}`);return await i.json()}catch(i){return console.warn("[TradeService] Analytics fetch failed:",i.message),null}}async function h0(){try{const i=await fetch(`${sr}/api/analytics/equity-curve`);if(!i.ok)throw new Error(`Backend returned ${i.status}`);return(await i.json()).curve||[]}catch(i){return console.warn("[TradeService] Equity curve fetch failed:",i.message),null}}async function d0(){try{const i=await fetch(`${sr}/api/analytics/heatmap`);if(!i.ok)throw new Error(`Backend returned ${i.status}`);return await i.json()}catch(i){return console.warn("[TradeService] Heatmap fetch failed:",i.message),null}}async function mj(){try{const i=await fetch(`${sr}/api/analytics/distributions`);if(!i.ok)throw new Error(`Backend returned ${i.status}`);return await i.json()}catch(i){return console.warn("[TradeService] Distribution fetch failed:",i.message),null}}function Cs(){try{const i=localStorage.getItem(dj);return(i?JSON.parse(i):[]).sort((s,a)=>{const c=new Date(s.exitTime||s.close_ts||0);return new Date(a.exitTime||a.close_ts||0)-c})}catch(i){return console.error("[TradeService] Failed to read trades:",i),[]}}function Id(i={}){const e=Cs(),{strategyFilter:s,startDate:a,endDate:c}=i;let h=e;if(s&&s!=="ALL"&&(h=h.filter(C=>(C.strategy_id||C.strategyId)===s)),a&&(h=h.filter(C=>new Date(C.exitTime||C.close_ts)>=new Date(a))),c&&(h=h.filter(C=>new Date(C.exitTime||C.close_ts)<=new Date(c))),h.length===0)return pj();const d=h.filter(C=>(C.netPnL||C.net_pct||0)>0),g=h.filter(C=>(C.netPnL||C.net_pct||0)<=0),p=d.reduce((C,j)=>C+Math.abs(j.netPnL||j.net_pct||0),0),v=g.reduce((C,j)=>C+Math.abs(j.netPnL||j.net_pct||0),0),x=p-v,y=d.length>0?p/d.length:0,b=g.length>0?v/g.length:0,S=d.length>0?Math.max(...d.map(C=>C.netPnL||C.net_pct||0)):0,N=g.length>0?Math.min(...g.map(C=>C.netPnL||C.net_pct||0)):0,E=d.length/h.length*100,R=v>0?p/v:p>0?1/0:0,_=E/100*y-(100-E)/100*b,{maxDrawdown:F,maxDrawdownPct:H,equityCurve:z,cumulativePnl:L}=oc(h);return{total_trades:h.length,wins:d.length,losses:g.length,win_rate:E,net_pnl:x,net_pnl_percent:x,gross_profit:p,gross_loss:v,profit_factor:R,expectancy:_,avg_win:y,avg_loss:b,largest_win:S,largest_loss:N,max_drawdown_pct:H,max_drawdown_value:F,risk_reward_ratio:b>0?y/b:0}}function pj(){return{total_trades:0,wins:0,losses:0,win_rate:0,net_pnl:0,net_pnl_percent:0,gross_profit:0,gross_loss:0,profit_factor:0,expectancy:0,avg_win:0,avg_loss:0,largest_win:0,largest_loss:0,max_drawdown_pct:0,max_drawdown_value:0,risk_reward_ratio:0}}function oc(i){if(!i||i.length===0)return{maxDrawdown:0,maxDrawdownPct:0,equityCurve:[{t:Date.now(),v:100,drawdown:0}],cumulativePnl:[{t:Date.now(),v:0}]};const e=[...i].sort((x,y)=>{const b=new Date(x.exitTime||x.close_ts),S=new Date(y.exitTime||y.close_ts);return b-S}),s=100;let a=s,c=s,h=0,d=0,g=0;const p=[{t:new Date(e[0].exitTime||e[0].close_ts).getTime()-1e3,v:s,drawdown:0}],v=[{t:new Date(e[0].exitTime||e[0].close_ts).getTime()-1e3,v:0}];return e.forEach(x=>{const y=x.net_pct??x.netPnL??0,b=new Date(x.exitTime||x.close_ts).getTime();a=a*(1+y/100),g+=y,a>c&&(c=a);const S=c-a,N=c>0?S/c*100:0;N>d&&(d=N,h=S),p.push({t:b,v:a,drawdown:N}),v.push({t:b,v:g})}),{maxDrawdown:h,maxDrawdownPct:d,equityCurve:p,cumulativePnl:v}}function gj(){const i=Cs(),{equityCurve:e}=oc(i);return e}function vj(){const i=Cs(),{cumulativePnl:e}=oc(i);return e}function f0(){const i=Cs(),e=[{label:"Mon",pnl:0},{label:"Tue",pnl:0},{label:"Wed",pnl:0},{label:"Thu",pnl:0},{label:"Fri",pnl:0}],s=[];for(let a=9;a<=16;a++)s.push({label:`${a>12?a-12:a}${a>=12?"PM":"AM"}`,pnl:0});return i.forEach(a=>{const c=new Date(a.exitTime||a.close_ts),h=c.getDay(),d=c.getHours(),g=a.net_pct??a.netPnL??0;h>=1&&h<=5&&(e[h-1].pnl+=g),d>=9&&d<=16&&(s[d-9].pnl+=g)}),{byDay:e,byHour:s}}function m0(){const i=Cs(),e=new Map;return i.forEach(s=>{const a=s.strategy_id||s.strategyId||"unknown",c=s.net_pct??s.netPnL??0;e.has(a)||e.set(a,{name:s.strategyName||a,total_pnl:0,trade_count:0,wins:0,losses:0});const h=e.get(a);h.total_pnl+=c,h.trade_count+=1,c>0?h.wins+=1:h.losses+=1}),Array.from(e.values())}function yj(){const i=Cs();if(i.length===0)return{bins:[],counts:[]};const e=i.map(v=>v.net_pct??v.netPnL??0),s=Math.min(...e),c=Math.max(...e)-s||1,h=10,d=c/h,g=[],p=[];for(let v=0;v<h;v++){const x=s+v*d,y=s+(v+1)*d;g.push(`${x.toFixed(1)} to ${y.toFixed(1)}`),p.push(0)}return e.forEach(v=>{const x=Math.min(Math.floor((v-s)/d),h-1);p[x]++}),{bins:g,counts:p}}function p0(i=10){return Cs().slice(0,i)}function Wo(){return{trades:Cs().map(e=>({id:e.id,strategy_id:e.strategy_id||e.strategyId,open_side:e.open_side||e.direction,open_price:e.open_price||e.entryPrice,open_ts:e.open_ts||e.entryTime,close_side:e.close_side,close_price:e.close_price||e.exitPrice,close_ts:e.close_ts||e.exitTime,gross_pct:e.gross_pct,fee_pct_total:e.fee_pct_total,net_pct:e.net_pct,meta:e.meta}))}}function bj(){const i=Id(),{equityCurve:e,cumulativePnl:s}=oc(Cs()),{byDay:a,byHour:c}=f0(),h=p0(15),d=m0();return{account:{starting_capital:100,current_equity:e[e.length-1]?.v||100,cash:100},metrics:i,risk:{avg_win:i.avg_win,avg_loss:i.avg_loss,largest_win:i.largest_win,largest_loss:i.largest_loss,profit_factor:i.profit_factor,risk_reward_ratio:i.risk_reward_ratio},strategies:d,equity_curve:e,cumulative_pnl_curve:s,time_pnl_by_day:a,time_pnl_by_hour:c,recent_trades:h,computed_at:new Date().toISOString()}}async function xj(){try{const[i,e,s,a]=await Promise.all([u0(),nr({limit:100}),h0(),d0()]);if(i&&!i.empty){const c=i.metrics||{},h=i.by_strategy||{},d=Object.entries(h).map(([b,S])=>({name:b,total_pnl:S.net_return_pct||0,trade_count:S.trade_count||0,wins:S.wins||0,losses:S.losses||0,win_rate:S.win_rate||0})),g=(s||[]).map(b=>({t:new Date(b.ts).getTime(),v:100+(b.equity_pct||0),drawdown:b.drawdown_pct||0})),p=(s||[]).map(b=>({t:new Date(b.ts).getTime(),v:b.equity_pct||0})),v=a?.by_day||[],x=a?.by_hour||[],y=(e||[]).slice(0,15);return{source:"backend",account:{starting_capital:100,current_equity:g.length>0?g[g.length-1].v:100,cash:100},metrics:{total_trades:c.trade_count||0,wins:c.wins||0,losses:c.losses||0,win_rate:c.win_rate||0,net_pnl:c.net_return_pct||0,net_pnl_percent:c.net_return_pct||0,gross_profit:0,gross_loss:0,profit_factor:typeof c.profit_factor=="string"?1/0:c.profit_factor||0,expectancy:c.expectancy||0,avg_win:c.avg_win_pct||0,avg_loss:c.avg_loss_pct||0,largest_win:c.largest_win_pct||0,largest_loss:c.largest_loss_pct||0,max_drawdown_pct:c.max_drawdown_pct||0,max_drawdown_value:c.max_drawdown_pct||0,risk_reward_ratio:c.avg_loss_pct?c.avg_win_pct/Math.abs(c.avg_loss_pct):0},risk:{avg_win:c.avg_win_pct||0,avg_loss:c.avg_loss_pct||0,largest_win:c.largest_win_pct||0,largest_loss:c.largest_loss_pct||0,profit_factor:typeof c.profit_factor=="string"?1/0:c.profit_factor||0,risk_reward_ratio:c.avg_loss_pct?c.avg_win_pct/Math.abs(c.avg_loss_pct):0},strategies:d,equity_curve:g.length>0?g:[{t:Date.now(),v:100,drawdown:0}],cumulative_pnl_curve:p.length>0?p:[{t:Date.now(),v:0}],time_pnl_by_day:v,time_pnl_by_hour:x,recent_trades:y,computed_at:i.computed_at||new Date().toISOString()}}e&&e.length>0&&console.log("[TradeService] Backend has trades but no analytics, computing locally")}catch(i){console.warn("[TradeService] Backend dashboard fetch failed:",i.message)}return console.log("[TradeService] Using localStorage for dashboard data"),{...bj(),source:"localStorage"}}const wj=()=>{const[i,e]=D.useState([]),[s,a]=D.useState(!0);D.useEffect(()=>{c();const p=()=>{c()};return window.addEventListener("flowgrid:trade-completed",p),()=>{window.removeEventListener("flowgrid:trade-completed",p)}},[]);const c=async()=>{try{a(!0);const v=(await nr()).slice(-10).reverse();e(v)}catch(p){console.error("Failed to load trades:",p),e([])}finally{a(!1)}},h=p=>p==null||isNaN(p)?"--":`${p>0?"+":""}${p.toFixed(2)}%`,d=p=>{if(!p)return"--";try{return new Date(p).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"--"}},g=p=>p?String(p).slice(0,8):"--";return s?l.jsxs("div",{className:"mini-trade-log-loading",children:[l.jsx("div",{className:"spinner"}),l.jsx("span",{children:"Loading trades..."})]}):!i||i.length===0?l.jsxs("div",{className:"mini-trade-log-empty",children:[l.jsx("div",{className:"empty-icon",children:""}),l.jsx("div",{className:"empty-text",children:"No trades yet"})]}):l.jsxs("div",{className:"mini-trade-log",children:[l.jsx("div",{className:"mini-trade-log-header",children:l.jsxs("span",{className:"trade-count",children:[i.length," Recent Trades"]})}),l.jsx("div",{className:"mini-trade-log-list",children:i.map(p=>l.jsxs("div",{className:`mini-trade-item ${(p.net_pct||0)>0?"win":"loss"}`,children:[l.jsxs("div",{className:"trade-row-1",children:[l.jsx("span",{className:"trade-id",children:g(p.id)}),l.jsx("span",{className:`trade-side ${(p.open_side||"").toLowerCase()}`,children:p.open_side||"--"}),l.jsx("span",{className:`trade-pnl ${(p.net_pct||0)>0?"positive":"negative"}`,children:h(p.net_pct)})]}),l.jsx("div",{className:"trade-row-2",children:l.jsx("span",{className:"trade-time",children:d(p.close_ts)})})]},p.id))})]})},g0="flowgrid_workflow_v1::saves",v0="flowgrid_enabled_strategies",y0="flowgrid_running_strategies",Pd="flowgrid_live_signals",ki=5,Sj=50,_j=1e3,b0=typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000",Fs=new Map,Go=new Map;function x0(){try{const i=localStorage.getItem(g0);return i?JSON.parse(i):{}}catch(i){return console.error("[StrategyRunner] Error loading saved strategies:",i),{}}}function jj(i){try{const e=x0();delete e[i],localStorage.setItem(g0,JSON.stringify(e));const s=Nj();return delete s[i],localStorage.setItem(v0,JSON.stringify(s)),window.dispatchEvent(new CustomEvent("flowgrid:strategy-deleted",{detail:{name:i}})),console.log(`[StrategyRunner]  Strategy "${i}" deleted`),!0}catch(e){return console.error("[StrategyRunner] Error deleting strategy:",e),!1}}function Nj(){try{const i=localStorage.getItem(v0);return i?JSON.parse(i):{}}catch(i){return console.error("[StrategyRunner] Error loading enabled strategies:",i),{}}}function w0(){try{const i=localStorage.getItem(y0);return i?JSON.parse(i):{}}catch{return{}}}function S0(i){try{localStorage.setItem(y0,JSON.stringify(i))}catch(e){console.error("[StrategyRunner] Error saving running state:",e)}}function _0(){try{const i=localStorage.getItem(Pd);return i?JSON.parse(i):[]}catch{return[]}}function Ej(){try{localStorage.setItem(Pd,JSON.stringify([])),Go.clear(),window.dispatchEvent(new CustomEvent("flowgrid:signals-cleared")),console.log("[StrategyRunner]  All signals cleared and signal tracker reset")}catch(i){console.error("[StrategyRunner] Error clearing signals:",i)}}function Tj(i){try{const s=_0().filter(c=>c.strategy_name!==i.strategy_name);s.unshift(i);const a=s.slice(0,Sj);localStorage.setItem(Pd,JSON.stringify(a)),window.dispatchEvent(new CustomEvent("flowgrid:new-signal",{detail:i}))}catch(e){console.error("[StrategyRunner] Error adding signal:",e)}}function Oo(){return Fs.size}function kj(i){return Fs.has(i)}function j0(){try{const i=localStorage.getItem("alpaca_key_id")||null,e=localStorage.getItem("alpaca_secret_key")||null;return{alpacaKeyId:i,alpacaSecretKey:e}}catch{return{alpacaKeyId:null,alpacaSecretKey:null}}}function Cj(i){const e=i.nodes||[],s=i.connections||[];if(!e||e.length===0)return null;const a=[...e].sort((b,S)=>b.y-S.y),c=new Set(["input","price_history","volume_history","trigger"]);let h="SPY",d="1Hour",g=7;const p=a.slice().reverse().find(b=>c.has(b.type)&&b.configValues&&(b.configValues.symbol||b.configValues.timeframe||b.configValues.days));p&&p.configValues&&(h=p.configValues.symbol||h,d=p.configValues.timeframe||d,g=p.configValues.days||g);const v=a.map(b=>{let S=b.configValues||{};if(c.has(b.type)&&S){const{symbol:N,timeframe:E,days:R,..._}=S;S=_}return{id:b.id,type:b.type,params:S}}),{alpacaKeyId:x,alpacaSecretKey:y}=j0();return console.log(`[StrategyRunner] Preparing payload: ${v.length} nodes, ${s.length} connections`),{symbol:h,timeframe:d,days:g,workflow:v,connections:s,priceType:"close",alpacaKeyId:x,alpacaSecretKey:y}}async function Mj(i,e,s){const a=Cj(e);try{const c=await fetch(`${b0}/execute_workflow_v2`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:s});if(!c.ok){const d=await c.text().catch(()=>"Unknown error");return console.warn(`[StrategyRunner] ${i} HTTP ${c.status}:`,d.slice(0,200)),{error:d}}return await c.json()}catch(c){return c.name==="AbortError"?null:(console.error(`[StrategyRunner] ${i} execution error:`,c),{error:c.message})}}function Dj(i,e,s){if(!e)return;let a=null,c=null,h=null;const d=(e.finalSignal||"").toUpperCase();if(d==="BUY"?(a="BUY",c="entry",h=e.confidence||"Strategy confirmed"):d==="SELL"&&(a="SELL",c="exit",h=e.confidence||"Strategy confirmed"),!a){const x=[e.final_output,e.decision_result,e.action,e.signal,e.trade_signal,e.result];for(const y of x){if(!y)continue;const b=String(y).toUpperCase();if(b.includes("BUY")||b.includes("LONG")||b==="TRUE"||b==="PASSED"){a="BUY",c="entry";break}else if(b.includes("SELL")||b.includes("SHORT")||b.includes("EXIT")){a="SELL",c="exit";break}}}if(!a&&e.comparison_result!==void 0&&(e.comparison_result===!0||e.comparison_result==="true")&&(a="BUY",c="entry"),!a&&e.indicators){const x=e.indicators.rsi?.value||e.indicators.RSI?.value;x!==void 0&&(x<30?(a="BUY",c="entry",h="RSI oversold"):x>70&&(a="SELL",c="exit",h="RSI overbought"))}const g=e.current_price||e.latest_close||e.price||e.indicators?.price?.value||e.close||e.latest_data?.close||0,p=Go.get(i),v=!p||p.direction!==a;if(a&&v){const x={id:`${Date.now()}-${Math.random().toString(36).substr(2,8)}`,timestamp:new Date().toISOString(),strategy_name:i,symbol:s,direction:a,type:c,price:g,confidence:h,indicators:e.indicators||{},status:"active"};Go.set(i,{direction:a,timestamp:Date.now()}),Tj(x),Rj(i,a,g),console.log(`[StrategyRunner] SIGNAL CHANGED: ${p?.direction||"NONE"} -> ${a} ${s} @ $${g.toFixed(2)} from ${i}`)}}async function Rj(i,e,s){try{const a=await fetch(`${b0}/api/signals/ingest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy_id:i,signal:e,price:s,ts:new Date().toISOString(),meta:{source:"StrategyRunner"}})});if(a.ok){const c=await a.json();c.action==="closed_and_opened"&&c.completed_trade&&(console.log(`[StrategyRunner] TRADE COMPLETED: ${c.completed_trade.net_pct.toFixed(2)}% from ${i}`),window.dispatchEvent(new CustomEvent("flowgrid:trade-completed",{detail:c.completed_trade})))}}catch(a){console.warn("[StrategyRunner] Failed to ingest signal to backend:",a.message)}}async function Aj(i){if(Fs.size>=ki)return console.warn(`[StrategyRunner] Max ${ki} strategies reached`),window.dispatchEvent(new CustomEvent("flowgrid:max-strategies-reached",{detail:{max:ki}})),!1;if(Fs.has(i))return console.log(`[StrategyRunner] ${i} already running`),!0;const{alpacaKeyId:e,alpacaSecretKey:s}=j0();if(!e||!s)return console.error("[StrategyRunner]  Alpaca API credentials not found in localStorage"),window.dispatchEvent(new CustomEvent("flowgrid:credentials-missing",{detail:{message:"Alpaca API credentials are required. Go to Settings to configure them."}})),!1;const c=x0()[i];if(!c)return console.error(`[StrategyRunner] Strategy "${i}" not found`),!1;if(!c.nodes||c.nodes.length===0)return console.error(`[StrategyRunner] Strategy "${i}" has no nodes`),!1;console.log(`[StrategyRunner]  Starting ${i}...`);const h=new AbortController,g=(c.nodes||[]).find(x=>x.type==="trigger")?.data?.symbol||"SPY",p=async()=>{let x=0;for(;!h.signal.aborted;){try{x++;const y=Date.now();console.log(`[StrategyRunner]  [${x}] Polling ${i} (${Fs.size} total running)`);const b=await Mj(i,c,h.signal),S=Date.now()-y;b&&!b.error?(console.log(`[StrategyRunner]  [${x}] ${i} completed in ${S}ms`),Dj(i,b,g)):b?.error&&console.warn(`[StrategyRunner]  [${x}] ${i} returned error: ${b.error.slice(0,100)}`)}catch(y){y.name!=="AbortError"&&console.error(`[StrategyRunner]  ${i} error:`,y)}await new Promise((y,b)=>{const S=setTimeout(y,_j);h.signal.addEventListener("abort",()=>{clearTimeout(S),y()})})}console.log(`[StrategyRunner]  ${i} stopped after ${x} polls`)};Fs.set(i,{abort:h});const v=w0();return v[i]=!0,S0(v),window.dispatchEvent(new CustomEvent("flowgrid:strategy-started",{detail:{name:i,running:Fs.size}})),p(),!0}function Lj(i){const e=Fs.get(i);if(!e)return console.log(`[StrategyRunner] ${i} not running`),!1;console.log(`[StrategyRunner]  Stopping ${i}...`),e.abort.abort(),Fs.delete(i),Go.delete(i);const s=w0();return delete s[i],S0(s),window.dispatchEvent(new CustomEvent("flowgrid:strategy-stopped",{detail:{name:i,running:Fs.size}})),!0}async function Oj(i,e){return e?await Aj(i):Lj(i)}const Jv="flowgrid_workflow_v1::saves",zo="flowgrid_enabled_strategies",Wh="flowgrid_dashboard_layout",ms=(i,e=!1)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}$${Math.abs(i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Qv=(i,e=!1)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}${i.toFixed(2)}%`,Yo=(i,e=2)=>i==null||isNaN(i)?"--":i.toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}),zj=({data:i,positive:e=!0,width:s=80,height:a=40})=>{if(!i||i.length<2)return l.jsx("div",{className:"metric-sparkline",children:l.jsx("svg",{viewBox:`0 0 ${s} ${a}`,children:l.jsx("path",{d:`M 0 ${a/2} L ${s} ${a/2}`,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"2"})})});const c=i.map(b=>typeof b=="number"?b:b.v||b.value||0),h=Math.min(...c),g=Math.max(...c)-h||1,p=c.map((b,S)=>{const N=S/(c.length-1)*s,E=a-(b-h)/g*(a-4)-2;return`${N},${E}`}).join(" "),x=c[c.length-1]>=c[0]?"#3b82f6":"#ef4444",y=`M 0,${a} L ${p.split(" ").map((b,S)=>{const[N,E]=b.split(",");return`${N},${E}`}).join(" L ")} L ${s},${a} Z`;return l.jsx("div",{className:"metric-sparkline",children:l.jsxs("svg",{viewBox:`0 0 ${s} ${a}`,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:`sparkGradient-${e}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"0%",stopColor:x,stopOpacity:"0.3"}),l.jsx("stop",{offset:"100%",stopColor:x,stopOpacity:"0"})]})}),l.jsx("path",{d:y,fill:`url(#sparkGradient-${e})`}),l.jsx("polyline",{points:p,fill:"none",stroke:x,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})},Ij=({winRate:i=0,wins:e=0,losses:s=0,neutral:a=0})=>{const h=2*Math.PI*24,d=Math.min(100,Math.max(0,i)),g=h-d/100*h;return l.jsxs("div",{className:"metric-ring-chart",children:[l.jsxs("svg",{viewBox:"0 0 60 60",children:[l.jsx("circle",{className:"ring-bg",cx:"30",cy:"30",r:24}),l.jsx("circle",{className:`ring-progress ${d>=50?"positive":"negative"}`,cx:"30",cy:"30",r:24,strokeDasharray:h,strokeDashoffset:g})]}),l.jsxs("div",{className:"metric-trade-badges",style:{position:"absolute",bottom:"-28px",left:"50%",transform:"translateX(-50%)"},children:[l.jsx("span",{className:"trade-badge wins",children:e}),a>0&&l.jsx("span",{className:"trade-badge neutral",children:a}),l.jsx("span",{className:"trade-badge losses",children:s})]})]})},Pj=({value:i=0})=>{const e=i===1/0?"":Yo(i,2),s=i>=1.5?"positive":i>=1?"neutral":"negative";return l.jsx("div",{className:`profit-factor-ring ${s}`,children:l.jsx("span",{style:{fontSize:"14px",fontWeight:700,fontFamily:"var(--font-mono)"},children:e})})},ja=({label:i,value:e,subValue:s,delta:a,tooltip:c,isNegative:h,isEmpty:d,emptyMessage:g,chartType:p,chartData:v,wins:x,losses:y,neutral:b})=>{const S=a!==void 0&&a>0,N=a!==void 0&&a<0,E=d||e==="--"||e==="0"||e===0||e==="0%"||e==="$0.00"||e==="-0.00%",R=()=>{if(!p)return null;switch(p){case"sparkline":return l.jsx(zj,{data:v,positive:!N});case"winrate":const F=typeof e=="string"?parseFloat(e):e;return l.jsx(Ij,{winRate:F,wins:x,losses:y,neutral:b});case"profitfactor":const H=e===""?1/0:typeof e=="string"?parseFloat(e):e;return l.jsx(Pj,{value:H});default:return null}},_=p&&!E;return l.jsx("div",{className:`metric-card ${E?"empty-state":""}`,children:l.jsxs("div",{className:_?"metric-card-with-chart":"",children:[l.jsxs("div",{className:_?"metric-card-content":"",children:[l.jsxs("div",{className:"metric-label",children:[i,c&&l.jsxs("span",{className:"metric-info-icon tooltip-trigger",children:["",l.jsx("span",{className:"tooltip-content",children:c})]}),p==="winrate"&&!E&&l.jsx("span",{style:{marginLeft:"auto",fontSize:"11px",color:"var(--text-muted)"},children:(x||0)+(y||0)+(b||0)})]}),l.jsx("div",{className:`metric-value ${h?"negative":""} ${S?"positive":""} ${N?"negative":""} ${E?"dimmed":""}`,children:E&&g?g:e}),s&&l.jsx("div",{className:`metric-subvalue ${S?"positive":""} ${N?"negative":""}`,children:s}),E&&!g&&l.jsx("div",{className:"metric-empty-hint",children:"No trades yet"})]}),_&&R()]})})},Bj=({equityCurve:i,cumulativePnl:e,timeframe:s,showDrawdown:a=!0})=>{const c=Ql.useRef(null),[h,d]=D.useState(()=>localStorage.getItem("flowgrid_chart_mode")||"equity"),[g,p]=D.useState(null),v=D.useCallback(R=>{d(R),localStorage.setItem("flowgrid_chart_mode",R)},[]),x=D.useMemo(()=>h==="equity"?i:e,[h,i,e]),y=x&&x.length>=1,b=h==="equity"?100:0,S=!y||x.length===1&&x[0]?.v===b||x.length>1&&x.every(R=>R.v===x[0]?.v);y&&x.length===1&&x[0]?.v,D.useEffect(()=>{const R=c.current;if(!R||!x||x.length===0)return;const _=R.getContext("2d"),F=window.devicePixelRatio||1,H=R.getBoundingClientRect();R.width=H.width*F,R.height=H.height*F,_.scale(F,F);const z=H.width,L=H.height,C={top:20,right:20,bottom:30,left:70},j=z-C.left-C.right,K=L-C.top-C.bottom;_.clearRect(0,0,z,L);const I=h==="equity"?100:0;let U=[I,...x.map(W=>W.v)],Y=[0,...x.map(W=>W.drawdown||0)];const $=Math.min(...U,I)*.98,Q=Math.max(...U,I)*1.02,q=Q-$||1;_.strokeStyle="rgba(255, 255, 255, 0.05)",_.lineWidth=1;const ge=5;for(let W=0;W<=ge;W++){const ce=C.top+K/ge*W;_.beginPath(),_.moveTo(C.left,ce),_.lineTo(z-C.right,ce),_.stroke();const se=Q-q/ge*W;_.fillStyle="rgba(255, 255, 255, 0.5)",_.font="11px Inter, sans-serif",_.textAlign="right",_.fillText(ms(se),C.left-8,ce+4)}if(a&&h==="equity"){_.fillStyle="rgba(239, 68, 68, 0.1)",_.beginPath();for(let W=0;W<x.length;W++){const ce=C.left+W/(x.length-1)*j,M=(Y[W]||0)/100*K*.5,T=C.top;W===0&&_.moveTo(ce,T),_.lineTo(ce,T+M)}_.lineTo(C.left+j,C.top),_.lineTo(C.left,C.top),_.closePath(),_.fill()}const O=_.createLinearGradient(0,C.top,0,L-C.bottom);U[U.length-1]>=U[0]?(O.addColorStop(0,"rgba(59, 130, 246, 0.3)"),O.addColorStop(1,"rgba(59, 130, 246, 0)")):(O.addColorStop(0,"rgba(239, 68, 68, 0.3)"),O.addColorStop(1,"rgba(239, 68, 68, 0)")),_.fillStyle=O,_.beginPath(),_.moveTo(C.left,L-C.bottom);for(let W=0;W<U.length;W++){const ce=C.left+W/(U.length-1)*j,se=C.top+(Q-U[W])/q*K;_.lineTo(ce,se)}_.lineTo(C.left+j,L-C.bottom),_.closePath(),_.fill(),_.strokeStyle="#3B82F6",_.lineWidth=2,_.beginPath();for(let W=0;W<U.length;W++){const ce=C.left+W/(U.length-1)*j,se=C.top+(Q-U[W])/q*K;W===0?_.moveTo(ce,se):_.lineTo(ce,se)}if(_.stroke(),g!==null&&g<U.length){const W=C.left+g/(U.length-1)*j,ce=C.top+(Q-U[g])/q*K;_.fillStyle="#3B82F6",_.beginPath(),_.arc(W,ce,5,0,Math.PI*2),_.fill(),_.fillStyle="rgba(0, 0, 0, 0.8)",_.fillRect(W-40,ce-30,80,22),_.fillStyle="#fff",_.font="11px Inter, sans-serif",_.textAlign="center",_.fillText(ms(U[g]),W,ce-14)}},[x,a,h,g]);const N=D.useCallback(R=>{if(!x||x.length===0)return;const _=c.current;if(!_)return;const F=_.getBoundingClientRect(),H=R.clientX-F.left,z={left:70,right:20},L=F.width-z.left-z.right,C=H-z.left,j=Math.round(C/L*(x.length-1));j>=0&&j<x.length?p(j):p(null)},[x]),E=D.useCallback(()=>{p(null)},[]);return l.jsxs("div",{className:"equity-chart-container",children:[l.jsxs("div",{className:"chart-toggles",children:[l.jsx("button",{className:`chart-toggle ${h==="equity"?"active":""}`,onClick:()=>v("equity"),title:"Show account equity over time",children:"Equity"}),l.jsx("button",{className:`chart-toggle ${h==="pnl"?"active":""}`,onClick:()=>v("pnl"),title:"Show cumulative realized P&L",children:"Cumulative P&L"})]}),S?l.jsxs("div",{className:"chart-empty-state",children:[l.jsx("div",{className:"chart-placeholder"}),l.jsxs("div",{className:"chart-empty-message",children:[l.jsx("span",{className:"empty-icon icon-chart"}),l.jsx("p",{children:h==="equity"?"Equity curve will appear here":"P&L history will appear here"}),l.jsx("p",{className:"empty-hint",children:"Enable a strategy to start tracking performance"})]})]}):l.jsx("canvas",{ref:c,className:"equity-canvas",onMouseMove:N,onMouseLeave:E})]})},$j=({strategies:i,onToggle:e,onEdit:s,onDelete:a,loading:c,togglingStrategy:h})=>{const d=i.slice(0,5),g=i.length>5,[p,v]=D.useState(!1),x=p?i:d;return l.jsxs("div",{className:"strategy-control-panel",children:[c&&l.jsxs("div",{className:"panel-loading",children:[l.jsx("span",{className:"loading-spinner",children:""})," Loading strategies..."]}),!c&&i.length===0&&l.jsxs("div",{className:"empty-strategies",children:[l.jsx("div",{className:"empty-icon icon-strategies"}),l.jsx("p",{children:"No strategies saved yet"}),l.jsx("p",{className:"empty-hint",children:"Create strategies in the Strategy Builder"})]}),!c&&x.map(y=>{const b=kj(y.name),S=h===y.name;return l.jsxs("div",{className:`strategy-row ${y.enabled?"enabled":"disabled"} ${b?"running":""} ${S?"toggling":""}`,children:[l.jsxs("label",{className:`strategy-toggle-switch ${S?"disabled":""}`,children:[l.jsx("input",{type:"checkbox",checked:y.enabled,onChange:()=>!S&&e(y.name,!y.enabled),disabled:S}),l.jsx("span",{className:"toggle-slider",children:S&&l.jsx("span",{className:"toggle-loading",children:""})})]}),l.jsxs("div",{className:"strategy-details",children:[l.jsxs("div",{className:"strategy-name",children:[y.name,b&&l.jsx("span",{className:"live-indicator",children:"LIVE"})]}),l.jsxs("div",{className:"strategy-stats",children:[l.jsx("span",{className:`stat-pnl ${y.net_pnl>=0?"positive":"negative"}`,children:ms(y.net_pnl,!0)}),l.jsx("span",{className:"stat-divider",children:""}),l.jsxs("span",{className:"stat-winrate",children:[y.win_rate?.toFixed(1)||0,"% win"]}),l.jsx("span",{className:"stat-divider",children:""}),l.jsxs("span",{className:"stat-trades",children:[y.trade_count||0," trades"]})]})]}),l.jsxs("div",{className:"strategy-actions",children:[l.jsx("button",{className:"strategy-edit-btn",onClick:()=>s(y),disabled:S,title:"Edit strategy"}),l.jsx("button",{className:"strategy-delete-btn",onClick:N=>{N.stopPropagation(),a(y.name)},disabled:S||y.enabled,title:y.enabled?"Stop strategy before deleting":"Delete strategy"})]})]},y.name)}),g&&!p&&l.jsxs("button",{className:"show-more-btn",onClick:()=>v(!0),children:["Show ",i.length-5," more..."]}),p&&g&&l.jsx("button",{className:"show-more-btn",onClick:()=>v(!1),children:"Show less"})]})},Uj=({riskData:i})=>{const{avg_win:e=0,avg_loss:s=0,largest_win:a=0,largest_loss:c=0,profit_factor:h=0,risk_reward_ratio:d=0}=i||{},g=Math.max(Math.abs(e),Math.abs(s),1),p=e>0||s>0||a>0||c>0;return l.jsxs("div",{className:"risk-quality-panel",children:[l.jsxs("div",{className:"risk-bars",children:[l.jsxs("div",{className:"risk-bar-row",children:[l.jsxs("span",{className:"risk-label tooltip-trigger",children:["Avg Win",l.jsx("span",{className:"tooltip-content",children:"Mean profit per winning trade = Total Wins  # Wins"})]}),l.jsx("div",{className:"risk-bar-container",children:l.jsx("div",{className:`risk-bar positive ${p?"":"empty"}`,style:{width:p?`${e/g*100}%`:"0%"}})}),l.jsx("span",{className:`risk-value positive ${p?"":"dimmed"}`,children:ms(e)})]}),l.jsxs("div",{className:"risk-bar-row",children:[l.jsxs("span",{className:"risk-label tooltip-trigger",children:["Avg Loss",l.jsx("span",{className:"tooltip-content",children:"Mean loss per losing trade = Total Losses  # Losses"})]}),l.jsx("div",{className:"risk-bar-container",children:l.jsx("div",{className:`risk-bar negative ${p?"":"empty"}`,style:{width:p?`${Math.abs(s)/g*100}%`:"0%"}})}),l.jsx("span",{className:`risk-value negative ${p?"":"dimmed"}`,children:ms(-Math.abs(s))})]})]}),!p&&l.jsx("div",{className:"risk-empty-hint",children:"Win/loss metrics will populate after your first closed trade"}),l.jsxs("div",{className:"risk-stats-grid",children:[l.jsxs("div",{className:"risk-stat tooltip-trigger",children:[l.jsx("span",{className:"risk-stat-label",children:"Largest Win"}),l.jsx("span",{className:`risk-stat-value positive ${p?"":"dimmed"}`,children:ms(a)}),l.jsx("span",{className:"tooltip-content",children:"Best single trade profit"})]}),l.jsxs("div",{className:"risk-stat tooltip-trigger",children:[l.jsx("span",{className:"risk-stat-label",children:"Largest Loss"}),l.jsx("span",{className:`risk-stat-value negative ${p?"":"dimmed"}`,children:ms(c)}),l.jsx("span",{className:"tooltip-content",children:"Worst single trade loss"})]}),l.jsxs("div",{className:"risk-stat tooltip-trigger",children:[l.jsx("span",{className:"risk-stat-label",children:"Risk/Reward"}),l.jsx("span",{className:`risk-stat-value ${p?"":"dimmed"}`,children:Yo(d)}),l.jsx("span",{className:"tooltip-content",children:"Avg Win  Avg Loss. Higher is better."})]}),l.jsxs("div",{className:"risk-stat tooltip-trigger",children:[l.jsx("span",{className:"risk-stat-label",children:"Profit Factor"}),l.jsx("span",{className:`risk-stat-value ${h>=1?"positive":"negative"} ${p?"":"dimmed"}`,children:h===1/0?"":Yo(h)}),l.jsx("span",{className:"tooltip-content",children:"Gross Profit  Gross Loss. Values > 1 = profitable"})]})]})]})},Vj=({dataByDay:i,dataByHour:e})=>{const[s,a]=D.useState("day"),c=D.useRef(null),h=s==="day"?i:e,d=(h||[]).some(y=>y.pnl!==0),v=s==="day"?["Mon","Tue","Wed","Thu","Fri"].map(y=>({label:y,pnl:0})):["9AM","10AM","11AM","12PM","1PM","2PM","3PM"].map(y=>({label:y,pnl:0})),x=d?h:v;return D.useEffect(()=>{const y=c.current;if(!y||!x||x.length===0)return;const b=y.getContext("2d"),S=window.devicePixelRatio||1,N=y.getBoundingClientRect();y.width=N.width*S,y.height=N.height*S,b.scale(S,S);const E=N.width,R=N.height,_={top:15,bottom:25,left:10,right:10},F=E-_.left-_.right,H=R-_.top-_.bottom;b.clearRect(0,0,E,R);const z=Math.max(...x.map($=>Math.abs($.pnl)),.01),L=_.top+H/2;b.strokeStyle="rgba(156, 163, 175, 0.3)",b.lineWidth=1,b.setLineDash([4,4]),b.beginPath(),b.moveTo(_.left,L),b.lineTo(E-_.right,L),b.stroke(),b.setLineDash([]);const C=x.length,j=8,K=(C-1)*j,I=Math.min(32,(F-K)/C),U=C*I+K,Y=_.left+(F-U)/2;x.forEach(($,Q)=>{const q=Y+Q*(I+j),ge=Math.abs($.pnl)/z*(H/2-5),O=$.pnl>=0,A=O?L-ge:L,W=2;if(b.beginPath(),d&&$.pnl!==0)b.fillStyle=O?"#3b82f6":"#ef4444",O?(b.moveTo(q+W,A),b.lineTo(q+I-W,A),b.quadraticCurveTo(q+I,A,q+I,A+W),b.lineTo(q+I,L),b.lineTo(q,L),b.lineTo(q,A+W),b.quadraticCurveTo(q,A,q+W,A)):(b.moveTo(q,L),b.lineTo(q+I,L),b.lineTo(q+I,A+ge-W),b.quadraticCurveTo(q+I,A+ge,q+I-W,A+ge),b.lineTo(q+W,A+ge),b.quadraticCurveTo(q,A+ge,q,A+ge-W),b.lineTo(q,L));else{b.fillStyle="rgba(255, 255, 255, 0.05)";const ce=H/6,se=L-ce/2;b.moveTo(q+W,se),b.lineTo(q+I-W,se),b.quadraticCurveTo(q+I,se,q+I,se+W),b.lineTo(q+I,se+ce-W),b.quadraticCurveTo(q+I,se+ce,q+I-W,se+ce),b.lineTo(q+W,se+ce),b.quadraticCurveTo(q,se+ce,q,se+ce-W),b.lineTo(q,se+W),b.quadraticCurveTo(q,se,q+W,se)}b.closePath(),b.fill(),b.fillStyle=d?"#9ca3af":"#4b5563",b.font="10px -apple-system, BlinkMacSystemFont, sans-serif",b.textAlign="center",b.fillText($.label,q+I/2,R-8)}),d&&(b.fillStyle="#6b7280",b.font="9px -apple-system, BlinkMacSystemFont, sans-serif",b.textAlign="right",b.fillText(`+${z.toFixed(0)}`,_.left+F+5,_.top+10),b.fillText(`-${z.toFixed(0)}`,_.left+F+5,R-_.bottom-5))},[x,d,s]),l.jsxs("div",{className:"time-performance-panel",children:[l.jsxs("div",{className:`time-chart-canvas-container ${d?"":"skeleton"}`,children:[l.jsx("canvas",{ref:c,className:"time-chart-canvas"}),!d&&l.jsx("div",{className:"time-empty-overlay",children:l.jsx("span",{children:"Performance by time will appear after trades close"})})]}),l.jsxs("div",{className:"time-tabs",children:[l.jsx("button",{className:`time-tab ${s==="day"?"active":""}`,onClick:()=>a("day"),title:"View P&L breakdown by day of week",children:"By Day"}),l.jsx("button",{className:`time-tab ${s==="hour"?"active":""}`,onClick:()=>a("hour"),title:"View P&L breakdown by trading hour",children:"By Hour"})]})]})},Zv={signal:"",trade_open:"",trade_close:"",strategy_start:"",strategy_stop:"",strategy_edit:"",default:""},Hj=({trades:i,activityLog:e,onTradeClick:s})=>{const a=D.useMemo(()=>{const c=[...i||[]];return e&&e.length>0&&e.forEach(h=>{c.push({id:h.id||`event-${h.timestamp}`,type:h.type,timestamp:h.timestamp,strategy_name:h.strategy_name,symbol:h.symbol||"",message:h.message,isEvent:!0})}),c.sort((h,d)=>{const g=h.timestamp||h.exitTime||"";return(d.timestamp||d.exitTime||"").localeCompare(g)}),c.slice(0,15)},[i,e]);return a.length===0?l.jsx("div",{className:"recent-trades-panel empty-panel",children:l.jsxs("div",{className:"no-trades",children:[l.jsx("span",{className:"empty-icon icon-list"}),l.jsx("p",{children:"No current signals"}),l.jsx("p",{className:"empty-hint",children:"Active strategy signals will appear here"})]})}):l.jsx("div",{className:"recent-trades-panel",children:a.map((c,h)=>{if(c.isEvent){const x=Zv[c.type]||Zv.default,y=c.timestamp?new Date(c.timestamp).toLocaleTimeString():"";return l.jsxs("div",{className:`activity-row event-${c.type}`,children:[l.jsx("span",{className:"activity-icon",children:x}),l.jsxs("div",{className:"activity-info",children:[l.jsx("span",{className:"activity-message",children:c.message||c.type}),c.strategy_name&&l.jsx("span",{className:"activity-strategy",children:c.strategy_name})]}),l.jsx("span",{className:"activity-time",children:y})]},c.id||h)}const d=c.timestamp&&!c.exitTime,g=c.timestamp?new Date(c.timestamp).toLocaleTimeString():c.exitTime?new Date(c.exitTime).toLocaleTimeString():"",p=(c.direction||(c.type==="entry"?"BUY":"SELL")).toLowerCase(),v=p==="buy"||p==="long";return l.jsxs("div",{className:`trade-row ${d?`live-signal ${v?"buy":"sell"}`:""}`,onClick:()=>s?.(c),children:[l.jsxs("span",{className:`trade-direction ${p}`,children:[c.direction||(c.type==="entry"?"BUY":"SELL"),d&&l.jsx("span",{className:`signal-badge ${v?"buy":"sell"}`,children:"LIVE"})]}),l.jsxs("div",{className:"trade-info",children:[l.jsx("span",{className:"trade-symbol",children:c.symbol}),l.jsx("span",{className:"trade-strategy",children:c.strategy_name}),g&&l.jsx("span",{className:"trade-time",children:g})]}),l.jsx("span",{className:`trade-pnl ${d?"live-price":(c.pnl||0)>=0?"positive":"negative"}`,children:c.pnl!==void 0&&c.pnl!==null?ms(c.pnl,!0):c.price?`@${c.price.toFixed(2)}`:"--"})]},c.id||h)})})},qj=({onNavigate:i})=>{const[e,s]=D.useState("1M"),[a,c]=D.useState(null),[h,d]=D.useState(!0),[g,p]=D.useState(null),[v,x]=D.useState(null),[y,b]=D.useState([]),[S,N]=D.useState({}),[E,R]=D.useState(null),[_,F]=D.useState([]),[H,z]=D.useState(()=>localStorage.getItem("flowgrid_display_name")||""),[L,C]=D.useState(!1),[j,K]=D.useState(["performance","strategies","risk","time","trades"]),[I,U]=D.useState([]),[Y,$]=D.useState(null),[Q,q]=D.useState(null);D.useEffect(()=>{const me=Se=>{Se.detail?.displayName!==void 0&&z(Se.detail.displayName)};return window.addEventListener("flowgrid:settings-updated",me),()=>window.removeEventListener("flowgrid:settings-updated",me)},[]),D.useEffect(()=>{const me=localStorage.getItem(Wh);if(me)try{const{order:Se,hidden:Ae}=JSON.parse(me);Se&&K(Se),Ae&&U(Ae)}catch(Se){console.error("Failed to load dashboard layout:",Se)}},[]);const ge=D.useCallback(()=>{localStorage.setItem(Wh,JSON.stringify({order:j,hidden:I})),C(!1)},[j,I]),O=D.useCallback(()=>{K(["performance","strategies","risk","time","trades"]),U([]),localStorage.removeItem(Wh),C(!1)},[]),A=D.useCallback(me=>{U(Se=>Se.includes(me)?Se.filter(Ae=>Ae!==me):[...Se,me])},[]),W=D.useCallback((me,Se)=>{$(Se),me.dataTransfer.effectAllowed="move"},[]),ce=D.useCallback((me,Se)=>{me.preventDefault(),Y&&Y!==Se&&q(Se)},[Y]),se=D.useCallback(()=>{q(null)},[]),M=D.useCallback((me,Se)=>{me.preventDefault(),Y&&Y!==Se&&K(Ae=>{const Ye=[...Ae],Me=Ye.indexOf(Y),Ce=Ye.indexOf(Se);return Ye.splice(Me,1),Ye.splice(Ce,0,Y),Ye}),$(null),q(null)},[Y]),T=D.useCallback(()=>{$(null),q(null)},[]),P=D.useCallback(()=>{try{const me=localStorage.getItem(Jv),Se=localStorage.getItem(zo);if(me){const Ae=JSON.parse(me),Ye=Se?JSON.parse(Se):{},Me=Object.keys(Ae).map(Ce=>({name:Ce,enabled:!!Ye[Ce],savedAt:Ae[Ce]?.savedAt||null,nodes:Ae[Ce]?.nodes||[],connections:Ae[Ce]?.connections||[]}));Me.sort((Ce,tt)=>Ce.savedAt?tt.savedAt?new Date(tt.savedAt)-new Date(Ce.savedAt):-1:1),b(Me),N(Ye)}else b([]),N({})}catch(me){console.error("Error loading local strategies:",me),b([])}},[]),B=D.useCallback(async me=>{try{p(null);const Se=await xj();console.log(`[Dashboard] Data source: ${Se.source||"unknown"}`);const Ae=y.map(Ce=>{const tt=Se.strategies?.find(bt=>bt.name===Ce.name);return{name:Ce.name,enabled:Ce.enabled,net_pnl:tt?.total_pnl||0,win_rate:tt?tt.wins/(tt.trade_count||1)*100:0,trade_count:tt?.trade_count||0,created_at:Ce.savedAt,updated_at:Ce.savedAt}}),Ye={...Se,strategies:Ae};c(Ye),x(new Date);const Me=Cs();console.log(`[Dashboard] Loaded ${Se.metrics?.total_trades||Me.length} trades`)}catch(Se){console.error("Failed to load dashboard data:",Se),p(Se.message)}finally{d(!1)}},[]);D.useEffect(()=>{P(),d(!1);const me=()=>{P(),setTimeout(()=>B(),500)},Se=Me=>{const{name:Ce,enabled:tt}=Me.detail||{};if(Ce){b(oi=>oi.map($t=>$t.name===Ce?{...$t,enabled:tt}:$t));const bt=localStorage.getItem(zo);bt&&N(JSON.parse(bt))}},Ae=Me=>{(Me.key===Jv||Me.key===zo)&&P()};window.addEventListener("flowgrid:strategy-saved",me),window.addEventListener("flowgrid:strategy-toggled",Se),window.addEventListener("storage",Ae);const Ye=setInterval(P,2e3);return()=>{window.removeEventListener("flowgrid:strategy-saved",me),window.removeEventListener("flowgrid:strategy-toggled",Se),window.removeEventListener("storage",Ae),clearInterval(Ye)}},[]),D.useEffect(()=>{const me=setTimeout(()=>{B()},100),Se=setInterval(()=>B(),1e4);return()=>{clearTimeout(me),clearInterval(Se)}},[]),D.useEffect(()=>{const me=Ae=>{console.log("[Dashboard] Trade completed event - refreshing metrics",Ae.detail),B()},Se=()=>{console.log("[Dashboard] Trades updated event - refreshing metrics"),B()};return window.addEventListener("flowgrid:trade-completed",me),window.addEventListener("flowgrid:trades-updated",Se),()=>{window.removeEventListener("flowgrid:trade-completed",me),window.removeEventListener("flowgrid:trades-updated",Se)}},[B]);const te=D.useCallback(me=>{s(me),d(!0),B(me)},[B]),de=D.useCallback(()=>{window.confirm("Clear all current signals?")&&(Ej(),Yt([]))},[]),oe=D.useCallback(me=>{window.confirm(`Delete strategy "${me}"? This cannot be undone.`)&&jj(me)&&(P(),setTimeout(()=>B(),300))},[P,B]),ue=D.useCallback(async(me,Se)=>{try{if(Se&&Oo()>=ki){alert(`Maximum ${ki} strategies can run at once. Please stop another strategy first.`);return}if(R(me),!await Oj(me,Se)&&Se){R(null),alert(`Failed to start strategy "${me}". Check if it has valid nodes.`);return}const Ye={...S,[me]:Se};localStorage.setItem(zo,JSON.stringify(Ye)),N(Ye),b(Me=>Me.map(Ce=>Ce.name===me?{...Ce,enabled:Se}:Ce)),window.dispatchEvent(new CustomEvent("flowgrid:strategy-toggled",{detail:{name:me,enabled:Se}})),setTimeout(()=>R(null),300),console.log(`Strategy "${me}" ${Se?"STARTED ":"STOPPED "} (${Oo()}/${ki} running)`)}catch(Ae){console.error("Failed to toggle strategy:",Ae),R(null),alert(`Error toggling strategy: ${Ae.message}`)}},[S]),ee=D.useCallback(me=>{F(Se=>[{id:`strategy_edit-${Date.now()}`,type:"strategy_edit",timestamp:new Date().toISOString(),strategy_name:me.name,message:`Editing strategy: ${me.name}`},...Se.slice(0,49)]),localStorage.setItem("flowgrid_workflow_v1::load_request",me.name),window.dispatchEvent(new CustomEvent("flowgrid:load-request",{detail:me.name})),i("builder")},[i]),Z=D.useCallback(me=>{console.log("Trade clicked:",me)},[]),ye=D.useMemo(()=>{if(!y.length)return[];const me=a?.strategies||[],Se=new Map(me.map(Ae=>[Ae.name,Ae]));return y.map(Ae=>{const Ye=Se.get(Ae.name);return{name:Ae.name,enabled:Ae.enabled,net_pnl:Ye?.net_pnl||0,win_rate:Ye?.win_rate||0,trade_count:Ye?.trade_count||0,created_at:Ae.savedAt,updated_at:Ae.savedAt}})},[y,a?.strategies]),we=a?.equity_curve||[],Re=a?.cumulative_pnl_curve||[],Be=a?.time_pnl_by_day||[],Le=a?.time_pnl_by_hour||[],Ie=a?.recent_trades||[],[ut,Yt]=D.useState([]),[Ot,jt]=D.useState(0),[lt,Ms]=D.useState(null),[Xs,It]=D.useState([]);D.useEffect(()=>{const me=()=>{const $t=_0();Yt($t),jt(Oo());const $a=Cs();It($a);const Qs=Id();Qs.total_trades>0&&Ms(Qs)};me();const Se=$t=>{console.log(" New signal received:",$t.detail),me()},Ae=()=>{jt(Oo()),me()},Ye=()=>{me()},Me=$t=>{console.log(" Trade completed event received:",$t.detail),me(),B()},Ce=$t=>{alert(`Maximum ${$t.detail.max} strategies can run at once!`)},tt=$t=>{alert($t.detail.message||"Alpaca API credentials are required to run strategies.")},bt=()=>{console.log(" Signals cleared event received"),Yt([])};window.addEventListener("flowgrid:new-signal",Se),window.addEventListener("flowgrid:strategy-started",Ae),window.addEventListener("flowgrid:strategy-stopped",Ae),window.addEventListener("flowgrid:trade-opened",Ye),window.addEventListener("flowgrid:trade-closed",Ye),window.addEventListener("flowgrid:trade-completed",Me),window.addEventListener("flowgrid:max-strategies-reached",Ce),window.addEventListener("flowgrid:credentials-missing",tt),window.addEventListener("flowgrid:signals-cleared",bt);const oi=setInterval(me,1e3);return()=>{window.removeEventListener("flowgrid:new-signal",Se),window.removeEventListener("flowgrid:strategy-started",Ae),window.removeEventListener("flowgrid:strategy-stopped",Ae),window.removeEventListener("flowgrid:trade-opened",Ye),window.removeEventListener("flowgrid:trade-closed",Ye),window.removeEventListener("flowgrid:trade-completed",Me),window.removeEventListener("flowgrid:max-strategies-reached",Ce),window.removeEventListener("flowgrid:credentials-missing",tt),window.removeEventListener("flowgrid:signals-cleared",bt),clearInterval(oi)}},[B]);const En=D.useMemo(()=>{const me=Xs.map(Me=>({id:Me.id,timestamp:Me.exitTime||Me.entryTime,strategy_name:Me.strategy_name,symbol:Me.symbol,direction:Me.direction,type:Me.status==="closed"?"exit":"entry",price:Me.exitPrice||Me.entryPrice,pnl:Me.pnl})),Se=[...ut,...me,...Ie],Ae=new Map;Se.forEach(Me=>{Ae.has(Me.id)||Ae.set(Me.id,Me)});const Ye=Array.from(Ae.values());return Ye.sort((Me,Ce)=>{const tt=Me.timestamp||Me.exitTime||"";return(Ce.timestamp||Ce.exitTime||"").localeCompare(tt)}),Ye.slice(0,15)},[ut,Xs,Ie]),yt=D.useMemo(()=>lt&&lt.total_trades>0?lt:a?.metrics||{},[lt,a?.metrics]),Js=D.useMemo(()=>lt&&lt.total_trades>0?{avg_win:lt.avg_win,avg_loss:lt.avg_loss,largest_win:lt.largest_win,largest_loss:lt.largest_loss,risk_reward_ratio:lt.avg_loss>0?lt.avg_win/lt.avg_loss:0,profit_factor:lt.profit_factor}:a?.risk||{},[lt,a?.risk]),ke=["1D","1W","1M","3M","1Y","ALL"];return l.jsxs("div",{className:"dashboard-page",children:[l.jsx(Zl,{onNavigate:i,activeRoute:"home"}),l.jsxs("main",{className:"dashboard-main",children:[l.jsxs("div",{className:"dashboard-header",children:[l.jsxs("div",{className:"header-left",children:[l.jsx("h1",{children:H?`Welcome back, ${H}`:"Dashboard"}),v&&l.jsxs("span",{className:"last-update",children:["Last updated: ",v.toLocaleTimeString()]})]}),l.jsxs("div",{className:"header-right",children:[Ot>0&&l.jsxs("span",{className:"running-badge",title:`${Ot} strategies running`,children:[l.jsx("span",{className:"running-dot"})," ",Ot,"/",ki," Running"]}),l.jsx("button",{className:`edit-dashboard-btn ${L?"active":""}`,onClick:()=>C(!L),title:"Customize dashboard layout",children:L?" Cancel":"Edit Dashboard"}),l.jsx("button",{className:"refresh-btn",onClick:()=>B(),disabled:h,children:"Refresh"})]})]}),L&&l.jsxs("div",{className:"edit-mode-toolbar",children:[l.jsx("span",{children:"Drag panels to reorder  Click  to hide panels"}),l.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[l.jsx("button",{className:"edit-toolbar-save",onClick:ge,children:"Save Layout"}),l.jsx("button",{className:"edit-toolbar-reset",onClick:O,children:" Reset"}),l.jsx("button",{className:"edit-toolbar-cancel",onClick:()=>C(!1),children:"Cancel"})]})]}),g&&l.jsxs("div",{className:"error-banner",children:[g," - Displaying local/demo data"]}),l.jsxs("div",{className:"metrics-row",children:[l.jsx(ja,{label:"NET P&L",value:ms(yt.net_pnl,!0),subValue:Qv(yt.net_pnl_percent,!0),delta:yt.net_pnl,tooltip:"Total profit and loss after fees, commissions, and slippage",chartType:"sparkline",chartData:Re}),l.jsx(ja,{label:"TRADE WIN %",value:`${yt.win_rate?.toFixed(2)||"0.00"}%`,tooltip:"Percentage of profitable trades",chartType:"winrate",wins:yt.wins||0,losses:yt.losses||0,neutral:0}),l.jsx(ja,{label:"PROFIT FACTOR",value:yt.profit_factor===1/0?"":Yo(yt.profit_factor),tooltip:"Gross profits divided by gross losses. Values > 1 indicate profitability",chartType:"profitfactor"}),l.jsx(ja,{label:"EXPECTANCY",value:ms(yt.expectancy),subValue:`Avg: +${ms(yt.avg_win)} / -${ms(yt.avg_loss)}`,tooltip:"Expected profit per trade based on win rate and average win/loss"}),l.jsx(ja,{label:"TOTAL TRADES",value:yt.total_trades||0,tooltip:"Total number of completed trades"}),l.jsx(ja,{label:"MAX DRAWDOWN",value:`-${Qv(yt.max_drawdown_pct)}`,subValue:ms(-yt.max_drawdown_value),isNegative:!0,tooltip:"Maximum peak-to-trough decline in account equity"})]}),l.jsxs("div",{className:`dashboard-grid ${L?"edit-mode":""}`,children:[!I.includes("performance")&&l.jsxs("div",{className:`panel performance-panel ${Y==="performance"?"dragging":""} ${Q==="performance"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"performance"),onDragOver:me=>ce(me,"performance"),onDragLeave:se,onDrop:me=>M(me,"performance"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("performance"),title:"Hide panel",children:""}),l.jsxs("div",{className:"panel-header",children:[l.jsx("span",{className:"panel-title",children:"Account Performance"}),l.jsx("div",{className:"timeframe-tabs",children:ke.map(me=>l.jsx("button",{className:`timeframe-tab ${e===me?"active":""}`,onClick:()=>te(me),children:me},me))})]}),l.jsx("div",{className:"panel-content",children:l.jsx(Bj,{equityCurve:we,cumulativePnl:Re,timeframe:e,showDrawdown:!0})})]}),!I.includes("strategies")&&l.jsxs("div",{className:`panel strategies-panel ${Y==="strategies"?"dragging":""} ${Q==="strategies"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"strategies"),onDragOver:me=>ce(me,"strategies"),onDragLeave:se,onDrop:me=>M(me,"strategies"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("strategies"),title:"Hide panel",children:""}),l.jsx("div",{className:"panel-header",children:l.jsx("span",{className:"panel-title",children:"My Strategies"})}),l.jsx("div",{className:"panel-content",children:l.jsx($j,{strategies:ye,onToggle:ue,onEdit:ee,onDelete:oe,loading:h,togglingStrategy:E})})]}),!I.includes("risk")&&l.jsxs("div",{className:`panel risk-panel ${Y==="risk"?"dragging":""} ${Q==="risk"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"risk"),onDragOver:me=>ce(me,"risk"),onDragLeave:se,onDrop:me=>M(me,"risk"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("risk"),title:"Hide panel",children:""}),l.jsx("div",{className:"panel-header",children:l.jsx("span",{className:"panel-title",children:"Risk & Trade Quality"})}),l.jsx("div",{className:"panel-content",children:l.jsx(Uj,{riskData:Js})})]}),!I.includes("time")&&l.jsxs("div",{className:`panel time-panel ${Y==="time"?"dragging":""} ${Q==="time"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"time"),onDragOver:me=>ce(me,"time"),onDragLeave:se,onDrop:me=>M(me,"time"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("time"),title:"Hide panel",children:""}),l.jsx("div",{className:"panel-header",children:l.jsx("span",{className:"panel-title",children:"Time-Based P&L"})}),l.jsx("div",{className:"panel-content",children:l.jsx(Vj,{dataByDay:Be,dataByHour:Le})})]}),!I.includes("trades")&&l.jsxs("div",{className:`panel trades-panel ${Y==="trades"?"dragging":""} ${Q==="trades"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"trades"),onDragOver:me=>ce(me,"trades"),onDragLeave:se,onDrop:me=>M(me,"trades"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("trades"),title:"Hide panel",children:""}),l.jsxs("div",{className:"panel-header",children:[l.jsx("span",{className:"panel-title",children:"Current Signals"}),ut.length>0&&l.jsx("button",{className:"clear-signals-btn",onClick:de,title:"Clear all signals",children:"Clear"})]}),l.jsx("div",{className:"panel-content",children:l.jsx(Hj,{trades:En,activityLog:_,onTradeClick:Z})})]}),!I.includes("tradelog")&&l.jsxs("div",{className:`panel tradelog-panel ${Y==="tradelog"?"dragging":""} ${Q==="tradelog"?"drag-over":""}`,draggable:L,onDragStart:me=>W(me,"tradelog"),onDragOver:me=>ce(me,"tradelog"),onDragLeave:se,onDrop:me=>M(me,"tradelog"),onDragEnd:T,children:[L&&l.jsx("span",{className:"panel-drag-handle",children:""}),L&&l.jsx("button",{className:"panel-delete-btn",onClick:()=>A("tradelog"),title:"Hide panel",children:""}),l.jsx("div",{className:"panel-header",children:l.jsx("span",{className:"panel-title",children:"Recent Trades"})}),l.jsx("div",{className:"panel-content",children:l.jsx(wj,{})})]})]})]})]})},ey=i=>i==null||isNaN(i)?"--":`$${Math.abs(i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Gh=(i,e=!0)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}${i.toFixed(2)}%`,ty=i=>{if(!i)return"--";try{return new Date(i).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"--"}},Fj=(i,e)=>{if(!i||!e)return"--";try{const s=new Date(e)-new Date(i),a=Math.floor(s/1e3),c=Math.floor(a/60),h=Math.floor(c/60),d=Math.floor(h/24);return d>0?`${d}d ${h%24}h`:h>0?`${h}h ${c%60}m`:c>0?`${c}m ${a%60}s`:`${a}s`}catch{return"--"}},zl=({title:i,children:e})=>l.jsxs("div",{className:"modal-section",children:[l.jsx("div",{className:"section-title",children:i}),l.jsx("div",{className:"section-content",children:e})]}),Ls=({label:i,value:e,badge:s,color:a,bold:c,mono:h})=>{const d=["field-value",a==="positive"?"positive":"",a==="negative"?"negative":"",c?"bold":"",h?"mono":""].filter(Boolean).join(" ");return l.jsxs("div",{className:"modal-field",children:[l.jsx("span",{className:"field-label",children:i}),s?l.jsx("span",{className:`side-badge ${String(e).toLowerCase()}`,children:e}):l.jsx("span",{className:d,children:e})]})},N0=({trade:i,strategyName:e,onClose:s})=>{if(!i)return null;const a=(i.net_pct||0)>0?"positive":(i.net_pct||0)<0?"negative":"",c=(i.gross_pct||0)>0?"positive":(i.gross_pct||0)<0?"negative":"",h=d=>{d.target===d.currentTarget&&s()};return Ql.useEffect(()=>{const d=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[s]),l.jsx("div",{className:"trade-modal-overlay",onClick:h,children:l.jsxs("div",{className:"trade-modal",children:[l.jsxs("div",{className:"modal-header",children:[l.jsxs("div",{className:"modal-title",children:[l.jsx("span",{className:`side-badge ${(i.open_side||"").toLowerCase()}`,children:i.open_side||"UNKNOWN"}),l.jsxs("span",{className:"trade-id",children:["Trade ",i.id?i.id.slice(0,8):"--"]})]}),l.jsx("button",{className:"modal-close",onClick:s,children:""})]}),l.jsxs("div",{className:"modal-body",children:[l.jsxs(zl,{title:"Overview",children:[l.jsx(Ls,{label:"Strategy",value:e||i.strategy_id||"Unknown"}),l.jsx(Ls,{label:"Side",value:i.open_side||"--",badge:!0}),l.jsx(Ls,{label:"Duration",value:Fj(i.open_ts,i.close_ts)})]}),l.jsxs(zl,{title:"Entry",children:[l.jsx(Ls,{label:"Time",value:ty(i.open_ts),mono:!0}),l.jsx(Ls,{label:"Price",value:ey(i.open_price)})]}),l.jsxs(zl,{title:"Exit",children:[l.jsx(Ls,{label:"Time",value:ty(i.close_ts),mono:!0}),l.jsx(Ls,{label:"Price",value:ey(i.close_price)})]}),l.jsxs(zl,{title:"Performance",children:[l.jsx(Ls,{label:"Gross %",value:Gh(i.gross_pct),color:c}),l.jsx(Ls,{label:"Fees %",value:Gh(i.fee_pct_total,!1)}),l.jsx(Ls,{label:"Net %",value:Gh(i.net_pct),color:a,bold:!0})]}),i.meta&&Object.keys(i.meta).length>0&&l.jsx(zl,{title:"Metadata",children:Object.entries(i.meta).map(([d,g])=>l.jsx(Ls,{label:d,value:typeof g=="object"?JSON.stringify(g):String(g),mono:!0},d))})]}),l.jsx("div",{className:"modal-footer",children:l.jsx("button",{className:"modal-close-btn",onClick:s,children:"Close"})})]})})},sy=i=>i==null||isNaN(i)?"--":`$${Math.abs(i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Bo=(i,e=!0)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}${i.toFixed(2)}%`,ny=i=>{if(!i)return"--";try{return new Date(i).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"--"}},E0=(i,e)=>{if(!i||!e)return"--";try{const s=new Date(e)-new Date(i),a=s/(1e3*60*60);return a<1?`${Math.floor(s/(1e3*60))}m`:a<24?`${a.toFixed(1)}h`:`${(a/24).toFixed(1)}d`}catch{return"--"}},Wj=i=>i?String(i).slice(0,8):"--",Gj=({strategies:i,filters:e,onFilterChange:s,onClear:a})=>l.jsxs("div",{className:"trade-filter-bar",children:[l.jsxs("div",{className:"filter-group",children:[l.jsx("label",{children:"Strategy"}),l.jsxs("select",{value:e.strategy||"ALL",onChange:c=>s("strategy",c.target.value),children:[l.jsx("option",{value:"ALL",children:"All Strategies"}),Object.entries(i).map(([c,h])=>l.jsx("option",{value:c,children:h},c))]})]}),l.jsxs("div",{className:"filter-group",children:[l.jsx("label",{children:"Side"}),l.jsxs("select",{value:e.side||"ALL",onChange:c=>s("side",c.target.value),children:[l.jsx("option",{value:"ALL",children:"All Sides"}),l.jsx("option",{value:"LONG",children:"Long Only"}),l.jsx("option",{value:"SHORT",children:"Short Only"})]})]}),l.jsxs("div",{className:"filter-group",children:[l.jsx("label",{children:"Result"}),l.jsxs("select",{value:e.result||"ALL",onChange:c=>s("result",c.target.value),children:[l.jsx("option",{value:"ALL",children:"All Trades"}),l.jsx("option",{value:"WINS",children:"Wins Only"}),l.jsx("option",{value:"LOSSES",children:"Losses Only"})]})]}),l.jsxs("div",{className:"filter-group date-range",children:[l.jsx("label",{children:"Date Range"}),l.jsxs("div",{className:"date-inputs",children:[l.jsx("input",{type:"date",value:e.startDate||"",onChange:c=>s("startDate",c.target.value)}),l.jsx("span",{className:"date-separator",children:"to"}),l.jsx("input",{type:"date",value:e.endDate||"",onChange:c=>s("endDate",c.target.value)})]})]}),l.jsx("button",{className:"filter-clear-btn",onClick:a,children:"Clear Filters"})]}),Yj=({trades:i})=>{const e=D.useMemo(()=>{if(!i||i.length===0)return{total:0,wins:0,losses:0,winRate:0,netPct:0};const s=i.filter(h=>(h.net_pct||0)>0),a=i.filter(h=>(h.net_pct||0)<=0),c=i.reduce((h,d)=>h+(d.net_pct||0),0);return{total:i.length,wins:s.length,losses:a.length,winRate:i.length>0?s.length/i.length*100:0,netPct:c}},[i]);return l.jsxs("div",{className:"trade-summary-bar",children:[l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Total Trades"}),l.jsx("span",{className:"stat-value",children:e.total})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Wins"}),l.jsx("span",{className:"stat-value positive",children:e.wins})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Losses"}),l.jsx("span",{className:"stat-value negative",children:e.losses})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Win Rate"}),l.jsxs("span",{className:"stat-value",children:[e.winRate.toFixed(1),"%"]})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Net P&L"}),l.jsx("span",{className:`stat-value ${e.netPct>0?"positive":e.netPct<0?"negative":""}`,children:Bo(e.netPct)})]})]})},Kj=({trades:i,disabled:e})=>{const[s,a]=D.useState(!1),c=()=>{if(!i||i.length===0)return;const d=["ID","Strategy","Side","Entry Time","Entry Price","Exit Time","Exit Price","Duration","Gross %","Fees %","Net %"],g=i.map(b=>[b.id||"",b.strategy_id||"",b.open_side||"",b.open_ts||"",b.open_price||"",b.close_ts||"",b.close_price||"",E0(b.open_ts,b.close_ts),(b.gross_pct||0).toFixed(2),(b.fee_pct_total||0).toFixed(2),(b.net_pct||0).toFixed(2)]),p=[d,...g].map(b=>b.join(",")).join(`
`),v=new Blob([p],{type:"text/csv"}),x=URL.createObjectURL(v),y=document.createElement("a");y.href=x,y.download=`trades-${Date.now()}.csv`,y.click(),URL.revokeObjectURL(x),a(!1)},h=()=>{if(!i||i.length===0)return;const d=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),g=URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download=`trades-${Date.now()}.json`,p.click(),URL.revokeObjectURL(g),a(!1)};return l.jsxs("div",{className:"export-dropdown",children:[l.jsxs("button",{className:"export-btn",onClick:()=>a(!s),disabled:e,children:["Export",l.jsx("span",{className:"export-arrow",children:""})]}),s&&l.jsxs("div",{className:"export-menu",children:[l.jsx("button",{onClick:c,children:"Export CSV"}),l.jsx("button",{onClick:h,children:"Export JSON"})]})]})},Xj=({trades:i,onSelectTrade:e,strategies:s})=>{const[a,c]=D.useState("close_ts"),[h,d]=D.useState("desc"),g=y=>{a===y?d(h==="asc"?"desc":"asc"):(c(y),d("desc"))},p=D.useMemo(()=>!i||i.length===0?[]:[...i].sort((y,b)=>{let S=y[a],N=b[a];return a.includes("_ts")&&(S=S?new Date(S).getTime():0,N=N?new Date(N).getTime():0),typeof S=="number"&&typeof N=="number"?h==="asc"?S-N:N-S:(S=String(S||""),N=String(N||""),h==="asc"?S.localeCompare(N):N.localeCompare(S))}),[i,a,h]),v=({field:y})=>a!==y?l.jsx("span",{className:"sort-icon",children:""}):l.jsx("span",{className:"sort-icon active",children:h==="asc"?"":""}),x=y=>s[y]||y||"Unknown";return!i||i.length===0?l.jsxs("div",{className:"trade-table-empty",children:[l.jsx("div",{className:"empty-icon icon-chart"}),l.jsx("div",{className:"empty-title",children:"No trades yet"}),l.jsx("div",{className:"empty-message",children:"Enable a strategy and wait for alternating BUY/SELL signals to generate trades."})]}):l.jsx("div",{className:"trade-table-container",children:l.jsx("div",{className:"trade-table-wrapper",children:l.jsxs("table",{className:"trade-table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsxs("th",{onClick:()=>g("id"),children:["ID ",l.jsx(v,{field:"id"})]}),l.jsxs("th",{onClick:()=>g("strategy_id"),children:["Strategy ",l.jsx(v,{field:"strategy_id"})]}),l.jsxs("th",{onClick:()=>g("open_side"),children:["Side ",l.jsx(v,{field:"open_side"})]}),l.jsxs("th",{onClick:()=>g("open_ts"),children:["Entry Time ",l.jsx(v,{field:"open_ts"})]}),l.jsxs("th",{onClick:()=>g("open_price"),children:["Entry Price ",l.jsx(v,{field:"open_price"})]}),l.jsxs("th",{onClick:()=>g("close_ts"),children:["Exit Time ",l.jsx(v,{field:"close_ts"})]}),l.jsxs("th",{onClick:()=>g("close_price"),children:["Exit Price ",l.jsx(v,{field:"close_price"})]}),l.jsx("th",{children:"Duration"}),l.jsxs("th",{onClick:()=>g("gross_pct"),children:["Gross % ",l.jsx(v,{field:"gross_pct"})]}),l.jsxs("th",{onClick:()=>g("fee_pct_total"),children:["Fees % ",l.jsx(v,{field:"fee_pct_total"})]}),l.jsxs("th",{onClick:()=>g("net_pct"),children:["Net % ",l.jsx(v,{field:"net_pct"})]}),l.jsx("th",{children:"Actions"})]})}),l.jsx("tbody",{children:p.map(y=>l.jsxs("tr",{className:(y.net_pct||0)>0?"win":"loss",onClick:()=>e(y),children:[l.jsx("td",{className:"mono",children:Wj(y.id)}),l.jsx("td",{children:x(y.strategy_id)}),l.jsx("td",{children:l.jsx("span",{className:`side-badge ${(y.open_side||"").toLowerCase()}`,children:y.open_side||"--"})}),l.jsx("td",{children:ny(y.open_ts)}),l.jsx("td",{children:sy(y.open_price)}),l.jsx("td",{children:ny(y.close_ts)}),l.jsx("td",{children:sy(y.close_price)}),l.jsx("td",{children:E0(y.open_ts,y.close_ts)}),l.jsx("td",{className:(y.gross_pct||0)>0?"positive":"negative",children:Bo(y.gross_pct)}),l.jsx("td",{className:"dimmed",children:Bo(y.fee_pct_total,!1)}),l.jsx("td",{className:`bold ${(y.net_pct||0)>0?"positive":"negative"}`,children:Bo(y.net_pct)}),l.jsx("td",{children:l.jsx("button",{className:"view-btn",onClick:b=>{b.stopPropagation(),e(y)},children:"View"})})]},y.id))})]})})})},Jj=()=>{const[i,e]=D.useState([]),[s,a]=D.useState({}),[c,h]=D.useState(!0),[d,g]=D.useState(null),[p,v]=D.useState(null),[x,y]=D.useState({strategy:"ALL",side:"ALL",result:"ALL",startDate:"",endDate:""}),b=D.useCallback(async()=>{try{h(!0),g(null);const _=await nr({limit:1e3});if(_&&_.length>0){const F=_.map(H=>({id:H.id,strategy_id:H.strategy_id,open_side:H.open_side,open_price:H.open_price,open_ts:H.open_ts,close_side:H.close_side,close_price:H.close_price,close_ts:H.close_ts,gross_pct:H.gross_pct,fee_pct_total:H.fee_pct_total,net_pct:H.net_pct,meta:H.meta}));e(F),console.log(`[TradeLogging] Loaded ${F.length} trades from backend`)}else{const F=Wo();e(F.trades||[]),console.log(`[TradeLogging] Loaded ${F.trades?.length||0} trades from localStorage`)}}catch(_){console.error("Error loading trades:",_);const F=Wo();e(F.trades||[]),console.log(`[TradeLogging] Fallback - loaded ${F.trades?.length||0} trades from localStorage`)}finally{h(!1)}},[]),S=D.useCallback(async()=>{try{const _=localStorage.getItem("flowgrid_workflow_v1::saves");if(_){const F=JSON.parse(_),H={};Object.keys(F).forEach(z=>{H[z]=z}),a(H)}}catch(_){console.error("Error loading strategies:",_)}},[]);D.useEffect(()=>{b(),S()},[b,S]),D.useEffect(()=>{const _=()=>{b()};return window.addEventListener("flowgrid:trade-completed",_),()=>window.removeEventListener("flowgrid:trade-completed",_)},[b]);const N=D.useMemo(()=>i.filter(_=>!(x.strategy!=="ALL"&&_.strategy_id!==x.strategy||x.side!=="ALL"&&_.open_side!==x.side||x.result==="WINS"&&(_.net_pct||0)<=0||x.result==="LOSSES"&&(_.net_pct||0)>0||x.startDate&&_.close_ts&&new Date(_.close_ts).toISOString().split("T")[0]<x.startDate||x.endDate&&_.close_ts&&new Date(_.close_ts).toISOString().split("T")[0]>x.endDate)),[i,x]),E=(_,F)=>{y(H=>({...H,[_]:F}))},R=()=>{y({strategy:"ALL",side:"ALL",result:"ALL",startDate:"",endDate:""})};return c?l.jsxs("div",{className:"trade-logging-loading",children:[l.jsx("div",{className:"loading-spinner"}),l.jsx("div",{children:"Loading trades..."})]}):d?l.jsxs("div",{className:"trade-logging-error",children:[l.jsx("div",{className:"error-icon icon-alert"}),l.jsx("div",{children:d}),l.jsx("button",{onClick:b,children:"Retry"})]}):l.jsxs("div",{className:"trade-logging",children:[l.jsxs("div",{className:"trade-logging-header",children:[l.jsxs("h3",{children:["Trade Log (",N.length," trades)"]}),l.jsx(Kj,{trades:N,disabled:N.length===0})]}),l.jsx(Gj,{strategies:s,filters:x,onFilterChange:E,onClear:R}),l.jsx(Yj,{trades:N}),l.jsx(Xj,{trades:N,strategies:s,onSelectTrade:v}),p&&l.jsx(N0,{trade:p,strategyName:s[p.strategy_id]||p.strategy_id,onClose:()=>v(null)})]})},si=(i,e=!0)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}${i.toFixed(2)}%`,T0=i=>i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),Qj=i=>["January","February","March","April","May","June","July","August","September","October","November","December"][i],Zj=(i,e)=>new Date(i,e+1,0).getDate(),eN=(i,e)=>{const s=new Date(i,e,1).getDay();return s===0?6:s-1},tN=(i,e)=>i.getFullYear()===e.getFullYear()&&i.getMonth()===e.getMonth()&&i.getDate()===e.getDate(),sN=i=>tN(i,new Date),nN=i=>i>new Date,iN=({year:i,month:e,onPrevMonth:s,onNextMonth:a,strategies:c,selectedStrategy:h,onStrategyChange:d})=>{const g=()=>{const p=new Date,v=(p.getFullYear()-i)*12+(p.getMonth()-e);for(let x=0;x<Math.abs(v);x++)v>0?a():s()};return l.jsxs("div",{className:"calendar-controls",children:[l.jsxs("div",{className:"calendar-nav",children:[l.jsx("button",{className:"nav-btn",onClick:s,children:""}),l.jsxs("span",{className:"current-month",children:[Qj(e)," ",i]}),l.jsx("button",{className:"nav-btn",onClick:a,children:""}),l.jsx("button",{className:"today-btn",onClick:g,children:"Today"})]}),l.jsx("div",{className:"calendar-filters",children:l.jsxs("select",{value:h,onChange:p=>d(p.target.value),children:[l.jsx("option",{value:"ALL",children:"All Strategies"}),Object.entries(c).map(([p,v])=>l.jsx("option",{value:p,children:v},p))]})})]})},aN=({date:i,dayData:e,maxAbsPct:s,onClick:a,isCurrentMonth:c})=>{const[h,d]=D.useState(!1);if(!i)return l.jsx("div",{className:"calendar-day empty"});const g=i.getDate(),p=e&&e.trades>0,v=e?.netPct||0,x=sN(i),y=nN(i),b=p&&s>0?Math.min(Math.abs(v)/s,1)*.8+.2:0;let S="transparent";p&&(v>0?S=`rgba(59, 130, 246, ${b})`:v<0?S=`rgba(239, 68, 68, ${b})`:S="rgba(156, 163, 175, 0.3)");const N=["calendar-day",p?"has-trades":"",x?"today":"",y?"future":"",c?"":"other-month"].filter(Boolean).join(" ");return l.jsxs("div",{className:N,style:{backgroundColor:S},onClick:()=>p&&a(i,e),onMouseEnter:()=>p&&d(!0),onMouseLeave:()=>d(!1),children:[l.jsx("span",{className:"day-number",children:g}),p&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{className:"trade-count",children:[e.trades," trade",e.trades>1?"s":""]}),l.jsx("span",{className:`day-pnl ${v>0?"positive":v<0?"negative":""}`,children:si(v)})]}),h&&p&&l.jsxs("div",{className:"day-popover",children:[l.jsxs("div",{className:"popover-header",children:[l.jsx("span",{children:T0(i)}),l.jsx("span",{className:v>0?"positive":"negative",children:si(v)})]}),l.jsxs("div",{className:"popover-stats",children:[l.jsxs("div",{className:"popover-stat",children:[l.jsx("span",{className:"label",children:"Trades:"}),l.jsx("span",{className:"value",children:e.trades})]}),l.jsxs("div",{className:"popover-stat",children:[l.jsx("span",{className:"label",children:"Wins:"}),l.jsx("span",{className:"value positive",children:e.wins})]}),l.jsxs("div",{className:"popover-stat",children:[l.jsx("span",{className:"label",children:"Losses:"}),l.jsx("span",{className:"value negative",children:e.losses})]})]}),l.jsx("div",{className:"popover-hint",children:"Click to view trades"})]})]})},lN=({year:i,month:e,dailyData:s,onDayClick:a})=>{const c=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],h=D.useMemo(()=>{const g=Object.values(s).map(p=>Math.abs(p.netPct||0));return g.length>0?Math.max(...g):1},[s]),d=D.useMemo(()=>{const g=[],p=Zj(i,e),v=eN(i,e);for(let x=0;x<v;x++)g.push({date:null,key:`empty-${x}`});for(let x=1;x<=p;x++){const y=new Date(i,e,x),b=y.toISOString().split("T")[0];g.push({date:y,key:b,data:s[b]||null})}return g},[i,e,s]);return l.jsxs("div",{className:"calendar-grid",children:[l.jsx("div",{className:"calendar-weekdays",children:c.map(g=>l.jsx("div",{className:"weekday-header",children:g},g))}),l.jsx("div",{className:"calendar-days",children:d.map(({date:g,key:p,data:v})=>l.jsx(aN,{date:g,dayData:v,maxAbsPct:h,onClick:a,isCurrentMonth:!0},p))})]})},rN=({dailyData:i,trades:e})=>{const s=D.useMemo(()=>{const c=Object.values(i).filter(p=>p.trades>0);if(c.length===0)return{totalTrades:0,tradingDays:0,bestDayPct:0,worstDayPct:0,avgDailyPct:0,monthlyNetPct:0};const h=c.map(p=>p.netPct||0),d=c.reduce((p,v)=>p+v.trades,0),g=h.reduce((p,v)=>p+v,0);return{totalTrades:d,tradingDays:c.length,bestDayPct:Math.max(...h),worstDayPct:Math.min(...h),avgDailyPct:g/c.length,monthlyNetPct:g}},[i]);return l.jsxs("div",{className:"month-summary",children:[l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Total Trades"}),l.jsx("span",{className:"stat-value",children:s.totalTrades})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Trading Days"}),l.jsx("span",{className:"stat-value",children:s.tradingDays})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Best Day"}),l.jsx("span",{className:"stat-value positive",children:si(s.bestDayPct)})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Worst Day"}),l.jsx("span",{className:"stat-value negative",children:si(s.worstDayPct)})]}),l.jsxs("div",{className:"summary-stat",children:[l.jsx("span",{className:"stat-label",children:"Avg Daily"}),l.jsx("span",{className:`stat-value ${s.avgDailyPct>0?"positive":s.avgDailyPct<0?"negative":""}`,children:si(s.avgDailyPct)})]}),l.jsxs("div",{className:"summary-stat highlight",children:[l.jsx("span",{className:"stat-label",children:"Monthly Net"}),l.jsx("span",{className:`stat-value ${s.monthlyNetPct>0?"positive":s.monthlyNetPct<0?"negative":""}`,children:si(s.monthlyNetPct)})]})]})},oN=({date:i,dayData:e,trades:s,strategies:a,onClose:c,onSelectTrade:h})=>{if(!i||!e)return null;const d=i.toISOString().split("T")[0],g=s.filter(v=>v.close_ts?v.close_ts.startsWith(d):!1),p=v=>{v.target===v.currentTarget&&c()};return l.jsx("div",{className:"trade-modal-overlay",onClick:p,children:l.jsxs("div",{className:"trade-modal day-detail-modal",children:[l.jsxs("div",{className:"modal-header",children:[l.jsxs("div",{className:"modal-title",children:[l.jsx("span",{className:"date-title",children:T0(i)}),l.jsx("span",{className:`day-result ${e.netPct>0?"positive":"negative"}`,children:si(e.netPct)})]}),l.jsx("button",{className:"modal-close",onClick:c,children:""})]}),l.jsxs("div",{className:"modal-body",children:[l.jsxs("div",{className:"day-modal-summary",children:[l.jsxs("div",{className:"day-stat",children:[l.jsx("span",{className:"label",children:"Trades"}),l.jsx("span",{className:"value",children:e.trades})]}),l.jsxs("div",{className:"day-stat",children:[l.jsx("span",{className:"label",children:"Wins"}),l.jsx("span",{className:"value positive",children:e.wins})]}),l.jsxs("div",{className:"day-stat",children:[l.jsx("span",{className:"label",children:"Losses"}),l.jsx("span",{className:"value negative",children:e.losses})]}),l.jsxs("div",{className:"day-stat",children:[l.jsx("span",{className:"label",children:"Win Rate"}),l.jsxs("span",{className:"value",children:[e.trades>0?(e.wins/e.trades*100).toFixed(0):0,"%"]})]})]}),l.jsxs("div",{className:"day-trades-list",children:[l.jsx("h4",{children:"Trades"}),g.length===0?l.jsx("div",{className:"no-trades",children:"No trade details available"}):l.jsx("div",{className:"trades-list",children:g.map(v=>l.jsxs("div",{className:`trade-row ${(v.net_pct||0)>0?"win":"loss"}`,onClick:()=>h(v),children:[l.jsx("span",{className:"trade-time",children:new Date(v.close_ts).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}),l.jsx("span",{className:"trade-strategy",children:a[v.strategy_id]||v.strategy_id}),l.jsx("span",{className:`side-badge ${(v.open_side||"").toLowerCase()}`,children:v.open_side}),l.jsx("span",{className:`trade-pnl ${(v.net_pct||0)>0?"positive":"negative"}`,children:si(v.net_pct)})]},v.id))})]})]}),l.jsx("div",{className:"modal-footer",children:l.jsx("button",{className:"modal-close-btn",onClick:c,children:"Close"})})]})})},cN=()=>{const i=new Date,[e,s]=D.useState(i.getFullYear()),[a,c]=D.useState(i.getMonth()),[h,d]=D.useState([]),[g,p]=D.useState({}),[v,x]=D.useState("ALL"),[y,b]=D.useState(!0),[S,N]=D.useState(null),[E,R]=D.useState(null),[_,F]=D.useState(null),[H,z]=D.useState(null),L=D.useCallback(async()=>{try{b(!0),N(null);const $=await nr({limit:1e3});if($&&$.length>0){const Q=$.map(q=>({id:q.id,strategy_id:q.strategy_id,open_side:q.open_side,open_price:q.open_price,open_ts:q.open_ts,close_side:q.close_side,close_price:q.close_price,close_ts:q.close_ts,gross_pct:q.gross_pct,fee_pct_total:q.fee_pct_total,net_pct:q.net_pct,meta:q.meta}));d(Q),console.log(`[TradeCalendar] Loaded ${Q.length} trades from backend`)}else{const Q=Wo();d(Q.trades||[]),console.log(`[TradeCalendar] Loaded ${Q.trades?.length||0} trades from localStorage`)}}catch($){console.error("Error loading trades:",$);const Q=Wo();d(Q.trades||[])}finally{b(!1)}},[]),C=D.useCallback(async()=>{try{const $=localStorage.getItem("flowgrid_workflow_v1::saves");if($){const Q=JSON.parse($),q={};Object.keys(Q).forEach(ge=>{q[ge]=ge}),p(q)}}catch($){console.error("Error loading strategies:",$)}},[]);D.useEffect(()=>{L(),C()},[L,C]),D.useEffect(()=>{const $=()=>L();return window.addEventListener("flowgrid:trade-completed",$),()=>window.removeEventListener("flowgrid:trade-completed",$)},[L]);const j=D.useMemo(()=>v==="ALL"?h:h.filter($=>$.strategy_id===v),[h,v]),K=D.useMemo(()=>{const $={};return j.forEach(Q=>{if(!Q.close_ts)return;const q=Q.close_ts.split("T")[0];$[q]||($[q]={trades:0,wins:0,losses:0,netPct:0}),$[q].trades++,$[q].netPct+=Q.net_pct||0,(Q.net_pct||0)>0?$[q].wins++:$[q].losses++}),$},[j]),I=()=>{a===0?(s(e-1),c(11)):c(a-1)},U=()=>{a===11?(s(e+1),c(0)):c(a+1)},Y=($,Q)=>{R($),F(Q)};return y?l.jsxs("div",{className:"trade-calendar-loading",children:[l.jsx("div",{className:"loading-spinner"}),l.jsx("div",{children:"Loading calendar..."})]}):S?l.jsxs("div",{className:"trade-calendar-error",children:[l.jsx("div",{className:"error-icon icon-alert"}),l.jsx("div",{children:S}),l.jsx("button",{onClick:L,children:"Retry"})]}):l.jsxs("div",{className:"trade-calendar",children:[l.jsx(iN,{year:e,month:a,onPrevMonth:I,onNextMonth:U,strategies:g,selectedStrategy:v,onStrategyChange:x}),l.jsx(lN,{year:e,month:a,dailyData:K,onDayClick:Y}),l.jsx(rN,{dailyData:K,trades:j}),E&&_&&l.jsx(oN,{date:E,dayData:_,trades:j,strategies:g,onClose:()=>{R(null),F(null)},onSelectTrade:$=>{R(null),F(null),z($)}}),H&&l.jsx(N0,{trade:H,strategyName:g[H.strategy_id]||H.strategy_id,onClose:()=>z(null)})]})},iy="flowgrid_enabled_strategies",ay="flowgrid_analytics_chart_mode",ly=5,Lt=(i,e=!1)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}$${Math.abs(i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Il=(i,e=!1)=>i==null||isNaN(i)?"--":`${e&&i>0?"+":""}${i.toFixed(2)}%`,md=(i,e=2)=>i==null||isNaN(i)?"--":i.toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}),k0=i=>{if(!i)return"";const e=new Date(i),a=Math.floor((new Date-e)/1e3);return a<60?"Just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`},qs={netPnl:"Net Profit/Loss = Gross P&L - Fees - Commissions - Slippage",winRate:"Win Rate = (Winning Trades / Total Trades)  100%",profitFactor:"Profit Factor = Gross Profits / Gross Losses (>1 is profitable)",expectancy:"Expectancy = (Win Rate  Avg Win) - (Loss Rate  Avg Loss)",maxDrawdown:"Maximum Drawdown = Largest peak-to-trough decline in equity",totalTrades:"Total completed trades (entry + exit)",avgWin:"Average profit on winning trades",avgLoss:"Average loss on losing trades"},Ns=({label:i,value:e,subValue:s,tooltip:a,isPositive:c,isNegative:h,isEmpty:d,emptyMessage:g="No data",loading:p=!1})=>{if(p)return l.jsx("div",{className:"metric-card skeleton skeleton-metric"});const v=d||e==="--"||e===void 0;return l.jsxs("div",{className:`metric-card ${v?"empty-state":""}`,children:[l.jsxs("div",{className:"metric-label",children:[i,a&&l.jsxs("span",{className:"metric-info-icon tooltip-trigger",children:["",l.jsx("span",{className:"tooltip-content",children:a})]})]}),l.jsx("div",{className:`metric-value ${c?"positive":""} ${h?"negative":""} ${v?"dimmed":""}`,children:v?g:e}),s&&!v&&l.jsx("div",{className:`metric-subvalue ${c?"positive":""} ${h?"negative":""}`,children:s}),v&&l.jsx("div",{className:"metric-empty-hint",children:"Enable strategies to see data"})]})},uN=({gradeData:i,onShowBreakdown:e,loading:s})=>{if(s)return l.jsx("div",{className:"flow-grade-card skeleton skeleton-chart",style:{height:"280px"}});if(!i||i.empty)return l.jsx("div",{className:"flow-grade-card",children:l.jsxs("div",{className:"empty-state-container",style:{padding:"24px"},children:[l.jsx("div",{className:"empty-state-icon icon-chart"}),l.jsx("div",{className:"empty-state-title",children:"Flow Grade"}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"Complete trades to see your performance grade"})]})});const{score:a,letter:c,reasons:h}=i,d=2*Math.PI*45,g=a/100*d,p=`grade-${(c||"c").toLowerCase()}`;return l.jsxs("div",{className:"flow-grade-card",children:[l.jsxs("div",{className:"flow-grade-score",children:[l.jsxs("svg",{className:"flow-grade-ring",viewBox:"0 0 100 100",children:[l.jsx("circle",{className:"flow-grade-ring-bg",cx:"50",cy:"50",r:"45"}),l.jsx("circle",{className:`flow-grade-ring-progress ${p}`,cx:"50",cy:"50",r:"45",strokeDasharray:d,strokeDashoffset:d-g})]}),l.jsxs("div",{className:"flow-grade-inner",children:[l.jsx("div",{className:`flow-grade-letter ${p}`,children:c}),l.jsx("div",{className:"flow-grade-number",children:a.toFixed(0)})]})]}),l.jsx("div",{className:"flow-grade-title",children:"Flow Grade"}),l.jsx("div",{className:"flow-grade-reasons",children:h?.slice(0,3).map((v,x)=>l.jsx("div",{className:"flow-grade-reason",children:v},x))}),l.jsx("button",{className:"flow-grade-breakdown-btn",onClick:e,children:"View Breakdown"})]})},hN=({gradeData:i,onClose:e})=>{if(!i)return null;const{components:s,suggestions:a}=i,c=h=>h>=70?"high":h>=40?"medium":"low";return l.jsx("div",{className:"modal-overlay",onClick:e,children:l.jsxs("div",{className:"modal-content",onClick:h=>h.stopPropagation(),children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("div",{className:"modal-title",children:"Flow Grade Breakdown"}),l.jsx("button",{className:"modal-close",onClick:e,children:""})]}),l.jsx("div",{className:"grade-component-list",children:s&&Object.entries(s).map(([h,d])=>h==="concentration_penalty"?null:l.jsxs("div",{className:"grade-component",children:[l.jsx("div",{className:"grade-component-label",children:h.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase())}),l.jsx("div",{className:"grade-component-value",children:typeof d.value=="number"?h.includes("pct")||h.includes("rate")?Il(d.value):md(d.value):d.value}),l.jsx("div",{className:"grade-component-bar",children:l.jsx("div",{className:`grade-component-fill ${c(d.score)}`,style:{width:`${d.score}%`}})})]},h))}),a?.length>0&&l.jsxs("div",{className:"grade-suggestions",children:[l.jsx("div",{className:"grade-suggestions-title",children:"Improvement Suggestions"}),a.map((h,d)=>l.jsx("div",{className:"grade-suggestion",children:h},d))]})]})})},dN=({data:i,loading:e,chartMode:s,onModeChange:a})=>{const c=D.useRef(null),[h,d]=D.useState(null),g=i&&i.curve&&i.curve.length>=1;return D.useEffect(()=>{if(!c.current||!g)return;const p=c.current,v=p.getContext("2d"),x=p.getBoundingClientRect(),y=window.devicePixelRatio||1;p.width=x.width*y,p.height=x.height*y,v.scale(y,y);const b=x.width,S=x.height,N={top:20,right:20,bottom:30,left:60},E=b-N.left-N.right,R=S-N.top-N.bottom,_=100;let H=[{t:(i.curve.length>0?i.curve[0].t:Date.now())-1,v:_,drawdown:0},...i.curve];const z=H.map(I=>I.v),L=Math.min(...z,_)*.98,C=Math.max(...z,_)*1.02,j=C-L||1;v.clearRect(0,0,b,S),v.strokeStyle="rgba(255, 255, 255, 0.05)",v.lineWidth=1;for(let I=0;I<=4;I++){const U=N.top+R/4*I;v.beginPath(),v.moveTo(N.left,U),v.lineTo(b-N.right,U),v.stroke()}v.fillStyle="rgba(255, 255, 255, 0.5)",v.font="10px Inter, system-ui",v.textAlign="right";for(let I=0;I<=4;I++){const U=C-j/4*I,Y=N.top+R/4*I;v.fillText(`$${(U/1e3).toFixed(0)}k`,N.left-8,Y+3)}v.beginPath();const K=H.length;if(H.forEach((I,U)=>{const Y=N.left+U/(K-1)*E,$=N.top+R-(I.v-L)/j*R;U===0?v.moveTo(Y,$):v.lineTo(Y,$)}),s==="area"){v.lineTo(N.left+E,N.top+R),v.lineTo(N.left,N.top+R),v.closePath();const I=v.createLinearGradient(0,N.top,0,N.top+R);z[z.length-1]>=z[0]?(I.addColorStop(0,"rgba(59, 130, 246, 0.3)"),I.addColorStop(1,"rgba(59, 130, 246, 0.0)")):(I.addColorStop(0,"rgba(239, 68, 68, 0.3)"),I.addColorStop(1,"rgba(239, 68, 68, 0.0)")),v.fillStyle=I,v.fill(),v.beginPath(),H.forEach((Y,$)=>{const Q=N.left+$/(H.length-1)*E,q=N.top+R-(Y.v-L)/j*R;$===0?v.moveTo(Q,q):v.lineTo(Q,q)})}if(z[z.length-1]>=z[0],v.strokeStyle="#3b82f6",v.lineWidth=2,v.stroke(),s==="area"&&H.some(I=>I.drawdown>0)){v.fillStyle="rgba(239, 68, 68, 0.15)";let I=z[0];H.forEach((U,Y)=>{if(U.v>I&&(I=U.v),(I-U.v)/I>.01){const Q=N.left+Y/(H.length-1)*E,q=N.top+R-(I-L)/j*R,ge=N.top+R-(U.v-L)/j*R;v.fillRect(Q-1,q,2,ge-q)}})}},[i,g,s]),e?l.jsx("div",{className:"chart-panel skeleton skeleton-chart"}):l.jsxs("div",{className:"chart-panel",children:[l.jsxs("div",{className:"chart-panel-header",children:[l.jsx("div",{className:"chart-panel-title",children:"Equity Curve"}),l.jsxs("div",{className:"chart-panel-controls",children:[l.jsx("button",{className:`chart-mode-btn ${s==="line"?"active":""}`,onClick:()=>a("line"),children:"Line"}),l.jsx("button",{className:`chart-mode-btn ${s==="area"?"active":""}`,onClick:()=>a("area"),children:"Area"})]})]}),g?l.jsx("div",{className:"chart-canvas-container",children:l.jsx("canvas",{ref:c})}):l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-trending-up"}),l.jsx("div",{className:"empty-state-title",children:"No Equity Data"}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"Execute trades to see your equity curve progression"})]})]})},fN=({activity:i,loading:e})=>{if(e)return l.jsx("div",{className:"activity-panel skeleton skeleton-chart"});const s=!i||i.length===0;return l.jsxs("div",{className:"activity-panel",children:[l.jsxs("div",{className:"activity-panel-header",children:[l.jsx("div",{className:"activity-panel-title",children:"Recent Activity"}),l.jsxs("div",{className:"activity-live-badge",children:[l.jsx("div",{className:"activity-live-dot"}),"Live"]})]}),s?l.jsxs("div",{className:"empty-state-container",style:{padding:"24px"},children:[l.jsx("div",{className:"empty-state-icon icon-activity"}),l.jsx("div",{className:"empty-state-message",children:"Signals and trades will appear here in real-time"})]}):l.jsx("div",{className:"activity-list",children:i.map((a,c)=>l.jsxs("div",{className:"activity-item",children:[l.jsx("div",{className:"activity-icon",children:a.icon||""}),l.jsxs("div",{className:"activity-details",children:[l.jsxs("div",{className:"activity-title",children:[a.type==="entry"?"Opened":"Closed"," ",a.symbol," (",a.strategy_name,")"]}),l.jsxs("div",{className:"activity-subtitle",children:[a.direction," @ $",a.price?.toFixed(2)]})]}),a.pnl!==void 0&&a.pnl!==null&&l.jsx("div",{className:`activity-pnl ${a.pnl>=0?"positive":"negative"}`,children:Lt(a.pnl,!0)}),l.jsx("div",{className:"activity-time",children:k0(a.timestamp)})]},a.id||c))})]})},mN=({strategies:i,enabledStrategies:e,onToggle:s,loading:a,recomputing:c})=>{const h=Object.values(e).filter(Boolean).length,d=h<ly;return a?l.jsx("div",{className:"strategy-control-panel skeleton skeleton-chart"}):l.jsxs("div",{className:"strategy-control-panel",children:[l.jsxs("div",{className:"strategy-control-header",children:[l.jsx("div",{className:"strategy-control-title",children:"Strategies"}),l.jsxs("div",{className:"strategy-limit-badge",children:[h,"/",ly," Active"]})]}),Object.keys(i).length===0?l.jsx("div",{className:"empty-state-container",style:{padding:"16px"},children:l.jsx("div",{className:"empty-state-message",children:"No saved strategies. Create one in the Workflow Builder."})}):l.jsx("div",{className:"strategy-list",children:Object.entries(i).map(([g,p])=>{const v=e[g],x=v||d;return l.jsxs("div",{className:`strategy-item ${v?"enabled":""} ${c?"loading":""}`,children:[l.jsx("div",{className:`strategy-toggle ${v?"enabled":""} ${x?"":"disabled"}`,onClick:()=>x&&s(g,!v)}),l.jsxs("div",{className:"strategy-info",children:[l.jsx("div",{className:"strategy-name",children:g}),l.jsxs("div",{className:"strategy-meta",children:[p.symbol||"SPY","  ",p.timeframe||"1Hour"]})]}),l.jsx("div",{className:`strategy-status ${v?"running":"stopped"}`,children:v?" Running":"Stopped"})]},g)})})]})},pN=({data:i,loading:e})=>{if(e)return l.jsx("div",{className:"chart-panel skeleton skeleton-chart"});if(!i||i.empty)return l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"P&L by Time"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-calendar"}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"Trade data needed for time analysis"})]})]});const{matrix:s,x_labels:a,y_labels:c,range:h}=i,d=Math.max(Math.abs(h.min),Math.abs(h.max))||1,g=p=>{const v=Math.min(Math.abs(p)/d,1);return p>0?`rgba(59, 130, 246, ${.2+v*.6})`:p<0?`rgba(239, 68, 68, ${.2+v*.6})`:"rgba(255, 255, 255, 0.05)"};return l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"P&L by Time"})}),l.jsxs("div",{className:"heatmap-container",children:[l.jsx("div",{style:{display:"flex",marginBottom:"4px",marginLeft:"40px"},children:a.map((p,v)=>l.jsx("div",{className:"heatmap-label",style:{flex:1},children:p},v))}),s.map((p,v)=>l.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2px"},children:[l.jsx("div",{className:"heatmap-row-label",style:{width:"40px"},children:c[v]}),p.map((x,y)=>l.jsx("div",{className:"heatmap-cell",style:{flex:1,height:"28px",background:g(x)},title:`${c[v]} ${a[y]}: ${Lt(x)}`,children:Math.abs(x)>100&&Lt(x).replace("$","")},y))]},v))]})]})},gN=({data:i,title:e,loading:s})=>{if(s)return l.jsx("div",{className:"chart-panel skeleton skeleton-chart"});if(!i||i.empty)return l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:e})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-chart"}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"More trades needed for distribution analysis"})]})]});const{histogram:a,stats:c}=i,h=Math.max(...a.map(d=>d.count));return l.jsxs("div",{className:"chart-panel",children:[l.jsxs("div",{className:"chart-panel-header",children:[l.jsx("div",{className:"chart-panel-title",children:e}),l.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["=",Lt(c.mean)," | =",Lt(c.std)]})]}),l.jsx("div",{className:"histogram-container",children:a.map((d,g)=>{const p=h>0?d.count/h*100:0,x=(d.bin_start+d.bin_end)/2>=0;return l.jsx("div",{className:`histogram-bar ${x?"positive":"negative"}`,style:{height:`${Math.max(p,2)}%`},children:l.jsxs("div",{className:"histogram-tooltip",children:[Lt(d.bin_start)," to ",Lt(d.bin_end),": ",d.count," trades"]})},g)})})]})},vN=({data:i,loading:e})=>{if(e)return l.jsx("div",{className:"chart-panel skeleton skeleton-chart"});if(!i||i.empty)return l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Strategy Attribution"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-target"}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"Trade data from multiple strategies needed"})]})]});const{contributions:s,total_pnl:a}=i,c=Math.max(...s.map(h=>Math.abs(h.pnl)));return l.jsxs("div",{className:"chart-panel",children:[l.jsxs("div",{className:"chart-panel-header",children:[l.jsx("div",{className:"chart-panel-title",children:"Strategy Attribution"}),l.jsxs("div",{style:{fontSize:"12px",fontWeight:600,color:a>=0?"var(--positive)":"var(--negative)"},children:["Total: ",Lt(a)]})]}),l.jsx("div",{className:"waterfall-container",children:l.jsx("div",{className:"waterfall-bar-container",children:s.map((h,d)=>{const g=c>0?Math.abs(h.pnl)/c*100:0;return l.jsxs("div",{className:"waterfall-bar-wrapper",children:[l.jsx("div",{className:`waterfall-bar ${h.pnl>=0?"positive":"negative"}`,style:{height:`${Math.max(g,5)}%`},children:l.jsx("div",{className:"waterfall-value",children:Lt(h.pnl)})}),l.jsx("div",{className:"waterfall-label",children:h.strategy_name})]},d)})})})]})},yN=({data:i,loading:e,isPremium:s})=>{if(e)return l.jsx("div",{className:"chart-panel skeleton skeleton-chart"});const a=!s&&i&&!i.empty;return l.jsxs("div",{className:"chart-panel",style:{position:"relative"},children:[l.jsxs("div",{className:"chart-panel-header",children:[l.jsx("div",{className:"chart-panel-title",children:"Monte Carlo Simulation"}),i&&!i.empty&&l.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[i.simulations," simulations"]})]}),!i||i.empty?l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon",children:""}),l.jsx("div",{className:"empty-state-message",children:i?.guidance||"Need at least 10 trades for Monte Carlo analysis"})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{padding:"16px",opacity:a?.3:1},children:[l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"16px"},children:[l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"10px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Prob. Profit"}),l.jsxs("div",{style:{fontSize:"18px",fontWeight:600,color:"var(--positive)"},children:[i.prob_profit,"%"]})]}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"10px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Median Outcome"}),l.jsx("div",{style:{fontSize:"18px",fontWeight:600},children:Lt(i.percentiles?.["50th"])})]}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:"10px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Risk of -10%"}),l.jsxs("div",{style:{fontSize:"18px",fontWeight:600,color:"var(--negative)"},children:[i.prob_loss_10pct,"%"]})]})]}),l.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[l.jsxs("div",{children:["5th Percentile (Worst): ",Lt(i.percentiles?.["5th"])]}),l.jsxs("div",{children:["95th Percentile (Best): ",Lt(i.percentiles?.["95th"])]})]})]}),a&&l.jsxs("div",{className:"premium-overlay",children:[l.jsx("div",{className:"premium-lock-icon icon-lock"}),l.jsx("div",{className:"premium-title",children:"Premium Feature"}),l.jsx("div",{className:"premium-description",children:"Unlock full Monte Carlo analysis with path visualization and advanced probability metrics"}),l.jsx("button",{className:"premium-upgrade-btn",children:"Upgrade for $99/mo"})]})]})]})},bN=({visible:i,status:e})=>i?l.jsx("div",{className:`recompute-toast ${e==="complete"?"complete":""}`,children:e==="processing"?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"recompute-spinner"}),l.jsx("div",{className:"recompute-text",children:"Recomputing metrics..."})]}):l.jsx("div",{className:"recompute-text",children:" Metrics updated"})}):null,xN=({onNavigate:i})=>{const[e,s]=D.useState("overview"),[a,c]=D.useState(!0),[h,d]=D.useState(null),[g,p]=D.useState(!1),[v,x]=D.useState(null),[y,b]=D.useState(null),[S,N]=D.useState([]),[E,R]=D.useState(null),[_,F]=D.useState(null),[H,z]=D.useState(null),[L,C]=D.useState(null),[j,K]=D.useState({}),[I,U]=D.useState({}),[Y,$]=D.useState(()=>localStorage.getItem(ay)||"area"),[Q,q]=D.useState(!1),[ge,O]=D.useState(!1),[A,W]=D.useState(null),[ce]=D.useState(!1);D.useRef(null),D.useEffect(()=>{try{const te=localStorage.getItem(iy);te&&U(JSON.parse(te))}catch(te){console.error("Error loading enabled strategies:",te)}},[]),D.useEffect(()=>{localStorage.setItem(ay,Y)},[Y]);const se=D.useRef(!1),M=D.useCallback(async(te=!1)=>{c(!0),d(null);try{let de="localStorage",oe,ue,ee,Z,ye,we,Re,Be,Le=Cs();try{const[ke,me,Se,Ae,Ye]=await Promise.all([u0(),h0(),d0(),mj(),nr({limit:100})]);if(ke&&!ke.empty){de="backend",console.log("[Analytics] Using backend API data");const Me=ke.metrics||{};oe={net_pnl:Me.net_return_pct||0,net_pnl_percent:Me.net_return_pct||0,win_rate:Me.win_rate||0,profit_factor:typeof Me.profit_factor=="string"?1/0:Me.profit_factor||0,expectancy:Me.expectancy||0,max_drawdown_pct:Me.max_drawdown_pct||0,max_drawdown_value:Me.max_drawdown_pct||0,total_trades:Me.trade_count||0,wins:Me.wins||0,losses:Me.losses||0,avg_win:Me.avg_win_pct||0,avg_loss:Me.avg_loss_pct||0,largest_win:Me.largest_win_pct||0,largest_loss:Me.largest_loss_pct||0},ue=(me||[]).map(Ce=>({t:new Date(Ce.ts).getTime(),v:100+(Ce.equity_pct||0),drawdown:Ce.drawdown_pct||0})),ee=(me||[]).map(Ce=>({t:new Date(Ce.ts).getTime(),v:Ce.equity_pct||0})),Z=Se?.by_day||[],ye=Se?.by_hour||[],we=Object.entries(ke.by_strategy||{}).map(([Ce,tt])=>({name:Ce,total_pnl:tt.net_return_pct||0,trade_count:tt.trade_count||0,wins:tt.wins||0,losses:tt.losses||0})),Re={bins:(Ae?.histogram||[]).map(Ce=>`${Ce.bin_start} to ${Ce.bin_end}`),counts:(Ae?.histogram||[]).map(Ce=>Ce.count)},Be=(Ye||[]).slice(0,15),Le=Ye||Le}}catch(ke){console.warn("[Analytics] Backend fetch failed, using localStorage:",ke.message)}if(de==="localStorage"){oe=Id(),ue=gj(),ee=vj();const ke=f0();Z=ke.byDay,ye=ke.byHour,we=m0(),Re=yj(),Be=p0(15)}console.log(`[Analytics] Loaded ${Le.length||oe.total_trades||0} trades from ${de}`),x({empty:(Le.length||oe.total_trades||0)===0,is_preview:!1,source:de,kpis:{net_pnl_usd:oe.net_pnl,net_pnl_pct:oe.net_pnl_percent,win_rate:oe.win_rate,profit_factor:oe.profit_factor,expectancy:oe.expectancy,max_drawdown_pct:oe.max_drawdown_pct,max_drawdown_usd:oe.max_drawdown_value,total_trades:oe.total_trades,wins:oe.wins,losses:oe.losses,avg_win:oe.avg_win,avg_loss:oe.avg_loss,largest_win:oe.largest_win,largest_loss:oe.largest_loss},flow_grade:(Le.length||oe.total_trades||0)>0?{score:Math.round((oe.win_rate||0)*.9),letter:(oe.win_rate||0)>=80?"A":(oe.win_rate||0)>=60?"B":(oe.win_rate||0)>=40?"C":(oe.win_rate||0)>=20?"D":"F",reasons:[`Win rate: ${(oe.win_rate||0).toFixed(1)}%`,`Profit factor: ${oe.profit_factor===1/0?"":(oe.profit_factor||0).toFixed(2)}`,(oe.max_drawdown_pct||0)<10?"Low drawdown":"Monitor drawdown"],breakdown:{consistency:Math.min(95,Math.max(0,50+(oe.profit_factor===1/0?10:oe.profit_factor||0)*10)),risk_mgmt:Math.max(0,100-(oe.max_drawdown_pct||0)*2),win_quality:oe.win_rate||0,trade_efficiency:(oe.profit_factor||0)>1?70+((oe.profit_factor===1/0?5:oe.profit_factor||0)-1)*20:50}}:null}),b({curve:ue,cumulative_pnl:ee});const Ie=Z.map(ke=>ke.label),ut=ye.map(ke=>ke.label),Yt=[Z.map(ke=>ke.pnl)],Ot=[...Z.map(ke=>ke.pnl),...ye.map(ke=>ke.pnl)],jt={min:Math.min(...Ot,0),max:Math.max(...Ot,0)};R({matrix:Yt,x_labels:Ie,y_labels:["P&L"],range:jt,by_day:Z,by_hour:ye}),N(Be.map(ke=>({type:"trade",timestamp:ke.exitTime||ke.close_ts,strategy:ke.strategyName||ke.strategy_id,symbol:ke.symbol,pnl:ke.netPnL||ke.net_pct,direction:ke.direction||ke.open_side})));const lt=Le.map(ke=>ke.net_pct??ke.netPnL??0),Ms=[];Re.bins&&Re.bins.length>0&&Re.bins.forEach((ke,me)=>{const Se=ke.split(" to ");Ms.push({bin_start:parseFloat(Se[0])||0,bin_end:parseFloat(Se[1])||0,count:Re.counts[me]||0})});const Xs=lt.length>0?lt.reduce((ke,me)=>ke+me,0)/lt.length:0,It=lt.length>0?lt.reduce((ke,me)=>ke+Math.pow(me-Xs,2),0)/lt.length:0,En=Math.sqrt(It);F({histogram:Ms,stats:{mean:Xs,std:En},empty:Le.length===0});const yt=we.reduce((ke,me)=>ke+(me.total_pnl||0),0);z({contributions:we.map(ke=>({strategy_name:ke.name,pnl:ke.total_pnl||0,trades:ke.trade_count||0,win_rate:ke.trade_count>0?((ke.wins||0)/ke.trade_count*100).toFixed(1):"0",contribution_pct:yt!==0?((ke.total_pnl||0)/Math.abs(yt)*100).toFixed(1):"0"})),total_pnl:yt,empty:we.length===0});const Js=localStorage.getItem("flowgrid_workflow_v1::saves");if(Js){const ke=JSON.parse(Js),me={};Object.keys(ke).forEach(Se=>{const Ae=we.find(Ye=>Ye.name===Se);me[Se]={name:Se,enabled:ke[Se].enabled||!1,net_pnl:Ae?.total_pnl||0,win_rate:Ae?Ae.wins/(Ae.trade_count||1)*100:0,trade_count:Ae?.trade_count||0}}),K(me)}p(!1),se.current=!0}catch(de){console.error("Error loading analytics data:",de),d("Failed to load analytics data from localStorage.")}finally{c(!1)}},[e]);D.useEffect(()=>{M()},[M]),D.useEffect(()=>{const te=()=>{console.log("[Analytics] Trade completed event - refreshing data"),M(!0)},de=()=>{console.log("[Analytics] Trades updated event - refreshing data"),M(!0)};return window.addEventListener("flowgrid:trade-completed",te),window.addEventListener("flowgrid:trades-updated",de),()=>{window.removeEventListener("flowgrid:trade-completed",te),window.removeEventListener("flowgrid:trades-updated",de)}},[M]);const T=D.useCallback(async(te,de)=>{const oe={...I,[te]:de};U(oe),localStorage.setItem(iy,JSON.stringify(oe)),O(!0),W("processing");try{await M(!0),W("complete"),setTimeout(()=>{O(!1),W(null)},1e3)}catch(ue){console.error("Error toggling strategy:",ue),O(!1),W(null)}},[I,M]),P=[{id:"overview",label:"Overview"},{id:"trade-logging",label:"Trade Logging"},{id:"trade-calendar",label:"Trade Calendar"},{id:"trade-analytics",label:"Trade Analytics"},{id:"attribution",label:"Strategy Attribution"},{id:"risk",label:"Risk & Drawdown"},{id:"time-analysis",label:"Time Analysis"}],B=()=>{switch(e){case"overview":return l.jsxs("div",{className:"analytics-overview-grid",children:[l.jsxs("div",{className:"overview-kpis",children:[l.jsx(Ns,{label:"Net P&L",value:Lt(v?.kpis?.net_pnl_usd),subValue:Il(v?.kpis?.net_pnl_pct,!0),tooltip:qs.netPnl,isPositive:v?.kpis?.net_pnl_usd>0,isNegative:v?.kpis?.net_pnl_usd<0,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Win Rate",value:Il(v?.kpis?.win_rate),subValue:`${v?.kpis?.wins||0}W / ${v?.kpis?.losses||0}L`,tooltip:qs.winRate,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Profit Factor",value:md(v?.kpis?.profit_factor),tooltip:qs.profitFactor,isPositive:v?.kpis?.profit_factor>1.5,isNegative:v?.kpis?.profit_factor<1,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Expectancy",value:Lt(v?.kpis?.expectancy),tooltip:qs.expectancy,isPositive:v?.kpis?.expectancy>0,isNegative:v?.kpis?.expectancy<0,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Max Drawdown",value:Il(v?.kpis?.max_drawdown_pct),subValue:Lt(v?.kpis?.max_drawdown_usd),tooltip:qs.maxDrawdown,isNegative:v?.kpis?.max_drawdown_pct>10,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Total Trades",value:v?.kpis?.total_trades||"--",tooltip:qs.totalTrades,isEmpty:v?.empty,loading:a}),l.jsx(Ns,{label:"Avg Win/Loss",value:`${Lt(v?.kpis?.avg_win)} / ${Lt(v?.kpis?.avg_loss)}`,tooltip:`${qs.avgWin} / ${qs.avgLoss}`,isEmpty:v?.empty,loading:a})]}),l.jsx("div",{className:"overview-main",children:l.jsx(dN,{data:y,loading:a,chartMode:Y,onModeChange:$})}),l.jsxs("div",{className:"overview-sidebar",children:[l.jsx(uN,{gradeData:v?.flow_grade,onShowBreakdown:()=>q(!0),loading:a}),l.jsx(fN,{activity:S,loading:a}),l.jsx(mN,{strategies:j,enabledStrategies:I,onToggle:T,loading:a,recomputing:ge})]})]});case"trade-analytics":return l.jsxs("div",{className:"trade-analytics-grid",children:[l.jsx(gN,{data:_,title:"P&L Distribution",loading:a}),l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Trade Duration"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-clock"}),l.jsx("div",{className:"empty-state-message",children:"Duration analysis coming soon"})]})]}),l.jsxs("div",{className:"chart-panel",style:{gridColumn:"1 / -1"},children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Trade Scatter Plot"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-target"}),l.jsx("div",{className:"empty-state-message",children:"Entry Price vs P&L scatter plot coming soon"})]})]})]});case"attribution":return l.jsxs("div",{className:"attribution-grid",children:[l.jsx(vN,{data:H,loading:a}),l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Strategy Metrics"})}),H?.contributions?.length>0?l.jsx("div",{style:{padding:"12px",overflowY:"auto"},children:H.contributions.map((te,de)=>l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px",background:"var(--secondary-bg)",borderRadius:"6px",marginBottom:"8px"},children:[l.jsxs("div",{children:[l.jsx("div",{style:{fontWeight:500,fontSize:"13px"},children:te.strategy_name}),l.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[te.trades," trades  ",te.win_rate,"% win rate"]})]}),l.jsxs("div",{style:{textAlign:"right"},children:[l.jsx("div",{style:{fontWeight:600,color:te.pnl>=0?"var(--positive)":"var(--negative)"},children:Lt(te.pnl)}),l.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[te.contribution_pct,"% contribution"]})]})]},de))}):l.jsx("div",{className:"empty-state-container",children:l.jsx("div",{className:"empty-state-message",children:"Strategy metrics will appear here"})})]})]});case"risk":return l.jsxs("div",{className:"risk-grid",children:[l.jsxs("div",{className:"risk-kpis",children:[l.jsx(Ns,{label:"Max Drawdown",value:Il(v?.kpis?.max_drawdown_pct),tooltip:qs.maxDrawdown,isNegative:!0,isEmpty:v?.empty}),l.jsx(Ns,{label:"Peak Equity",value:Lt(1e5+(v?.kpis?.net_pnl_usd||0)),isEmpty:v?.empty}),l.jsx(Ns,{label:"Profit Factor",value:md(v?.kpis?.profit_factor),tooltip:qs.profitFactor,isEmpty:v?.empty}),l.jsx(Ns,{label:"Largest Loss",value:Lt(v?.kpis?.avg_loss*-2),isNegative:!0,isEmpty:v?.empty}),l.jsx(Ns,{label:"Recovery Factor",value:"--",tooltip:"Net Profit / Max Drawdown",isEmpty:v?.empty})]}),l.jsx(yN,{data:L,loading:a,isPremium:ce}),l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Drawdown Timeline"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-trending-down"}),l.jsx("div",{className:"empty-state-message",children:"Drawdown visualization coming soon"})]})]})]});case"time-analysis":return l.jsxs("div",{className:"time-analysis-grid",children:[l.jsx(pN,{data:E,loading:a}),l.jsxs("div",{className:"chart-panel",children:[l.jsx("div",{className:"chart-panel-header",children:l.jsx("div",{className:"chart-panel-title",children:"Intraday Performance"})}),l.jsxs("div",{className:"empty-state-container",children:[l.jsx("div",{className:"empty-state-icon icon-chart"}),l.jsx("div",{className:"empty-state-message",children:"Intraday P&L curve coming soon"})]})]})]});case"trade-logging":return l.jsx("div",{className:"trade-logging-tab",children:l.jsx(Jj,{})});case"trade-calendar":return l.jsx("div",{className:"trade-calendar-tab",children:l.jsx(cN,{})});default:return null}};return l.jsxs("div",{className:"dashboard-page",children:[l.jsx(Zl,{onNavigate:i,activeRoute:"analytics"}),l.jsxs("main",{className:"dashboard-main",children:[l.jsxs("div",{className:"dashboard-header",children:[l.jsxs("div",{className:"header-left",children:[l.jsx("h1",{children:"Analytics"}),v?.computed_at&&l.jsxs("span",{className:"last-update",children:["Updated ",k0(v.computed_at)]})]}),l.jsxs("div",{className:"header-right",children:[Object.values(I).filter(Boolean).length>0&&l.jsxs("div",{className:"running-badge",children:[" ",Object.values(I).filter(Boolean).length," Running"]}),l.jsx("button",{className:"refresh-btn",onClick:M,disabled:a,children:"Refresh"})]})]}),h&&l.jsx("div",{className:"error-banner",children:h}),g&&l.jsxs("div",{className:"preview-banner",children:[l.jsx("span",{className:"preview-icon",children:""}),l.jsx("span",{children:"Showing preview data from backtest results. Metrics will update when live trades are recorded."})]}),l.jsx("div",{className:"analytics-tabs",children:P.map(te=>l.jsx("button",{className:`analytics-tab ${e===te.id?"active":""} ${te.premium?"premium":""}`,onClick:()=>s(te.id),children:te.label},te.id))}),l.jsx("div",{className:"analytics-content",children:B()})]}),Q&&l.jsx(hN,{gradeData:v?.flow_grade,onClose:()=>q(!1)}),l.jsx(bN,{visible:ge,status:A})]})},Yh="alpaca_key_id",Kh="alpaca_secret_key",Xh="telegram_bot_token",Jh="telegram_chat_id",wN=({noWrapper:i=!1})=>{const[e,s]=D.useState(""),[a,c]=D.useState(""),[h,d]=D.useState(!1),[g,p]=D.useState(""),[v,x]=D.useState(""),[y,b]=D.useState(!1);D.useEffect(()=>{try{const q=localStorage.getItem(Yh)||"",ge=localStorage.getItem(Kh)||"";s(q),c(ge);const O=localStorage.getItem(Xh)||"",A=localStorage.getItem(Jh)||"";p(O),x(A)}catch{}},[]);const S=()=>{try{localStorage.setItem(Yh,e.trim()),localStorage.setItem(Kh,a.trim()),d(!0),setTimeout(()=>d(!1),1500)}catch(q){console.warn(q)}},N=()=>{try{localStorage.removeItem(Yh),localStorage.removeItem(Kh),s(""),c(""),d(!0),setTimeout(()=>d(!1),1200)}catch{}},[E,R]=D.useState(!1),[_,F]=D.useState(null),H=async()=>{R(!0),F(null);try{const q=await fetch("/test_alpaca_keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({alpacaKeyId:e.trim(),alpacaSecretKey:a.trim()})}),ge=await q.json().catch(()=>null);q.ok&&ge&&ge.ok?F({ok:!0,msg:`Validated: ${ge.message||"OK"}`}):F({ok:!1,msg:ge&&ge.error||`HTTP ${q.status}`})}catch(q){F({ok:!1,msg:String(q)})}R(!1)},[z,L]=D.useState(!1),[C,j]=D.useState(null),K=async()=>{try{localStorage.setItem(Xh,g.trim()),localStorage.setItem(Jh,v.trim());const q=await fetch("/api/telegram/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:g.trim(),chat_id:v.trim()})});if(q.ok)b(!0),setTimeout(()=>b(!1),1500);else{const ge=await q.json().catch(()=>({}));alert(`Failed to save Telegram settings: ${ge.error||"Unknown error"}`)}}catch(q){console.warn(q),alert(`Error saving Telegram settings: ${q.message}`)}},I=()=>{try{localStorage.removeItem(Xh),localStorage.removeItem(Jh),p(""),x(""),b(!0),setTimeout(()=>b(!1),1200)}catch{}},U=async()=>{L(!0),j(null);try{const q=await fetch("/api/telegram/test",{method:"POST",headers:{"Content-Type":"application/json"}}),ge=await q.json().catch(()=>null);q.ok&&ge&&ge.success?j({ok:!0,msg:` ${ge.message}`}):j({ok:!1,msg:ge&&ge.error||`HTTP ${q.status}`})}catch(q){j({ok:!1,msg:String(q)})}L(!1)},Y=()=>!e||!a?"No API keys set":"Alpaca keys present",$=()=>!g||!v?"No Telegram configured":"Telegram configured",Q=l.jsx("div",{className:"panel-body",children:l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[l.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:600,color:"#cfe8ff"},children:"Alpaca API Keys"}),l.jsx("label",{style:{fontSize:12,color:"#9fb2c9"},children:"Alpaca Key ID"}),l.jsx("input",{value:e,onChange:q=>s(q.target.value),placeholder:"Enter Alpaca Key ID",style:{padding:8,borderRadius:6,border:"1px solid rgba(255,255,255,0.04)",background:"transparent",color:"#e6eef8"}}),l.jsx("label",{style:{fontSize:12,color:"#9fb2c9"},children:"Alpaca Secret Key"}),l.jsx("input",{type:"password",value:a,onChange:q=>c(q.target.value),placeholder:"Enter Alpaca Secret Key",autoComplete:"new-password",style:{padding:8,borderRadius:6,border:"1px solid rgba(255,255,255,0.04)",background:"transparent",color:"#e6eef8"}}),l.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[l.jsx("button",{onClick:S,className:"toolbar-btn",children:"Save"}),l.jsx("button",{onClick:N,className:"toolbar-btn",children:"Clear"}),l.jsx("button",{onClick:H,disabled:E||!e||!a,className:"toolbar-btn",children:E?"Validating...":"Validate"}),l.jsx("div",{style:{marginLeft:"auto",color:"#93a3b6",alignSelf:"center"},children:h?"Saved":Y()})]}),_&&l.jsx("div",{style:{marginTop:8,color:_.ok?"#7ee787":"#ff9b9b"},children:_.msg}),l.jsx("div",{style:{marginTop:8,color:"#93a3b6",fontSize:12},children:"Note: Price Input nodes will automatically use these keys to fetch data from Alpaca."})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,paddingTop:16,borderTop:"1px solid rgba(255,255,255,0.06)"},children:[l.jsx("h3",{style:{margin:0,fontSize:14,fontWeight:600,color:"#cfe8ff"},children:"Telegram Notifications "}),l.jsxs("div",{style:{fontSize:12,color:"#9fb2c9",lineHeight:1.5},children:["Get trading signals sent directly to your Telegram.",l.jsx("br",{}),l.jsx("a",{href:"https://core.telegram.org/bots#6-botfather",target:"_blank",rel:"noopener noreferrer",style:{color:"#5e8cff"},children:"Create a bot with @BotFather"})," and get your chat ID from ",l.jsx("a",{href:"https://t.me/userinfobot",target:"_blank",rel:"noopener noreferrer",style:{color:"#5e8cff"},children:"@userinfobot"})]}),l.jsx("label",{style:{fontSize:12,color:"#9fb2c9",marginTop:8},children:"Bot Token (from @BotFather)"}),l.jsx("input",{type:"password",value:g,onChange:q=>p(q.target.value),placeholder:"Enter Bot Token (e.g., 123456:ABC-DEF...)",style:{padding:8,borderRadius:6,border:"1px solid rgba(255,255,255,0.04)",background:"transparent",color:"#e6eef8"}}),l.jsx("label",{style:{fontSize:12,color:"#9fb2c9"},children:"Chat ID (your Telegram user ID)"}),l.jsx("input",{value:v,onChange:q=>x(q.target.value),placeholder:"Enter Chat ID (e.g., 123456789)",style:{padding:8,borderRadius:6,border:"1px solid rgba(255,255,255,0.04)",background:"transparent",color:"#e6eef8"}}),l.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[l.jsx("button",{onClick:K,className:"toolbar-btn",children:"Save"}),l.jsx("button",{onClick:I,className:"toolbar-btn",children:"Clear"}),l.jsx("button",{onClick:U,disabled:z||!g||!v,className:"toolbar-btn",children:z?"Testing...":"Send Test"}),l.jsx("div",{style:{marginLeft:"auto",color:"#93a3b6",alignSelf:"center"},children:y?" Saved":$()})]}),C&&l.jsx("div",{style:{marginTop:8,padding:8,borderRadius:6,background:C.ok?"rgba(126, 231, 135, 0.1)":"rgba(255, 155, 155, 0.1)",color:C.ok?"#7ee787":"#ff9b9b"},children:C.msg}),l.jsx("div",{style:{marginTop:8,color:"#93a3b6",fontSize:12},children:" Notifications are sent automatically when strategies generate BUY/SELL signals."})]})]})});return i?Q:l.jsxs("div",{className:"panel",children:[l.jsx("div",{className:"panel-header",children:"Alpaca API Settings"}),Q]})},SN=({onNavigate:i})=>l.jsxs("div",{className:"dashboard-page",children:[l.jsx(Zl,{onNavigate:i,activeRoute:"settings"}),l.jsxs("main",{className:"dashboard-main",children:[l.jsx("div",{className:"dashboard-header",children:l.jsx("h1",{children:"Account & Settings"})}),l.jsx("div",{className:"calendar-panel",style:{maxWidth:720},children:l.jsx(wN,{})})]})]}),Ca=typeof import.meta<"u"?"https://flowtradebackend.onrender.com".replace(/\/$/,""):"http://127.0.0.1:5000",wt={ALPACA_KEY_ID:"alpaca_key_id",ALPACA_SECRET:"alpaca_secret_key",TELEGRAM_BOT_TOKEN:"telegram_bot_token",TELEGRAM_CHAT_ID:"telegram_chat_id",ALERT_SOUND:"flowgrid_alert_sound",THEME:"flowgrid_theme",CHART_COLORS:"flowgrid_chart_colors",COMPACT_MODE:"flowgrid_compact_mode",DISPLAY_NAME:"flowgrid_display_name"},ks={api:l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),l.jsx("path",{d:"M2 17l10 5 10-5"}),l.jsx("path",{d:"M2 12l10 5 10-5"})]}),bell:l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),l.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),user:l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),l.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),palette:l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("circle",{cx:"12",cy:"8",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"8",cy:"14",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"16",cy:"14",r:"2",fill:"currentColor"})]}),shield:l.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),check:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("polyline",{points:"20 6 9 17 4 12"})}),x:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),loader:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"spinner",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),l.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeLinecap:"round"})]})},_N=[{id:"api",label:"API Configuration",icon:ks.api},{id:"notifications",label:"Notifications",icon:ks.bell},{id:"account",label:"Account",icon:ks.user},{id:"appearance",label:"Appearance",icon:ks.palette},{id:"privacy",label:"Data & Privacy",icon:ks.shield}],jN=({message:i,type:e="success",onClose:s})=>(D.useEffect(()=>{const a=setTimeout(s,3e3);return()=>clearTimeout(a)},[s]),l.jsxs("div",{className:`settings-toast ${e}`,children:[e==="success"?ks.check:ks.x,l.jsx("span",{children:i})]})),ry=({showToast:i})=>{const[e,s]=D.useState(""),[a,c]=D.useState(""),[h,d]=D.useState(!1),[g,p]=D.useState(null),[v,x]=D.useState(!1);D.useEffect(()=>{s(localStorage.getItem(wt.ALPACA_KEY_ID)||""),c(localStorage.getItem(wt.ALPACA_SECRET)||"")},[]);const y=()=>{localStorage.setItem(wt.ALPACA_KEY_ID,e.trim()),localStorage.setItem(wt.ALPACA_SECRET,a.trim()),i("API credentials saved successfully","success")},b=()=>{localStorage.removeItem(wt.ALPACA_KEY_ID),localStorage.removeItem(wt.ALPACA_SECRET),s(""),c(""),i("API credentials cleared","success")},S=async()=>{if(!e||!a){i("Please enter API credentials first","error");return}d(!0),p(null);try{const N=await fetch(`${Ca}/test_alpaca_keys`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({alpacaKeyId:e.trim(),alpacaSecretKey:a.trim()})}),E=await N.json().catch(()=>null);N.ok&&E?.ok?(p({ok:!0,msg:E.message||"Connection successful"}),i("API connection verified!","success")):(p({ok:!1,msg:E?.error||`HTTP ${N.status}`}),i("Connection failed","error"))}catch(N){p({ok:!1,msg:String(N)}),i("Connection error","error")}d(!1)};return l.jsx("div",{className:"settings-tab-content",children:l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Alpaca Trading API"}),l.jsx("p",{className:"settings-section-desc",children:"Connect your Alpaca brokerage account to enable live trading and real-time market data."}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"API Key ID"}),l.jsx("input",{type:"text",className:"settings-input",value:e,onChange:N=>s(N.target.value),placeholder:"Enter your Alpaca API Key ID"})]}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"Secret Key"}),l.jsxs("div",{className:"settings-input-group",children:[l.jsx("input",{type:v?"text":"password",className:"settings-input",value:a,onChange:N=>c(N.target.value),placeholder:"Enter your Alpaca Secret Key",autoComplete:"new-password"}),l.jsx("button",{type:"button",className:"settings-input-toggle",onClick:()=>x(!v),children:v?"Hide":"Show"})]})]}),g&&l.jsxs("div",{className:`settings-validation-result ${g.ok?"success":"error"}`,children:[g.ok?ks.check:ks.x,l.jsx("span",{children:g.msg})]}),l.jsxs("div",{className:"settings-button-group",children:[l.jsx("button",{className:"settings-btn primary",onClick:y,children:"Save Credentials"}),l.jsx("button",{className:"settings-btn secondary",onClick:S,disabled:h||!e||!a,children:h?l.jsxs(l.Fragment,{children:[ks.loader," Testing..."]}):"Test Connection"}),l.jsx("button",{className:"settings-btn danger-text",onClick:b,children:"Clear"})]}),l.jsxs("div",{className:"settings-info-box",children:[l.jsx("strong",{children:"Note:"})," Your API credentials are stored locally in your browser and are never sent to our servers. Get your API keys from ",l.jsx("a",{href:"https://app.alpaca.markets/paper/dashboard/overview",target:"_blank",rel:"noopener noreferrer",children:"Alpaca Dashboard"}),"."]})]})})},NN=({showToast:i})=>{const[e,s]=D.useState(""),[a,c]=D.useState(""),[h,d]=D.useState(!0),[g,p]=D.useState(!1),[v,x]=D.useState(!1);D.useEffect(()=>{s(localStorage.getItem(wt.TELEGRAM_BOT_TOKEN)||""),c(localStorage.getItem(wt.TELEGRAM_CHAT_ID)||""),d(localStorage.getItem(wt.ALERT_SOUND)!=="false")},[]);const y=async()=>{localStorage.setItem(wt.TELEGRAM_BOT_TOKEN,e.trim()),localStorage.setItem(wt.TELEGRAM_CHAT_ID,a.trim());try{await fetch(`${Ca}/api/telegram/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:e.trim(),chat_id:a.trim()})}),i("Telegram settings saved","success")}catch{i("Saved locally, but failed to sync to server","error")}},b=async()=>{if(!e||!a){i("Please enter Telegram credentials first","error");return}p(!0);try{const E=await fetch(`${Ca}/api/telegram/test`,{method:"POST",headers:{"Content-Type":"application/json"}}),R=await E.json().catch(()=>null);E.ok&&R?.success?i("Test message sent! Check your Telegram.","success"):i(R?.error||"Failed to send test message","error")}catch{i("Failed to send test message","error")}p(!1)},S=E=>{d(E),localStorage.setItem(wt.ALERT_SOUND,E.toString()),i(`Sound alerts ${E?"enabled":"disabled"}`,"success")},N=()=>{try{const E=new(window.AudioContext||window.webkitAudioContext),R=E.createOscillator(),_=E.createGain();R.connect(_),_.connect(E.destination),R.frequency.value=800,R.type="sine",_.gain.setValueAtTime(.3,E.currentTime),_.gain.exponentialRampToValueAtTime(.01,E.currentTime+.3),R.start(E.currentTime),R.stop(E.currentTime+.3),i("Sound played!","success")}catch{i("Could not play sound","error")}};return l.jsxs("div",{className:"settings-tab-content",children:[l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Telegram Notifications "}),l.jsx("p",{className:"settings-section-desc",children:"Receive trading signals and alerts directly to your Telegram."}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"Bot Token (from @BotFather)"}),l.jsxs("div",{className:"settings-input-group",children:[l.jsx("input",{type:v?"text":"password",className:"settings-input",value:e,onChange:E=>s(E.target.value),placeholder:"Enter Bot Token (e.g., 123456:ABC-DEF...)"}),l.jsx("button",{type:"button",className:"settings-input-toggle",onClick:()=>x(!v),children:v?"Hide":"Show"})]})]}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"Chat ID"}),l.jsx("input",{type:"text",className:"settings-input",value:a,onChange:E=>c(E.target.value),placeholder:"Enter Chat ID (e.g., 123456789)"}),l.jsxs("span",{className:"settings-input-hint",children:["Get your Chat ID from ",l.jsx("a",{href:"https://t.me/userinfobot",target:"_blank",rel:"noopener noreferrer",children:"@userinfobot"})]})]}),l.jsxs("div",{className:"settings-button-group",children:[l.jsx("button",{className:"settings-btn primary",onClick:y,children:"Save Telegram Settings"}),l.jsx("button",{className:"settings-btn secondary",onClick:b,disabled:g||!e||!a,children:g?l.jsxs(l.Fragment,{children:[ks.loader," Sending..."]}):"Send Test Message"})]}),l.jsxs("div",{className:"settings-info-box",children:[l.jsx("strong",{children:"Setup Guide:"}),l.jsxs("ol",{children:[l.jsx("li",{children:"Search for @BotFather on Telegram"}),l.jsx("li",{children:"Send /newbot and follow the instructions"}),l.jsx("li",{children:"Copy the bot token provided"}),l.jsx("li",{children:"Get your Chat ID from @userinfobot"})]})]})]}),l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Alert Preferences"}),l.jsx("div",{className:"settings-toggle-group",children:l.jsxs("label",{className:"settings-toggle",children:[l.jsx("input",{type:"checkbox",checked:h,onChange:E=>S(E.target.checked)}),l.jsx("span",{className:"toggle-switch"}),l.jsxs("span",{className:"toggle-label",children:[l.jsx("span",{className:"toggle-title",children:"Sound Alerts"}),l.jsx("span",{className:"toggle-desc",children:"Play sound when new signals are generated"})]})]})}),l.jsx("div",{className:"settings-button-group",style:{marginTop:16},children:l.jsx("button",{className:"settings-btn secondary",onClick:N,disabled:!h,children:" Test Sound"})})]})]})},EN=({showToast:i})=>{const[e,s]=D.useState("");D.useEffect(()=>{s(localStorage.getItem(wt.DISPLAY_NAME)||"")},[]);const a=()=>{const c=e.trim();localStorage.setItem(wt.DISPLAY_NAME,c),window.dispatchEvent(new CustomEvent("flowgrid:settings-updated",{detail:{displayName:c}})),i("Display name saved","success")};return l.jsx("div",{className:"settings-tab-content",children:l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Profile"}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"Display Name"}),l.jsx("input",{type:"text",className:"settings-input",value:e,onChange:c=>s(c.target.value),placeholder:"Enter your name"}),l.jsx("span",{className:"settings-input-hint",children:"This name will be shown on your dashboard welcome message"})]}),l.jsx("div",{className:"settings-button-group",children:l.jsx("button",{className:"settings-btn primary",onClick:a,children:"Save Profile"})})]})})},TN=({showToast:i})=>{const[e,s]=D.useState("dark"),[a,c]=D.useState("default"),[h,d]=D.useState(!1);D.useEffect(()=>{s(localStorage.getItem(wt.THEME)||"dark"),c(localStorage.getItem(wt.CHART_COLORS)||"default"),d(localStorage.getItem(wt.COMPACT_MODE)==="true")},[]);const g=S=>{document.documentElement.setAttribute("data-theme",S),S==="light"?(document.documentElement.style.setProperty("--bg-primary","#f8fafc"),document.documentElement.style.setProperty("--bg-secondary","#ffffff"),document.documentElement.style.setProperty("--bg-tertiary","#f1f5f9"),document.documentElement.style.setProperty("--text-primary","#1e293b"),document.documentElement.style.setProperty("--text-secondary","#475569"),document.documentElement.style.setProperty("--border-color","rgba(0, 0, 0, 0.1)")):(document.documentElement.style.setProperty("--bg-primary","#0a0e17"),document.documentElement.style.setProperty("--bg-secondary","#111827"),document.documentElement.style.setProperty("--bg-tertiary","#1f2937"),document.documentElement.style.setProperty("--text-primary","#f8fafc"),document.documentElement.style.setProperty("--text-secondary","#94a3b8"),document.documentElement.style.setProperty("--border-color","rgba(255, 255, 255, 0.06)"))},p=S=>{let N,E;switch(S){case"blue":N="#3b82f6",E="#f97316";break;case"monochrome":N="#e2e8f0",E="#64748b";break;case"colorblind":N="#0ea5e9",E="#f59e0b";break;default:N="#3b82f6",E="#ef4444"}document.documentElement.style.setProperty("--chart-up-color",N),document.documentElement.style.setProperty("--chart-down-color",E),window.dispatchEvent(new CustomEvent("flowgrid:chart-colors-changed",{detail:{upColor:N,downColor:E}}))},v=S=>{S?document.body.classList.add("compact-mode"):document.body.classList.remove("compact-mode")},x=S=>{s(S),localStorage.setItem(wt.THEME,S),g(S),i(`Theme changed to ${S}`,"success")},y=S=>{c(S),localStorage.setItem(wt.CHART_COLORS,S),p(S),i("Chart colors updated","success")},b=S=>{d(S),localStorage.setItem(wt.COMPACT_MODE,S.toString()),v(S),i(`Compact mode ${S?"enabled":"disabled"}`,"success")};return D.useEffect(()=>{const S=localStorage.getItem(wt.THEME)||"dark",N=localStorage.getItem(wt.CHART_COLORS)||"default",E=localStorage.getItem(wt.COMPACT_MODE)==="true";g(S),p(N),v(E)},[]),l.jsxs("div",{className:"settings-tab-content",children:[l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Theme"}),l.jsxs("div",{className:"settings-theme-grid",children:[l.jsxs("button",{className:`theme-option ${e==="dark"?"active":""}`,onClick:()=>x("dark"),children:[l.jsxs("div",{className:"theme-preview dark",children:[l.jsx("div",{className:"theme-preview-header"}),l.jsxs("div",{className:"theme-preview-content",children:[l.jsx("div",{className:"theme-preview-sidebar"}),l.jsx("div",{className:"theme-preview-main"})]})]}),l.jsx("span",{children:"Dark"})]}),l.jsxs("button",{className:`theme-option ${e==="light"?"active":""}`,onClick:()=>x("light"),children:[l.jsxs("div",{className:"theme-preview light",children:[l.jsx("div",{className:"theme-preview-header"}),l.jsxs("div",{className:"theme-preview-content",children:[l.jsx("div",{className:"theme-preview-sidebar"}),l.jsx("div",{className:"theme-preview-main"})]})]}),l.jsx("span",{children:"Light"})]})]})]}),l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Chart Colors"}),l.jsxs("div",{className:"settings-form-group",children:[l.jsx("label",{className:"settings-label",children:"Color Scheme"}),l.jsxs("select",{className:"settings-select",value:a,onChange:S=>y(S.target.value),children:[l.jsx("option",{value:"default",children:"Default (Green/Red)"}),l.jsx("option",{value:"blue",children:"Blue/Orange"}),l.jsx("option",{value:"monochrome",children:"Monochrome"}),l.jsx("option",{value:"colorblind",children:"Colorblind Friendly"})]}),l.jsxs("div",{className:"color-preview",style:{marginTop:12,display:"flex",gap:16},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("div",{style:{width:24,height:24,borderRadius:4,background:a==="default"||a==="blue"?"#3b82f6":a==="monochrome"?"#e2e8f0":"#0ea5e9"}}),l.jsx("span",{style:{fontSize:13,color:"#94a3b8"},children:"Up/Profit"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("div",{style:{width:24,height:24,borderRadius:4,background:a==="default"?"#ef4444":a==="blue"?"#f97316":a==="monochrome"?"#64748b":"#f59e0b"}}),l.jsx("span",{style:{fontSize:13,color:"#94a3b8"},children:"Down/Loss"})]})]})]})]}),l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Layout"}),l.jsx("div",{className:"settings-toggle-group",children:l.jsxs("label",{className:"settings-toggle",children:[l.jsx("input",{type:"checkbox",checked:h,onChange:S=>b(S.target.checked)}),l.jsx("span",{className:"toggle-switch"}),l.jsxs("span",{className:"toggle-label",children:[l.jsx("span",{className:"toggle-title",children:"Compact Mode"}),l.jsx("span",{className:"toggle-desc",children:"Reduce spacing and padding for more data density"})]})]})})]})]})},kN=({showToast:i})=>{const[e,s]=D.useState(!1),a=async()=>{s(!0);try{const v={exportDate:new Date().toISOString(),version:"1.0",settings:{},strategies:null,trades:null};Object.entries(wt).forEach(([N,E])=>{const R=localStorage.getItem(E);R&&(v.settings[N]=R)});const x=localStorage.getItem("flowgrid_workflow_v1::saves");if(x)try{v.strategies=JSON.parse(x)}catch{v.strategies=x}try{const N=await fetch(`${Ca}/api/trades`);if(N.ok){const E=await N.json();v.trades=E.trades||E}}catch{console.log("Could not fetch trades from backend")}const y=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),b=URL.createObjectURL(y),S=document.createElement("a");S.href=b,S.download=`flowgrid-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(b),i("Data exported successfully","success")}catch(v){i("Failed to export data: "+v.message,"error")}s(!1)},c=()=>{try{const v=localStorage.getItem("flowgrid_workflow_v1::saves");if(!v){i("No strategies to export","error");return}const x=new Blob([v],{type:"application/json"}),y=URL.createObjectURL(x),b=document.createElement("a");b.href=y,b.download=`flowgrid-strategies-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(y),i("Strategies exported successfully","success")}catch{i("Failed to export strategies","error")}},h=()=>{window.confirm("This will clear cached market data and temporary files. Your settings and strategies will NOT be affected. Continue?")&&(["flowgrid_market_cache","flowgrid_price_cache","flowgrid_analytics_cache"].forEach(x=>localStorage.removeItem(x)),i("Cache cleared successfully","success"))},d=async()=>{if(window.confirm(" This will delete ALL your trade history. This cannot be undone. Continue?"))try{(await fetch(`${Ca}/api/trades`,{method:"DELETE"})).ok?i("All trades deleted","success"):i("Failed to delete trades","error")}catch(v){i("Error: "+v.message,"error")}},g=()=>{window.confirm(" This will delete ALL your saved strategies. This cannot be undone. Continue?")&&(localStorage.removeItem("flowgrid_workflow_v1::saves"),localStorage.removeItem("flowgrid_enabled_strategies"),i("All strategies deleted","success"),window.dispatchEvent(new CustomEvent("flowgrid:strategies-cleared")))},p=()=>{window.confirm(" WARNING: This will delete ALL your data including strategies, settings, and API keys. This cannot be undone. Are you sure?")&&window.confirm("Are you REALLY sure? This action is irreversible.")&&(fetch(`${Ca}/api/trades`,{method:"DELETE"}).catch(()=>{}),localStorage.clear(),i("All data cleared. Page will reload...","success"),setTimeout(()=>window.location.reload(),1500))};return l.jsxs("div",{className:"settings-tab-content",children:[l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Export Data"}),l.jsx("p",{className:"settings-section-desc",children:"Download a copy of your settings, strategies, and trade history."}),l.jsxs("div",{className:"settings-button-group",children:[l.jsx("button",{className:"settings-btn primary",onClick:a,disabled:e,children:e?l.jsxs(l.Fragment,{children:[ks.loader," Exporting..."]}):" Export All Data"}),l.jsx("button",{className:"settings-btn secondary",onClick:c,children:" Export Strategies Only"})]})]}),l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Clear Cache"}),l.jsx("p",{className:"settings-section-desc",children:"Clear temporary data and cached market information to free up storage."}),l.jsx("div",{className:"settings-button-group",children:l.jsx("button",{className:"settings-btn secondary",onClick:h,children:" Clear Cache"})})]}),l.jsxs("div",{className:"settings-section danger",children:[l.jsx("h3",{className:"settings-section-title",children:"Danger Zone"}),l.jsx("p",{className:"settings-section-desc",children:"These actions are permanent and cannot be undone."}),l.jsxs("div",{className:"settings-button-group",style:{flexDirection:"column",alignItems:"flex-start"},children:[l.jsx("button",{className:"settings-btn danger",onClick:d,children:" Delete All Trades"}),l.jsx("button",{className:"settings-btn danger",onClick:g,children:" Delete All Strategies"}),l.jsx("button",{className:"settings-btn danger",onClick:p,style:{marginTop:8},children:" Delete Everything (Factory Reset)"})]})]}),l.jsxs("div",{className:"settings-section",children:[l.jsx("h3",{className:"settings-section-title",children:"Privacy Information"}),l.jsx("div",{className:"settings-info-box",children:l.jsxs("ul",{children:[l.jsx("li",{children:"All data is stored locally in your browser"}),l.jsx("li",{children:"API credentials are never sent to our servers"}),l.jsx("li",{children:"Market data is fetched directly from Alpaca"}),l.jsx("li",{children:"No analytics or tracking cookies are used"})]})})]})]})},CN=({onNavigate:i})=>{const[e,s]=D.useState("api"),[a,c]=D.useState(null),h=(g,p="success")=>{c({message:g,type:p})},d=()=>{switch(e){case"api":return l.jsx(ry,{showToast:h});case"notifications":return l.jsx(NN,{showToast:h});case"account":return l.jsx(EN,{showToast:h});case"appearance":return l.jsx(TN,{showToast:h});case"privacy":return l.jsx(kN,{showToast:h});default:return l.jsx(ry,{showToast:h})}};return l.jsxs("div",{className:"dashboard-page",children:[l.jsx(Zl,{onNavigate:i,activeRoute:"settings"}),l.jsxs("main",{className:"dashboard-main settings-page",children:[l.jsx("div",{className:"dashboard-header",children:l.jsx("h1",{children:"Settings"})}),l.jsxs("div",{className:"settings-container",children:[l.jsx("nav",{className:"settings-nav",children:_N.map(g=>l.jsxs("button",{className:`settings-nav-item ${e===g.id?"active":""}`,onClick:()=>s(g.id),children:[g.icon,l.jsx("span",{children:g.label})]},g.id))}),l.jsx("div",{className:"settings-content",children:d()})]})]}),a&&l.jsx(jN,{message:a.message,type:a.type,onClose:()=>c(null)})]})},MN=()=>{};var oy={};const C0=function(i){const e=[];let s=0;for(let a=0;a<i.length;a++){let c=i.charCodeAt(a);c<128?e[s++]=c:c<2048?(e[s++]=c>>6|192,e[s++]=c&63|128):(c&64512)===55296&&a+1<i.length&&(i.charCodeAt(a+1)&64512)===56320?(c=65536+((c&1023)<<10)+(i.charCodeAt(++a)&1023),e[s++]=c>>18|240,e[s++]=c>>12&63|128,e[s++]=c>>6&63|128,e[s++]=c&63|128):(e[s++]=c>>12|224,e[s++]=c>>6&63|128,e[s++]=c&63|128)}return e},DN=function(i){const e=[];let s=0,a=0;for(;s<i.length;){const c=i[s++];if(c<128)e[a++]=String.fromCharCode(c);else if(c>191&&c<224){const h=i[s++];e[a++]=String.fromCharCode((c&31)<<6|h&63)}else if(c>239&&c<365){const h=i[s++],d=i[s++],g=i[s++],p=((c&7)<<18|(h&63)<<12|(d&63)<<6|g&63)-65536;e[a++]=String.fromCharCode(55296+(p>>10)),e[a++]=String.fromCharCode(56320+(p&1023))}else{const h=i[s++],d=i[s++];e[a++]=String.fromCharCode((c&15)<<12|(h&63)<<6|d&63)}}return e.join("")},M0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let c=0;c<i.length;c+=3){const h=i[c],d=c+1<i.length,g=d?i[c+1]:0,p=c+2<i.length,v=p?i[c+2]:0,x=h>>2,y=(h&3)<<4|g>>4;let b=(g&15)<<2|v>>6,S=v&63;p||(S=64,d||(b=64)),a.push(s[x],s[y],s[b],s[S])}return a.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(C0(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):DN(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let c=0;c<i.length;){const h=s[i.charAt(c++)],g=c<i.length?s[i.charAt(c)]:0;++c;const v=c<i.length?s[i.charAt(c)]:64;++c;const y=c<i.length?s[i.charAt(c)]:64;if(++c,h==null||g==null||v==null||y==null)throw new RN;const b=h<<2|g>>4;if(a.push(b),v!==64){const S=g<<4&240|v>>2;if(a.push(S),y!==64){const N=v<<6&192|y;a.push(N)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class RN extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const AN=function(i){const e=C0(i);return M0.encodeByteArray(e,!0)},D0=function(i){return AN(i).replace(/\./g,"")},R0=function(i){try{return M0.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function LN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ON=()=>LN().__FIREBASE_DEFAULTS__,zN=()=>{if(typeof process>"u"||typeof oy>"u")return;const i=oy.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},IN=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&R0(i[1]);return e&&JSON.parse(e)},Bd=()=>{try{return MN()||ON()||zN()||IN()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},PN=i=>Bd()?.emulatorHosts?.[i],A0=()=>Bd()?.config,L0=i=>Bd()?.[`_${i}`];class BN{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,a))}}}function cc(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function $N(i){return(await fetch(i,{credentials:"include"})).ok}const Vl={};function UN(){const i={prod:[],emulator:[]};for(const e of Object.keys(Vl))Vl[e]?i.emulator.push(e):i.prod.push(e);return i}function VN(i){let e=document.getElementById(i),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),s=!0),{created:s,element:e}}let cy=!1;function HN(i,e){if(typeof window>"u"||typeof document>"u"||!cc(window.location.host)||Vl[i]===e||Vl[i]||cy)return;Vl[i]=e;function s(b){return`__firebase__banner__${b}`}const a="__firebase__banner",h=UN().prod.length>0;function d(){const b=document.getElementById(a);b&&b.remove()}function g(b){b.style.display="flex",b.style.background="#7faaf0",b.style.position="fixed",b.style.bottom="5px",b.style.left="5px",b.style.padding=".5em",b.style.borderRadius="5px",b.style.alignItems="center"}function p(b,S){b.setAttribute("width","24"),b.setAttribute("id",S),b.setAttribute("height","24"),b.setAttribute("viewBox","0 0 24 24"),b.setAttribute("fill","none"),b.style.marginLeft="-6px"}function v(){const b=document.createElement("span");return b.style.cursor="pointer",b.style.marginLeft="16px",b.style.fontSize="24px",b.innerHTML=" &times;",b.onclick=()=>{cy=!0,d()},b}function x(b,S){b.setAttribute("id",S),b.innerText="Learn more",b.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",b.setAttribute("target","__blank"),b.style.paddingLeft="5px",b.style.textDecoration="underline"}function y(){const b=VN(a),S=s("text"),N=document.getElementById(S)||document.createElement("span"),E=s("learnmore"),R=document.getElementById(E)||document.createElement("a"),_=s("preprendIcon"),F=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(b.created){const H=b.element;g(H),x(R,E);const z=v();p(F,_),H.append(F,N,R,z),document.body.appendChild(H)}h?(N.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function Qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qN(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qt())}function FN(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function WN(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function GN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function YN(){const i=Qt();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function KN(){try{return typeof indexedDB=="object"}catch{return!1}}function XN(){return new Promise((i,e)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(a);c.onsuccess=()=>{c.result.close(),s||self.indexedDB.deleteDatabase(a),i(!0)},c.onupgradeneeded=()=>{s=!1},c.onerror=()=>{e(c.error?.message||"")}}catch(s){e(s)}})}const JN="FirebaseError";class li extends Error{constructor(e,s,a){super(s),this.code=e,this.customData=a,this.name=JN,Object.setPrototypeOf(this,li.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ir.prototype.create)}}class ir{constructor(e,s,a){this.service=e,this.serviceName=s,this.errors=a}create(e,...s){const a=s[0]||{},c=`${this.service}/${e}`,h=this.errors[e],d=h?QN(h,a):"Error",g=`${this.serviceName}: ${d} (${c}).`;return new li(c,g,a)}}function QN(i,e){return i.replace(ZN,(s,a)=>{const c=e[a];return c!=null?String(c):`<${a}?>`})}const ZN=/\{\$([^}]+)}/g;function e2(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function za(i,e){if(i===e)return!0;const s=Object.keys(i),a=Object.keys(e);for(const c of s){if(!a.includes(c))return!1;const h=i[c],d=e[c];if(uy(h)&&uy(d)){if(!za(h,d))return!1}else if(h!==d)return!1}for(const c of a)if(!s.includes(c))return!1;return!0}function uy(i){return i!==null&&typeof i=="object"}function ar(i){const e=[];for(const[s,a]of Object.entries(i))Array.isArray(a)?a.forEach(c=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function t2(i,e){const s=new s2(i,e);return s.subscribe.bind(s)}class s2{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,a){let c;if(e===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");n2(e,["next","error","complete"])?c=e:c={next:e,error:s,complete:a},c.next===void 0&&(c.next=Qh),c.error===void 0&&(c.error=Qh),c.complete===void 0&&(c.complete=Qh);const h=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),h}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function n2(i,e){if(typeof i!="object"||i===null)return!1;for(const s of e)if(s in i&&typeof i[s]=="function")return!0;return!1}function Qh(){}function ri(i){return i&&i._delegate?i._delegate:i}class Ia{constructor(e,s,a){this.name=e,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ti="[DEFAULT]";class i2{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const a=new BN;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:s});c&&a.resolve(c)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){const s=this.normalizeInstanceIdentifier(e?.identifier),a=e?.optional??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(c){if(a)return null;throw c}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(l2(e))try{this.getOrInitializeService({instanceIdentifier:Ti})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(s);try{const h=this.getOrInitializeService({instanceIdentifier:c});a.resolve(h)}catch{}}}}clearInstance(e=Ti){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ti){return this.instances.has(e)}getOptions(e=Ti){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[h,d]of this.instancesDeferred.entries()){const g=this.normalizeInstanceIdentifier(h);a===g&&d.resolve(c)}return c}onInit(e,s){const a=this.normalizeInstanceIdentifier(s),c=this.onInitCallbacks.get(a)??new Set;c.add(e),this.onInitCallbacks.set(a,c);const h=this.instances.get(a);return h&&e(h,a),()=>{c.delete(e)}}invokeOnInitCallbacks(e,s){const a=this.onInitCallbacks.get(s);if(a)for(const c of a)try{c(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:a2(e),options:s}),this.instances.set(e,a),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Ti){return this.component?this.component.multipleInstances?e:Ti:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function a2(i){return i===Ti?void 0:i}function l2(i){return i.instantiationMode==="EAGER"}class r2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new i2(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}var ft;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(ft||(ft={}));const o2={debug:ft.DEBUG,verbose:ft.VERBOSE,info:ft.INFO,warn:ft.WARN,error:ft.ERROR,silent:ft.SILENT},c2=ft.INFO,u2={[ft.DEBUG]:"log",[ft.VERBOSE]:"log",[ft.INFO]:"info",[ft.WARN]:"warn",[ft.ERROR]:"error"},h2=(i,e,...s)=>{if(e<i.logLevel)return;const a=new Date().toISOString(),c=u2[e];if(c)console[c](`[${a}]  ${i.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class O0{constructor(e){this.name=e,this._logLevel=c2,this._logHandler=h2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ft))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?o2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ft.DEBUG,...e),this._logHandler(this,ft.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ft.VERBOSE,...e),this._logHandler(this,ft.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ft.INFO,...e),this._logHandler(this,ft.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ft.WARN,...e),this._logHandler(this,ft.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ft.ERROR,...e),this._logHandler(this,ft.ERROR,...e)}}const d2=(i,e)=>e.some(s=>i instanceof s);let hy,dy;function f2(){return hy||(hy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function m2(){return dy||(dy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const z0=new WeakMap,pd=new WeakMap,I0=new WeakMap,Zh=new WeakMap,$d=new WeakMap;function p2(i){const e=new Promise((s,a)=>{const c=()=>{i.removeEventListener("success",h),i.removeEventListener("error",d)},h=()=>{s(ni(i.result)),c()},d=()=>{a(i.error),c()};i.addEventListener("success",h),i.addEventListener("error",d)});return e.then(s=>{s instanceof IDBCursor&&z0.set(s,i)}).catch(()=>{}),$d.set(e,i),e}function g2(i){if(pd.has(i))return;const e=new Promise((s,a)=>{const c=()=>{i.removeEventListener("complete",h),i.removeEventListener("error",d),i.removeEventListener("abort",d)},h=()=>{s(),c()},d=()=>{a(i.error||new DOMException("AbortError","AbortError")),c()};i.addEventListener("complete",h),i.addEventListener("error",d),i.addEventListener("abort",d)});pd.set(i,e)}let gd={get(i,e,s){if(i instanceof IDBTransaction){if(e==="done")return pd.get(i);if(e==="objectStoreNames")return i.objectStoreNames||I0.get(i);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return ni(i[e])},set(i,e,s){return i[e]=s,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function v2(i){gd=i(gd)}function y2(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const a=i.call(ed(this),e,...s);return I0.set(a,e.sort?e.sort():[e]),ni(a)}:m2().includes(i)?function(...e){return i.apply(ed(this),e),ni(z0.get(this))}:function(...e){return ni(i.apply(ed(this),e))}}function b2(i){return typeof i=="function"?y2(i):(i instanceof IDBTransaction&&g2(i),d2(i,f2())?new Proxy(i,gd):i)}function ni(i){if(i instanceof IDBRequest)return p2(i);if(Zh.has(i))return Zh.get(i);const e=b2(i);return e!==i&&(Zh.set(i,e),$d.set(e,i)),e}const ed=i=>$d.get(i);function x2(i,e,{blocked:s,upgrade:a,blocking:c,terminated:h}={}){const d=indexedDB.open(i,e),g=ni(d);return a&&d.addEventListener("upgradeneeded",p=>{a(ni(d.result),p.oldVersion,p.newVersion,ni(d.transaction),p)}),s&&d.addEventListener("blocked",p=>s(p.oldVersion,p.newVersion,p)),g.then(p=>{h&&p.addEventListener("close",()=>h()),c&&p.addEventListener("versionchange",v=>c(v.oldVersion,v.newVersion,v))}).catch(()=>{}),g}const w2=["get","getKey","getAll","getAllKeys","count"],S2=["put","add","delete","clear"],td=new Map;function fy(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(td.get(e))return td.get(e);const s=e.replace(/FromIndex$/,""),a=e!==s,c=S2.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(c||w2.includes(s)))return;const h=async function(d,...g){const p=this.transaction(d,c?"readwrite":"readonly");let v=p.store;return a&&(v=v.index(g.shift())),(await Promise.all([v[s](...g),c&&p.done]))[0]};return td.set(e,h),h}v2(i=>({...i,get:(e,s,a)=>fy(e,s)||i.get(e,s,a),has:(e,s)=>!!fy(e,s)||i.has(e,s)}));class _2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(j2(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function j2(i){return i.getComponent()?.type==="VERSION"}const vd="@firebase/app",my="0.14.6";const jn=new O0("@firebase/app"),N2="@firebase/app-compat",E2="@firebase/analytics-compat",T2="@firebase/analytics",k2="@firebase/app-check-compat",C2="@firebase/app-check",M2="@firebase/auth",D2="@firebase/auth-compat",R2="@firebase/database",A2="@firebase/data-connect",L2="@firebase/database-compat",O2="@firebase/functions",z2="@firebase/functions-compat",I2="@firebase/installations",P2="@firebase/installations-compat",B2="@firebase/messaging",$2="@firebase/messaging-compat",U2="@firebase/performance",V2="@firebase/performance-compat",H2="@firebase/remote-config",q2="@firebase/remote-config-compat",F2="@firebase/storage",W2="@firebase/storage-compat",G2="@firebase/firestore",Y2="@firebase/ai",K2="@firebase/firestore-compat",X2="firebase",J2="12.6.0";const yd="[DEFAULT]",Q2={[vd]:"fire-core",[N2]:"fire-core-compat",[T2]:"fire-analytics",[E2]:"fire-analytics-compat",[C2]:"fire-app-check",[k2]:"fire-app-check-compat",[M2]:"fire-auth",[D2]:"fire-auth-compat",[R2]:"fire-rtdb",[A2]:"fire-data-connect",[L2]:"fire-rtdb-compat",[O2]:"fire-fn",[z2]:"fire-fn-compat",[I2]:"fire-iid",[P2]:"fire-iid-compat",[B2]:"fire-fcm",[$2]:"fire-fcm-compat",[U2]:"fire-perf",[V2]:"fire-perf-compat",[H2]:"fire-rc",[q2]:"fire-rc-compat",[F2]:"fire-gcs",[W2]:"fire-gcs-compat",[G2]:"fire-fst",[K2]:"fire-fst-compat",[Y2]:"fire-vertex","fire-js":"fire-js",[X2]:"fire-js-all"};const Ko=new Map,Z2=new Map,bd=new Map;function py(i,e){try{i.container.addComponent(e)}catch(s){jn.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,s)}}function Kl(i){const e=i.name;if(bd.has(e))return jn.debug(`There were multiple attempts to register component ${e}.`),!1;bd.set(e,i);for(const s of Ko.values())py(s,i);for(const s of Z2.values())py(s,i);return!0}function P0(i,e){const s=i.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),i.container.getProvider(e)}function Ws(i){return i==null?!1:i.settings!==void 0}const eE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ii=new ir("app","Firebase",eE);class tE{constructor(e,s,a){this._isDeleted=!1,this._options={...e},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Ia("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ii.create("app-deleted",{appName:this._name})}}const lr=J2;function B0(i,e={}){let s=i;typeof e!="object"&&(e={name:e});const a={name:yd,automaticDataCollectionEnabled:!0,...e},c=a.name;if(typeof c!="string"||!c)throw ii.create("bad-app-name",{appName:String(c)});if(s||(s=A0()),!s)throw ii.create("no-options");const h=Ko.get(c);if(h){if(za(s,h.options)&&za(a,h.config))return h;throw ii.create("duplicate-app",{appName:c})}const d=new r2(c);for(const p of bd.values())d.addComponent(p);const g=new tE(s,a,d);return Ko.set(c,g),g}function sE(i=yd){const e=Ko.get(i);if(!e&&i===yd&&A0())return B0();if(!e)throw ii.create("no-app",{appName:i});return e}function Ma(i,e,s){let a=Q2[i]??i;s&&(a+=`-${s}`);const c=a.match(/\s|\//),h=e.match(/\s|\//);if(c||h){const d=[`Unable to register library "${a}" with version "${e}":`];c&&d.push(`library name "${a}" contains illegal characters (whitespace or "/")`),c&&h&&d.push("and"),h&&d.push(`version name "${e}" contains illegal characters (whitespace or "/")`),jn.warn(d.join(" "));return}Kl(new Ia(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}const nE="firebase-heartbeat-database",iE=1,Xl="firebase-heartbeat-store";let sd=null;function $0(){return sd||(sd=x2(nE,iE,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(Xl)}catch(s){console.warn(s)}}}}).catch(i=>{throw ii.create("idb-open",{originalErrorMessage:i.message})})),sd}async function aE(i){try{const s=(await $0()).transaction(Xl),a=await s.objectStore(Xl).get(U0(i));return await s.done,a}catch(e){if(e instanceof li)jn.warn(e.message);else{const s=ii.create("idb-get",{originalErrorMessage:e?.message});jn.warn(s.message)}}}async function gy(i,e){try{const a=(await $0()).transaction(Xl,"readwrite");await a.objectStore(Xl).put(e,U0(i)),await a.done}catch(s){if(s instanceof li)jn.warn(s.message);else{const a=ii.create("idb-set",{originalErrorMessage:s?.message});jn.warn(a.message)}}}function U0(i){return`${i.name}!${i.options.appId}`}const lE=1024,rE=30;class oE{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new uE(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=vy();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(c=>c.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:s}),this._heartbeatsCache.heartbeats.length>rE){const c=hE(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){jn.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=vy(),{heartbeatsToSend:s,unsentEntries:a}=cE(this._heartbeatsCache.heartbeats),c=D0(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}catch(e){return jn.warn(e),""}}}function vy(){return new Date().toISOString().substring(0,10)}function cE(i,e=lE){const s=[];let a=i.slice();for(const c of i){const h=s.find(d=>d.agent===c.agent);if(h){if(h.dates.push(c.date),yy(s)>e){h.dates.pop();break}}else if(s.push({agent:c.agent,dates:[c.date]}),yy(s)>e){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class uE{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return KN()?XN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await aE(this.app);return s?.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return gy(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return gy(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function yy(i){return D0(JSON.stringify({version:2,heartbeats:i})).length}function hE(i){if(i.length===0)return-1;let e=0,s=i[0].date;for(let a=1;a<i.length;a++)i[a].date<s&&(s=i[a].date,e=a);return e}function dE(i){Kl(new Ia("platform-logger",e=>new _2(e),"PRIVATE")),Kl(new Ia("heartbeat",e=>new oE(e),"PRIVATE")),Ma(vd,my,i),Ma(vd,my,"esm2020"),Ma("fire-js","")}dE("");var fE="firebase",mE="12.7.0";Ma(fE,mE,"app");function V0(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const pE=V0,H0=new ir("auth","Firebase",V0());const Xo=new O0("@firebase/auth");function gE(i,...e){Xo.logLevel<=ft.WARN&&Xo.warn(`Auth (${lr}): ${i}`,...e)}function $o(i,...e){Xo.logLevel<=ft.ERROR&&Xo.error(`Auth (${lr}): ${i}`,...e)}function Ks(i,...e){throw Vd(i,...e)}function zs(i,...e){return Vd(i,...e)}function Ud(i,e,s){const a={...pE(),[e]:s};return new ir("auth","Firebase",a).create(e,{appName:i.name})}function Di(i){return Ud(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function vE(i,e,s){const a=s;if(!(e instanceof a))throw a.name!==e.constructor.name&&Ks(i,"argument-error"),Ud(i,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Vd(i,...e){if(typeof i!="string"){const s=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=i.name),i._errorFactory.create(s,...a)}return H0.create(i,...e)}function Pe(i,e,...s){if(!i)throw Vd(e,...s)}function Sn(i){const e="INTERNAL ASSERTION FAILED: "+i;throw $o(e),new Error(e)}function Nn(i,e){i||Sn(e)}function xd(){return typeof self<"u"&&self.location?.href||""}function yE(){return by()==="http:"||by()==="https:"}function by(){return typeof self<"u"&&self.location?.protocol||null}function bE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(yE()||WN()||"connection"in navigator)?navigator.onLine:!0}function xE(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class rr{constructor(e,s){this.shortDelay=e,this.longDelay=s,Nn(s>e,"Short delay should be less than long delay!"),this.isMobile=qN()||GN()}get(){return bE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Hd(i,e){Nn(i.emulator,"Emulator should always be set here");const{url:s}=i.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}class q0{static initialize(e,s,a){this.fetchImpl=e,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const wE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const SE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_E=new rr(3e4,6e4);function qd(i,e){return i.tenantId&&!e.tenantId?{...e,tenantId:i.tenantId}:e}async function Ba(i,e,s,a,c={}){return F0(i,c,async()=>{let h={},d={};a&&(e==="GET"?d=a:h={body:JSON.stringify(a)});const g=ar({key:i.config.apiKey,...d}).slice(1),p=await i._getAdditionalHeaders();p["Content-Type"]="application/json",i.languageCode&&(p["X-Firebase-Locale"]=i.languageCode);const v={method:e,headers:p,...h};return FN()||(v.referrerPolicy="no-referrer"),i.emulatorConfig&&cc(i.emulatorConfig.host)&&(v.credentials="include"),q0.fetch()(await W0(i,i.config.apiHost,s,g),v)})}async function F0(i,e,s){i._canInitEmulator=!1;const a={...wE,...e};try{const c=new NE(i),h=await Promise.race([s(),c.promise]);c.clearNetworkTimeout();const d=await h.json();if("needConfirmation"in d)throw Io(i,"account-exists-with-different-credential",d);if(h.ok&&!("errorMessage"in d))return d;{const g=h.ok?d.errorMessage:d.error.message,[p,v]=g.split(" : ");if(p==="FEDERATED_USER_ID_ALREADY_LINKED")throw Io(i,"credential-already-in-use",d);if(p==="EMAIL_EXISTS")throw Io(i,"email-already-in-use",d);if(p==="USER_DISABLED")throw Io(i,"user-disabled",d);const x=a[p]||p.toLowerCase().replace(/[_\s]+/g,"-");if(v)throw Ud(i,x,v);Ks(i,x)}}catch(c){if(c instanceof li)throw c;Ks(i,"network-request-failed",{message:String(c)})}}async function jE(i,e,s,a,c={}){const h=await Ba(i,e,s,a,c);return"mfaPendingCredential"in h&&Ks(i,"multi-factor-auth-required",{_serverResponse:h}),h}async function W0(i,e,s,a){const c=`${e}${s}?${a}`,h=i,d=h.config.emulator?Hd(i.config,c):`${i.config.apiScheme}://${c}`;return SE.includes(s)&&(await h._persistenceManagerAvailable,h._getPersistenceType()==="COOKIE")?h._getPersistence()._getFinalTarget(d).toString():d}class NE{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(zs(this.auth,"network-request-failed")),_E.get())})}}function Io(i,e,s){const a={appName:i.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const c=zs(i,e,a);return c.customData._tokenResponse=s,c}async function EE(i,e){return Ba(i,"POST","/v1/accounts:delete",e)}async function Jo(i,e){return Ba(i,"POST","/v1/accounts:lookup",e)}function Hl(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function TE(i,e=!1){const s=ri(i),a=await s.getIdToken(e),c=Fd(a);Pe(c&&c.exp&&c.auth_time&&c.iat,s.auth,"internal-error");const h=typeof c.firebase=="object"?c.firebase:void 0,d=h?.sign_in_provider;return{claims:c,token:a,authTime:Hl(nd(c.auth_time)),issuedAtTime:Hl(nd(c.iat)),expirationTime:Hl(nd(c.exp)),signInProvider:d||null,signInSecondFactor:h?.sign_in_second_factor||null}}function nd(i){return Number(i)*1e3}function Fd(i){const[e,s,a]=i.split(".");if(e===void 0||s===void 0||a===void 0)return $o("JWT malformed, contained fewer than 3 sections"),null;try{const c=R0(s);return c?JSON.parse(c):($o("Failed to decode base64 JWT payload"),null)}catch(c){return $o("Caught error parsing JWT payload as JSON",c?.toString()),null}}function xy(i){const e=Fd(i);return Pe(e,"internal-error"),Pe(typeof e.exp<"u","internal-error"),Pe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Jl(i,e,s=!1){if(s)return e;try{return await e}catch(a){throw a instanceof li&&kE(a)&&i.auth.currentUser===i&&await i.auth.signOut(),a}}function kE({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class CE{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class wd{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hl(this.lastLoginAt),this.creationTime=Hl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Qo(i){const e=i.auth,s=await i.getIdToken(),a=await Jl(i,Jo(e,{idToken:s}));Pe(a?.users.length,e,"internal-error");const c=a.users[0];i._notifyReloadListener(c);const h=c.providerUserInfo?.length?G0(c.providerUserInfo):[],d=DE(i.providerData,h),g=i.isAnonymous,p=!(i.email&&c.passwordHash)&&!d?.length,v=g?p:!1,x={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new wd(c.createdAt,c.lastLoginAt),isAnonymous:v};Object.assign(i,x)}async function ME(i){const e=ri(i);await Qo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function DE(i,e){return[...i.filter(a=>!e.some(c=>c.providerId===a.providerId)),...e]}function G0(i){return i.map(({providerId:e,...s})=>({providerId:e,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}async function RE(i,e){const s=await F0(i,{},async()=>{const a=ar({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:h}=i.config,d=await W0(i,c,"/v1/token",`key=${h}`),g=await i._getAdditionalHeaders();g["Content-Type"]="application/x-www-form-urlencoded";const p={method:"POST",headers:g,body:a};return i.emulatorConfig&&cc(i.emulatorConfig.host)&&(p.credentials="include"),q0.fetch()(d,p)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function AE(i,e){return Ba(i,"POST","/v2/accounts:revokeToken",qd(i,e))}class Da{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Pe(e.idToken,"internal-error"),Pe(typeof e.idToken<"u","internal-error"),Pe(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Pe(e.length!==0,"internal-error");const s=xy(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Pe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:a,refreshToken:c,expiresIn:h}=await RE(e,s);this.updateTokensAndExpiration(a,c,Number(h))}updateTokensAndExpiration(e,s,a){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,s){const{refreshToken:a,accessToken:c,expirationTime:h}=s,d=new Da;return a&&(Pe(typeof a=="string","internal-error",{appName:e}),d.refreshToken=a),c&&(Pe(typeof c=="string","internal-error",{appName:e}),d.accessToken=c),h&&(Pe(typeof h=="number","internal-error",{appName:e}),d.expirationTime=h),d}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Da,this.toJSON())}_performRefresh(){return Sn("not implemented")}}function Qn(i,e){Pe(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class Os{constructor({uid:e,auth:s,stsTokenManager:a,...c}){this.providerId="firebase",this.proactiveRefresh=new CE(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=s,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=c.displayName||null,this.email=c.email||null,this.emailVerified=c.emailVerified||!1,this.phoneNumber=c.phoneNumber||null,this.photoURL=c.photoURL||null,this.isAnonymous=c.isAnonymous||!1,this.tenantId=c.tenantId||null,this.providerData=c.providerData?[...c.providerData]:[],this.metadata=new wd(c.createdAt||void 0,c.lastLoginAt||void 0)}async getIdToken(e){const s=await Jl(this,this.stsTokenManager.getToken(this.auth,e));return Pe(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return TE(this,e)}reload(){return ME(this)}_assign(e){this!==e&&(Pe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>({...s})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new Os({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(e){Pe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),s&&await Qo(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ws(this.auth.app))return Promise.reject(Di(this.auth));const e=await this.getIdToken();return await Jl(this,EE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){const a=s.displayName??void 0,c=s.email??void 0,h=s.phoneNumber??void 0,d=s.photoURL??void 0,g=s.tenantId??void 0,p=s._redirectEventId??void 0,v=s.createdAt??void 0,x=s.lastLoginAt??void 0,{uid:y,emailVerified:b,isAnonymous:S,providerData:N,stsTokenManager:E}=s;Pe(y&&E,e,"internal-error");const R=Da.fromJSON(this.name,E);Pe(typeof y=="string",e,"internal-error"),Qn(a,e.name),Qn(c,e.name),Pe(typeof b=="boolean",e,"internal-error"),Pe(typeof S=="boolean",e,"internal-error"),Qn(h,e.name),Qn(d,e.name),Qn(g,e.name),Qn(p,e.name),Qn(v,e.name),Qn(x,e.name);const _=new Os({uid:y,auth:e,email:c,emailVerified:b,displayName:a,isAnonymous:S,photoURL:d,phoneNumber:h,tenantId:g,stsTokenManager:R,createdAt:v,lastLoginAt:x});return N&&Array.isArray(N)&&(_.providerData=N.map(F=>({...F}))),p&&(_._redirectEventId=p),_}static async _fromIdTokenResponse(e,s,a=!1){const c=new Da;c.updateFromServerResponse(s);const h=new Os({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a});return await Qo(h),h}static async _fromGetAccountInfoResponse(e,s,a){const c=s.users[0];Pe(c.localId!==void 0,"internal-error");const h=c.providerUserInfo!==void 0?G0(c.providerUserInfo):[],d=!(c.email&&c.passwordHash)&&!h?.length,g=new Da;g.updateFromIdToken(a);const p=new Os({uid:c.localId,auth:e,stsTokenManager:g,isAnonymous:d}),v={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:h,metadata:new wd(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!h?.length};return Object.assign(p,v),p}}const wy=new Map;function _n(i){Nn(i instanceof Function,"Expected a class definition");let e=wy.get(i);return e?(Nn(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,wy.set(i,e),e)}class Y0{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}Y0.type="NONE";const Sy=Y0;function Uo(i,e,s){return`firebase:${i}:${e}:${s}`}class Ra{constructor(e,s,a){this.persistence=e,this.auth=s,this.userKey=a;const{config:c,name:h}=this.auth;this.fullUserKey=Uo(this.userKey,c.apiKey,h),this.fullPersistenceKey=Uo("persistence",c.apiKey,h),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await Jo(this.auth,{idToken:e}).catch(()=>{});return s?Os._fromGetAccountInfoResponse(this.auth,s,e):null}return Os._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,a="authUser"){if(!s.length)return new Ra(_n(Sy),e,a);const c=(await Promise.all(s.map(async v=>{if(await v._isAvailable())return v}))).filter(v=>v);let h=c[0]||_n(Sy);const d=Uo(a,e.config.apiKey,e.name);let g=null;for(const v of s)try{const x=await v._get(d);if(x){let y;if(typeof x=="string"){const b=await Jo(e,{idToken:x}).catch(()=>{});if(!b)break;y=await Os._fromGetAccountInfoResponse(e,b,x)}else y=Os._fromJSON(e,x);v!==h&&(g=y),h=v;break}}catch{}const p=c.filter(v=>v._shouldAllowMigration);return!h._shouldAllowMigration||!p.length?new Ra(h,e,a):(h=p[0],g&&await h._set(d,g.toJSON()),await Promise.all(s.map(async v=>{if(v!==h)try{await v._remove(d)}catch{}})),new Ra(h,e,a))}}function _y(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Q0(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(K0(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(eb(e))return"Blackberry";if(tb(e))return"Webos";if(X0(e))return"Safari";if((e.includes("chrome/")||J0(e))&&!e.includes("edge/"))return"Chrome";if(Z0(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=i.match(s);if(a?.length===2)return a[1]}return"Other"}function K0(i=Qt()){return/firefox\//i.test(i)}function X0(i=Qt()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function J0(i=Qt()){return/crios\//i.test(i)}function Q0(i=Qt()){return/iemobile/i.test(i)}function Z0(i=Qt()){return/android/i.test(i)}function eb(i=Qt()){return/blackberry/i.test(i)}function tb(i=Qt()){return/webos/i.test(i)}function Wd(i=Qt()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function LE(i=Qt()){return Wd(i)&&!!window.navigator?.standalone}function OE(){return YN()&&document.documentMode===10}function sb(i=Qt()){return Wd(i)||Z0(i)||tb(i)||eb(i)||/windows phone/i.test(i)||Q0(i)}function nb(i,e=[]){let s;switch(i){case"Browser":s=_y(Qt());break;case"Worker":s=`${_y(Qt())}-${i}`;break;default:s=i}const a=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${lr}/${a}`}class zE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const a=h=>new Promise((d,g)=>{try{const p=e(h);d(p)}catch(p){g(p)}});a.onAbort=s,this.queue.push(a);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const a of this.queue)await a(e),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const c of s)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function IE(i,e={}){return Ba(i,"GET","/v2/passwordPolicy",qd(i,e))}const PE=6;class BE{constructor(e){const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??PE,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(e,s){const a=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=e.length>=a),c&&(s.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let c=0;c<e.length;c++)a=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,s,a,c,h){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=h))}}class $E{constructor(e,s,a,c){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jy(this),this.idTokenSubscription=new jy(this),this.beforeStateQueue=new zE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=H0,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion,this._persistenceManagerAvailable=new Promise(h=>this._resolvePersistenceManagerAvailable=h)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=_n(s)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Ra.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await Jo(this,{idToken:e}),a=await Os._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ws(this.app)){const h=this.app.settings.authIdToken;return h?new Promise(d=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(h).then(d,d))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let a=s,c=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const h=this.redirectUser?._redirectEventId,d=a?._redirectEventId,g=await this.tryRedirectSignIn(e);(!h||h===d)&&g?.user&&(a=g.user,c=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(c)try{await this.beforeStateQueue.runMiddleware(a)}catch(h){a=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(h))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Pe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await Qo(e)}catch(s){if(s?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xE()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ws(this.app))return Promise.reject(Di(this));const s=e?ri(e):null;return s&&Pe(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Pe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ws(this.app)?Promise.reject(Di(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ws(this.app)?Promise.reject(Di(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_n(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await IE(this),s=new BE(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ir("auth","Firebase",e())}onAuthStateChanged(e,s,a){return this.registerStateListener(this.authStateSubscription,e,s,a)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,a){return this.registerStateListener(this.idTokenSubscription,e,s,a)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await AE(this,a)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,s){const a=await this.getOrInitRedirectPersistenceManager(s);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&_n(e)||this._popupRedirectResolver;Pe(s,this,"argument-error"),this.redirectPersistenceManager=await Ra.create(this,[_n(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,a,c){if(this._deleted)return()=>{};const h=typeof s=="function"?s:s.next.bind(s);let d=!1;const g=this._isInitialized?Promise.resolve():this._initializationPromise;if(Pe(g,this,"internal-error"),g.then(()=>{d||h(this.currentUser)}),typeof s=="function"){const p=e.addObserver(s,a,c);return()=>{d=!0,p()}}else{const p=e.addObserver(s);return()=>{d=!0,p()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Pe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const s=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();s&&(e["X-Firebase-Client"]=s);const a=await this._getAppCheckToken();return a&&(e["X-Firebase-AppCheck"]=a),e}async _getAppCheckToken(){if(Ws(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&gE(`Error while retrieving App Check token: ${e.error}`),e?.token}}function uc(i){return ri(i)}class jy{constructor(e){this.auth=e,this.observer=null,this.addObserver=t2(s=>this.observer=s)}get next(){return Pe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Gd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function UE(i){Gd=i}function VE(i){return Gd.loadJS(i)}function HE(){return Gd.gapiScript}function qE(i){return`__${i}${Math.floor(Math.random()*1e6)}`}function FE(i,e){const s=P0(i,"auth");if(s.isInitialized()){const c=s.getImmediate(),h=s.getOptions();if(za(h,e??{}))return c;Ks(c,"already-initialized")}return s.initialize({options:e})}function WE(i,e){const s=e?.persistence||[],a=(Array.isArray(s)?s:[s]).map(_n);e?.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(a,e?.popupRedirectResolver)}function GE(i,e,s){const a=uc(i);Pe(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const c=!1,h=ib(e),{host:d,port:g}=YE(e),p=g===null?"":`:${g}`,v={url:`${h}//${d}${p}/`},x=Object.freeze({host:d,port:g,protocol:h.replace(":",""),options:Object.freeze({disableWarnings:c})});if(!a._canInitEmulator){Pe(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Pe(za(v,a.config.emulator)&&za(x,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=v,a.emulatorConfig=x,a.settings.appVerificationDisabledForTesting=!0,cc(d)?($N(`${h}//${d}${p}`),HN("Auth",!0)):KE()}function ib(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function YE(i){const e=ib(i),s=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(a);if(c){const h=c[1];return{host:h,port:Ny(a.substr(h.length+1))}}else{const[h,d]=a.split(":");return{host:h,port:Ny(d)}}}function Ny(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function KE(){function i(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class ab{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Sn("not implemented")}_getIdTokenResponse(e){return Sn("not implemented")}_linkToIdToken(e,s){return Sn("not implemented")}_getReauthenticationResolver(e){return Sn("not implemented")}}async function Aa(i,e){return jE(i,"POST","/v1/accounts:signInWithIdp",qd(i,e))}const XE="http://localhost";class zi extends ab{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new zi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):Ks("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:c,...h}=s;if(!a||!c)return null;const d=new zi(a,c);return d.idToken=h.idToken||void 0,d.accessToken=h.accessToken||void 0,d.secret=h.secret,d.nonce=h.nonce,d.pendingToken=h.pendingToken||null,d}_getIdTokenResponse(e){const s=this.buildRequest();return Aa(e,s)}_linkToIdToken(e,s){const a=this.buildRequest();return a.idToken=s,Aa(e,a)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,Aa(e,s)}buildRequest(){const e={requestUri:XE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=ar(s)}return e}}class Yd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class or extends Yd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zn extends or{constructor(){super("facebook.com")}static credential(e){return zi._fromParams({providerId:Zn.PROVIDER_ID,signInMethod:Zn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zn.credentialFromTaggedObject(e)}static credentialFromError(e){return Zn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zn.credential(e.oauthAccessToken)}catch{return null}}}Zn.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zn.PROVIDER_ID="facebook.com";class bn extends or{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return zi._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:a}=e;if(!s&&!a)return null;try{return bn.credential(s,a)}catch{return null}}}bn.GOOGLE_SIGN_IN_METHOD="google.com";bn.PROVIDER_ID="google.com";class ei extends or{constructor(){super("github.com")}static credential(e){return zi._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ei.credentialFromTaggedObject(e)}static credentialFromError(e){return ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ei.credential(e.oauthAccessToken)}catch{return null}}}ei.GITHUB_SIGN_IN_METHOD="github.com";ei.PROVIDER_ID="github.com";class ti extends or{constructor(){super("twitter.com")}static credential(e,s){return zi._fromParams({providerId:ti.PROVIDER_ID,signInMethod:ti.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return ti.credentialFromTaggedObject(e)}static credentialFromError(e){return ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=e;if(!s||!a)return null;try{return ti.credential(s,a)}catch{return null}}}ti.TWITTER_SIGN_IN_METHOD="twitter.com";ti.PROVIDER_ID="twitter.com";class Pa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,a,c=!1){const h=await Os._fromIdTokenResponse(e,a,c),d=Ey(a);return new Pa({user:h,providerId:d,_tokenResponse:a,operationType:s})}static async _forOperation(e,s,a){await e._updateTokensIfNecessary(a,!0);const c=Ey(a);return new Pa({user:e,providerId:c,_tokenResponse:a,operationType:s})}}function Ey(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}class Zo extends li{constructor(e,s,a,c){super(s.code,s.message),this.operationType=a,this.user=c,Object.setPrototypeOf(this,Zo.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,s,a,c){return new Zo(e,s,a,c)}}function lb(i,e,s,a){return(e==="reauthenticate"?s._getReauthenticationResolver(i):s._getIdTokenResponse(i)).catch(h=>{throw h.code==="auth/multi-factor-auth-required"?Zo._fromErrorAndOperation(i,h,e,a):h})}async function JE(i,e,s=!1){const a=await Jl(i,e._linkToIdToken(i.auth,await i.getIdToken()),s);return Pa._forOperation(i,"link",a)}async function QE(i,e,s=!1){const{auth:a}=i;if(Ws(a.app))return Promise.reject(Di(a));const c="reauthenticate";try{const h=await Jl(i,lb(a,c,e,i),s);Pe(h.idToken,a,"internal-error");const d=Fd(h.idToken);Pe(d,a,"internal-error");const{sub:g}=d;return Pe(i.uid===g,a,"user-mismatch"),Pa._forOperation(i,c,h)}catch(h){throw h?.code==="auth/user-not-found"&&Ks(a,"user-mismatch"),h}}async function ZE(i,e,s=!1){if(Ws(i.app))return Promise.reject(Di(i));const a="signIn",c=await lb(i,a,e),h=await Pa._fromIdTokenResponse(i,a,c);return s||await i._updateCurrentUser(h.user),h}function eT(i,e,s,a){return ri(i).onIdTokenChanged(e,s,a)}function tT(i,e,s){return ri(i).beforeAuthStateChanged(e,s)}function sT(i,e,s,a){return ri(i).onAuthStateChanged(e,s,a)}function nT(i){return ri(i).signOut()}const ec="__sak";class rb{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(ec,"1"),this.storage.removeItem(ec),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const iT=1e3,aT=10;class ob extends rb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sb(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),c=this.localCache[s];a!==c&&e(s,c,a)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((d,g,p)=>{this.notifyListeners(d,p)});return}const a=e.key;s?this.detachListener():this.stopPolling();const c=()=>{const d=this.storage.getItem(a);!s&&this.localCache[a]===d||this.notifyListeners(a,d)},h=this.storage.getItem(a);OE()&&h!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,aT):c()}notifyListeners(e,s){this.localCache[e]=s;const a=this.listeners[e];if(a)for(const c of Array.from(a))c(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:a}),!0)})},iT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}ob.type="LOCAL";const lT=ob;class cb extends rb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}cb.type="SESSION";const ub=cb;function rT(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}class hc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(c=>c.isListeningto(e));if(s)return s;const a=new hc(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:a,eventType:c,data:h}=s.data,d=this.handlersMap[c];if(!d?.size)return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:c});const g=Array.from(d).map(async v=>v(s.origin,h)),p=await rT(g);s.ports[0].postMessage({status:"done",eventId:a,eventType:c,response:p})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hc.receivers=[];function Kd(i="",e=10){let s="";for(let a=0;a<e;a++)s+=Math.floor(Math.random()*10);return i+s}class oT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,a=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let h,d;return new Promise((g,p)=>{const v=Kd("",20);c.port1.start();const x=setTimeout(()=>{p(new Error("unsupported_event"))},a);d={messageChannel:c,onMessage(y){const b=y;if(b.data.eventId===v)switch(b.data.status){case"ack":clearTimeout(x),h=setTimeout(()=>{p(new Error("timeout"))},3e3);break;case"done":clearTimeout(h),g(b.data.response);break;default:clearTimeout(x),clearTimeout(h),p(new Error("invalid_response"));break}}},this.handlers.add(d),c.port1.addEventListener("message",d.onMessage),this.target.postMessage({eventType:e,eventId:v,data:s},[c.port2])}).finally(()=>{d&&this.removeMessageHandler(d)})}}function Ys(){return window}function cT(i){Ys().location.href=i}function hb(){return typeof Ys().WorkerGlobalScope<"u"&&typeof Ys().importScripts=="function"}async function uT(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hT(){return navigator?.serviceWorker?.controller||null}function dT(){return hb()?self:null}const db="firebaseLocalStorageDb",fT=1,tc="firebaseLocalStorage",fb="fbase_key";class cr{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function dc(i,e){return i.transaction([tc],e?"readwrite":"readonly").objectStore(tc)}function mT(){const i=indexedDB.deleteDatabase(db);return new cr(i).toPromise()}function Sd(){const i=indexedDB.open(db,fT);return new Promise((e,s)=>{i.addEventListener("error",()=>{s(i.error)}),i.addEventListener("upgradeneeded",()=>{const a=i.result;try{a.createObjectStore(tc,{keyPath:fb})}catch(c){s(c)}}),i.addEventListener("success",async()=>{const a=i.result;a.objectStoreNames.contains(tc)?e(a):(a.close(),await mT(),e(await Sd()))})})}async function Ty(i,e,s){const a=dc(i,!0).put({[fb]:e,value:s});return new cr(a).toPromise()}async function pT(i,e){const s=dc(i,!1).get(e),a=await new cr(s).toPromise();return a===void 0?null:a.value}function ky(i,e){const s=dc(i,!0).delete(e);return new cr(s).toPromise()}const gT=800,vT=3;class mb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Sd(),this.db)}async _withRetries(e){let s=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(s++>vT)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hc._getInstance(dT()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await uT(),!this.activeServiceWorker)return;this.sender=new oT(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Sd();return await Ty(e,ec,"1"),await ky(e,ec),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>Ty(a,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(a=>pT(a,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>ky(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const h=dc(c,!1).getAll();return new cr(h).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(e.length!==0)for(const{fbase_key:c,value:h}of e)a.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(h)&&(this.notifyListeners(c,h),s.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!a.has(c)&&(this.notifyListeners(c,null),s.push(c));return s}notifyListeners(e,s){this.localCache[e]=s;const a=this.listeners[e];if(a)for(const c of Array.from(a))c(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mb.type="LOCAL";const yT=mb;new rr(3e4,6e4);function pb(i,e){return e?_n(e):(Pe(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class Xd extends ab{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Aa(e,this._buildIdpRequest())}_linkToIdToken(e,s){return Aa(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return Aa(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function bT(i){return ZE(i.auth,new Xd(i),i.bypassAuthState)}function xT(i){const{auth:e,user:s}=i;return Pe(s,e,"internal-error"),QE(s,new Xd(i),i.bypassAuthState)}async function wT(i){const{auth:e,user:s}=i;return Pe(s,e,"internal-error"),JE(s,new Xd(i),i.bypassAuthState)}class gb{constructor(e,s,a,c,h=!1){this.auth=e,this.resolver=a,this.user=c,this.bypassAuthState=h,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:a,postBody:c,tenantId:h,error:d,type:g}=e;if(d){this.reject(d);return}const p={auth:this.auth,requestUri:s,sessionId:a,tenantId:h||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(g)(p))}catch(v){this.reject(v)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bT;case"linkViaPopup":case"linkViaRedirect":return wT;case"reauthViaPopup":case"reauthViaRedirect":return xT;default:Ks(this.auth,"internal-error")}}resolve(e){Nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ST=new rr(2e3,1e4);async function _T(i,e,s){if(Ws(i.app))return Promise.reject(zs(i,"operation-not-supported-in-this-environment"));const a=uc(i);vE(i,e,Yd);const c=pb(a,s);return new Ci(a,"signInViaPopup",e,c).executeNotNull()}class Ci extends gb{constructor(e,s,a,c,h){super(e,s,c,h),this.provider=a,this.authWindow=null,this.pollId=null,Ci.currentPopupAction&&Ci.currentPopupAction.cancel(),Ci.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Pe(e,this.auth,"internal-error"),e}async onExecution(){Nn(this.filter.length===1,"Popup operations only handle one event");const e=Kd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(zs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(zs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ci.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ST.get())};e()}}Ci.currentPopupAction=null;const jT="pendingRedirect",Vo=new Map;class NT extends gb{constructor(e,s,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let e=Vo.get(this.auth._key());if(!e){try{const a=await ET(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(s){e=()=>Promise.reject(s)}Vo.set(this.auth._key(),e)}return this.bypassAuthState||Vo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ET(i,e){const s=CT(e),a=kT(i);if(!await a._isAvailable())return!1;const c=await a._get(s)==="true";return await a._remove(s),c}function TT(i,e){Vo.set(i._key(),e)}function kT(i){return _n(i._redirectPersistence)}function CT(i){return Uo(jT,i.config.apiKey,i.name)}async function MT(i,e,s=!1){if(Ws(i.app))return Promise.reject(Di(i));const a=uc(i),c=pb(a,e),d=await new NT(a,c,s).execute();return d&&!s&&(delete d.user._redirectEventId,await a._persistUserIfCurrent(d.user),await a._setRedirectUser(null,e)),d}const DT=600*1e3;class RT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(s=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!AT(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){if(e.error&&!vb(e)){const a=e.error.code?.split("auth/")[1]||"internal-error";s.onError(zs(this.auth,a))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const a=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DT&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cy(e))}saveEventToCache(e){this.cachedEventUids.add(Cy(e)),this.lastProcessedEventTime=Date.now()}}function Cy(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function vb({type:i,error:e}){return i==="unknown"&&e?.code==="auth/no-auth-event"}function AT(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vb(i);default:return!1}}async function LT(i,e={}){return Ba(i,"GET","/v1/projects",e)}const OT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zT=/^https?/;async function IT(i){if(i.config.emulator)return;const{authorizedDomains:e}=await LT(i);for(const s of e)try{if(PT(s))return}catch{}Ks(i,"unauthorized-domain")}function PT(i){const e=xd(),{protocol:s,hostname:a}=new URL(e);if(i.startsWith("chrome-extension://")){const d=new URL(i);return d.hostname===""&&a===""?s==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&d.hostname===a}if(!zT.test(s))return!1;if(OT.test(i))return a===i;const c=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(a)}const BT=new rr(3e4,6e4);function My(){const i=Ys().___jsl;if(i?.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let s=0;s<i.CP.length;s++)i.CP[s]=null}}function $T(i){return new Promise((e,s)=>{function a(){My(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{My(),s(zs(i,"network-request-failed"))},timeout:BT.get()})}if(Ys().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ys().gapi?.load)a();else{const c=qE("iframefcb");return Ys()[c]=()=>{gapi.load?a():s(zs(i,"network-request-failed"))},VE(`${HE()}?onload=${c}`).catch(h=>s(h))}}).catch(e=>{throw Ho=null,e})}let Ho=null;function UT(i){return Ho=Ho||$T(i),Ho}const VT=new rr(5e3,15e3),HT="__/auth/iframe",qT="emulator/auth/iframe",FT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},WT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function GT(i){const e=i.config;Pe(e.authDomain,i,"auth-domain-config-required");const s=e.emulator?Hd(e,qT):`https://${i.config.authDomain}/${HT}`,a={apiKey:e.apiKey,appName:i.name,v:lr},c=WT.get(i.config.apiHost);c&&(a.eid=c);const h=i._getFrameworks();return h.length&&(a.fw=h.join(",")),`${s}?${ar(a).slice(1)}`}async function YT(i){const e=await UT(i),s=Ys().gapi;return Pe(s,i,"internal-error"),e.open({where:document.body,url:GT(i),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:FT,dontclear:!0},a=>new Promise(async(c,h)=>{await a.restyle({setHideOnLeave:!1});const d=zs(i,"network-request-failed"),g=Ys().setTimeout(()=>{h(d)},VT.get());function p(){Ys().clearTimeout(g),c(a)}a.ping(p).then(p,()=>{h(d)})}))}const KT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},XT=500,JT=600,QT="_blank",ZT="http://localhost";class Dy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ek(i,e,s,a=XT,c=JT){const h=Math.max((window.screen.availHeight-c)/2,0).toString(),d=Math.max((window.screen.availWidth-a)/2,0).toString();let g="";const p={...KT,width:a.toString(),height:c.toString(),top:h,left:d},v=Qt().toLowerCase();s&&(g=J0(v)?QT:s),K0(v)&&(e=e||ZT,p.scrollbars="yes");const x=Object.entries(p).reduce((b,[S,N])=>`${b}${S}=${N},`,"");if(LE(v)&&g!=="_self")return tk(e||"",g),new Dy(null);const y=window.open(e||"",g,x);Pe(y,i,"popup-blocked");try{y.focus()}catch{}return new Dy(y)}function tk(i,e){const s=document.createElement("a");s.href=i,s.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}const sk="__/auth/handler",nk="emulator/auth/handler",ik=encodeURIComponent("fac");async function Ry(i,e,s,a,c,h){Pe(i.config.authDomain,i,"auth-domain-config-required"),Pe(i.config.apiKey,i,"invalid-api-key");const d={apiKey:i.config.apiKey,appName:i.name,authType:s,redirectUrl:a,v:lr,eventId:c};if(e instanceof Yd){e.setDefaultLanguage(i.languageCode),d.providerId=e.providerId||"",e2(e.getCustomParameters())||(d.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,y]of Object.entries({}))d[x]=y}if(e instanceof or){const x=e.getScopes().filter(y=>y!=="");x.length>0&&(d.scopes=x.join(","))}i.tenantId&&(d.tid=i.tenantId);const g=d;for(const x of Object.keys(g))g[x]===void 0&&delete g[x];const p=await i._getAppCheckToken(),v=p?`#${ik}=${encodeURIComponent(p)}`:"";return`${ak(i)}?${ar(g).slice(1)}${v}`}function ak({config:i}){return i.emulator?Hd(i,nk):`https://${i.authDomain}/${sk}`}const id="webStorageSupport";class lk{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ub,this._completeRedirectFn=MT,this._overrideRedirectResult=TT}async _openPopup(e,s,a,c){Nn(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const h=await Ry(e,s,a,xd(),c);return ek(e,h,Kd())}async _openRedirect(e,s,a,c){await this._originValidation(e);const h=await Ry(e,s,a,xd(),c);return cT(h),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:c,promise:h}=this.eventManagers[s];return c?Promise.resolve(c):(Nn(h,"If manager is not set, promise should be"),h)}const a=this.initAndGetManager(e);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(e){const s=await YT(e),a=new RT(e);return s.register("authEvent",c=>(Pe(c?.authEvent,e,"invalid-auth-event"),{status:a.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=s,a}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(id,{type:id},c=>{const h=c?.[0]?.[id];h!==void 0&&s(!!h),Ks(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=IT(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return sb()||X0()||Wd()}}const rk=lk;var Ay="@firebase/auth",Ly="1.12.0";class ok{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(a=>{e(a?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Pe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ck(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function uk(i){Kl(new Ia("auth",(e,{options:s})=>{const a=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),h=e.getProvider("app-check-internal"),{apiKey:d,authDomain:g}=a.options;Pe(d&&!d.includes(":"),"invalid-api-key",{appName:a.name});const p={apiKey:d,authDomain:g,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nb(i)},v=new $E(a,c,h,p);return WE(v,s),v},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,a)=>{e.getProvider("auth-internal").initialize()})),Kl(new Ia("auth-internal",e=>{const s=uc(e.getProvider("auth").getImmediate());return(a=>new ok(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ma(Ay,Ly,ck(i)),Ma(Ay,Ly,"esm2020")}const hk=300,dk=L0("authIdTokenMaxAge")||hk;let Oy=null;const fk=i=>async e=>{const s=e&&await e.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>dk)return;const c=s?.token;Oy!==c&&(Oy=c,await fetch(i,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function mk(i=sE()){const e=P0(i,"auth");if(e.isInitialized())return e.getImmediate();const s=FE(i,{popupRedirectResolver:rk,persistence:[yT,lT,ub]}),a=L0("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const h=new URL(a,location.origin);if(location.origin===h.origin){const d=fk(h.toString());tT(s,d,()=>d(s.currentUser)),eT(s,g=>d(g))}}const c=PN("auth");return c&&GE(s,`http://${c}`),s}function pk(){return document.getElementsByTagName("head")?.[0]??document}UE({loadJS(i){return new Promise((e,s)=>{const a=document.createElement("script");a.setAttribute("src",i),a.onload=e,a.onerror=c=>{const h=zs("internal-error");h.customData=c,s(h)},a.type="text/javascript",a.charset="UTF-8",pk().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});uk("Browser");const gk={apiKey:"AIzaSyAhIJaE5znNp8X3_ZWsuK1RWn1PpMQY1Rw",authDomain:"flowtrade210.firebaseapp.com",projectId:"flowtrade210",storageBucket:"flowtrade210.firebasestorage.app",messagingSenderId:"924867520326",appId:"1:924867520326:web:fcf9cf14fc1649c5f6e747"},vk=B0(gk),_d=mk(vk),yb=new bn;yb.setCustomParameters({prompt:"select_account"});const yk=({user:i})=>{const e=async()=>{try{await _T(_d,yb)}catch(a){console.error("Sign-in error",a),alert("Sign-in failed: "+(a.message||a))}},s=async()=>{try{await nT(_d)}catch(a){console.error("Sign-out error",a)}};return l.jsx("div",{style:{padding:20,textAlign:"center"},children:i?l.jsxs("div",{children:[l.jsxs("p",{children:["Signed in as ",l.jsx("strong",{children:i.displayName||i.email})]}),l.jsx("button",{onClick:s,style:{padding:"6px 12px"},children:"Sign out"})]}):l.jsxs("div",{children:[l.jsx("h2",{children:"Sign in to FlowGrid"}),l.jsx("button",{onClick:e,style:{padding:"8px 16px",fontSize:16},children:"Sign in with Google"}),l.jsx("p",{style:{marginTop:12,opacity:.9},children:"You must sign in with Google to use this app."})]})})},bk=()=>{const e=(typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams("")).get("route")||"home",[s,a]=D.useState(e),[c,h]=D.useState(null),[d,g]=D.useState(!0),p=v=>a(v);return D.useEffect(()=>{const v=sT(_d,x=>{h(x),g(!1)});return()=>v()},[]),d?l.jsx("div",{style:{padding:40,textAlign:"center"},children:"Loading authentication..."}):c?l.jsxs(Ql.StrictMode,{children:[l.jsx("div",{style:{display:s==="builder"?"block":"none"},children:l.jsx(aw,{onNavigate:p})}),s==="home"&&l.jsx(qj,{onNavigate:p}),s==="backtest"&&l.jsx(hj,{onNavigate:p}),s==="analytics"&&l.jsx(xN,{onNavigate:p}),s==="account"&&l.jsx(SN,{onNavigate:p}),s==="settings"&&l.jsx(CN,{onNavigate:p}),s==="billing"&&l.jsx("div",{style:{padding:24},children:"Billing / Subscription (placeholder)"}),s==="help"&&l.jsx("div",{style:{padding:24},children:"Help / Documentation (placeholder)"})]}):l.jsx(yk,{user:null})},xk=P1.createRoot(document.getElementById("root"));xk.render(l.jsx(bk,{}));
